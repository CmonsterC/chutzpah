/**
 * TypeScript Compiler v0.8.1.1
 * http://typescriptlang.org
 *
 */

/* *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved. 
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0  
 
THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE, 
MERCHANTABLITY OR NON-INFRINGEMENT. 
 
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

var TypeScript;(function(e){function t(e,t){return(e&t)!=0}function h(e){return e}function g(e,t){var n="";for(var r=1;r<1<<31;r=r<<1){if((t&r)!=0){for(var i in e){if(e[i]==r){if(n.length>0){n+="|"}n+=i;break}}}}return n}e.hasFlag=t;(function(e){e._map=[];e.None=0;e.Comma=1;e.SColon=1<<1;e.Asg=1<<2;e.BinOp=1<<3;e.RBrack=1<<4;e.RCurly=1<<5;e.RParen=1<<6;e.Dot=1<<7;e.Colon=1<<8;e.PrimType=1<<9;e.AddOp=1<<10;e.LCurly=1<<11;e.PreOp=1<<12;e.RegExp=1<<13;e.LParen=1<<14;e.LBrack=1<<15;e.Scope=1<<16;e.In=1<<17;e.SCase=1<<18;e.Else=1<<19;e.Catch=1<<20;e.Var=1<<21;e.Stmt=1<<22;e.While=1<<23;e.ID=1<<24;e.Prefix=1<<25;e.Literal=1<<26;e.RLit=1<<27;e.Func=1<<28;e.EOF=1<<29;e.TypeScriptS=1<<30;e.ExprStart=e.SColon|e.AddOp|e.LCurly|e.PreOp|e.RegExp|e.LParen|e.LBrack|e.ID|e.Prefix|e.RLit|e.Func|e.Literal;e.StmtStart=e.ExprStart|e.SColon|e.Var|e.Stmt|e.While|e.TypeScriptS;e.Postfix=e.Dot|e.LParen|e.LBrack})(e.ErrorRecoverySet||(e.ErrorRecoverySet={}));var n=e.ErrorRecoverySet;(function(e){e._map=[];e.None=0;e.ModuleDeclarations=1<<2;e.ClassDeclarations=1<<3;e.InterfaceDeclarations=1<<4;e.AmbientDeclarations=1<<10;e.Properties=1<<11;e.Global=e.ModuleDeclarations|e.ClassDeclarations|e.InterfaceDeclarations|e.AmbientDeclarations;e.QuickParse=e.Global|e.Properties})(e.AllowedElements||(e.AllowedElements={}));var r=e.AllowedElements;(function(e){e._map=[];e.None=0;e.Private=1;e.Public=1<<1;e.Readonly=1<<2;e.Ambient=1<<3;e.Exported=1<<4;e.Getter=1<<5;e.Setter=1<<6;e.Static=1<<7})(e.Modifiers||(e.Modifiers={}));var i=e.Modifiers;(function(e){e._map=[];e.None=0;e.ExplicitSemicolon=1;e.AutomaticSemicolon=1<<1;e.Writeable=1<<2;e.Error=1<<3;e.DotLHSPartial=1<<4;e.DotLHS=1<<5;e.IsStatement=1<<6;e.StrictMode=1<<7;e.PossibleOptionalParameter=1<<8;e.ClassBaseConstructorCall=1<<9;e.OptionalName=1<<10;e.SkipNextRParen=1<<11})(e.ASTFlags||(e.ASTFlags={}));var s=e.ASTFlags;(function(e){e._map=[];e.None=0;e.Exported=1;e.Private=1<<1;e.Public=1<<2;e.Ambient=1<<3;e.Static=1<<4;e.LocalStatic=1<<5;e.GetAccessor=1<<6;e.SetAccessor=1<<7})(e.DeclFlags||(e.DeclFlags={}));var o=e.DeclFlags;(function(e){e._map=[];e.None=0;e.Exported=1;e.Private=1<<1;e.Public=1<<2;e.Ambient=1<<3;e.Static=1<<4;e.LocalStatic=1<<5;e.GetAccessor=1<<6;e.SetAccessor=1<<7;e.IsEnum=1<<8;e.ShouldEmitModuleDecl=1<<9;e.IsWholeFile=1<<10;e.IsDynamic=1<<11;e.MustCaptureThis=1<<12})(e.ModuleFlags||(e.ModuleFlags={}));var u=e.ModuleFlags;(function(e){e._map=[];e.None=0;e.Exported=1;e.Private=1<<1;e.Public=1<<2;e.Ambient=1<<3;e.Static=1<<4;e.LocalStatic=1<<5;e.GetAccessor=1<<6;e.SetAccessor=1<<7;e.Property=1<<8;e.Readonly=1<<9;e.ModuleMember=1<<10;e.InterfaceMember=1<<11;e.ClassMember=1<<12;e.BuiltIn=1<<13;e.TypeSetDuringScopeAssignment=1<<14;e.Constant=1<<15;e.Optional=1<<16;e.RecursivelyReferenced=1<<17;e.Bound=1<<18;e.CompilerGenerated=1<<19})(e.SymbolFlags||(e.SymbolFlags={}));var a=e.SymbolFlags;(function(e){e._map=[];e.None=0;e.Exported=1;e.Private=1<<1;e.Public=1<<2;e.Ambient=1<<3;e.Static=1<<4;e.LocalStatic=1<<5;e.GetAccessor=1<<6;e.SetAccessor=1<<7;e.AutoInit=1<<8;e.Property=1<<9;e.Readonly=1<<10;e.Class=1<<11;e.ClassProperty=1<<12;e.ClassBodyProperty=1<<13;e.ClassConstructorProperty=1<<14;e.ClassSuperMustBeFirstCallInConstructor=1<<15;e.Constant=1<<16;e.MustCaptureThis=1<<17})(e.VarFlags||(e.VarFlags={}));var f=e.VarFlags;(function(e){e._map=[];e.None=0;e.Exported=1;e.Private=1<<1;e.Public=1<<2;e.Ambient=1<<3;e.Static=1<<4;e.LocalStatic=1<<5;e.GetAccessor=1<<6;e.SetAccessor=1<<7;e.Definition=1<<8;e.Signature=1<<9;e.Method=1<<10;e.HasReturnExpression=1<<11;e.CallMember=1<<12;e.ConstructMember=1<<13;e.HasSelfReference=1<<14;e.IsFatArrowFunction=1<<15;e.IndexerMember=1<<16;e.IsFunctionExpression=1<<17;e.ClassMethod=1<<18;e.ClassPropertyMethodExported=1<<19})(e.FncFlags||(e.FncFlags={}));var l=e.FncFlags;(function(e){e._map=[];e.None=0;e.IsIndexer=1;e.IsStringIndexer=1<<1;e.IsNumberIndexer=1<<2})(e.SignatureFlags||(e.SignatureFlags={}));var c=e.SignatureFlags;e.ToDeclFlags=h;(function(e){e._map=[];e.None=0;e.HasImplementation=1;e.HasSelfReference=1<<1;e.MergeResult=1<<2;e.IsEnum=1<<3;e.BuildingName=1<<4;e.HasBaseType=1<<5;e.HasBaseTypeOfObject=1<<6;e.IsClass=1<<7})(e.TypeFlags||(e.TypeFlags={}));var p=e.TypeFlags;(function(e){e._map=[];e.SuccessfulComparison=0;e.SourceIsNullTargetIsVoidOrUndefined=1;e.RequiredPropertyIsMissing=1<<1;e.IncompatibleSignatures=1<<2;e.SourceSignatureHasTooManyParameters=3;e.IncompatibleReturnTypes=1<<4;e.IncompatiblePropertyTypes=1<<5;e.IncompatibleParameterTypes=1<<6})(e.TypeRelationshipFlags||(e.TypeRelationshipFlags={}));var d=e.TypeRelationshipFlags;(function(e){e._map=[];e.ES3=0;e.ES5=1})(e.CodeGenTarget||(e.CodeGenTarget={}));var v=e.CodeGenTarget;(function(e){e._map=[];e.Synchronous=0;e.Asynchronous=1;e.Local=1<<1})(e.ModuleGenTarget||(e.ModuleGenTarget={}));var m=e.ModuleGenTarget;e.codeGenTarget=v.ES3;e.moduleGenTarget=m.Synchronous;e.optimizeModuleCodeGen=true;e.flagsToString=g})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[];e._map[0]="None";e.None=0;e._map[1]="Empty";e.Empty=1;e._map[2]="EmptyExpr";e.EmptyExpr=2;e._map[3]="True";e.True=3;e._map[4]="False";e.False=4;e._map[5]="This";e.This=5;e._map[6]="Super";e.Super=6;e._map[7]="QString";e.QString=7;e._map[8]="Regex";e.Regex=8;e._map[9]="Null";e.Null=9;e._map[10]="ArrayLit";e.ArrayLit=10;e._map[11]="ObjectLit";e.ObjectLit=11;e._map[12]="Void";e.Void=12;e._map[13]="Comma";e.Comma=13;e._map[14]="Pos";e.Pos=14;e._map[15]="Neg";e.Neg=15;e._map[16]="Delete";e.Delete=16;e._map[17]="Await";e.Await=17;e._map[18]="In";e.In=18;e._map[19]="Dot";e.Dot=19;e._map[20]="From";e.From=20;e._map[21]="Is";e.Is=21;e._map[22]="InstOf";e.InstOf=22;e._map[23]="Typeof";e.Typeof=23;e._map[24]="NumberLit";e.NumberLit=24;e._map[25]="Name";e.Name=25;e._map[26]="TypeRef";e.TypeRef=26;e._map[27]="Index";e.Index=27;e._map[28]="Call";e.Call=28;e._map[29]="New";e.New=29;e._map[30]="Asg";e.Asg=30;e._map[31]="AsgAdd";e.AsgAdd=31;e._map[32]="AsgSub";e.AsgSub=32;e._map[33]="AsgDiv";e.AsgDiv=33;e._map[34]="AsgMul";e.AsgMul=34;e._map[35]="AsgMod";e.AsgMod=35;e._map[36]="AsgAnd";e.AsgAnd=36;e._map[37]="AsgXor";e.AsgXor=37;e._map[38]="AsgOr";e.AsgOr=38;e._map[39]="AsgLsh";e.AsgLsh=39;e._map[40]="AsgRsh";e.AsgRsh=40;e._map[41]="AsgRs2";e.AsgRs2=41;e._map[42]="ConditionalExpression";e.ConditionalExpression=42;e._map[43]="LogOr";e.LogOr=43;e._map[44]="LogAnd";e.LogAnd=44;e._map[45]="Or";e.Or=45;e._map[46]="Xor";e.Xor=46;e._map[47]="And";e.And=47;e._map[48]="Eq";e.Eq=48;e._map[49]="Ne";e.Ne=49;e._map[50]="Eqv";e.Eqv=50;e._map[51]="NEqv";e.NEqv=51;e._map[52]="Lt";e.Lt=52;e._map[53]="Le";e.Le=53;e._map[54]="Gt";e.Gt=54;e._map[55]="Ge";e.Ge=55;e._map[56]="Add";e.Add=56;e._map[57]="Sub";e.Sub=57;e._map[58]="Mul";e.Mul=58;e._map[59]="Div";e.Div=59;e._map[60]="Mod";e.Mod=60;e._map[61]="Lsh";e.Lsh=61;e._map[62]="Rsh";e.Rsh=62;e._map[63]="Rs2";e.Rs2=63;e._map[64]="Not";e.Not=64;e._map[65]="LogNot";e.LogNot=65;e._map[66]="IncPre";e.IncPre=66;e._map[67]="DecPre";e.DecPre=67;e._map[68]="IncPost";e.IncPost=68;e._map[69]="DecPost";e.DecPost=69;e._map[70]="TypeAssertion";e.TypeAssertion=70;e._map[71]="FuncDecl";e.FuncDecl=71;e._map[72]="Member";e.Member=72;e._map[73]="VarDecl";e.VarDecl=73;e._map[74]="ArgDecl";e.ArgDecl=74;e._map[75]="Return";e.Return=75;e._map[76]="Break";e.Break=76;e._map[77]="Continue";e.Continue=77;e._map[78]="Throw";e.Throw=78;e._map[79]="For";e.For=79;e._map[80]="ForIn";e.ForIn=80;e._map[81]="If";e.If=81;e._map[82]="While";e.While=82;e._map[83]="DoWhile";e.DoWhile=83;e._map[84]="Block";e.Block=84;e._map[85]="Case";e.Case=85;e._map[86]="Switch";e.Switch=86;e._map[87]="Try";e.Try=87;e._map[88]="TryCatch";e.TryCatch=88;e._map[89]="TryFinally";e.TryFinally=89;e._map[90]="Finally";e.Finally=90;e._map[91]="Catch";e.Catch=91;e._map[92]="List";e.List=92;e._map[93]="Script";e.Script=93;e._map[94]="ClassDeclaration";e.ClassDeclaration=94;e._map[95]="InterfaceDeclaration";e.InterfaceDeclaration=95;e._map[96]="ModuleDeclaration";e.ModuleDeclaration=96;e._map[97]="ImportDeclaration";e.ImportDeclaration=97;e._map[98]="With";e.With=98;e._map[99]="Label";e.Label=99;e._map[100]="LabeledStatement";e.LabeledStatement=100;e._map[101]="EBStart";e.EBStart=101;e._map[102]="GotoEB";e.GotoEB=102;e._map[103]="EndCode";e.EndCode=103;e._map[104]="Error";e.Error=104;e._map[105]="Comment";e.Comment=105;e._map[106]="Debugger";e.Debugger=106;e.GeneralNode=e.FuncDecl;e.LastAsg=e.AsgRs2})(e.NodeType||(e.NodeType={}));var t=e.NodeType})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(e){var t=668265261;e=e^61^e>>>16;e=e+(e<<3);e=e^e>>>4;e=e*t;e=e^e>>>15;return e}function s(e,t){return t^(e>>5)+e}var t=function(){function e(){this.prototype=undefined;this.toString=undefined;this.toLocaleString=undefined;this.valueOf=undefined;this.hasOwnProperty=undefined;this.propertyIsEnumerable=undefined;this.isPrototypeOf=undefined;this["constructor"]=undefined}return e}();e.BlockIntrinsics=t;var n=function(){function e(){this.itemCount=0;this.table=new t}e.prototype.getAllKeys=function(){var e=[];for(var t in this.table){if(this.table[t]!=undefined){e[e.length]=t}}return e};e.prototype.add=function(e,t){if(this.table[e]!=undefined){return false}this.table[e]=t;this.itemCount++;return true};e.prototype.addOrUpdate=function(e,t){if(this.table[e]!=undefined){this.table[e]=t;return false}this.table[e]=t;this.itemCount++;return true};e.prototype.map=function(e,t){for(var n in this.table){var r=this.table[n];if(r!=undefined){e(n,this.table[n],t)}}};e.prototype.every=function(e,t){for(var n in this.table){var r=this.table[n];if(r!=undefined){if(!e(n,this.table[n],t)){return false}}}return true};e.prototype.some=function(e,t){for(var n in this.table){var r=this.table[n];if(r!=undefined){if(e(n,this.table[n],t)){return true}}}return false};e.prototype.count=function(){return this.itemCount};e.prototype.lookup=function(e){var t=this.table[e];if(t!=undefined){return t}else{return null}};return e}();e.StringHashTable=n;var r=function(){function e(e,t){this.primaryTable=e;this.secondaryTable=t;this.insertPrimary=true}e.prototype.getAllKeys=function(){return this.primaryTable.getAllKeys().concat(this.secondaryTable.getAllKeys())};e.prototype.add=function(e,t){if(this.insertPrimary){return this.primaryTable.add(e,t)}else{return this.secondaryTable.add(e,t)}};e.prototype.addOrUpdate=function(e,t){if(this.insertPrimary){return this.primaryTable.addOrUpdate(e,t)}else{return this.secondaryTable.addOrUpdate(e,t)}};e.prototype.map=function(e,t){this.primaryTable.map(e,t);this.secondaryTable.map(e,t)};e.prototype.every=function(e,t){return this.primaryTable.every(e,t)&&this.secondaryTable.every(e,t)};e.prototype.some=function(e,t){return this.primaryTable.some(e,t)||this.secondaryTable.some(e,t)};e.prototype.count=function(){return this.primaryTable.count()+this.secondaryTable.count()};e.prototype.lookup=function(e){var t=this.primaryTable.lookup(e);if(t!=undefined){return t}else{return this.secondaryTable.lookup(e)}};return e}();e.DualStringHashTable=r;e.numberHashFn=i;e.combineHashes=s;var o=function(){function e(e,t){this.key=e;this.data=t}return e}();e.HashEntry=o;var u=function(){function e(e,t,n){this.size=e;this.hashFn=t;this.equalsFn=n;this.itemCount=0;this.table=new Array;for(var r=0;r<this.size;r++){this.table[r]=null}}e.prototype.add=function(e,t){var n;var r=new o(e,t);var i=this.hashFn(e);i=i%this.size;for(n=this.table[i];n!=null;n=n.next){if(this.equalsFn(e,n.key)){return false}}r.next=this.table[i];this.table[i]=r;this.itemCount++;return true};e.prototype.remove=function(e){var t;var n=this.hashFn(e);n=n%this.size;var r=null;var i=null;for(t=this.table[n];t!=null;t=t.next){if(this.equalsFn(e,t.key)){r=t.data;this.itemCount--;if(i){i.next=t.next}else{this.table[n]=t.next}break}i=t}return r};e.prototype.count=function(){return this.itemCount};e.prototype.lookup=function(e){var t;var n=this.hashFn(e);n=n%this.size;for(t=this.table[n];t!=null;t=t.next){if(this.equalsFn(e,t.key)){return t.data}}return null};return e}();e.HashTable=u;var a=function(){function e(){this.keys=[];this.values=[]}e.prototype.lookup=function(e,t){var n=this.keys;if(t){n=this.values}for(var r=0;r<n.length;r++){if(n[r]==e){return{key:this.keys[r],data:this.values[r]}}}return null};e.prototype.add=function(e,t){var n=this.lookup(e);if(n){return false}this.keys[this.keys.length]=e;this.values[this.values.length]=t;return true};return e}();e.SimpleHashTable=a})(TypeScript||(TypeScript={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype;e.prototype=new n};var TypeScript;(function(e){var t=function(){function e(){this.minChar=-1;this.limChar=-1}return e}();e.ASTSpan=t;var n=function(t){function n(n){t.call(this);this.nodeType=n;this.type=null;this.flags=e.ASTFlags.Writeable;this.passCreated=e.CompilerDiagnostics.analysisPass;this.preComments=null;this.postComments=null;this.isParenthesized=false}__extends(n,t);n.prototype.isExpression=function(){return false};n.prototype.isStatementOrExpression=function(){return false};n.prototype.isCompoundStatement=function(){return false};n.prototype.isLeaf=function(){return this.isStatementOrExpression()&&!this.isCompoundStatement()};n.prototype.typeCheck=function(t){switch(this.nodeType){case e.NodeType.Error:case e.NodeType.EmptyExpr:{this.type=t.anyType;break};case e.NodeType.This:{return t.typeCheckThis(this)};case e.NodeType.Null:{this.type=t.nullType;break};case e.NodeType.False:case e.NodeType.True:{this.type=t.booleanType;break};case e.NodeType.Super:{return t.typeCheckSuper(this)};case e.NodeType.EndCode:case e.NodeType.Empty:case e.NodeType.Void:{this.type=t.voidType;break};default:{throw new Error("please implement in derived class")}}return this};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);switch(this.nodeType){case e.NodeType.This:{t.recordSourceMappingStart(this);if(t.thisFnc&&e.hasFlag(t.thisFnc.fncFlags,e.FncFlags.IsFatArrowFunction)){t.writeToOutput("_this")}else{t.writeToOutput("this")}t.recordSourceMappingEnd(this);break};case e.NodeType.Null:{t.recordSourceMappingStart(this);t.writeToOutput("null");t.recordSourceMappingEnd(this);break};case e.NodeType.False:{t.recordSourceMappingStart(this);t.writeToOutput("false");t.recordSourceMappingEnd(this);break};case e.NodeType.True:{t.recordSourceMappingStart(this);t.writeToOutput("true");t.recordSourceMappingEnd(this);break};case e.NodeType.Super:{t.recordSourceMappingStart(this);t.emitSuperReference();t.recordSourceMappingEnd(this);break};case e.NodeType.EndCode:{break};case e.NodeType.Error:case e.NodeType.EmptyExpr:{break};case e.NodeType.Empty:{t.recordSourceMappingStart(this);t.writeToOutput("; ");t.recordSourceMappingEnd(this);break};case e.NodeType.Void:{t.recordSourceMappingStart(this);t.writeToOutput("void ");t.recordSourceMappingEnd(this);break};default:{throw new Error("please implement in derived class")}}t.emitParensAndCommentsInPlace(this,false)};n.prototype.print=function(t){t.startLine();var n={line:-1,col:-1};var r={line:-1,col:-1};if(t.parser!==null){t.parser.getSourceLineCol(n,this.minChar);t.parser.getSourceLineCol(r,this.limChar);t.write("("+n.line+","+n.col+")--"+"("+r.line+","+r.col+"): ")}var i=this.printLabel();if(e.hasFlag(this.flags,e.ASTFlags.Error)){i+=" (Error)"}t.writeLine(i)};n.prototype.printLabel=function(){if(e.nodeTypeTable[this.nodeType]!==undefined){return e.nodeTypeTable[this.nodeType]}else{return e.NodeType._map[this.nodeType]}};n.prototype.addToControlFlow=function(e){e.walker.options.goChildren=false;e.addContent(this)};n.prototype.netFreeUses=function(e,t){};n.prototype.treeViewLabel=function(){return e.NodeType._map[this.nodeType]};n.getResolvedIdentifierName=function(t){if(!t){return""}var n="";var r=0;var i=0;while(i<=t.length-6){if(t.charAt(i)=="\\"&&t.charAt(i+1)=="u"){var s=parseInt(t.substr(i+2,4),16);n+=t.substr(r,i-r);n+=String.fromCharCode(s);i+=6;r=i;continue}i++}n+=t.substring(r);return n};return n}(t);e.AST=n;var r=function(t){function n(n,r){t.call(this,e.NodeType.Error);this.minChar=n;this.limChar=r}__extends(n,t);return n}(n);e.IncompleteAST=r;var i=function(t){function n(){t.call(this,e.NodeType.List);this.enclosingScope=null;this.members=new Array}__extends(n,t);n.prototype.addToControlFlow=function(e){var t=this.members.length;for(var n=0;n<t;n++){if(e.noContinuation){e.addUnreachable(this.members[n]);break}else{this.members[n]=e.walk(this.members[n],this)}}e.walker.options.goChildren=false};n.prototype.append=function(e){this.members[this.members.length]=e;return this};n.prototype.appendAll=function(t){if(t.nodeType==e.NodeType.List){var n=t;for(var r=0,i=n.members.length;r<i;r++){this.append(n.members[r])}}else{this.append(t)}return this};n.prototype.emit=function(t,n,r){t.recordSourceMappingStart(this);t.emitJavascriptList(this,null,e.TokenID.Semicolon,r,false,false);t.recordSourceMappingEnd(this)};n.prototype.typeCheck=function(e){var t=this.members.length;e.nestingLevel++;for(var n=0;n<t;n++){if(this.members[n]){this.members[n]=this.members[n].typeCheck(e)}}e.nestingLevel--;return this};return n}(n);e.ASTList=i;var s=function(t){function r(n,r){t.call(this,e.NodeType.Name);this.actualText=n;this.hasEscapeSequence=r;this.sym=null;this.cloId=-1;this.setText(n,r)}__extends(r,t);r.prototype.setText=function(e,t){this.actualText=e;if(t){this.text=n.getResolvedIdentifierName(e)}else{this.text=e}};r.prototype.isMissing=function(){return false};r.prototype.isLeaf=function(){return true};r.prototype.treeViewLabel=function(){return"id: "+this.actualText};r.prototype.printLabel=function(){if(this.actualText){return"id: "+this.actualText}else{return"name node"}};r.prototype.typeCheck=function(e){return e.typeCheckName(this)};r.prototype.emit=function(e,t,n){e.emitJavascriptName(this,true)};r.fromToken=function(t){return new r(t.getText(),t.hasEscapeSequence)};return r}(n);e.Identifier=s;var o=function(e){function t(){e.call(this,"__missing")}__extends(t,e);t.prototype.isMissing=function(){return true};t.prototype.emit=function(e,t,n){};return t}(s);e.MissingIdentifier=o;var u=function(t){function n(n){t.call(this,e.NodeType.Label);this.id=n}__extends(n,t);n.prototype.printLabel=function(){return this.id.actualText+":"};n.prototype.typeCheck=function(e){this.type=e.voidType;return this};n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);e.recordSourceMappingStart(this.id);e.writeToOutput(this.id.actualText);e.recordSourceMappingEnd(this.id);e.writeLineToOutput(":");e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};return n}(n);e.Label=u;var a=function(e){function t(t){e.call(this,t)}__extends(t,e);t.prototype.isExpression=function(){return true};t.prototype.isStatementOrExpression=function(){return true};return t}(n);e.Expression=a;var f=function(t){function n(e,n){t.call(this,e);this.operand=n;this.targetType=null;this.castTerm=null}__extends(n,t);n.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n);if(this.nodeType==e.NodeType.Throw){n.returnStmt()}};n.prototype.typeCheck=function(t){switch(this.nodeType){case e.NodeType.Not:{return t.typeCheckBitNot(this)};case e.NodeType.LogNot:{return t.typeCheckLogNot(this)};case e.NodeType.Pos:case e.NodeType.Neg:{return t.typeCheckUnaryNumberOperator(this)};case e.NodeType.IncPost:case e.NodeType.IncPre:case e.NodeType.DecPost:case e.NodeType.DecPre:{return t.typeCheckIncOrDec(this)};case e.NodeType.ArrayLit:{t.typeCheckArrayLit(this);return this};case e.NodeType.ObjectLit:{t.typeCheckObjectLit(this);return this};case e.NodeType.Throw:{this.operand=t.typeCheck(this.operand);this.type=t.voidType;return this};case e.NodeType.Typeof:{this.operand=t.typeCheck(this.operand);this.type=t.stringType;return this};case e.NodeType.Delete:{this.operand=t.typeCheck(this.operand);this.type=t.booleanType;break};case e.NodeType.TypeAssertion:{this.castTerm=t.typeCheck(this.castTerm);var n=!this.operand.isParenthesized;var r=n?this.castTerm.type:null;t.checker.typeCheckWithContextualType(r,t.checker.inProvisionalTypecheckMode(),true,this.operand);t.castWithCoercion(this.operand,this.castTerm.type,false,true);this.type=this.castTerm.type;return this};case e.NodeType.Void:{this.operand=t.typeCheck(this.operand);this.type=t.checker.undefinedType;break};default:{throw new Error("please implement in derived class")}}return this};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);switch(this.nodeType){case e.NodeType.IncPost:{t.emitJavascript(this.operand,e.TokenID.PlusPlus,false);t.writeToOutput("++");break};case e.NodeType.LogNot:{t.writeToOutput("!");t.emitJavascript(this.operand,e.TokenID.Exclamation,false);break};case e.NodeType.DecPost:{t.emitJavascript(this.operand,e.TokenID.MinusMinus,false);t.writeToOutput("--");break};case e.NodeType.ObjectLit:{t.emitObjectLiteral(this.operand);break};case e.NodeType.ArrayLit:{t.emitArrayLiteral(this.operand);break};case e.NodeType.Not:{t.writeToOutput("~");t.emitJavascript(this.operand,e.TokenID.Tilde,false);break};case e.NodeType.Neg:{t.writeToOutput("-");if(this.operand.nodeType==e.NodeType.Neg){this.operand.isParenthesized=true}t.emitJavascript(this.operand,e.TokenID.Minus,false);break};case e.NodeType.Pos:{t.writeToOutput("+");if(this.operand.nodeType==e.NodeType.Pos){this.operand.isParenthesized=true}t.emitJavascript(this.operand,e.TokenID.Plus,false);break};case e.NodeType.IncPre:{t.writeToOutput("++");t.emitJavascript(this.operand,e.TokenID.PlusPlus,false);break};case e.NodeType.DecPre:{t.writeToOutput("--");t.emitJavascript(this.operand,e.TokenID.MinusMinus,false);break};case e.NodeType.Throw:{t.writeToOutput("throw ");t.emitJavascript(this.operand,e.TokenID.Tilde,false);t.writeToOutput(";");break};case e.NodeType.Typeof:{t.writeToOutput("typeof ");t.emitJavascript(this.operand,e.TokenID.Tilde,false);break};case e.NodeType.Delete:{t.writeToOutput("delete ");t.emitJavascript(this.operand,e.TokenID.Tilde,false);break};case e.NodeType.Void:{t.writeToOutput("void ");t.emitJavascript(this.operand,e.TokenID.Tilde,false);break};case e.NodeType.TypeAssertion:{t.emitJavascript(this.operand,e.TokenID.Tilde,false);break};default:{throw new Error("please implement in derived class")}}t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};return n}(a);e.UnaryExpression=f;var l=function(t){function n(e,n,r){t.call(this,e);this.target=n;this.arguments=r;this.signature=null;this.minChar=this.target.minChar}__extends(n,t);n.prototype.typeCheck=function(t){if(this.nodeType==e.NodeType.New){return t.typeCheckNew(this)}else{return t.typeCheckCall(this)}};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);if(this.nodeType==e.NodeType.New){t.emitNew(this.target,this.arguments)}else{t.emitCall(this,this.target,this.arguments)}t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};return n}(a);e.CallExpression=l;var c=function(t){function n(e,n,r){t.call(this,e);this.operand1=n;this.operand2=r}__extends(n,t);n.prototype.typeCheck=function(t){switch(this.nodeType){case e.NodeType.Dot:{return t.typeCheckDotOperator(this)};case e.NodeType.Asg:{return t.typeCheckAsgOperator(this)};case e.NodeType.Add:case e.NodeType.Sub:case e.NodeType.Mul:case e.NodeType.Div:case e.NodeType.Mod:case e.NodeType.Or:case e.NodeType.And:{return t.typeCheckArithmeticOperator(this,false)};case e.NodeType.Xor:{return t.typeCheckBitwiseOperator(this,false)};case e.NodeType.Ne:case e.NodeType.Eq:{var n;if(t.checker.styleSettings.eqeqeq){n=e.nodeTypeTable[this.nodeType];t.checker.errorReporter.styleError(this,"use of "+n)}else{if(t.checker.styleSettings.eqnull){n=e.nodeTypeTable[this.nodeType];if(this.operand2!==null&&this.operand2.nodeType==e.NodeType.Null){t.checker.errorReporter.styleError(this,"use of "+n+" to compare with null")}}}};case e.NodeType.Eqv:case e.NodeType.NEqv:case e.NodeType.Lt:case e.NodeType.Le:case e.NodeType.Ge:case e.NodeType.Gt:{return t.typeCheckBooleanOperator(this)};case e.NodeType.Index:{return t.typeCheckIndex(this)};case e.NodeType.Member:{this.type=t.voidType;return this};case e.NodeType.LogOr:{return t.typeCheckLogOr(this)};case e.NodeType.LogAnd:{return t.typeCheckLogAnd(this)};case e.NodeType.AsgAdd:case e.NodeType.AsgSub:case e.NodeType.AsgMul:case e.NodeType.AsgDiv:case e.NodeType.AsgMod:case e.NodeType.AsgOr:case e.NodeType.AsgAnd:{return t.typeCheckArithmeticOperator(this,true)};case e.NodeType.AsgXor:{return t.typeCheckBitwiseOperator(this,true)};case e.NodeType.Lsh:case e.NodeType.Rsh:case e.NodeType.Rs2:{return t.typeCheckShift(this,false)};case e.NodeType.AsgLsh:case e.NodeType.AsgRsh:case e.NodeType.AsgRs2:{return t.typeCheckShift(this,true)};case e.NodeType.Comma:{return t.typeCheckCommaOperator(this)};case e.NodeType.InstOf:{return t.typeCheckInstOf(this)};case e.NodeType.In:{return t.typeCheckInOperator(this)};case e.NodeType.From:{t.checker.errorReporter.simpleError(this,"Illegal use of 'from' keyword in binary expression");break};default:{throw new Error("please implement in derived class")}}return this};n.prototype.emit=function(t,n,r){var i=e.nodeTypeToTokTable[this.nodeType];t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);if(i!=undefined){t.emitJavascript(this.operand1,i,false);if(e.tokenTable[i].text=="instanceof"){t.writeToOutput(" instanceof ")}else{if(e.tokenTable[i].text=="in"){t.writeToOutput(" in ")}else{t.writeToOutputTrimmable(" "+e.tokenTable[i].text+" ")}}t.emitJavascript(this.operand2,i,false)}else{switch(this.nodeType){case e.NodeType.Dot:{if(!t.tryEmitConstant(this)){t.emitJavascript(this.operand1,e.TokenID.Dot,false);t.writeToOutput(".");t.emitJavascriptName(this.operand2,false)}break};case e.NodeType.Index:{t.emitIndex(this.operand1,this.operand2);break};case e.NodeType.Member:{if(this.operand2.nodeType==e.NodeType.FuncDecl&&this.operand2.isAccessor()){var s=this.operand2;if(e.hasFlag(s.fncFlags,e.FncFlags.GetAccessor)){t.writeToOutput("get ")}else{t.writeToOutput("set ")}t.emitJavascript(this.operand1,e.TokenID.Colon,false)}else{t.emitJavascript(this.operand1,e.TokenID.Colon,false);t.writeToOutputTrimmable(": ")}t.emitJavascript(this.operand2,e.TokenID.Comma,false);break};case e.NodeType.Comma:{t.emitJavascript(this.operand1,e.TokenID.Comma,false);if(t.emitState.inObjectLiteral){t.writeLineToOutput(", ")}else{t.writeToOutput(",")}t.emitJavascript(this.operand2,e.TokenID.Comma,false);break};case e.NodeType.Is:{throw new Error("should be de-sugared during type check")};default:{throw new Error("please implement in derived class")}}}t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};return n}(a);e.BinaryExpression=c;var h=function(t){function n(n,r,i){t.call(this,e.NodeType.ConditionalExpression);this.operand1=n;this.operand2=r;this.operand3=i}__extends(n,t);n.prototype.typeCheck=function(e){return e.typeCheckQMark(this)};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.emitJavascript(this.operand1,e.TokenID.Question,false);t.writeToOutput(" ? ");t.emitJavascript(this.operand2,e.TokenID.Question,false);t.writeToOutput(" : ");t.emitJavascript(this.operand3,e.TokenID.Question,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};return n}(a);e.ConditionalExpression=h;var p=function(t){function n(n,r){t.call(this,e.NodeType.NumberLit);this.value=n;this.hasEmptyFraction=r;this.isNegativeZero=false}__extends(n,t);n.prototype.typeCheck=function(e){this.type=e.doubleType;return this};n.prototype.treeViewLabel=function(){return"num: "+this.printLabel()};n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);if(this.isNegativeZero){e.writeToOutput("-")}e.writeToOutput(this.value.toString());if(this.hasEmptyFraction){e.writeToOutput(".0")}e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};n.prototype.printLabel=function(){if(Math.floor(this.value)!=this.value){return this.value.toFixed(2).toString()}else{if(this.hasEmptyFraction){return this.value.toString()+".0"}else{return this.value.toString()}}};return n}(a);e.NumberLiteral=p;var d=function(t){function n(n){t.call(this,e.NodeType.Regex);this.regex=n}__extends(n,t);n.prototype.typeCheck=function(e){this.type=e.regexType;return this};n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);e.writeToOutput(this.regex.toString());e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};return n}(a);e.RegexLiteral=d;var v=function(t){function n(n){t.call(this,e.NodeType.QString);this.text=n}__extends(n,t);n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);e.emitStringLiteral(this.text);e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){this.type=e.stringType;return this};n.prototype.treeViewLabel=function(){return"st: "+this.text};n.prototype.printLabel=function(){return this.text};return n}(a);e.StringLiteral=v;var m=function(e){function t(t){e.call(this,t)}__extends(t,e);return t}(n);e.ModuleElement=m;var g=function(t){function n(n,r){t.call(this,e.NodeType.ImportDeclaration);this.id=n;this.alias=r;this.varFlags=e.VarFlags.None;this.isDynamicImport=false}__extends(n,t);n.prototype.isStatementOrExpression=function(){return true};n.prototype.emit=function(t,n,r){var i=this.alias.type;if(!this.isDynamicImport||this.id.sym&&!this.id.sym.onlyReferencedAsTypeRef){var s=t.modAliasId;var o=t.firstModAlias;t.recordSourceMappingStart(this);t.emitParensAndCommentsInPlace(this,true);t.writeToOutput("var "+this.id.actualText+" = ");t.modAliasId=this.id.actualText;t.firstModAlias=this.firstAliasedModToString();t.emitJavascript(this.alias,e.TokenID.Tilde,false);if(!this.isDynamicImport){t.writeToOutput(";")}t.emitParensAndCommentsInPlace(this,false);t.recordSourceMappingEnd(this);t.modAliasId=s;t.firstModAlias=o}};n.prototype.typeCheck=function(e){return e.typeCheckImportDecl(this)};n.prototype.getAliasName=function(t){if(typeof t==="undefined"){t=this.alias}if(t.nodeType==e.NodeType.Name){return t.actualText}else{var n=t;return this.getAliasName(n.operand1)+"."+this.getAliasName(n.operand2)}};n.prototype.firstAliasedModToString=function(){if(this.alias.nodeType==e.NodeType.Name){return this.alias.actualText}else{var t=this.alias;var n=t.operand1;return n.actualText}};return n}(m);e.ImportDeclaration=g;var y=function(t){function n(n,r,i){t.call(this,r);this.id=n;this.nestingLevel=i;this.init=null;this.typeExpr=null;this.varFlags=e.VarFlags.None;this.sym=null}__extends(n,t);n.prototype.isStatementOrExpression=function(){return true};n.prototype.isPrivate=function(){return e.hasFlag(this.varFlags,e.VarFlags.Private)};n.prototype.isPublic=function(){return e.hasFlag(this.varFlags,e.VarFlags.Public)};n.prototype.isProperty=function(){return e.hasFlag(this.varFlags,e.VarFlags.Property)};n.prototype.typeCheck=function(e){return e.typeCheckBoundDecl(this)};n.prototype.printLabel=function(){return this.treeViewLabel()};return n}(n);e.BoundDecl=y;var b=function(t){function n(n,r){t.call(this,n,e.NodeType.VarDecl,r)}__extends(n,t);n.prototype.isAmbient=function(){return e.hasFlag(this.varFlags,e.VarFlags.Ambient)};n.prototype.isExported=function(){return e.hasFlag(this.varFlags,e.VarFlags.Exported)};n.prototype.isStatic=function(){return e.hasFlag(this.varFlags,e.VarFlags.Static)};n.prototype.emit=function(e,t,n){e.emitJavascriptVarDecl(this,t)};n.prototype.treeViewLabel=function(){return"var "+this.id.actualText};return n}(y);e.VarDecl=b;var w=function(t){function n(n){t.call(this,n,e.NodeType.ArgDecl,0);this.isOptional=false;this.parameterPropertySym=null}__extends(n,t);n.prototype.isOptionalArg=function(){return this.isOptional||this.init};n.prototype.treeViewLabel=function(){return"arg: "+this.id.actualText};n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);e.writeToOutput(this.id.actualText);e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};return n}(y);e.ArgDecl=w;var E=0;var S=function(t){function n(n,r,i,s,o,u,a,f){t.call(this,f);this.name=n;this.bod=r;this.isConstructor=i;this.arguments=s;this.vars=o;this.scopes=u;this.statics=a;this.hint=null;this.fncFlags=e.FncFlags.None;this.returnTypeAnnotation=null;this.variableArgList=false;this.jumpRefs=null;this.internalNameCache=null;this.tmp1Declared=false;this.enclosingFnc=null;this.freeVariables=[];this.unitIndex=-1;this.classDecl=null;this.boundToProperty=null;this.isOverload=false;this.innerStaticFuncs=[];this.isTargetTypedAsMethod=false;this.isInlineCallLiteral=false;this.accessorSymbol=null;this.leftCurlyCount=0;this.rightCurlyCount=0;this.returnStatementsWithExpressions=[];this.scopeType=null;this.endingToken=null}__extends(n,t);n.prototype.internalName=function(){if(this.internalNameCache==null){var e=this.getNameText();if(e){this.internalNameCache="_internal_"+e}else{this.internalNameCache="_internal_"+E++}}return this.internalNameCache};n.prototype.hasSelfReference=function(){return e.hasFlag(this.fncFlags,e.FncFlags.HasSelfReference)};n.prototype.setHasSelfReference=function(){this.fncFlags|=e.FncFlags.HasSelfReference};n.prototype.addCloRef=function(e,t){if(this.envids==null){this.envids=new Array}this.envids[this.envids.length]=e;var n=this.enclosingFnc;if(t){while(n&&n.type.symbol!=t.container){n.addJumpRef(t);n=n.enclosingFnc}}return this.envids.length-1};n.prototype.addJumpRef=function(e){if(this.jumpRefs==null){this.jumpRefs=new Array}var t=new s(e.name);this.jumpRefs[this.jumpRefs.length]=t;t.sym=e;t.cloId=this.addCloRef(t,null)};n.prototype.buildControlFlow=function(){var t=new e.BasicBlock;var n=new e.BasicBlock;var r=new e.ControlFlowContext(t,n);var i=function(e,t,n){e.addToControlFlow(n.state);return e};var s=e.getAstWalkerFactory().getWalker(i,null,null,r);r.walker=s;s.walk(this.bod,this);return r};n.prototype.typeCheck=function(e){return e.typeCheckFunction(this)};n.prototype.emit=function(e,t,n){e.emitJavascriptFunction(this)};n.prototype.getNameText=function(){if(this.name){return this.name.actualText}else{return this.hint}};n.prototype.isMethod=function(){return(this.fncFlags&e.FncFlags.Method)!=e.FncFlags.None};n.prototype.isCallMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.CallMember)};n.prototype.isConstructMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.ConstructMember)};n.prototype.isIndexerMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.IndexerMember)};n.prototype.isSpecialFn=function(){return this.isCallMember()||this.isIndexerMember()||this.isConstructMember()};n.prototype.isAnonymousFn=function(){return this.name===null};n.prototype.isAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.GetAccessor)||e.hasFlag(this.fncFlags,e.FncFlags.SetAccessor)};n.prototype.isGetAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.GetAccessor)};n.prototype.isSetAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.SetAccessor)};n.prototype.isAmbient=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Ambient)};n.prototype.isExported=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Exported)};n.prototype.isPrivate=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Private)};n.prototype.isPublic=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Public)};n.prototype.isStatic=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Static)};n.prototype.treeViewLabel=function(){if(this.name==null){return"funcExpr"}else{return"func: "+this.name.actualText}};n.prototype.ClearFlags=function(){this.fncFlags=e.FncFlags.None};n.prototype.isSignature=function(){return(this.fncFlags&e.FncFlags.Signature)!=e.FncFlags.None};n.prototype.hasStaticDeclarations=function(){return!this.isConstructor&&(this.statics.members.length>0||this.innerStaticFuncs.length>0)};return n}(n);e.FuncDecl=S;var x=function(){function e(e,t,n){this.filename=e;this.lineMap=t;this.unitIndex=n}return e}();e.LocationInfo=x;e.unknownLocationInfo=new x("unknown",null,-1);var T=function(t){function n(n,r){t.call(this,new s("script"),null,false,null,n,r,null,e.NodeType.Script);this.locationInfo=null;this.referencedFiles=[];this.requiresGlobal=false;this.requiresInherits=false;this.isResident=false;this.isDeclareFile=false;this.hasBeenTypeChecked=false;this.topLevelMod=null;this.leftCurlyCount=0;this.rightCurlyCount=0;this.containsUnicodeChar=false;this.containsUnicodeCharInComment=false;this.vars=n;this.scopes=r}__extends(n,t);n.prototype.typeCheck=function(e){return e.typeCheckScript(this)};n.prototype.treeViewLabel=function(){return"Script"};n.prototype.emitRequired=function(){if(!this.isDeclareFile&&!this.isResident&&this.bod){for(var t=0,n=this.bod.members.length;t<n;t++){var r=this.bod.members[t];if(r.nodeType==e.NodeType.ModuleDeclaration){if(!e.hasFlag(r.modFlags,e.ModuleFlags.ShouldEmitModuleDecl|e.ModuleFlags.Ambient)){return true}}else{if(r.nodeType==e.NodeType.ClassDeclaration){if(!e.hasFlag(r.varFlags,e.VarFlags.Ambient)){return true}}else{if(r.nodeType==e.NodeType.VarDecl){if(!e.hasFlag(r.varFlags,e.VarFlags.Ambient)){return true}}else{if(r.nodeType==e.NodeType.FuncDecl){if(!r.isSignature()){return true}}else{if(r.nodeType!=e.NodeType.InterfaceDeclaration&&r.nodeType!=e.NodeType.Empty){return true}}}}}}}return false};n.prototype.emit=function(t,n,r){if(this.emitRequired()){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.emitJavascriptList(this.bod,null,e.TokenID.Semicolon,true,false,false,true,this.requiresInherits);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)}};return n}(S);e.Script=T;var N=function(e){function t(t,n,r){e.call(this,t);this.name=n;this.members=r;this.leftCurlyCount=0;this.rightCurlyCount=0}__extends(t,e);return t}(m);e.NamedDeclaration=N;var C=function(t){function n(n,r,i,s,o){t.call(this,e.NodeType.ModuleDeclaration,n,r);this.endingToken=o;this.modFlags=e.ModuleFlags.ShouldEmitModuleDecl;this.amdDependencies=[];this.containsUnicodeChar=false;this.containsUnicodeCharInComment=false;this.vars=i;this.scopes=s;this.prettyName=this.name.actualText}__extends(n,t);n.prototype.isExported=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.Exported)};n.prototype.isAmbient=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.Ambient)};n.prototype.isEnum=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.IsEnum)};n.prototype.recordNonInterface=function(){this.modFlags&=~e.ModuleFlags.ShouldEmitModuleDecl};n.prototype.typeCheck=function(e){return e.typeCheckModule(this)};n.prototype.emit=function(t,n,r){if(!e.hasFlag(this.modFlags,e.ModuleFlags.ShouldEmitModuleDecl)){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.emitJavascriptModule(this);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)}};return n}(N);e.ModuleDeclaration=C;var k=function(t){function n(n,r,i,s,o){t.call(this,n,r,o);this.extendsList=i;this.implementsList=s;this.varFlags=e.VarFlags.None}__extends(n,t);n.prototype.isExported=function(){return e.hasFlag(this.varFlags,e.VarFlags.Exported)};n.prototype.isAmbient=function(){return e.hasFlag(this.varFlags,e.VarFlags.Ambient)};return n}(N);e.TypeDeclaration=k;var L=function(t){function n(n,r,i,s){t.call(this,e.NodeType.ClassDeclaration,n,i,s,r);this.knownMemberNames={};this.constructorDecl=null;this.constructorNestingLevel=0;this.endingToken=null}__extends(n,t);n.prototype.typeCheck=function(e){return e.typeCheckClass(this)};n.prototype.emit=function(e,t,n){e.emitJavascriptClass(this)};return n}(k);e.ClassDeclaration=L;var A=function(t){function n(n,r,i,s){t.call(this,e.NodeType.InterfaceDeclaration,n,i,s,r)}__extends(n,t);n.prototype.typeCheck=function(e){return e.typeCheckInterface(this)};n.prototype.emit=function(e,t,n){};return n}(k);e.InterfaceDeclaration=A;var O=function(t){function n(n){t.call(this,n);this.flags|=e.ASTFlags.IsStatement}__extends(n,t);n.prototype.isLoop=function(){return false};n.prototype.isStatementOrExpression=function(){return true};n.prototype.isCompoundStatement=function(){return this.isLoop()};n.prototype.typeCheck=function(e){this.type=e.voidType;return this};return n}(m);e.Statement=O;var M=function(t){function n(n,r){t.call(this,e.NodeType.LabeledStatement);this.labels=n;this.stmt=r}__extends(n,t);n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);if(this.labels){var r=this.labels.members.length;for(var i=0;i<r;i++){this.labels.members[i].emit(e,t,n)}}this.stmt.emit(e,t,true);e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){e.typeCheck(this.labels);this.stmt=this.stmt.typeCheck(e);return this};n.prototype.addToControlFlow=function(t){var n=t.current;var r=new e.BasicBlock;t.current=r;n.addSuccessor(r)};return n}(O);e.LabeledStatement=M;var _=function(t){function n(n,r){t.call(this,e.NodeType.Block);this.statements=n;this.isStatementBlock=r}__extends(n,t);n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);if(this.isStatementBlock){t.writeLineToOutput(" {");t.indenter.increaseIndent()}else{t.setInVarBlock(this.statements.members.length)}var i=t.setInObjectLiteral(false);if(this.statements){t.emitJavascriptList(this.statements,null,e.TokenID.Semicolon,true,false,false)}if(this.isStatementBlock){t.indenter.decreaseIndent();t.emitIndent();t.writeToOutput("}")}t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock;t.pushStatement(this,t.current,n);if(this.statements){t.walk(this.statements,this)}t.walker.options.goChildren=false;t.popStatement();if(n.predecessors.length>0){t.current.addSuccessor(n);t.current=n}};n.prototype.typeCheck=function(e){if(!e.checker.styleSettings.emptyBlocks){if(this.statements===null||this.statements.members.length==0){e.checker.errorReporter.styleError(this,"empty block")}}e.typeCheck(this.statements);return this};return n}(O);e.Block=_;var D=function(t){function n(e){t.call(this,e);this.target=null;this.resolvedTarget=null}__extends(n,t);n.prototype.hasExplicitTarget=function(){return this.target};n.prototype.setResolvedTarget=function(t,n){if(n.isLoop()){this.resolvedTarget=n;return true}if(this.nodeType===e.NodeType.Continue){t.reportParseError("continue statement applies only to loops");return false}else{if(n.nodeType==e.NodeType.Switch||this.hasExplicitTarget()){this.resolvedTarget=n;return true}else{t.reportParseError("break statement with no label can apply only to a loop or switch statement");return false}}};n.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n);n.unconditionalBranch(this.resolvedTarget,this.nodeType==e.NodeType.Continue)};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);if(this.nodeType==e.NodeType.Break){t.writeToOutput("break")}else{t.writeToOutput("continue")}if(this.hasExplicitTarget()){t.writeToOutput(" "+this.target)}t.recordSourceMappingEnd(this);t.writeToOutput(";");t.emitParensAndCommentsInPlace(this,false)};return n}(O);e.Jump=D;var P=function(t){function n(n){t.call(this,e.NodeType.While);this.cond=n;this.body=null}__extends(n,t);n.prototype.isLoop=function(){return true};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.writeToOutput("while(");t.emitJavascript(this.cond,e.TokenID.While,false);t.writeToOutput(")");t.emitJavascriptStatements(this.body,false,false);t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){return e.typeCheckWhile(this)};n.prototype.addToControlFlow=function(t){var n=t.current;var r=new e.BasicBlock;var i=new e.BasicBlock;n.addSuccessor(r);t.current=r;t.addContent(this.cond);var s=t.current;var o=null;if(this.body){t.current=new e.BasicBlock;s.addSuccessor(t.current);t.pushStatement(this,r,i);t.walk(this.body,this);o=t.popStatement()}if(!t.noContinuation){var u=t.current;u.addSuccessor(r)}t.current=i;s.addSuccessor(i);t.noContinuation=false;t.walker.options.goChildren=false};return n}(O);e.WhileStatement=P;var H=function(t){function n(){t.call(this,e.NodeType.DoWhile);this.body=null;this.whileAST=null;this.cond=null}__extends(n,t);n.prototype.isLoop=function(){return true};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.writeToOutput("do");t.emitJavascriptStatements(this.body,true,false);t.recordSourceMappingStart(this.whileAST);t.writeToOutput("while");t.recordSourceMappingEnd(this.whileAST);t.writeToOutput("(");t.emitJavascript(this.cond,e.TokenID.CloseParen,false);t.writeToOutput(")");t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){return e.typeCheckDoWhile(this)};n.prototype.addToControlFlow=function(t){var n=t.current;var r=new e.BasicBlock;var i=new e.BasicBlock;n.addSuccessor(r);t.current=r;var s=null;if(this.body){t.pushStatement(this,r,i);t.walk(this.body,this);s=t.popStatement()}if(!t.noContinuation){var o=t.current;o.addSuccessor(r);t.addContent(this.cond);t.current=i;o.addSuccessor(i)}else{t.addUnreachable(this.cond)}t.walker.options.goChildren=false};return n}(O);e.DoWhileStatement=H;var B=function(n){function r(r){n.call(this,e.NodeType.If);this.cond=r;this.elseBod=null;this.statement=new t}__extends(r,n);r.prototype.isCompoundStatement=function(){return true};r.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.recordSourceMappingStart(this.statement);t.writeToOutput("if(");t.emitJavascript(this.cond,e.TokenID.If,false);t.writeToOutput(")");t.recordSourceMappingEnd(this.statement);t.emitJavascriptStatements(this.thenBod,true,false);if(this.elseBod){t.writeToOutput(" else");t.emitJavascriptStatements(this.elseBod,true,true)}t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};r.prototype.typeCheck=function(e){return e.typeCheckIf(this)};r.prototype.addToControlFlow=function(t){this.cond.addToControlFlow(t);var n=new e.BasicBlock;var r=t.current;t.pushStatement(this,r,n);var i=false;t.current=new e.BasicBlock;r.addSuccessor(t.current);t.walk(this.thenBod,this);if(!t.noContinuation){i=true;t.current.addSuccessor(n)}if(this.elseBod){t.current=new e.BasicBlock;t.noContinuation=false;r.addSuccessor(t.current);t.walk(this.elseBod,this);if(!t.noContinuation){i=true;t.current.addSuccessor(n)}else{if(i){t.noContinuation=false}}}else{r.addSuccessor(n);t.noContinuation=false;i=true}var s=t.popStatement();if(n.predecessors.length>0){t.noContinuation=false;i=true}if(i){t.current=n}t.walker.options.goChildren=false};return r}(O);e.IfStatement=B;var j=function(t){function n(){t.call(this,e.NodeType.Return);this.returnExpression=null}__extends(n,t);n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);if(this.returnExpression){t.writeToOutput("return ");t.emitJavascript(this.returnExpression,e.TokenID.Semicolon,false)}else{t.writeToOutput("return;")}t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.addToControlFlow=function(e){t.prototype.addToControlFlow.call(this,e);e.returnStmt()};n.prototype.typeCheck=function(e){return e.typeCheckReturn(this)};return n}(O);e.ReturnStatement=j;var F=function(t){function n(){t.call(this,e.NodeType.EndCode)}__extends(n,t);return n}(n);e.EndCode=F;var I=function(n){function r(r,i){n.call(this,e.NodeType.ForIn);this.lval=r;this.obj=i;this.statement=new t;if(this.lval&&this.lval.nodeType==e.NodeType.VarDecl){this.lval.varFlags|=e.VarFlags.AutoInit}}__extends(r,n);r.prototype.isLoop=function(){return true};r.prototype.isFiltered=function(){if(this.body){var t=null;if(this.body.nodeType==e.NodeType.List){var n=this.body;if(n.members.length==1){t=n.members[0]}}else{t=this.body}if(t!==null){if(t.nodeType==e.NodeType.Block){var r=t;if(r.statements!==null&&r.statements.members.length==1){t=r.statements.members[0]}}if(t.nodeType==e.NodeType.If){var i=t.cond;if(i.nodeType==e.NodeType.Call){var s=i.target;if(s.nodeType==e.NodeType.Dot){var o=s;if(o.operand1.nodeType==e.NodeType.Name&&this.obj.nodeType==e.NodeType.Name&&o.operand1.actualText==this.obj.actualText){var u=o.operand2;if(u.actualText=="hasOwnProperty"){var a=i.arguments;if(a!==null&&a.members.length==1){var f=a.members[0];if(f.nodeType==e.NodeType.Name&&this.lval.nodeType==e.NodeType.Name){if(this.lval.actualText==f.actualText){return true}}}}}}}}}}return false};r.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.recordSourceMappingStart(this.statement);t.writeToOutput("for(");t.emitJavascript(this.lval,e.TokenID.For,false);t.writeToOutput(" in ");t.emitJavascript(this.obj,e.TokenID.For,false);t.writeToOutput(")");t.recordSourceMappingEnd(this.statement);t.emitJavascriptStatements(this.body,true,false);t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};r.prototype.typeCheck=function(e){if(e.checker.styleSettings.forin){if(!this.isFiltered()){e.checker.errorReporter.styleError(this,"no hasOwnProperty filter")}}return e.typeCheckForIn(this)};r.prototype.addToControlFlow=function(t){if(this.lval){t.addContent(this.lval)}if(this.obj){t.addContent(this.obj)}var n=t.current;var r=new e.BasicBlock;var i=new e.BasicBlock;n.addSuccessor(r);t.current=r;if(this.body){t.pushStatement(this,r,i);t.walk(this.body,this);t.popStatement()}if(!t.noContinuation){var s=t.current;s.addSuccessor(r)}t.current=i;t.noContinuation=false;n.addSuccessor(i);t.walker.options.goChildren=false};return r}(O);e.ForInStatement=I;var q=function(t){function n(n){t.call(this,e.NodeType.For);this.init=n}__extends(n,t);n.prototype.isLoop=function(){return true};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.writeToOutput("for(");if(this.init){if(this.init.nodeType!=e.NodeType.List){t.emitJavascript(this.init,e.TokenID.For,false)}else{t.setInVarBlock(this.init.members.length);t.emitJavascriptList(this.init,null,e.TokenID.For,false,false,false)}}t.writeToOutput("; ");t.emitJavascript(this.cond,e.TokenID.For,false);t.writeToOutput("; ");t.emitJavascript(this.incr,e.TokenID.For,false);t.writeToOutput(")");t.emitJavascriptStatements(this.body,true,false);t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){return e.typeCheckFor(this)};n.prototype.addToControlFlow=function(t){if(this.init){t.addContent(this.init)}var n=t.current;var r=new e.BasicBlock;var i=new e.BasicBlock;n.addSuccessor(r);t.current=r;var s=null;var o=r;var u=null;if(this.incr){u=new e.BasicBlock;o=u}if(this.cond){s=t.current;t.addContent(this.cond);t.current=new e.BasicBlock;s.addSuccessor(t.current)}var a=null;if(this.body){t.pushStatement(this,o,i);t.walk(this.body,this);a=t.popStatement()}if(this.incr){if(t.noContinuation){if(u.predecessors.length==0){t.addUnreachable(this.incr)}}else{t.current.addSuccessor(u);t.current=u;t.addContent(this.incr)}}var f=t.current;if(!t.noContinuation){f.addSuccessor(r)}if(s){s.addSuccessor(i);t.noContinuation=false}if(i.predecessors.length>0){t.noContinuation=false;t.current=i}t.walker.options.goChildren=false};return n}(O);e.ForStatement=q;var R=function(t){function n(n){t.call(this,e.NodeType.With);this.expr=n;this.withSym=null}__extends(n,t);n.prototype.isCompoundStatement=function(){return true};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.writeToOutput("with (");if(this.expr){t.emitJavascript(this.expr,e.TokenID.With,false)}t.writeToOutput(")");t.emitJavascriptStatements(this.body,true,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){return e.typeCheckWith(this)};return n}(O);e.WithStatement=R;var U=function(n){function r(r){n.call(this,e.NodeType.Switch);this.val=r;this.defaultCase=null;this.statement=new t}__extends(r,n);r.prototype.isCompoundStatement=function(){return true};r.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(false);t.recordSourceMappingStart(this.statement);t.writeToOutput("switch(");t.emitJavascript(this.val,e.TokenID.Identifier,false);t.writeToOutput(")");t.recordSourceMappingEnd(this.statement);t.writeLineToOutput(" {");t.indenter.increaseIndent();var s=this.caseList.members.length;for(var o=0;o<s;o++){var u=this.caseList.members[o];t.emitJavascript(u,e.TokenID.Case,true);t.writeLineToOutput("")}t.indenter.decreaseIndent();t.emitIndent();t.writeToOutput("}");t.setInObjectLiteral(i);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};r.prototype.typeCheck=function(e){var t=this.caseList.members.length;this.val=e.typeCheck(this.val);for(var n=0;n<t;n++){this.caseList.members[n]=e.typeCheck(this.caseList.members[n])}this.defaultCase=e.typeCheck(this.defaultCase);this.type=e.voidType;return this};r.prototype.addToControlFlow=function(t){var n=t.current;t.addContent(this.val);var r=new e.BasicBlock;var i=new e.BasicBlock;n.addSuccessor(r);t.pushSwitch(r);t.current=r;t.pushStatement(this,r,i);t.walk(this.caseList,this);t.popSwitch();var s=t.popStatement();var o=this.defaultCase==null;if(this.defaultCase==null){n.addSuccessor(i)}if(i.predecessors.length>0){t.noContinuation=false;t.current=i}else{t.noContinuation=true}t.walker.options.goChildren=false};return r}(O);e.SwitchStatement=U;var z=function(t){function n(){t.call(this,e.NodeType.Case);this.expr=null}__extends(n,t);n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);if(this.expr){t.writeToOutput("case ");t.emitJavascript(this.expr,e.TokenID.Identifier,false)}else{t.writeToOutput("default")}t.writeToOutput(":");t.emitJavascriptStatements(this.body,false,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){this.expr=e.typeCheck(this.expr);e.typeCheck(this.body);this.type=e.voidType;return this};n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock;var r=t.currentSwitch[t.currentSwitch.length-1];if(this.expr){var i=new e.BasicBlock;t.current=i;r.addSuccessor(i);t.addContent(this.expr);i.addSuccessor(n)}else{r.addSuccessor(n)}t.current=n;if(this.body){t.walk(this.body,this)}t.noContinuation=false;t.walker.options.goChildren=false};return n}(O);e.CaseStatement=z;var W=function(t){function n(n,r){t.call(this,e.NodeType.TypeRef);this.term=n;this.arrayCount=r}__extends(n,t);n.prototype.emit=function(e,t,n){throw new Error("should not emit a type ref")};n.prototype.typeCheck=function(t){var n=t.inTypeRefTypeCheck;t.inTypeRefTypeCheck=true;var r=e.getTypeLink(this,t.checker,true);t.checker.resolveTypeLink(t.scope,r,false);if(this.term){t.typeCheck(this.term)}t.checkForVoidConstructor(r.type,this);this.type=r.type;if(this.term){this.term.type=this.type}t.inTypeRefTypeCheck=n;return this};return n}(n);e.TypeReference=W;var X=function(t){function n(n,r){t.call(this,e.NodeType.TryFinally);this.tryNode=n;this.finallyNode=r}__extends(n,t);n.prototype.isCompoundStatement=function(){return true};n.prototype.emit=function(t,n,r){t.recordSourceMappingStart(this);t.emitJavascript(this.tryNode,e.TokenID.Try,false);t.emitJavascript(this.finallyNode,e.TokenID.Finally,false);t.recordSourceMappingEnd(this)};n.prototype.typeCheck=function(e){this.tryNode=e.typeCheck(this.tryNode);this.finallyNode=e.typeCheck(this.finallyNode);this.type=e.voidType;return this};n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock;t.walk(this.tryNode,this);var r=new e.BasicBlock;if(t.current){t.current.addSuccessor(r)}t.current=r;t.pushStatement(this,null,n);t.walk(this.finallyNode,this);if(!t.noContinuation&&t.current){t.current.addSuccessor(n)}if(n.predecessors.length>0){t.current=n}else{t.noContinuation=true}t.popStatement();t.walker.options.goChildren=false};return n}(O);e.TryFinally=X;var V=function(t){function n(n,r){t.call(this,e.NodeType.TryCatch);this.tryNode=n;this.catchNode=r}__extends(n,t);n.prototype.isCompoundStatement=function(){return true};n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.emitJavascript(this.tryNode,e.TokenID.Try,false);t.emitJavascript(this.catchNode,e.TokenID.Catch,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.addToControlFlow=function(t){var n=t.current;var r=new e.BasicBlock;n.addSuccessor(r);t.current=r;var i=new e.BasicBlock;t.pushStatement(this,null,i);t.walk(this.tryNode,this);if(!t.noContinuation){if(t.current){t.current.addSuccessor(i)}}t.current=new e.BasicBlock;n.addSuccessor(t.current);t.walk(this.catchNode,this);t.popStatement();if(!t.noContinuation){if(t.current){t.current.addSuccessor(i)}}t.current=i;t.walker.options.goChildren=false};n.prototype.typeCheck=function(e){this.tryNode=e.typeCheck(this.tryNode);this.catchNode=e.typeCheck(this.catchNode);this.type=e.voidType;return this};return n}(O);e.TryCatch=V;var $=function(t){function n(n){t.call(this,e.NodeType.Try);this.body=n}__extends(n,t);n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.writeToOutput("try ");t.emitJavascript(this.body,e.TokenID.Try,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.typeCheck=function(e){this.body=e.typeCheck(this.body);return this};n.prototype.addToControlFlow=function(e){if(this.body){e.walk(this.body,this)}e.walker.options.goChildren=false;e.noContinuation=false};return n}(O);e.Try=$;var J=function(n){function r(r,i){n.call(this,e.NodeType.Catch);this.param=r;this.body=i;this.statement=new t;this.containedScope=null;if(this.param){this.param.varFlags|=e.VarFlags.AutoInit}}__extends(r,n);r.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.writeToOutput(" ");t.recordSourceMappingStart(this.statement);t.writeToOutput("catch (");t.emitJavascript(this.param,e.TokenID.OpenParen,false);t.writeToOutput(")");t.recordSourceMappingEnd(this.statement);t.emitJavascript(this.body,e.TokenID.Catch,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};r.prototype.addToControlFlow=function(t){if(this.param){t.addContent(this.param);var n=new e.BasicBlock;t.current.addSuccessor(n);t.current=n}if(this.body){t.walk(this.body,this)}t.noContinuation=false;t.walker.options.goChildren=false};r.prototype.typeCheck=function(t){var n=t.scope;t.scope=this.containedScope;this.param=t.typeCheck(this.param);var r=new e.ValueLocation;var i=new e.VariableSymbol(this.param.id.text,this.param.minChar,t.checker.locationInfo.unitIndex,r);r.symbol=i;r.typeLink=new e.TypeLink;r.typeLink.type=t.anyType;var s=t.thisFnc;if(s&&s.type){r.symbol.container=s.type.symbol}else{r.symbol.container=null}this.param.sym=r.symbol;t.scope.enter(r.symbol.container,this.param,r.symbol,t.checker.errorReporter,false,false,false);this.body=t.typeCheck(this.body);if(t.checker.inProvisionalTypecheckMode()){var o=t.scope.getTable();o.secondaryTable.table[r.symbol.name]=undefined}this.type=t.voidType;t.scope=n;return this};return r}(O);e.Catch=J;var K=function(t){function n(n){t.call(this,e.NodeType.Finally);this.body=n}__extends(n,t);n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,true);t.recordSourceMappingStart(this);t.writeToOutput("finally");t.emitJavascript(this.body,e.TokenID.Finally,false);t.recordSourceMappingEnd(this);t.emitParensAndCommentsInPlace(this,false)};n.prototype.addToControlFlow=function(e){if(this.body){e.walk(this.body,this)}e.walker.options.goChildren=false;e.noContinuation=false};n.prototype.typeCheck=function(e){this.body=e.typeCheck(this.body);return this};return n}(O);e.Finally=K;var Q=function(t){function n(n,r,i){t.call(this,e.NodeType.Comment);this.content=n;this.isBlockComment=r;this.endsLine=i;this.text=null}__extends(n,t);n.prototype.getText=function(){if(this.text==null){if(this.isBlockComment){this.text=this.content.split("\n");for(var e=0;e<this.text.length;e++){this.text[e]=this.text[e].replace(/^\s+|\s+$/g,"")}}else{this.text=[this.content.replace(/^\s+|\s+$/g,"")]}}return this.text};return n}(n);e.Comment=Q;var G=function(t){function n(){t.call(this,e.NodeType.Debugger)}__extends(n,t);n.prototype.emit=function(e,t,n){e.emitParensAndCommentsInPlace(this,true);e.recordSourceMappingStart(this);e.writeLineToOutput("debugger;");e.recordSourceMappingEnd(this);e.emitParensAndCommentsInPlace(this,false)};return n}(O);e.DebuggerStatement=G})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(){if(!i){i=new r}return i}var t=function(){function e(){this.goChildren=true;this.goNextSibling=true;this.reverseSiblings=false}e.prototype.stopWalk=function(e){if(typeof e==="undefined"){e=true}this.goChildren=!e;this.goNextSibling=!e};return e}();e.AstWalkOptions=t;var n=function(){function e(e,t,n,r,i){this.childrenWalkers=e;this.pre=t;this.post=n;this.options=r;this.state=i}e.prototype.walk=function(e,t){var n=this.pre(e,t,this);if(n===undefined){n=e}if(this.options.goChildren){var r=this.options.goNextSibling;this.options.goNextSibling=true;this.childrenWalkers[e.nodeType](e,t,this);this.options.goNextSibling=r}else{this.options.goChildren=true}if(this.post){var i=this.post(n,t,this);if(i===undefined){i=n}return i}else{return n}};return e}();var r=function(){function r(){this.childrenWalkers=[];this.initChildrenWalkers()}r.prototype.walk=function(e,t,n,r,i){return this.getWalker(t,n,r,i).walk(e,null)};r.prototype.getWalker=function(e,t,n,r){return this.getSlowWalker(e,t,n,r)};r.prototype.getSlowWalker=function(e,r,i,s){if(!i){i=new t}return new n(this.childrenWalkers,e,r,i,s)};r.prototype.initChildrenWalkers=function(){this.childrenWalkers[e.NodeType.None]=o.walkNone;this.childrenWalkers[e.NodeType.Empty]=o.walkNone;this.childrenWalkers[e.NodeType.EmptyExpr]=o.walkNone;this.childrenWalkers[e.NodeType.True]=o.walkNone;this.childrenWalkers[e.NodeType.False]=o.walkNone;this.childrenWalkers[e.NodeType.This]=o.walkNone;this.childrenWalkers[e.NodeType.Super]=o.walkNone;this.childrenWalkers[e.NodeType.QString]=o.walkNone;this.childrenWalkers[e.NodeType.Regex]=o.walkNone;this.childrenWalkers[e.NodeType.Null]=o.walkNone;this.childrenWalkers[e.NodeType.ArrayLit]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.ObjectLit]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.Void]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.Comma]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Pos]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.Neg]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.Delete]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.Await]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.In]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Dot]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.From]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Is]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.InstOf]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Typeof]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.NumberLit]=o.walkNone;this.childrenWalkers[e.NodeType.Name]=o.walkNone;this.childrenWalkers[e.NodeType.TypeRef]=o.walkTypeReferenceChildren;this.childrenWalkers[e.NodeType.Index]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Call]=o.walkCallExpressionChildren;this.childrenWalkers[e.NodeType.New]=o.walkCallExpressionChildren;this.childrenWalkers[e.NodeType.Asg]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgAdd]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgSub]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgDiv]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgMul]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgMod]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgAnd]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgXor]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgOr]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgLsh]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgRsh]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.AsgRs2]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.ConditionalExpression]=o.walkTrinaryExpressionChildren;this.childrenWalkers[e.NodeType.LogOr]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.LogAnd]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Or]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Xor]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.And]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Eq]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Ne]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Eqv]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.NEqv]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Lt]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Le]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Gt]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Ge]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Add]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Sub]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Mul]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Div]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Mod]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Lsh]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Rsh]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Rs2]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.Not]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.LogNot]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.IncPre]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.DecPre]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.IncPost]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.DecPost]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.TypeAssertion]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.FuncDecl]=o.walkFuncDeclChildren;this.childrenWalkers[e.NodeType.Member]=o.walkBinaryExpressionChildren;this.childrenWalkers[e.NodeType.VarDecl]=o.walkBoundDeclChildren;this.childrenWalkers[e.NodeType.ArgDecl]=o.walkBoundDeclChildren;this.childrenWalkers[e.NodeType.Return]=o.walkReturnStatementChildren;this.childrenWalkers[e.NodeType.Break]=o.walkNone;this.childrenWalkers[e.NodeType.Continue]=o.walkNone;this.childrenWalkers[e.NodeType.Throw]=o.walkUnaryExpressionChildren;this.childrenWalkers[e.NodeType.For]=o.walkForStatementChildren;this.childrenWalkers[e.NodeType.ForIn]=o.walkForInStatementChildren;this.childrenWalkers[e.NodeType.If]=o.walkIfStatementChildren;this.childrenWalkers[e.NodeType.While]=o.walkWhileStatementChildren;this.childrenWalkers[e.NodeType.DoWhile]=o.walkDoWhileStatementChildren;this.childrenWalkers[e.NodeType.Block]=o.walkBlockChildren;this.childrenWalkers[e.NodeType.Case]=o.walkCaseStatementChildren;this.childrenWalkers[e.NodeType.Switch]=o.walkSwitchStatementChildren;this.childrenWalkers[e.NodeType.Try]=o.walkTryChildren;this.childrenWalkers[e.NodeType.TryCatch]=o.walkTryCatchChildren;this.childrenWalkers[e.NodeType.TryFinally]=o.walkTryFinallyChildren;this.childrenWalkers[e.NodeType.Finally]=o.walkFinallyChildren;this.childrenWalkers[e.NodeType.Catch]=o.walkCatchChildren;this.childrenWalkers[e.NodeType.List]=o.walkListChildren;this.childrenWalkers[e.NodeType.Script]=o.walkScriptChildren;this.childrenWalkers[e.NodeType.ClassDeclaration]=o.walkClassDeclChildren;this.childrenWalkers[e.NodeType.InterfaceDeclaration]=o.walkTypeDeclChildren;this.childrenWalkers[e.NodeType.ModuleDeclaration]=o.walkModuleDeclChildren;this.childrenWalkers[e.NodeType.ImportDeclaration]=o.walkImportDeclChildren;this.childrenWalkers[e.NodeType.With]=o.walkWithStatementChildren;this.childrenWalkers[e.NodeType.Label]=o.walkLabelChildren;this.childrenWalkers[e.NodeType.LabeledStatement]=o.walkLabeledStatementChildren;this.childrenWalkers[e.NodeType.EBStart]=o.walkNone;this.childrenWalkers[e.NodeType.GotoEB]=o.walkNone;this.childrenWalkers[e.NodeType.EndCode]=o.walkNone;this.childrenWalkers[e.NodeType.Error]=o.walkNone;this.childrenWalkers[e.NodeType.Comment]=o.walkNone;this.childrenWalkers[e.NodeType.Debugger]=o.walkNone;for(var t in e.NodeType._map){if(this.childrenWalkers[t]===undefined){throw new Error("initWalkers function is not up to date with enum content!")}}};return r}();e.AstWalkerFactory=r;var i;e.getAstWalkerFactory=s;var o;(function(e){function t(e,t,n){}function n(e,t,n){var r=e.members.length;if(n.options.reverseSiblings){for(var i=r-1;i>=0;i--){if(n.options.goNextSibling){e.members[i]=n.walk(e.members[i],e)}}}else{for(var i=0;i<r;i++){if(n.options.goNextSibling){e.members[i]=n.walk(e.members[i],e)}}}}function r(e,t,n){if(e.castTerm){e.castTerm=n.walk(e.castTerm,e)}if(e.operand){e.operand=n.walk(e.operand,e)}}function i(e,t,n){if(n.options.reverseSiblings){if(e.operand2){e.operand2=n.walk(e.operand2,e)}if(e.operand1&&n.options.goNextSibling){e.operand1=n.walk(e.operand1,e)}}else{if(e.operand1){e.operand1=n.walk(e.operand1,e)}if(e.operand2&&n.options.goNextSibling){e.operand2=n.walk(e.operand2,e)}}}function s(e,t,n){if(e.term){e.term=n.walk(e.term,e)}}function o(e,t,n){if(!n.options.reverseSiblings){e.target=n.walk(e.target,e)}if(e.arguments&&n.options.goNextSibling){e.arguments=n.walk(e.arguments,e)}if(n.options.reverseSiblings&&n.options.goNextSibling){e.target=n.walk(e.target,e)}}function u(e,t,n){if(e.operand1){e.operand1=n.walk(e.operand1,e)}if(e.operand2&&n.options.goNextSibling){e.operand2=n.walk(e.operand2,e)}if(e.operand3&&n.options.goNextSibling){e.operand3=n.walk(e.operand3,e)}}function a(e,t,n){if(e.name){e.name=n.walk(e.name,e)}if(e.arguments&&e.arguments.members.length>0&&n.options.goNextSibling){e.arguments=n.walk(e.arguments,e)}if(e.returnTypeAnnotation&&n.options.goNextSibling){e.returnTypeAnnotation=n.walk(e.returnTypeAnnotation,e)}if(e.bod&&e.bod.members.length>0&&n.options.goNextSibling){e.bod=n.walk(e.bod,e)}}function f(e,t,n){if(e.id){e.id=n.walk(e.id,e)}if(e.init){e.init=n.walk(e.init,e)}if(e.typeExpr&&n.options.goNextSibling){e.typeExpr=n.walk(e.typeExpr,e)}}function l(e,t,n){if(e.returnExpression){e.returnExpression=n.walk(e.returnExpression,e)}}function c(e,t,n){if(e.init){e.init=n.walk(e.init,e)}if(e.cond&&n.options.goNextSibling){e.cond=n.walk(e.cond,e)}if(e.incr&&n.options.goNextSibling){e.incr=n.walk(e.incr,e)}if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function h(e,t,n){e.lval=n.walk(e.lval,e);if(n.options.goNextSibling){e.obj=n.walk(e.obj,e)}if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function p(e,t,n){e.cond=n.walk(e.cond,e);if(e.thenBod&&n.options.goNextSibling){e.thenBod=n.walk(e.thenBod,e)}if(e.elseBod&&n.options.goNextSibling){e.elseBod=n.walk(e.elseBod,e)}}function d(e,t,n){e.cond=n.walk(e.cond,e);if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function v(e,t,n){e.cond=n.walk(e.cond,e);if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function m(e,t,n){if(e.statements){e.statements=n.walk(e.statements,e)}}function g(e,t,n){if(e.expr){e.expr=n.walk(e.expr,e)}if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function y(e,t,n){if(e.val){e.val=n.walk(e.val,e)}if(e.caseList&&n.options.goNextSibling){e.caseList=n.walk(e.caseList,e)}}function b(e,t,n){if(e.body){e.body=n.walk(e.body,e)}}function w(e,t,n){if(e.tryNode){e.tryNode=n.walk(e.tryNode,e)}if(e.catchNode&&n.options.goNextSibling){e.catchNode=n.walk(e.catchNode,e)}}function E(e,t,n){if(e.tryNode){e.tryNode=n.walk(e.tryNode,e)}if(e.finallyNode&&n.options.goNextSibling){e.finallyNode=n.walk(e.finallyNode,e)}}function S(e,t,n){if(e.body){e.body=n.walk(e.body,e)}}function x(e,t,n){if(e.param){e.param=n.walk(e.param,e)}if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function T(e,t,n){e.name=n.walk(e.name,e);if(n.options.goNextSibling&&e.members){e.members=n.walk(e.members,e)}}function N(e,t,n){T(e,t,n)}function C(e,t,n){N(e,t,n);if(n.options.goNextSibling&&e.extendsList){e.extendsList=n.walk(e.extendsList,e)}if(n.options.goNextSibling&&e.implementsList){e.implementsList=n.walk(e.implementsList,e)}}function k(e,t,n){if(e.bod){e.bod=n.walk(e.bod,e)}}function L(e,t,n){N(e,t,n);if(n.options.goNextSibling&&e.extendsList){e.extendsList=n.walk(e.extendsList,e)}if(n.options.goNextSibling&&e.implementsList){e.implementsList=n.walk(e.implementsList,e)}}function A(e,t,n){T(e,t,n)}function O(e,t,n){if(e.id){e.id=n.walk(e.id,e)}if(e.alias){e.alias=n.walk(e.alias,e)}}function M(e,t,n){if(e.expr){e.expr=n.walk(e.expr,e)}if(e.body&&n.options.goNextSibling){e.body=n.walk(e.body,e)}}function _(e,t,n){}function D(e,t,n){e.labels=n.walk(e.labels,e);if(n.options.goNextSibling){e.stmt=n.walk(e.stmt,e)}}e.walkNone=t;e.walkListChildren=n;e.walkUnaryExpressionChildren=r;e.walkBinaryExpressionChildren=i;e.walkTypeReferenceChildren=s;e.walkCallExpressionChildren=o;e.walkTrinaryExpressionChildren=u;e.walkFuncDeclChildren=a;e.walkBoundDeclChildren=f;e.walkReturnStatementChildren=l;e.walkForStatementChildren=c;e.walkForInStatementChildren=h;e.walkIfStatementChildren=p;e.walkWhileStatementChildren=d;e.walkDoWhileStatementChildren=v;e.walkBlockChildren=m;e.walkCaseStatementChildren=g;e.walkSwitchStatementChildren=y;e.walkTryChildren=b;e.walkTryCatchChildren=w;e.walkTryFinallyChildren=E;e.walkFinallyChildren=S;e.walkCatchChildren=x;e.walkRecordChildren=T;e.walkNamedTypeChildren=N;e.walkClassDeclChildren=C;e.walkScriptChildren=k;e.walkTypeDeclChildren=L;e.walkModuleDeclChildren=A;e.walkImportDeclChildren=O;e.walkWithStatementChildren=M;e.walkLabelChildren=_;e.walkLabeledStatementChildren=D})(o||(o={}))})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(t){function n(t,n){var i=function(e,t){o.options.goChildren=r(true,e,n);return e};var s=function(e,t){r(false,e,n);return e};var o=e.getAstWalkerFactory().getWalker(i,s);o.walk(t,null)}function r(t,n,r){var i=n.nodeType;var s=e.NodeType._map[i]+"Callback";if(r[s]){return r[s](t,n)}if(r.DefaultCallback){return r.DefaultCallback(t,n)}return true}t.walk=n})(e.AstWalkerWithDetailCallback||(e.AstWalkerWithDetailCallback={}));var t=e.AstWalkerWithDetailCallback})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function t(e){return e===null||e.length===0?null:e[e.length-1]}function n(e,t){return e>=t?e:t}function r(e,t){return e<=t?e:t}function s(e){if(e===null){return false}if(e.minChar===-1||e.limChar===-1){return false}return true}function a(t,n,r){if(typeof r==="undefined"){r=u.Default}var i=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var r=e[t].minChar;var i=e[t].limChar;if(!e[t].isBlockComment){i++}if(n>=r&&n<i){f.path.push(e[t])}}}};var a=function(o,a,l){if(s(o)){var c=e.hasFlag(r,u.EdgeInclusive)||o.nodeType===e.NodeType.Name||n===t.limChar;var h=o.minChar;var p=o.limChar+(c?1:0);if(n>=h&&n<p){var d=f.path.ast();if(d==null||o.minChar>=d.minChar&&o.limChar<=d.limChar){f.path.push(o)}else{}}if(n<p){i(o.preComments)}if(n>=h){i(o.postComments)}if(!e.hasFlag(r,u.DontPruneSearchBasedOnPosition)){l.options.goChildren=h<=n&&n<=p}}return o};var f=new o;e.getAstWalkerFactory().walk(t,a,null,null,f);return f.path}function f(t,r){var i=0;var s=function(t,s,o){if(e.isValidAstNode(t)){if(t.minChar<=r){i=n(i,t.minChar)}if(t.minChar>r||t.limChar<i){o.options.goChildren=false}}return t};e.getAstWalkerFactory().walk(t,s);return i}function l(t,n){var r=function(e,t,r){var i=r.state;i.push(e);n(i,r);return e};var s=function(e,t,n){var r=n.state;r.pop();return e};var o=new i;e.getAstWalkerFactory().walk(t,r,s,null,o)}e.lastOf=t;e.max=n;e.min=r;var i=function(){function n(){this.asts=[];this.top=-1}n.reverseIndexOf=function(t,n){return t===null||t.length<=n?null:t[t.length-n-1]};n.prototype.clone=function(){var e=new n;e.asts=this.asts.map(function(e){return e});e.top=this.top;return e};n.prototype.pop=function(){var e=this.ast();this.up();while(this.asts.length>this.count()){this.asts.pop()}return e};n.prototype.push=function(e){while(this.asts.length>this.count()){this.asts.pop()}this.top=this.asts.length;this.asts.push(e)};n.prototype.up=function(){if(this.top<=-1){throw new Error("Invalid call to 'up'")}this.top--};n.prototype.down=function(){if(this.top==this.ast.length-1){throw new Error("Invalid call to 'down'")}this.top++};n.prototype.nodeType=function(){if(this.ast()==null){return e.NodeType.None}return this.ast().nodeType};n.prototype.ast=function(){return n.reverseIndexOf(this.asts,this.asts.length-(this.top+1))};n.prototype.parent=function(){return n.reverseIndexOf(this.asts,this.asts.length-this.top)};n.prototype.count=function(){return this.top+1};n.prototype.get=function(e){return this.asts[e]};n.prototype.isNameOfClass=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.ClassDeclaration&&this.parent().name===this.ast()};n.prototype.isNameOfInterface=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.InterfaceDeclaration&&this.parent().name===this.ast()};n.prototype.isNameOfArgument=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.ArgDecl&&this.parent().id===this.ast()};n.prototype.isNameOfVariable=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.VarDecl&&this.parent().id===this.ast()};n.prototype.isNameOfModule=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.ModuleDeclaration&&this.parent().name===this.ast()};n.prototype.isNameOfFunction=function(){if(this.ast()===null||this.parent()===null){return false}return this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.FuncDecl&&this.parent().name===this.ast()};n.prototype.isChildOfScript=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.Script};n.prototype.isChildOfModule=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.ModuleDeclaration};n.prototype.isChildOfClass=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.ClassDeclaration};n.prototype.isArgumentOfClassConstructor=function(){var n=t(this.asts);return this.count()>=5&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-3].nodeType===e.NodeType.List&&this.asts[this.top-4].nodeType===e.NodeType.ClassDeclaration&&this.asts[this.top-2].isConstructor&&this.asts[this.top-2].arguments===this.asts[this.top-1]&&this.asts[this.top-4].constructorDecl===this.asts[this.top-2]};n.prototype.isChildOfInterface=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.InterfaceDeclaration};n.prototype.isTopLevelImplicitModule=function(){return this.count()>=1&&this.asts[this.top].nodeType===e.NodeType.ModuleDeclaration&&e.hasFlag(this.asts[this.top].modFlags,e.ModuleFlags.IsWholeFile)};n.prototype.isBodyOfTopLevelImplicitModule=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.ModuleDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]&&e.hasFlag(this.asts[this.top-1].modFlags,e.ModuleFlags.IsWholeFile)};n.prototype.isBodyOfScript=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Script&&this.asts[this.top-1].bod==this.asts[this.top-0]};n.prototype.isBodyOfSwitch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Switch&&this.asts[this.top-1].caseList==this.asts[this.top-0]};n.prototype.isBodyOfModule=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ModuleDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]};n.prototype.isBodyOfClass=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ClassDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]};n.prototype.isBodyOfFunction=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-1].bod==this.asts[this.top-0]};n.prototype.isBodyOfInterface=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.InterfaceDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]};n.prototype.isBodyOfBlock=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Block&&this.asts[this.top-1].statements==this.asts[this.top-0]};n.prototype.isBodyOfFor=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.For&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfCase=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Case&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfTry=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Try&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfCatch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Catch&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfDoWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.DoWhile&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.While&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfForIn=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ForIn&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfWith=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.With&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isBodyOfFinally=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Finally&&this.asts[this.top-1].body==this.asts[this.top-0]};n.prototype.isCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.Switch&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]};n.prototype.isDefaultCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.Switch&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]&&this.asts[this.top-2].defaultCase==this.asts[this.top-0]};n.prototype.isListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]};n.prototype.isBodyOfObjectLit=function(){return this.isListOfObjectLit()};n.prototype.isEmptyListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]&&this.asts[this.top-0].members.length==0};n.prototype.isMemberOfObjectLit=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-0].nodeType===e.NodeType.Member&&this.asts[this.top-2].operand==this.asts[this.top-1]};n.prototype.isNameOfMemberOfObjectLit=function(){return this.count()>=4&&this.asts[this.top-3].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-2].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-0].nodeType===e.NodeType.Name&&this.asts[this.top-3].operand==this.asts[this.top-2]};n.prototype.isListOfArrayLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ArrayLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]};n.prototype.isTargetOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-1].operand1===this.asts[this.top-0]};n.prototype.isMemberOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-1].operand2===this.asts[this.top-0]};n.prototype.isItemOfList=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.List};n.prototype.isThenOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.If&&this.asts[this.top-1].thenBod==this.asts[this.top-0]};n.prototype.isElseOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.If&&this.asts[this.top-1].elseBod==this.asts[this.top-0]};n.prototype.isBodyOfDefaultCase=function(){return this.isBodyOfCase()};n.prototype.isSingleStatementList=function(){return this.count()>=1&&this.asts[this.top].nodeType===e.NodeType.List&&this.asts[this.top].members.length===1};n.prototype.isArgumentListOfFunction=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-1].arguments===this.asts[this.top-0]};n.prototype.isArgumentOfFunction=function(){return this.count()>=3&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-2].arguments===this.asts[this.top-1]};n.prototype.isArgumentListOfCall=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.Call&&this.asts[this.top-1].arguments===this.asts[this.top-0]};n.prototype.isArgumentListOfNew=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.New&&this.asts[this.top-1].arguments===this.asts[this.top-0]};n.prototype.isSynthesizedBlock=function(){return this.count()>=1&&this.asts[this.top-0].nodeType===e.NodeType.Block&&this.asts[this.top-0].isStatementBlock===false};return n}();e.AstPath=i;e.isValidAstNode=s;var o=function(){function t(){this.path=new e.AstPath}return t}();e.AstPathContext=o;(function(e){e._map=[];e.Default=0;e.EdgeInclusive=1;e.DontPruneSearchBasedOnPosition=1<<1})(e.GetAstPathOptions||(e.GetAstPathOptions={}));var u=e.GetAstPathOptions;e.getAstPathToPosition=a;e.getTokenizationOffset=f;e.walkAST=l})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.logger=e}t.prototype.logScript=function(t){var n=this;this.logLinemap(t.locationInfo.lineMap);var r=[];var i=function(e,i){r.push(e);var s=(r.length-1)*2;n.logComments(t,e.preComments,s);n.logNode(t,e,s);n.logComments(t,e.postComments,s);return e};var s=function(e,t){r.pop();return e};e.getAstWalkerFactory().walk(t,i,s)};t.prototype.logNode=function(e,t,n){var r=this.addPadding("",n,"| ",true);r=r.concat("+ "+t.treeViewLabel());r=this.addPadding(r,70," ",false);r=r+this.addLineColumn(e,t.minChar);r=this.addPadding(r,80," ",false);r=r+"=> ";r=r+this.addLineColumn(e,t.limChar);r=this.addPadding(r,102," ",false);r=r.concat("["+this.addPadding(t.minChar.toString(),1," ",true)+", "+this.addPadding(t.limChar.toString(),1," ",true)+"]");r=this.addPadding(r,115," ",false);r=r.concat("sym="+t.sym);r=this.addPadding(r,135," ",false);r=r.concat("type="+(t.type===null?"null":t.type.getTypeName()));this.logger.log(r)};t.prototype.logComments=function(e,t,n){if(t==null){return}for(var r=0;r<t.length;r++){this.logNode(e,t[r],n)}};t.prototype.logLinemap=function(e){var t="[";for(var n=0;n<e.length;n++){if(n>0){t+=","}t+=e[n]}t+="]";this.logger.log("linemap: "+t)};t.prototype.addPadding=function(e,t,n,r){var i=r?"":e;for(var s=e.length;s<t;s++){i=i+n}i=i+(r?e:"");return i};t.prototype.addLineColumn=function(t,n){var r={line:-1,col:-1};e.getSourceLineColFromMap(r,n,t.locationInfo.lineMap);if(r.col!==-1){r.col++}return"("+r.line+", "+r.col+")"};return t}();e.AstLogger=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.checker=e}t.prototype.resolveBaseTypeLinks=function(e,t){var n=null;if(e){n=new Array;for(var r=0,i=e.length;r<i;r++){var s=e[r];this.checker.resolvingBases=true;this.checker.resolveTypeLink(t,s,true);this.checker.resolvingBases=false;if(s.type.isClass()){n[r]=s.type.instanceType}else{n[r]=s.type}}}return n};t.prototype.resolveBases=function(e,t){t.extendsList=this.resolveBaseTypeLinks(t.extendsTypeLinks,e);var n=0,r=t.extendsList.length;var i=t.isClassInstance();for(;n<r;n++){var s=t.extendsList[n].isClassInstance();if(t.extendsList[n]!=this.checker.anyType){if(i){if(!s){this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A export class may only extend other classes, "+t.extendsList[n].symbol.fullName()+" is an interface.")}}else{if(s){this.checker.errorReporter.simpleErrorFromSym(t.symbol,"An interface may only extend other interfaces, "+t.extendsList[n].symbol.fullName()+" is a class.")}}}}t.implementsList=this.resolveBaseTypeLinks(t.implementsTypeLinks,e);if(t.implementsList){for(n=0,r=t.implementsList.length;n<r;n++){var o=t.implementsList[n];if(o.isClassInstance()){if(i){this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A class may only implement an interface; "+o.symbol.fullName()+" is a class.")}}}}};t.prototype.resolveSignatureGroup=function(e,t,n){var r=!e.hasImplementation;for(var i=0,s=e.signatures.length;i<s;i++){var o=e.signatures[i];if(n){o.returnType.type=n}else{this.checker.resolveTypeLink(t,o.returnType,r)}var u=o.parameters.length;for(var a=0;a<u;a++){this.bindSymbol(t,o.parameters[a])}if(o.hasVariableArgList){var f=o.parameters[u-1];f.argsOffset=u-1;if(!f.getType().isArray()){this.checker.errorReporter.simpleErrorFromSym(f,"... parameter must have array type");f.parameter.typeLink.type=this.checker.makeArrayType(f.parameter.typeLink.type)}}}};t.prototype.bindType=function(t,n,r){if(r){this.bindType(t,r,null)}if(n.hasMembers()){var i=n.members;var s=n.ambientMembers;var o=n.getAllEnclosedTypes();var u=n.getAllAmbientEnclosedTypes();var a=new e.SymbolTableScope(i,s,o,u,n.symbol);var f=new e.SymbolAggregateScope(n.symbol);var l=this.checker.currentModDecl;var c=this.checker.inBind;f.addParentScope(a);f.addParentScope(t);if(n.isModuleType()){this.checker.currentModDecl=n.symbol.declAST;this.checker.inBind=true}if(i){this.bind(f,n.members.allMembers)}if(o){this.bind(f,o.allMembers)}if(s){this.bind(f,s.allMembers)}if(u){this.bind(f,u.allMembers)}this.checker.currentModDecl=l;this.checker.inBind=c}if(n.extendsTypeLinks){this.resolveBases(t,n)}if(n.construct){this.resolveSignatureGroup(n.construct,t,r)}if(n.call){this.resolveSignatureGroup(n.call,t,null)}if(n.index){this.resolveSignatureGroup(n.index,t,null)}if(n.elementType){this.bindType(t,n.elementType,null)}};t.prototype.bindSymbol=function(t,n){if(!n.bound){var r=this.checker.locationInfo;if(this.checker.units&&n.unitIndex>=0&&n.unitIndex<this.checker.units.length){this.checker.locationInfo=this.checker.units[n.unitIndex]}switch(n.kind()){case e.SymbolKind.Type:{if(n.flags&e.SymbolFlags.Bound){break}var i=n;i.flags|=e.SymbolFlags.Bound;if(i.aliasLink&&!i.type&&i.aliasLink.alias.nodeType==e.NodeType.Name){var s=i.aliasLink.alias.text;var o=this.checker.findSymbolForDynamicModule(s,this.checker.locationInfo.filename,function(e){return t.find(e,false,true)});if(o){i.type=o.getType()}}if(i.type&&i.type!=this.checker.gloModType){this.bindType(t,i.type,i.instanceType);if(i.type.isModuleType()){for(var u=0;u<i.expansions.length;u++){this.bindType(t,i.expansions[u],i.instanceType)}}}break};case e.SymbolKind.Field:{this.checker.resolveTypeLink(t,n.field.typeLink,false);break};case e.SymbolKind.Parameter:{this.checker.resolveTypeLink(t,n.parameter.typeLink,true);break}}this.checker.locationInfo=r}n.bound=true};t.prototype.bind=function(e,t){t.map(function(t,n,r){r.bindSymbol(e,n)},this)};return t}();e.Binder=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(){}e.encodedValues="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";e.encode=function(n){if(n<64){return e.encodedValues.charAt(n)}throw TypeError(n+": not a 64 based value")};e.decodeChar=function(n){if(n.length===1){return e.encodedValues.indexOf(n)}else{throw TypeError('"'+n+'" must have length 1')}};return e}();var n=function(){function e(){}e.encode=function(n){if(n<0){n=(-n<<1)+1}else{n=n<<1}var r="";do{var i=n&31;n=n>>5;if(n>0){i=i|32}r=r+t.encode(i)}while(n>0);return r};e.decode=function(n){var r=0;var i=false;var s=0;for(var o=0;o<n.length;o++){var u=t.decodeChar(n[o]);if(o===0){if((u&1)===1){i=true}r=u>>1&15}else{r=r|(u&31)<<s}s+=o==0?4:5;if((u&32)===32){}else{return{value:i?-r:r,rest:n.substr(o+1)}}}throw new Error('Base64 value "'+n+'" finished with a continuation bit')};return e}();e.Base64VLQFormat=n})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(){}return e}();e.SourceMapPosition=t;var n=function(){function e(){this.start=new t;this.end=new t;this.nameIndex=-1;this.childMappings=[]}return e}();e.SourceMapping=n;var r=function(){function t(t,n,r,i){this.jsFile=r;this.sourceMapOut=i;this.sourceMappings=[];this.currentMappings=[];this.names=[];this.currentNameIndex=[];this.currentMappings.push(this.sourceMappings);n=e.switchToForwardSlashes(n);this.jsFileName=e.getPrettyName(n,false,true);var s=n.lastIndexOf(this.jsFileName);var o=n.substring(0,s);this.tsFileName=e.getRelativePathToFixedPath(o,t)}t.MapFileExtension=".map";t.EmitSourceMapping=function(r){var i=r[0];i.jsFile.WriteLine("//@ sourceMappingURL="+i.jsFileName+t.MapFileExtension);var s=i.sourceMapOut;var o="";var u=[];var a=0;var f=0;var l=0;var c=0;var h=0;var p=0;var d=[];var v=0;var m=false;var g=null;for(var y=0;y<r.length;y++){i=r[y];var b=u.length;u.push(i.tsFileName);if(i.names.length>0){d.push(i.names.join('","'))}var w=function(t,n){if(g!=null&&g.emittedColumn==t.emittedColumn&&g.emittedLine==t.emittedLine){return}if(f!==t.emittedLine){while(f<t.emittedLine){a=0;o=o+";";f++}m=false}else{if(m){o=o+","}}o=o+e.Base64VLQFormat.encode(t.emittedColumn-a);a=t.emittedColumn;o=o+e.Base64VLQFormat.encode(b-h);h=b;o=o+e.Base64VLQFormat.encode(t.sourceLine-1-c);c=t.sourceLine-1;o=o+e.Base64VLQFormat.encode(t.sourceColumn-l);l=t.sourceColumn;if(n>=0){o=o+e.Base64VLQFormat.encode(v+n-p);p=v+n}m=true;g=t};var E=function(e){for(var t=0;t<e.length;t++){var n=e[t];w(n.start,n.nameIndex);E(n.childMappings);w(n.end,n.nameIndex)}};E(i.sourceMappings,-1);v=v+i.names.length}if(o!=""){s.Write("{");s.Write('"version":3,');s.Write('"file":"'+i.jsFileName+'",');s.Write('"sources":["'+u.join('","')+'"],');s.Write('"names":["'+d.join('","')+'"],');s.Write('"mappings":"'+o);s.Write('"');s.Write("}")}s.Close()};return t}();e.SourceMapper=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[];e._map[0]="Prog";e.Prog=0;e._map[1]="Module";e.Module=1;e._map[2]="DynamicModule";e.DynamicModule=2;e._map[3]="Class";e.Class=3;e._map[4]="Constructor";e.Constructor=4;e._map[5]="Function";e.Function=5;e._map[6]="Args";e.Args=6;e._map[7]="Interface";e.Interface=7})(e.EmitContainer||(e.EmitContainer={}));var t=e.EmitContainer;var n=function(){function e(){this.column=0;this.line=0;this.pretty=false;this.inObjectLiteral=false;this.container=t.Prog}return e}();e.EmitState=n;var r=function(){function e(){this.indentAmt=0}e.indentStep=4;e.indentStepString="    ";e.indentStrings=[];e.prototype.increaseIndent=function(){this.indentAmt+=e.indentStep};e.prototype.decreaseIndent=function(){this.indentAmt-=e.indentStep};e.prototype.getIndent=function(){var t=e.indentStrings[this.indentAmt];if(t===undefined){t="";for(var n=0;n<this.indentAmt;n=n+e.indentStep){t+=e.indentStepString}e.indentStrings[this.indentAmt]=t}return t};return e}();e.Indenter=r;var i=function(){function i(e,t,i){this.checker=e;this.outfile=t;this.emitOptions=i;this.prologueEmitted=false;this.thisClassNode=null;this.thisFnc=null;this.moduleDeclList=[];this.moduleName="";this.emitState=new n;this.indenter=new r;this.ambientModule=false;this.modAliasId=null;this.firstModAlias=null;this.allSourceMappers=[];this.sourceMapper=null;this.captureThisStmtString="var _this = this;";this.varListCount=0}i.prototype.setSourceMappings=function(e){this.allSourceMappers.push(e);this.sourceMapper=e};i.prototype.writeToOutput=function(e){this.outfile.Write(e);this.emitState.column+=e.length};i.prototype.writeToOutputTrimmable=function(e){if(this.emitOptions.minWhitespace){e=e.replace(/[\s]*/g,"")}this.writeToOutput(e)};i.prototype.writeLineToOutput=function(t){if(this.emitOptions.minWhitespace){this.writeToOutput(t);var n=t.charCodeAt(t.length-1);if(!(n==e.LexCodeSpace||n==e.LexCodeSMC||n==e.LexCodeLBR)){this.writeToOutput(" ")}}else{this.outfile.WriteLine(t);this.emitState.column=0;this.emitState.line++}};i.prototype.writeCaptureThisStatement=function(e){this.emitIndent();this.recordSourceMappingStart(e);this.writeToOutput(this.captureThisStmtString);this.recordSourceMappingEnd(e);this.writeLineToOutput("")};i.prototype.setInVarBlock=function(e){this.varListCount=e};i.prototype.setInObjectLiteral=function(e){var t=this.emitState.inObjectLiteral;this.emitState.inObjectLiteral=e;return t};i.prototype.setContainer=function(e){var t=this.emitState.container;this.emitState.container=e;return t};i.prototype.getIndentString=function(){if(this.emitOptions.minWhitespace){return""}else{return this.indenter.getIndent()}};i.prototype.emitIndent=function(){this.writeToOutput(this.getIndentString())};i.prototype.emitCommentInPlace=function(e){this.recordSourceMappingStart(e);var t=e.getText();var n=false;if(e.isBlockComment){if(this.emitState.column==0){this.emitIndent()}this.writeToOutput(t[0]);if(t.length>1||e.endsLine){this.writeLineToOutput("");for(var r=1;r<t.length;r++){this.emitIndent();this.writeLineToOutput(t[r])}n=true}}else{if(this.emitState.column==0){this.emitIndent()}this.writeLineToOutput(t[0]);n=true}if(n){this.emitIndent()}else{this.writeToOutput(" ")}this.recordSourceMappingEnd(e)};i.prototype.emitParensAndCommentsInPlace=function(e,t){var n=t?e.preComments:e.postComments;if(e.isParenthesized&&!t){this.writeToOutput(")")}if(this.emitOptions.emitComments&&n&&n.length!=0){for(var r=0;r<n.length;r++){this.emitCommentInPlace(n[r])}}if(e.isParenthesized&&t){this.writeToOutput("(")}};i.prototype.emitObjectLiteral=function(t){this.writeLineToOutput("{");this.indenter.increaseIndent();var n=this.setInObjectLiteral(true);this.emitJavascriptList(t,",",e.TokenID.Comma,true,false,false);this.setInObjectLiteral(n);this.indenter.decreaseIndent();this.emitIndent();this.writeToOutput("}")};i.prototype.emitArrayLiteral=function(t){this.writeToOutput("[");if(t){this.writeLineToOutput("");this.indenter.increaseIndent();this.emitJavascriptList(t,", ",e.TokenID.Comma,true,false,false);this.indenter.decreaseIndent();this.emitIndent()}this.writeToOutput("]")};i.prototype.emitNew=function(t,n){this.writeToOutput("new ");if(t.nodeType==e.NodeType.TypeRef){this.writeToOutput("Array()")}else{this.emitJavascript(t,e.TokenID.Tilde,false);this.recordSourceMappingStart(n);this.writeToOutput("(");this.emitJavascriptList(n,", ",e.TokenID.Comma,false,false,false);this.writeToOutput(")");this.recordSourceMappingEnd(n)}};i.prototype.tryEmitConstant=function(t){if(!this.emitOptions.propagateConstants){return false}var n=t.operand2;if(n&&n.sym&&n.sym.isVariable()){if(e.hasFlag(n.sym.flags,e.SymbolFlags.Constant)){if(n.sym.declAST){var r=n.sym.declAST;if(r.init&&r.init.nodeType==e.NodeType.NumberLit){var i=r.init;this.writeToOutput(i.value.toString());var s=" /* ";s+=n.actualText;s+=" */ ";this.writeToOutput(s);return true}}}}return false};i.prototype.emitCall=function(t,n,r){if(!this.emitSuperCall(t)){if(!e.hasFlag(t.flags,e.ASTFlags.ClassBaseConstructorCall)){if(n.nodeType==e.NodeType.FuncDecl&&!n.isParenthesized){this.writeToOutput("(")}this.emitJavascript(n,e.TokenID.OpenParen,false);if(n.nodeType==e.NodeType.FuncDecl&&!n.isParenthesized){this.writeToOutput(")")}this.recordSourceMappingStart(r);this.writeToOutput("(");this.emitJavascriptList(r,", ",e.TokenID.Comma,false,false,false);this.writeToOutput(")");this.recordSourceMappingEnd(r)}else{this.indenter.decreaseIndent();this.indenter.decreaseIndent();var i=new e.ASTList;i.members[0]=t;this.emitConstructorCalls(i,this.thisClassNode);this.indenter.increaseIndent();this.indenter.increaseIndent()}}};i.prototype.defaultValue=function(e){if(e==this.checker.anyType){return"undefined"}else{if(e==this.checker.numberType){return"0"}else{if(e==this.checker.stringType){return'""'}else{if(e==this.checker.booleanType){return"false"}else{return"null"}}}}};i.prototype.emitConstructorCalls=function(t,n){if(t==null){return}var r=t.members.length;this.recordSourceMappingStart(n);for(var i=0;i<r;i++){var s=t.members[i];var o=null;if(s.nodeType==e.NodeType.Call){o=s.target.type.symbol}else{o=s.type.symbol}var u=o.name;if(o.declModule!=n.type.symbol.declModule){u=o.fullName()}if(s.nodeType==e.NodeType.Call){this.emitIndent();this.writeToOutput("_super.call(this");var a=s.arguments;if(a&&a.members.length>0){this.writeToOutput(", ");this.emitJavascriptList(a,", ",e.TokenID.Comma,false,false,false)}this.writeToOutput(")")}else{if(s.type&&s.type.isClassInstance()){this.emitIndent();this.writeToOutput(n.name.actualText+"._super.constructor");this.writeToOutput(".call(this)")}}}this.recordSourceMappingEnd(n)};i.prototype.emitInnerFunction=function(n,r,i,s,o,u){var a=n.isConstructor&&e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod);var f=a&&e.hasFlag(this.thisClassNode.type.instanceType.typeFlags,e.TypeFlags.HasBaseType)&&!e.hasFlag(this.thisClassNode.type.instanceType.typeFlags,e.TypeFlags.HasBaseTypeOfObject);var l=f&&e.hasFlag(this.thisClassNode.varFlags,e.VarFlags.ClassSuperMustBeFirstCallInConstructor);this.emitParensAndCommentsInPlace(n,true);this.recordSourceMappingStart(n);if(!(n.isAccessor()&&n.accessorSymbol.isObjectLitField)){this.writeToOutput("function ")}if(r){var c=n.getNameText();if(c&&!n.isAccessor()){if(n.name){this.recordSourceMappingStart(n.name)}this.writeToOutput(c);if(n.name){this.recordSourceMappingEnd(n.name)}}}this.writeToOutput("(");var h=0;var p=0;var d;var v=[];if(n.arguments){var m=this.setContainer(t.Args);h=n.arguments.members.length;var g=h;if(n.variableArgList){g--}for(p=0;p<g;p++){d=n.arguments.members[p];if(d.init){v.push(d)}this.emitJavascript(d,e.TokenID.OpenParen,false);if(p<g-1){this.writeToOutput(", ")}}this.setContainer(m)}this.writeLineToOutput(") {");if(n.isConstructor){this.recordSourceMappingNameStart("constructor")}else{if(n.isGetAccessor()){this.recordSourceMappingNameStart("get_"+n.getNameText())}else{if(n.isSetAccessor()){this.recordSourceMappingNameStart("set_"+n.getNameText())}else{this.recordSourceMappingNameStart(n.getNameText())}}}this.indenter.increaseIndent();for(p=0;p<v.length;p++){var d=v[p];this.emitIndent();this.recordSourceMappingStart(d);this.writeToOutput("if (typeof "+d.id.actualText+' === "undefined") { ');this.recordSourceMappingStart(d.id);this.writeToOutput(d.id.actualText);this.recordSourceMappingEnd(d.id);this.writeToOutput(" = ");this.emitJavascript(d.init,e.TokenID.OpenParen,false);this.writeLineToOutput("; }");this.recordSourceMappingEnd(d)}if(n.isConstructor&&n.classDecl.varFlags&e.VarFlags.MustCaptureThis){this.writeCaptureThisStatement(n)}if(n.isConstructor&&!l){if(n.arguments){h=n.arguments.members.length;for(p=0;p<h;p++){d=n.arguments.members[p];if((d.varFlags&e.VarFlags.Property)!=e.VarFlags.None){this.emitIndent();this.recordSourceMappingStart(d);this.recordSourceMappingStart(d.id);this.writeToOutput("this."+d.id.actualText);this.recordSourceMappingEnd(d.id);this.writeToOutput(" = ");this.recordSourceMappingStart(d.id);this.writeToOutput(d.id.actualText);this.recordSourceMappingEnd(d.id);this.writeLineToOutput(";");this.recordSourceMappingEnd(d)}}}if(!e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod)){this.emitConstructorCalls(s,u)}}if(o){this.writeCaptureThisStatement(n)}if(n.variableArgList){h=n.arguments.members.length;var y=n.arguments.members[h-1];this.emitIndent();this.recordSourceMappingStart(y);this.writeToOutput("var ");this.recordSourceMappingStart(y.id);this.writeToOutput(y.id.actualText);this.recordSourceMappingEnd(y.id);this.writeLineToOutput(" = [];");this.recordSourceMappingEnd(y);this.emitIndent();this.writeToOutput("for (");this.recordSourceMappingStart(y);this.writeToOutput("var _i = 0;");this.recordSourceMappingEnd(y);this.writeToOutput(" ");this.recordSourceMappingStart(y);this.writeToOutput("_i < (arguments.length - "+(h-1)+")");this.recordSourceMappingEnd(y);this.writeToOutput("; ");this.recordSourceMappingStart(y);this.writeToOutput("_i++");this.recordSourceMappingEnd(y);this.writeLineToOutput(") {");this.indenter.increaseIndent();this.emitIndent();this.recordSourceMappingStart(y);this.writeToOutput(y.id.actualText+"[_i] = arguments[_i + "+(h-1)+"];");this.recordSourceMappingEnd(y);this.writeLineToOutput("");this.indenter.decreaseIndent();this.emitIndent();this.writeLineToOutput("}")}if(n.isConstructor&&e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod)&&!l){var b=this.thisClassNode.members.members.length;for(var p=0;p<b;p++){if(this.thisClassNode.members.members[p].nodeType==e.NodeType.VarDecl){var w=this.thisClassNode.members.members[p];if(!e.hasFlag(w.varFlags,e.VarFlags.Static)&&w.init){this.emitIndent();this.emitJavascriptVarDecl(w,e.TokenID.Tilde);this.writeLineToOutput("")}}}}this.emitBareJavascriptStatements(n.bod,l);this.indenter.decreaseIndent();this.emitIndent();this.recordSourceMappingStart(n.endingToken);this.writeToOutput("}");this.recordSourceMappingNameEnd();this.recordSourceMappingEnd(n.endingToken);this.recordSourceMappingEnd(n);this.recordSourceMappingEnd(n);if(!i&&!e.hasFlag(n.fncFlags,e.FncFlags.IsFunctionExpression)&&(e.hasFlag(n.fncFlags,e.FncFlags.Definition)||n.isConstructor)){this.writeLineToOutput("")}if(n.hasStaticDeclarations()){this.writeLineToOutput("");this.emitIndent();var E=n.getNameText();this.writeLineToOutput("(function ("+E+") {");this.indenter.increaseIndent();var S=0;var p=0;S=n.innerStaticFuncs.length;for(p=0;p<S;p++){var x=n.innerStaticFuncs[p];if(x.isOverload){continue}this.emitIndent();if(x.isAccessor()){this.emitPropertyAccessor(x,n.name.actualText,false)}else{this.recordSourceMappingStart(x);this.writeToOutput(E+"."+x.name.actualText+" = ");this.emitInnerFunction(x,x.name&&!x.name.isMissing(),false,null,x.hasSelfReference(),null)}}if(n.statics){this.recordSourceMappingStart(n.statics);S=n.statics.members.length;for(p=0;p<S;p++){this.emitIndent();this.writeToOutput(E);this.emitJavascript(n.statics.members[p],e.TokenID.Tilde,false);this.writeLineToOutput("")}this.recordSourceMappingEnd(n.statics)}this.indenter.decreaseIndent();this.emitIndent();var T=i&&this.thisClassNode;var N=T?this.thisClassNode.name.actualText+".prototype.":"";this.writeLineToOutput("})("+N+E+");")}this.emitParensAndCommentsInPlace(n,false)};i.prototype.emitJavascriptModule=function(n){var r=n.name.actualText;if(e.isTSFile(r)){n.name.setText(r.substring(0,r.length-3))}else{if(e.isSTRFile(r)){n.name.setText(r.substring(0,r.length-4))}}if(!e.hasFlag(n.modFlags,e.ModuleFlags.Ambient)){var i=e.hasFlag(n.modFlags,e.ModuleFlags.IsDynamic);var s=this.outfile;var o=this.allSourceMappers;var u=this.sourceMapper;var a=this.emitState.column;var f=this.emitState.line;var l=this.setContainer(t.Module);var c=this.moduleName;var h=e.hasFlag(n.modFlags,e.ModuleFlags.Exported);this.moduleDeclList[this.moduleDeclList.length]=n;var p=e.hasFlag(n.modFlags,e.ModuleFlags.IsWholeFile);this.moduleName=n.name.actualText;if(i){var d=e.stripQuotes(n.name.actualText);var v=e.trimModName(d)+".js";if(this.emitOptions.createFile){if(e.switchToForwardSlashes(v)!=e.switchToForwardSlashes(this.emitOptions.path)){var m=n.containsUnicodeChar||this.emitOptions.emitComments&&n.containsUnicodeCharInComment;this.outfile=this.emitOptions.createFile(v,m);if(u!=null){this.allSourceMappers=[];this.setSourceMappings(new e.SourceMapper(d,v,this.outfile,this.emitOptions.createFile(v+e.SourceMapper.MapFileExtension)));this.emitState.column=0;this.emitState.line=0}}else{if(!this.emitOptions.outputMany){this.checker.errorReporter.emitterError(n,"Module emit collides with emitted script: "+v)}}}this.setContainer(t.DynamicModule);this.recordSourceMappingStart(n);if(e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){var g='["require", "exports"';var y="require, exports";var b=null;for(var w=0;w<n.mod.importedModules.length;w++){b=n.mod.importedModules[w];if(b.id.sym&&!b.id.sym.onlyReferencedAsTypeRef){if(w<=n.mod.importedModules.length-1){g+=", ";y+=", "}y+="__"+b.id.actualText+"__";g+=b.firstAliasedModToString()}}for(var w=0;w<n.amdDependencies.length;w++){g+=', "'+n.amdDependencies[w]+'"'}g+="]";this.writeLineToOutput("define("+g+","+" function("+y+") {")}else{}}else{if(!h){this.recordSourceMappingStart(n);this.writeToOutput("var ");this.recordSourceMappingStart(n.name);this.writeToOutput(this.moduleName);this.recordSourceMappingEnd(n.name);this.writeLineToOutput(";");this.recordSourceMappingEnd(n);this.emitIndent()}this.writeToOutput("(");this.recordSourceMappingStart(n);this.writeToOutput("function (");this.recordSourceMappingStart(n.name);this.writeToOutput(this.moduleName);this.recordSourceMappingEnd(n.name);this.writeLineToOutput(") {")}if(!p){this.recordSourceMappingNameStart(this.moduleName)}if(!i||e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){this.indenter.increaseIndent()}if(n.modFlags&e.ModuleFlags.MustCaptureThis){this.writeCaptureThisStatement(n)}this.emitJavascriptList(n.members,null,e.TokenID.Semicolon,true,false,false);if(!i||e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){this.indenter.decreaseIndent()}this.emitIndent();if(i){if(e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){this.writeLineToOutput("})")}else{}if(!p){this.recordSourceMappingNameEnd()}this.recordSourceMappingEnd(n);if(this.outfile!=s){if(u!=null){this.emitSourceMappings();this.allSourceMappers=o;this.sourceMapper=u;this.emitState.column=a;this.emitState.line=f}this.outfile.Close();this.outfile=s}}else{var E=null;if(n.type&&n.type.symbol.container&&n.type.symbol.container.declAST){E=n.type.symbol.container.declAST}var S=E&&e.hasFlag(E.modFlags,e.ModuleFlags.IsDynamic);this.recordSourceMappingStart(n.endingToken);if(l==t.Prog&&h){this.writeToOutput("}");if(!p){this.recordSourceMappingNameEnd()}this.recordSourceMappingEnd(n.endingToken);this.writeLineToOutput(")(this."+this.moduleName+" || (this."+this.moduleName+" = {}));")}else{if(h||l==t.Prog){var x=c!=""?(S?"exports":c)+".":c;this.writeToOutput("}");if(!p){this.recordSourceMappingNameEnd()}this.recordSourceMappingEnd(n.endingToken);this.writeLineToOutput(")("+x+this.moduleName+" || ("+x+this.moduleName+" = {}));")}else{if(!h&&l!=t.Prog){this.writeToOutput("}");if(!p){this.recordSourceMappingNameEnd()}this.recordSourceMappingEnd(n.endingToken);this.writeLineToOutput(")("+this.moduleName+" || ("+this.moduleName+" = {}));")}else{this.writeToOutput("}");if(!p){this.recordSourceMappingNameEnd()}this.recordSourceMappingEnd(n.endingToken);this.writeLineToOutput(")();")}}}this.recordSourceMappingEnd(n);if(l!=t.Prog&&h){this.emitIndent();this.recordSourceMappingStart(n);if(S){this.writeLineToOutput("var "+this.moduleName+" = exports."+this.moduleName+";")}else{this.writeLineToOutput("var "+this.moduleName+" = "+c+"."+this.moduleName+";")}this.recordSourceMappingEnd(n)}}this.setContainer(l);this.moduleName=c;this.moduleDeclList.length--}};i.prototype.emitIndex=function(t,n){var r=this.setInObjectLiteral(false);this.emitJavascript(t,e.TokenID.Tilde,false);this.writeToOutput("[");this.emitJavascriptList(n,", ",e.TokenID.Comma,false,false,false);this.writeToOutput("]");this.setInObjectLiteral(r)};i.prototype.emitStringLiteral=function(e){this.writeToOutput(e)};i.prototype.emitJavascriptFunction=function(n){if(e.hasFlag(n.fncFlags,e.FncFlags.Signature)||n.isOverload){return}var r;var i=this.thisFnc;this.thisFnc=n;if(n.isConstructor){r=this.setContainer(t.Constructor)}else{r=this.setContainer(t.Function)}var s=null;var o=false;var u=n.getNameText();if((this.emitState.inObjectLiteral||!n.isAccessor())&&(r!=t.Constructor||(n.fncFlags&e.FncFlags.Method)==e.FncFlags.None)){var a=this.setInObjectLiteral(false);if(this.thisClassNode){s=this.thisClassNode.extendsList}o=n.hasSelfReference();this.recordSourceMappingStart(n);if(e.hasFlag(n.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)&&n.type.symbol.container==this.checker.gloMod&&!n.isConstructor){this.writeToOutput("this."+u+" = ");this.emitInnerFunction(n,false,false,s,o,this.thisClassNode)}else{this.emitInnerFunction(n,n.name&&!n.name.isMissing(),false,s,o,this.thisClassNode)}this.setInObjectLiteral(a)}this.setContainer(r);this.thisFnc=i;if(e.hasFlag(n.fncFlags,e.FncFlags.Definition)){if(e.hasFlag(n.fncFlags,e.FncFlags.Static)){if(this.thisClassNode){if(n.isAccessor()){this.emitPropertyAccessor(n,this.thisClassNode.name.actualText,false)}else{this.emitIndent();this.recordSourceMappingStart(n);this.writeLineToOutput(this.thisClassNode.name.actualText+"."+u+" = "+u+";");this.recordSourceMappingEnd(n)}}}else{if((this.emitState.container==t.Module||this.emitState.container==t.DynamicModule)&&e.hasFlag(n.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)){this.emitIndent();var f=this.emitState.container==t.Module?this.moduleName:"exports";this.recordSourceMappingStart(n);this.writeLineToOutput(f+"."+u+" = "+u+";");this.recordSourceMappingEnd(n)}}}};i.prototype.emitAmbientVarDecl=function(t){if(t.init){this.emitParensAndCommentsInPlace(t,true);this.recordSourceMappingStart(t);this.recordSourceMappingStart(t.id);this.writeToOutput(t.id.actualText);this.recordSourceMappingEnd(t.id);this.writeToOutput(" = ");this.emitJavascript(t.init,e.TokenID.Comma,false);this.recordSourceMappingEnd(t);this.writeToOutput(";");this.emitParensAndCommentsInPlace(t,false)}};i.prototype.emitVarDeclVar=function(){if(this.varListCount>=0){this.writeToOutput("var ");this.varListCount=-this.varListCount}return true};i.prototype.onEmitVar=function(){if(this.varListCount>0){this.varListCount--}else{if(this.varListCount<0){this.varListCount++}}};i.prototype.emitJavascriptVarDecl=function(n,r){if((n.varFlags&e.VarFlags.Ambient)==e.VarFlags.Ambient){this.emitAmbientVarDecl(n);this.onEmitVar()}else{var i=n.sym;var s=n.init!=null;this.emitParensAndCommentsInPlace(n,true);this.recordSourceMappingStart(n);if(i&&i.isMember()&&i.container&&i.container.kind()==e.SymbolKind.Type){var o=i.container.type;if(o.isClass()&&!e.hasFlag(i.flags,e.SymbolFlags.ModuleMember)){if(this.emitState.container!=t.Args){if(e.hasFlag(i.flags,e.SymbolFlags.Static)){this.writeToOutput(i.container.name+".")}else{this.writeToOutput("this.")}}}else{if(o.hasImplementation()){if(!e.hasFlag(i.flags,e.SymbolFlags.Exported)&&(i.container==this.checker.gloMod||!e.hasFlag(i.flags,e.SymbolFlags.Property))){this.emitVarDeclVar()}else{if(e.hasFlag(n.varFlags,e.VarFlags.LocalStatic)){this.writeToOutput(".")}else{if(this.emitState.container==t.DynamicModule){this.writeToOutput("exports.")}else{this.writeToOutput(this.moduleName+".")}}}}else{if(r!=e.TokenID.OpenParen){if(e.hasFlag(i.flags,e.SymbolFlags.Exported)&&i.container==this.checker.gloMod){this.writeToOutput("this.")}else{this.emitVarDeclVar()}}}}}else{if(r!=e.TokenID.OpenParen){this.emitVarDeclVar()}}this.recordSourceMappingStart(n.id);this.writeToOutput(n.id.actualText);this.recordSourceMappingEnd(n.id);if(s){this.writeToOutputTrimmable(" = ");this.emitJavascript(n.init,e.TokenID.Comma,false)}else{if(i&&i.isMember()&&this.emitState.container==t.Constructor){this.writeToOutputTrimmable(" = ");this.writeToOutput(this.defaultValue(n.type))}}this.onEmitVar();if(r!=e.TokenID.OpenParen){if(this.varListCount<0){this.writeToOutput(", ")}else{if(r!=e.TokenID.For){this.writeToOutputTrimmable(";")}}}this.recordSourceMappingEnd(n);this.emitParensAndCommentsInPlace(n,false)}};i.prototype.declEnclosed=function(e){if(e==null){return true}for(var t=0,n=this.moduleDeclList.length;t<n;t++){if(this.moduleDeclList[t]==e){return true}}return false};i.prototype.emitJavascriptName=function(n,r){var i=n.sym;this.emitParensAndCommentsInPlace(n,true);this.recordSourceMappingStart(n);if(!n.isMissing()){if(r&&this.emitState.container!=t.Args&&i){if(i.container&&i.container.name!=e.globalId){if(e.hasFlag(i.flags,e.SymbolFlags.Static)&&e.hasFlag(i.flags,e.SymbolFlags.Property)){if(i.declModule&&e.hasFlag(i.declModule.modFlags,e.ModuleFlags.IsDynamic)){this.writeToOutput("exports.")}else{this.writeToOutput(i.container.name+".")}}else{if(i.kind()==e.SymbolKind.Field){var s=i;if(e.hasFlag(s.flags,e.SymbolFlags.ModuleMember)){if(i.container!=this.checker.gloMod&&(e.hasFlag(i.flags,e.SymbolFlags.Property)||e.hasFlag(i.flags,e.SymbolFlags.Exported))){if(e.hasFlag(i.declModule.modFlags,e.ModuleFlags.IsDynamic)){this.writeToOutput("exports.")}else{this.writeToOutput(i.container.name+".")}}}else{if(i.isInstanceProperty()){if(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor){this.writeToOutput("_this.")}else{this.writeToOutput("this.")}}}}else{if(i.kind()==e.SymbolKind.Type){if(i.isInstanceProperty()){var o=i;var u=o.type;if(u.call&&!e.hasFlag(i.flags,e.SymbolFlags.ModuleMember)){if(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor){this.writeToOutput("_this.")}else{this.writeToOutput("this.")}}}else{if(i.unitIndex!=this.checker.locationInfo.unitIndex||!this.declEnclosed(i.declModule)){this.writeToOutput(i.container.name+".")}}}}}}else{if(i.container==this.checker.gloMod&&e.hasFlag(i.flags,e.SymbolFlags.Exported)&&!e.hasFlag(i.flags,e.SymbolFlags.Ambient)&&!((i.isType()||i.isMember())&&i.declModule&&e.hasFlag(i.declModule.modFlags,e.ModuleFlags.Ambient))&&this.emitState.container==t.Prog&&i.declAST.nodeType!=e.NodeType.FuncDecl){this.writeToOutput("this.")}}}if(i&&i.declAST&&i.declAST.nodeType==e.NodeType.ModuleDeclaration&&e.hasFlag(i.declAST.modFlags,e.ModuleFlags.IsDynamic)){var a=i.declAST;if(e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){this.writeLineToOutput("__"+this.modAliasId+"__;")}else{var f=n.actualText;var l=a.mod.symbol.declAST&&e.hasFlag(a.mod.symbol.declAST.modFlags,e.ModuleFlags.Ambient);f=l?f:this.firstModAlias?this.firstModAlias:e.quoteBaseName(f);f=l?f:!e.isRelative(e.stripQuotes(f))?e.quoteStr("./"+e.stripQuotes(f)):f;this.writeToOutput("require("+f+")")}}else{this.writeToOutput(n.actualText)}}this.recordSourceMappingEnd(n);this.emitParensAndCommentsInPlace(n,false)};i.prototype.emitJavascriptStatements=function(t,n,r){if(t){if(t.nodeType!=e.NodeType.Block){var i=t&&(t.nodeType!=e.NodeType.List||t.members.length>0);if(n||i){var s=t.nodeType==e.NodeType.Block||t.nodeType==e.NodeType.List&&t.members.length==1&&t.members[0].nodeType==e.NodeType.Block;this.recordSourceMappingStart(t);if(!s){this.writeLineToOutput(" {");this.indenter.increaseIndent()}this.emitJavascriptList(t,null,e.TokenID.Semicolon,true,false,false);if(!s){this.writeLineToOutput("");this.indenter.decreaseIndent();this.emitIndent();this.writeToOutput("}")}this.recordSourceMappingEnd(t)}}else{this.emitJavascript(t,e.TokenID.Semicolon,true)}}else{if(n){this.writeToOutput("{ }")}}};i.prototype.emitBareJavascriptStatements=function(t,n){if(t.nodeType!=e.NodeType.Block){if(t.nodeType==e.NodeType.List){var r=t;if(r.members.length==2&&r.members[0].nodeType==e.NodeType.Block&&r.members[1].nodeType==e.NodeType.EndCode){this.emitJavascript(r.members[0],e.TokenID.Semicolon,true);this.writeLineToOutput("")}else{this.emitJavascriptList(t,null,e.TokenID.Semicolon,true,false,n)}}else{this.emitJavascript(t,e.TokenID.Semicolon,true)}}else{this.emitJavascript(t,e.TokenID.Semicolon,true)}};i.prototype.recordSourceMappingNameStart=function(e){if(this.sourceMapper){var t=e;if(!e){t=""}else{if(this.sourceMapper.currentNameIndex.length>0){t=this.sourceMapper.names[this.sourceMapper.currentNameIndex.length-1]+"."+e}}this.sourceMapper.names.push(t);this.sourceMapper.currentNameIndex.push(this.sourceMapper.names.length-1)}};i.prototype.recordSourceMappingNameEnd=function(){if(this.sourceMapper){this.sourceMapper.currentNameIndex.pop()}};i.prototype.recordSourceMappingStart=function(t){if(this.sourceMapper&&e.isValidAstNode(t)){var n={line:-1,col:-1};var r=new e.SourceMapping;r.start.emittedColumn=this.emitState.column;r.start.emittedLine=this.emitState.line;e.getSourceLineColFromMap(n,t.minChar,this.checker.locationInfo.lineMap);r.start.sourceColumn=n.col;r.start.sourceLine=n.line;e.getSourceLineColFromMap(n,t.limChar,this.checker.locationInfo.lineMap);r.end.sourceColumn=n.col;r.end.sourceLine=n.line;if(this.sourceMapper.currentNameIndex.length>0){r.nameIndex=this.sourceMapper.currentNameIndex[this.sourceMapper.currentNameIndex.length-1]}var i=this.sourceMapper.currentMappings[this.sourceMapper.currentMappings.length-1];i.push(r);this.sourceMapper.currentMappings.push(r.childMappings)}};i.prototype.recordSourceMappingEnd=function(t){if(this.sourceMapper&&e.isValidAstNode(t)){this.sourceMapper.currentMappings.pop();var n=this.sourceMapper.currentMappings[this.sourceMapper.currentMappings.length-1];var r=n[n.length-1];r.end.emittedColumn=this.emitState.column;r.end.emittedLine=this.emitState.line}};i.prototype.emitSourceMappings=function(){e.SourceMapper.EmitSourceMapping(this.allSourceMappers)};i.prototype.emitJavascriptList=function(t,n,r,i,s,o,u,a){if(typeof u==="undefined"){u=false}if(t==null){return}else{if(t.nodeType!=e.NodeType.List){this.emitPrologue(u);this.emitJavascript(t,r,i)}else{var f=t;if(f.members.length==0){return}this.emitParensAndCommentsInPlace(t,true);var l=f.members.length;for(var c=0;c<l;c++){if(u){if(c==1||!e.hasFlag(f.flags,e.ASTFlags.StrictMode)){this.emitPrologue(a);u=false}}if(c==1&&o){var h=this.thisClassNode.constructorDecl;if(h&&h.arguments){var p=h.arguments.members.length;for(var d=0;d<p;d++){var v=h.arguments.members[d];if((v.varFlags&e.VarFlags.Property)!=e.VarFlags.None){this.emitIndent();this.recordSourceMappingStart(v);this.recordSourceMappingStart(v.id);this.writeToOutput("this."+v.id.actualText);this.recordSourceMappingEnd(v.id);this.writeToOutput(" = ");this.recordSourceMappingStart(v.id);this.writeToOutput(v.id.actualText);this.recordSourceMappingEnd(v.id);this.writeLineToOutput(";");this.recordSourceMappingEnd(v)}}}var m=this.thisClassNode.members.members.length;for(var g=0;g<m;g++){if(this.thisClassNode.members.members[g].nodeType==e.NodeType.VarDecl){var y=this.thisClassNode.members.members[g];if(!e.hasFlag(y.varFlags,e.VarFlags.Static)&&y.init){this.emitIndent();this.emitJavascriptVarDecl(y,e.TokenID.Tilde);this.writeLineToOutput("")}}}}var b=f.members[c];var w=b.nodeType==e.NodeType.FuncDecl&&e.hasFlag(b.fncFlags,e.FncFlags.Static)||b.nodeType==e.NodeType.VarDecl&&e.hasFlag(b.varFlags,e.VarFlags.Static);if(s?!w:w){continue}this.emitJavascript(b,r,i);if(n&&c<l-1){if(i){this.writeLineToOutput(n)}else{this.writeToOutput(n)}}else{if(i&&b.nodeType!=e.NodeType.ModuleDeclaration&&b.nodeType!=e.NodeType.InterfaceDeclaration&&!(b.nodeType==e.NodeType.VarDecl&&(b.varFlags&e.VarFlags.Ambient)==e.VarFlags.Ambient&&b.init==null)&&this.varListCount>=0&&(b.nodeType!=e.NodeType.Block||b.isStatementBlock)&&b.nodeType!=e.NodeType.EndCode&&b.nodeType!=e.NodeType.FuncDecl){this.writeLineToOutput("")}}}this.emitParensAndCommentsInPlace(t,false)}}};i.prototype.emitJavascript=function(n,r,i){if(n==null){return}var s=false;if(i&&this.indenter.indentAmt>0&&n.nodeType!=e.NodeType.List&&n.nodeType!=e.NodeType.Block){if(n.nodeType!=e.NodeType.InterfaceDeclaration&&!(n.nodeType==e.NodeType.VarDecl&&(n.varFlags&e.VarFlags.Ambient)==e.VarFlags.Ambient&&n.init==null)&&this.varListCount>=0&&n.nodeType!=e.NodeType.EndCode&&(n.nodeType!=e.NodeType.FuncDecl||this.emitState.container!=t.Constructor)){this.emitIndent()}}if(s){this.writeToOutput("(")}n.emit(this,r,i);if(s){this.writeToOutput(")")}if(r==e.TokenID.Semicolon&&n.nodeType<e.NodeType.GeneralNode){this.writeToOutput(";")}};i.prototype.emitPropertyAccessor=function(e,t,n){if(!e.accessorSymbol.hasBeenEmitted){var r=e.accessorSymbol;this.emitIndent();this.recordSourceMappingStart(e);this.writeLineToOutput("Object.defineProperty("+t+(n?'.prototype, "':', "')+e.name.actualText+'"'+", {");this.indenter.increaseIndent();if(r.getter){var i=r.getter.declAST;this.emitIndent();this.recordSourceMappingStart(i);this.writeToOutput("get: ");this.emitInnerFunction(i,false,n,null,e.hasSelfReference(),null);this.writeLineToOutput(",")}if(r.setter){var s=r.setter.declAST;this.emitIndent();this.recordSourceMappingStart(s);this.writeToOutput("set: ");this.emitInnerFunction(s,false,n,null,e.hasSelfReference(),null);this.writeLineToOutput(",")}this.emitIndent();this.writeLineToOutput("enumerable: true,");this.emitIndent();this.writeLineToOutput("configurable: true");this.indenter.decreaseIndent();this.emitIndent();this.writeLineToOutput("});");this.recordSourceMappingEnd(e);r.hasBeenEmitted=true}};i.prototype.emitPrototypeMember=function(t,n){if(t.nodeType==e.NodeType.FuncDecl){var r=t;if(r.isAccessor()){this.emitPropertyAccessor(r,n,true)}else{this.emitIndent();this.recordSourceMappingStart(r);this.writeToOutput(n+".prototype."+r.getNameText()+" = ");this.emitInnerFunction(r,false,true,null,r.hasSelfReference(),null);this.writeLineToOutput(";")}}else{if(t.nodeType==e.NodeType.VarDecl){var i=t;if(i.init){this.emitIndent();this.recordSourceMappingStart(i);this.recordSourceMappingStart(i.id);this.writeToOutput(n+".prototype."+i.id.actualText);this.recordSourceMappingEnd(i.id);this.writeToOutput(" = ");this.emitJavascript(i.init,e.TokenID.Equals,false);this.recordSourceMappingEnd(i);this.writeLineToOutput(";")}}}};i.prototype.emitAddBaseMethods=function(t,n,r){if(n.members){var i=n.symbol;var s=i.name;if(i.declModule!=r.type.symbol.declModule){s=i.fullName()}n.members.allMembers.map(function(n,r,i){var o=r;if(o.kind()==e.SymbolKind.Type&&o.type.call){this.recordSourceMappingStart(o.declAST);this.writeLineToOutput(t+".prototype."+o.name+" = "+s+".prototype."+o.name+";");this.recordSourceMappingEnd(o.declAST)}},null)}if(n.extendsList){for(var o=0,u=n.extendsList.length;o<u;o++){this.emitAddBaseMethods(t,n.extendsList[o],r)}}};i.prototype.emitJavascriptClass=function(n){if(!e.hasFlag(n.varFlags,e.VarFlags.Ambient)){var r=this.thisClassNode;var i=0;this.thisClassNode=n;var s=n.name.actualText;this.emitParensAndCommentsInPlace(n,true);var o=this.setContainer(t.Class);this.recordSourceMappingStart(n);if(e.hasFlag(n.varFlags,e.VarFlags.Exported)&&n.type.symbol.container==this.checker.gloMod){this.writeToOutput("this."+s)}else{this.writeToOutput("var "+s)}var u=n.type;var a=u.instanceType;var f=a?a.baseClass():null;var l=null;var c=null;if(f){this.writeLineToOutput(" = (function (_super) {")}else{this.writeLineToOutput(" = (function () {")}this.recordSourceMappingNameStart(s);this.indenter.increaseIndent();if(f){l=n.extendsList.members[0];c=l.nodeType==e.NodeType.Call?l.target:l;this.emitIndent();this.writeLineToOutput("__extends("+s+", _super);");var h=a.extendsList.length;if(h>1){for(var i=1;i<h;i++){var p=a.extendsList[i];this.emitAddBaseMethods(s,p,n)}}}this.emitIndent();var d=n.constructorDecl;if(d){this.emitJavascript(n.constructorDecl,e.TokenID.OpenParen,false)}else{var v=0;this.recordSourceMappingStart(n);this.indenter.increaseIndent();this.writeToOutput("function "+n.name.actualText+"() {");this.recordSourceMappingNameStart("constructor");if(f){this.writeLineToOutput("");this.emitIndent();this.writeLineToOutput("_super.apply(this, arguments);");v++}if(n.varFlags&e.VarFlags.MustCaptureThis){this.writeCaptureThisStatement(n)}var m=this.thisClassNode.members.members;for(var i=0;i<m.length;i++){if(m[i].nodeType==e.NodeType.VarDecl){var g=m[i];if(!e.hasFlag(g.varFlags,e.VarFlags.Static)&&g.init){this.writeLineToOutput("");this.emitIndent();this.emitJavascriptVarDecl(g,e.TokenID.Tilde);v++}}}if(v){this.writeLineToOutput("");this.indenter.decreaseIndent();this.emitIndent();this.writeLineToOutput("}")}else{this.writeLineToOutput(" }");this.indenter.decreaseIndent()}this.recordSourceMappingNameEnd();this.recordSourceMappingEnd(n)}var y=n.members.members.length;for(var b=0;b<y;b++){var w=n.members.members[b];if(w.nodeType==e.NodeType.FuncDecl){var E=w;if(e.hasFlag(E.fncFlags,e.FncFlags.Method)&&!E.isSignature()){if(!e.hasFlag(E.fncFlags,e.FncFlags.Static)){this.emitPrototypeMember(E,s)}else{if(E.isAccessor()){this.emitPropertyAccessor(E,this.thisClassNode.name.actualText,false)}else{this.emitIndent();this.recordSourceMappingStart(E);this.writeToOutput(n.name.actualText+"."+E.name.actualText+" = ");this.emitInnerFunction(E,E.name&&!E.name.isMissing(),false,null,E.hasSelfReference(),null)}}}}else{if(w.nodeType==e.NodeType.VarDecl){var g=w;if(e.hasFlag(g.varFlags,e.VarFlags.Static)){this.emitIndent();this.recordSourceMappingStart(g);this.writeToOutput(n.name.actualText+"."+g.id.actualText+" = ");if(g.init){this.emitJavascript(g.init,e.TokenID.Equals,false);this.writeLineToOutput(";")}else{this.writeLineToOutput(this.defaultValue(g.type)+";")}this.recordSourceMappingEnd(g)}}else{throw Error("We want to catch this")}}}this.emitIndent();this.recordSourceMappingStart(n.endingToken);this.writeLineToOutput("return "+s+";");this.recordSourceMappingEnd(n.endingToken);this.indenter.decreaseIndent();this.emitIndent();this.recordSourceMappingStart(n.endingToken);this.writeToOutput("}");this.recordSourceMappingNameEnd();this.recordSourceMappingEnd(n.endingToken);this.recordSourceMappingStart(n);this.writeToOutput(")(");if(f){this.emitJavascript(c,e.TokenID.Tilde,false)}this.writeToOutput(");");this.recordSourceMappingEnd(n);if((o==t.Module||o==t.DynamicModule)&&e.hasFlag(n.varFlags,e.VarFlags.Exported)){this.writeLineToOutput("");this.emitIndent();var S=o==t.Module?this.moduleName:"exports";this.recordSourceMappingStart(n);this.writeToOutput(S+"."+s+" = "+s+";");this.recordSourceMappingEnd(n)}this.emitIndent();this.recordSourceMappingEnd(n);this.emitParensAndCommentsInPlace(n,false);this.setContainer(o);this.thisClassNode=r}};i.prototype.emitPrologue=function(e){if(!this.prologueEmitted){if(e){this.prologueEmitted=true;this.writeLineToOutput("var __extends = this.__extends || function (d, b) {");this.writeLineToOutput("    function __() { this.constructor = d; }");this.writeLineToOutput("    __.prototype = b.prototype;");this.writeLineToOutput("    d.prototype = new __();");this.writeLineToOutput("};")}if(this.checker.mustCaptureGlobalThis){this.prologueEmitted=true;this.writeLineToOutput(this.captureThisStmtString)}}};i.prototype.emitSuperReference=function(){this.writeToOutput("_super.prototype")};i.prototype.emitSuperCall=function(t){if(t.target.nodeType==e.NodeType.Dot){var n=t.target;if(n.operand1.nodeType==e.NodeType.Super){this.emitJavascript(n,e.TokenID.OpenParen,false);this.writeToOutput(".call(this");if(t.arguments&&t.arguments.members.length>0){this.writeToOutput(", ");this.emitJavascriptList(t.arguments,", ",e.TokenID.Comma,false,false,false)}this.writeToOutput(")");return true}}return false};return i}();e.Emitter=i})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.outfile=e;this.parser=null;this.checker=null;this.lineCol={line:0,col:0};this.emitAsComments=true;this.hasErrors=false;this.pushToErrorSink=false;this.errorSink=[]}t.prototype.getCapturedErrors=function(){return this.errorSink};t.prototype.freeCapturedErrors=function(){this.errorSink=[]};t.prototype.captureError=function(e){this.errorSink[this.errorSink.length]=e};t.prototype.setErrOut=function(e){this.outfile=e;this.emitAsComments=false};t.prototype.emitPrefix=function(){if(this.emitAsComments){this.outfile.Write("// ")}this.outfile.Write(this.checker.locationInfo.filename+"("+this.lineCol.line+","+this.lineCol.col+"): ")};t.prototype.writePrefix=function(e){if(e){this.setError(e)}else{this.lineCol.line=-1;this.lineCol.col=-1}this.emitPrefix()};t.prototype.writePrefixFromSym=function(t){if(t&&this.checker.locationInfo.lineMap){e.getSourceLineColFromMap(this.lineCol,t.location,this.checker.locationInfo.lineMap)}else{this.lineCol.line=-1;this.lineCol.col=-1}this.emitPrefix()};t.prototype.setError=function(t){if(t){t.flags|=e.ASTFlags.Error;if(this.checker.locationInfo.lineMap){e.getSourceLineColFromMap(this.lineCol,t.minChar,this.checker.locationInfo.lineMap)}}};t.prototype.reportError=function(e,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=true;var n=e.limChar-e.minChar;if(this.parser.errorRecovery&&this.parser.errorCallback){this.parser.errorCallback(e.minChar,n,t,this.checker.locationInfo.unitIndex)}else{this.writePrefix(e);this.outfile.WriteLine(t)}};t.prototype.reportErrorFromSym=function(e,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=true;if(this.parser.errorRecovery&&this.parser.errorCallback){this.parser.errorCallback(e.location,1,t,this.checker.locationInfo.unitIndex)}else{this.writePrefixFromSym(e);this.outfile.WriteLine(t)}};t.prototype.emitterError=function(e,t){this.reportError(e,t);throw Error("EmitError")};t.prototype.duplicateIdentifier=function(e,t){this.reportError(e,"Duplicate identifier '"+t+"'")};t.prototype.showRef=function(e,t,n){var r={line:-1,col:-1};this.parser.getSourceLineCol(r,n.location);this.reportError(e,"symbol "+t+" defined at ("+r.line+","+r.col+")")};t.prototype.unresolvedSymbol=function(e,t){this.reportError(e,"The name '"+t+"' does not exist in the current scope")};t.prototype.symbolDoesNotReferToAValue=function(e,t){this.reportError(e,"The name '"+t+"' does not refer to a value")};t.prototype.styleError=function(e,t){var n=this.pushToErrorSink;this.pushToErrorSink=false;this.reportError(e,"STYLE: "+t);this.pushToErrorSink=n};t.prototype.simpleError=function(e,t){this.reportError(e,t)};t.prototype.simpleErrorFromSym=function(e,t){this.reportErrorFromSym(e,t)};t.prototype.invalidSuperReference=function(e){this.simpleError(e,"Keyword 'super' can only be used inside a class instance method")};t.prototype.valueCannotBeModified=function(e){this.simpleError(e,"The left-hand side of an assignment expression must be a variable, property or indexer")};t.prototype.invalidCall=function(t,n,r){var i=t.target.type;var s=i.getScopedTypeName(r);if(i.construct&&n==e.NodeType.Call){this.reportError(t,"Value of type '"+s+"' is not callable.  Did you mean to include 'new'?")}else{var o=n==e.NodeType.Call?"callable":"newable";this.reportError(t,"Value of type '"+s+"' is not "+o)}};t.prototype.indexLHS=function(e,t){var n=e.operand1.type.getScopedTypeName(t);var r=e.operand2.type.getScopedTypeName(t);this.simpleError(e,"Value of type '"+n+"' is not indexable by type '"+r+"'")};t.prototype.incompatibleTypes=function(e,t,n,r,i,s){if(!t){t=this.checker.anyType}if(!n){n=this.checker.anyType}var o=s?s.message:"";if(r){this.reportError(e,"Operator '"+r+"' cannot be applied to types '"+t.getScopedTypeName(i)+"' and '"+n.getScopedTypeName(i)+"'"+(o?": "+o:""))}else{this.reportError(e,"Cannot convert '"+t.getScopedTypeName(i)+"' to '"+n.getScopedTypeName(i)+"'"+(o?": "+o:""))}};t.prototype.expectedClassOrInterface=function(e){this.simpleError(e,"Expected var, class, interface, or module")};t.prototype.unaryOperatorTypeError=function(e,t,n){this.reportError(e,"Operator '"+t+"' cannot be applied to type '"+n.getTypeName()+"'")};return t}();e.ErrorReporter=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(t,n,r,s,o,u){var a=r.getText(s,o);t.log("Quick parse range ("+s+","+o+'): "'+e.stringToLiteral(a,100)+'"');var f=new i;f.setErrorRecovery(null);f.errorCallback=u;var l=new e.ClassDeclaration(null,null,null,null);f.currentClassDecl=l;var c=f.quickParse(new e.StringSourceText(a),"",0);return c}(function(e){e._map=[];e.NoTypes=0;e.ArraySuffix=1;e.Primitive=2;e.Named=4;e.AllSimpleTypes=e.Primitive|e.Named;e.AllTypes=e.Primitive|e.Named|e.ArraySuffix})(e.TypeContext||(e.TypeContext={}));var t=e.TypeContext;(function(e){e._map=[];e._map[0]="None";e.None=0;e._map[1]="StartScript";e.StartScript=1;e._map[2]="StartStatementList";e.StartStatementList=2;e._map[3]="StartStatement";e.StartStatement=3;e._map[4]="StartFncDecl";e.StartFncDecl=4;e._map[5]="FncDeclName";e.FncDeclName=5;e._map[6]="FncDeclArgs";e.FncDeclArgs=6;e._map[7]="FncDeclReturnType";e.FncDeclReturnType=7;e._map[8]="ForInit";e.ForInit=8;e._map[9]="ForInitAfterVar";e.ForInitAfterVar=9;e._map[10]="ForCondStart";e.ForCondStart=10;e._map[11]="EndStmtList";e.EndStmtList=11;e._map[12]="EndScript";e.EndScript=12})(e.ParseState||(e.ParseState={}));var n=e.ParseState;var r=function(){function e(e,t){this.Script=e;this.endLexState=t}return e}();e.QuickParseResult=r;var i=function(){function i(){this.varLists=[];this.scopeLists=[];this.staticsLists=[];this.scanner=new e.Scanner;this.currentToken=null;this.needTerminator=false;this.inFunction=false;this.inInterfaceDecl=false;this.currentClassDecl=null;this.inFncDecl=false;this.anonId=new e.Identifier("_anonymous");this.style_requireSemi=false;this.style_funcInLoop=true;this.incremental=false;this.errorRecovery=false;this.outfile=undefined;this.errorCallback=null;this.state=n.StartStatementList;this.ambientModule=false;this.ambientClass=false;this.topLevel=true;this.currentUnitIndex=-1;this.prevIDTok=null;this.statementInfoStack=new Array;this.hasTopLevelImportOrExport=false;this.strictMode=false;this.nestingLevel=0;this.prevExpr=null;this.currentClassDefinition=null;this.parsingClassConstructorDefinition=false;this.parsingDeclareFile=false;this.amdDependencies=[];this.inferPropertiesFromThisAssignment=false;this.fname=""}i.prototype.resetStmtStack=function(){this.statementInfoStack=new Array};i.prototype.inLoop=function(){for(var e=this.statementInfoStack.length-1;e>=0;e--){if(this.statementInfoStack[e].stmt.isLoop()){return true}}return false};i.prototype.pushStmt=function(e,t){var n={stmt:e,labels:t};this.statementInfoStack.push(n)};i.prototype.popStmt=function(){return this.statementInfoStack.pop()};i.prototype.resolveJumpTarget=function(t){var n=e.AST.getResolvedIdentifierName(t.target);var r=this.statementInfoStack.length;for(var i=r-1;i>=0;i--){var s=this.statementInfoStack[i];if(t.target){if(s.labels&&s.labels.members.length>0){for(var o=0,u=s.labels.members.length;o<u;o++){var a=s.labels.members[o];if(a.id.text==n){t.setResolvedTarget(this,s.stmt);return}}}}else{if(s.stmt.isLoop()){t.setResolvedTarget(this,s.stmt);return}else{if(s.stmt.nodeType==e.NodeType.Switch&&t.nodeType==e.NodeType.Break){t.setResolvedTarget(this,s.stmt);return}}}}if(t.target){this.reportParseError("could not find enclosing statement with label "+t.target)}else{if(t.nodeType==e.NodeType.Break){this.reportParseError("break statement requires enclosing loop or switch")}else{this.reportParseError("continue statement requires enclosing loop")}}};i.prototype.setErrorRecovery=function(e){this.outfile=e;this.errorRecovery=true};i.prototype.getSourceLineCol=function(t,n){e.getSourceLineColFromMap(t,n,this.scanner.lineMap)};i.prototype.createRef=function(t,n,r){var i=new e.Identifier(t,n);i.minChar=r;return i};i.prototype.reportParseStyleError=function(e){this.reportParseError("STYLE: "+e)};i.prototype.reportParseError=function(e,t,n){if(typeof t==="undefined"){t=this.scanner.startPos}if(typeof n==="undefined"){n=this.scanner.pos}var r=Math.max(1,n-t);if(this.errorCallback){this.errorCallback(t,r,e,this.currentUnitIndex)}else{if(this.errorRecovery){var i={line:-1,col:-1};this.getSourceLineCol(i,t);if(this.outfile){this.outfile.WriteLine("// "+this.fname+" ("+i.line+","+i.col+"): "+e)}}else{throw new SyntaxError(this.fname+" ("+this.scanner.line+","+this.scanner.col+"): "+e)}}};i.prototype.checkNextToken=function(e,t,n){if(typeof n==="undefined"){n=null}this.currentToken=this.scanner.scan();this.checkCurrentToken(e,t,n)};i.prototype.skip=function(t){t|=e.ErrorRecoverySet.EOF;var n=e.ErrorRecoverySet.None;var r=e.lookupToken(this.currentToken.tokenId);if(r!=undefined){n=r.ers}var i=0;while((n&t)==e.ErrorRecoverySet.None||this.currentToken.tokenId==e.TokenID.CloseBrace&&i>0){if(this.currentToken.tokenId==e.TokenID.OpenBrace){i++}else{if(this.currentToken.tokenId==e.TokenID.CloseBrace){i--}}this.currentToken=this.scanner.scan();n=e.ErrorRecoverySet.None;r=e.lookupToken(this.currentToken.tokenId);if(r!=undefined){n=r.ers}}};i.prototype.checkCurrentToken=function(t,n,r){if(typeof r==="undefined"){r=null}if(this.currentToken.tokenId!=t){r=r==null?"Expected '"+e.tokenTable[t].text+"'":r;this.reportParseError(r);if(this.errorRecovery){this.skip(n)}}else{this.currentToken=this.scanner.scan()}};i.prototype.pushDeclLists=function(){this.staticsLists.push(new e.ASTList);this.varLists.push(new e.ASTList);this.scopeLists.push(new e.ASTList)};i.prototype.popDeclLists=function(){this.staticsLists.pop();this.varLists.pop();this.scopeLists.pop()};i.prototype.topVarList=function(){return this.varLists[this.varLists.length-1]};i.prototype.topScopeList=function(){return this.scopeLists[this.scopeLists.length-1]};i.prototype.topStaticsList=function(){return this.staticsLists[this.staticsLists.length-1]};i.prototype.parseComment=function(t){if(t){var n=new e.Comment(t.value,t.isBlock,t.endsLine);n.minChar=t.startPos;n.limChar=t.startPos+t.value.length;if(!t.isBlock&&t.value.length>3&&t.value.substring(0,3)=="///"){var r=e.getAdditionalDependencyPath(t.value);if(r){this.amdDependencies.push(r)}if(e.getImplicitImport(t.value)){this.hasTopLevelImportOrExport=true}}return n}else{return null}};i.prototype.parseCommentsInner=function(e){if(e){var t=new Array;for(var n=0;n<e.length;n++){t.push(this.parseComment(e[n]))}return t}else{return null}};i.prototype.parseComments=function(){var e=this.scanner.getComments();return this.parseCommentsInner(e)};i.prototype.parseCommentsForLine=function(e){var t=this.scanner.getCommentsForLine(e);return this.parseCommentsInner(t)};i.prototype.combineComments=function(e,t){if(e==null){return t}else{if(t==null){return e}else{return e.concat(t)}}};i.prototype.parseEnumDecl=function(n,r){var i=this.scanner.leftCurlyCount;var s=this.scanner.rightCurlyCount;var o=null;if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){o=e.Identifier.fromToken(this.currentToken);o.minChar=this.scanner.startPos;o.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}else{this.reportParseError("Enum declaration requires identifier");if(this.errorRecovery){o=new e.MissingIdentifier;o.minChar=this.scanner.startPos;o.limChar=this.scanner.startPos;o.flags|=e.ASTFlags.Error}}var u=this.scanner.startPos;this.checkCurrentToken(e.TokenID.OpenBrace,n|e.ErrorRecoverySet.ID);this.pushDeclLists();var a=new e.ASTList;a.minChar=u;var f=new e.VarDecl(new e.Identifier("_map"),0);f.varFlags|=e.VarFlags.Exported;f.varFlags|=e.VarFlags.Private;f.varFlags|=e.VarFlags.Property|e.VarFlags.Public;f.init=new e.UnaryExpression(e.NodeType.ArrayLit,null);a.append(f);var l=null;for(;;){var c=this.scanner.startPos;var h;var p=null;var d=null;var v=null;var m=null;if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToIDName(this.currentToken)){p=e.Identifier.fromToken(this.currentToken);p.minChar=this.scanner.startPos;p.limChar=this.scanner.pos}else{if(this.currentToken.tokenId==e.TokenID.CloseBrace){break}else{this.reportParseError("Expected identifer of enum member");if(this.errorRecovery){p=new e.MissingIdentifier;p.minChar=this.scanner.startPos;p.limChar=this.scanner.startPos;p.flags|=e.ASTFlags.Error}}}h=this.scanner.pos;v=this.parseComments();this.currentToken=this.scanner.scan();m=this.parseComments();if(this.currentToken.tokenId==e.TokenID.Equals){this.currentToken=this.scanner.scan();d=this.parseExpr(n,e.OperatorPrecedence.Comma,true,t.NoTypes);l=d;h=d.limChar}else{if(l==null){d=new e.NumberLiteral(0);l=d}else{d=new e.NumberLiteral(l.value+1);l=d}var g=new e.BinaryExpression(e.NodeType.Asg,new e.BinaryExpression(e.NodeType.Index,new e.Identifier("_map"),d),new e.StringLiteral('"'+p.actualText+'"'));a.append(g)}var y=new e.VarDecl(p,this.nestingLevel);y.minChar=c;y.limChar=h;y.init=d;y.typeExpr=new e.TypeReference(this.createRef(o.actualText,o.hasEscapeSequence,-1),0);y.varFlags|=e.VarFlags.Readonly|e.VarFlags.Property;if(d.nodeType==e.NodeType.NumberLit){y.varFlags|=e.VarFlags.Constant}y.preComments=v;a.append(y);y.postComments=m;y.varFlags|=e.VarFlags.Exported;if(this.currentToken.tokenId==e.TokenID.Comma){this.currentToken=this.scanner.scan();y.postComments=this.combineComments(y.postComments,this.parseCommentsForLine(this.scanner.prevLine));if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToIDName(this.currentToken)){continue}}break}var b=new e.ASTSpan;b.minChar=this.scanner.startPos;b.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseBrace,n);a.limChar=this.scanner.lastTokenLimChar();var w=new e.ModuleDeclaration(o,a,this.topVarList(),this.topScopeList(),b);w.modFlags|=e.ModuleFlags.IsEnum;this.popDeclLists();w.leftCurlyCount=this.scanner.leftCurlyCount-i;w.rightCurlyCount=this.scanner.rightCurlyCount-s;return w};i.prototype.parseDottedName=function(t){this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){var n=e.Identifier.fromToken(this.currentToken);n.preComments=this.parseComments();t[t.length]=n;n.minChar=this.scanner.startPos;n.limChar=this.scanner.pos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Dot){this.parseDottedName(t)}}else{this.reportParseError("need identifier after '.'")}};i.prototype.isValidImportPath=function(t){t=e.stripQuotes(t);if(!t||t.indexOf(":")!=-1||t.indexOf("\\")!=-1||t.charAt(0)=="/"){return false}return true};i.prototype.parseImportDeclaration=function(n,r){var i=null;var s=null;var o=null;var u=this.scanner.startPos;var a=false;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){i=e.Identifier.fromToken(this.currentToken)}else{this.reportParseError("Expected identifer after 'import'");i=new e.MissingIdentifier}i.minChar=this.scanner.startPos;i.limChar=this.scanner.pos;this.currentToken=this.scanner.scan();this.checkCurrentToken(e.TokenID.Equals,n|e.ErrorRecoverySet.ID);var f=this.parseComments();var l;if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){if(this.currentToken.tokenId==e.TokenID.Module){l=this.scanner.pos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.OpenParen){this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.StringLiteral||this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){if(this.currentToken.tokenId==e.TokenID.StringLiteral){if(this.topLevel){this.hasTopLevelImportOrExport=true}var c=this.currentToken.getText();s=e.Identifier.fromToken(this.currentToken);s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos;if(!this.isValidImportPath(s.text)){this.reportParseError("Invalid import path")}a=true;this.currentToken=this.scanner.scan();s.preComments=f}else{s=this.parseExpr(n|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Assignment,true,t.NoTypes);s.preComments=f}}l=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,n|e.ErrorRecoverySet.ID);if(s){s.postComments=this.parseComments()}}}else{s=this.parseExpr(n|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Assignment,true,t.NoTypes);l=this.scanner.pos}}else{this.reportParseError("Expected module name");s=new e.MissingIdentifier;s.minChar=this.scanner.startPos;if(this.currentToken.tokenId==e.TokenID.Semicolon){s.limChar=this.scanner.startPos}else{s.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}s.flags|=e.ASTFlags.Error;l=s.limChar}o=new e.ImportDeclaration(i,s);o.isDynamicImport=a;if(e.hasFlag(r,e.Modifiers.Exported)){o.varFlags|=e.VarFlags.Exported}o.minChar=u;o.limChar=l;return o};i.prototype.parseModuleDecl=function(t,n){var r=this.scanner.leftCurlyCount;var i=this.scanner.rightCurlyCount;var s=this.ambientModule;var o=this.topLevel;this.topLevel=false;if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient)){this.ambientModule=true}this.currentToken=this.scanner.scan();var u=null;var a=null;this.pushDeclLists();var f=this.parseComments();var l=this.scanner.startPos;var c=false;if(this.currentToken.tokenId==e.TokenID.Identifier||this.currentToken.tokenId==e.TokenID.StringLiteral||!e.isPrimitiveTypeToken(this.currentToken)&&e.convertTokToID(this.currentToken,this.strictMode)){var h=this.currentToken.getText();if(this.currentToken.tokenId==e.TokenID.StringLiteral){c=true;if(!this.ambientModule){this.reportParseError("Only ambient dynamic modules may have string literal names")}}u=e.Identifier.fromToken(this.currentToken);u.minChar=this.scanner.startPos;u.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}else{if(this.currentToken.tokenId==e.TokenID.OpenBrace){this.reportParseError("Module name missing");u=new e.Identifier("");u.minChar=l;u.limChar=l}}if(this.currentToken.tokenId==e.TokenID.Dot){a=new Array;this.parseDottedName(a)}if(u==null){u=new e.MissingIdentifier}var p=new e.ASTList;var d=this.scanner.startPos;this.checkCurrentToken(e.TokenID.OpenBrace,t|e.ErrorRecoverySet.ID);this.parseStatementList(t|e.ErrorRecoverySet.RCurly,p,true,true,e.AllowedElements.Global,n);p.minChar=d;p.limChar=this.scanner.pos;var v=new e.ASTSpan;v.minChar=this.scanner.startPos;v.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseBrace,t);var m=this.scanner.lastTokenLimChar();var g;if(a&&a.length>0){var y=a.length;var b=a[y-1];var w=new e.ModuleDeclaration(b,p,this.topVarList(),this.topScopeList(),v);if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient)){w.modFlags|=e.ModuleFlags.Ambient}w.modFlags|=e.ModuleFlags.Exported;w.minChar=l;w.limChar=m;this.popDeclLists();var E;for(var S=y-2;S>=0;S--){E=new e.ASTList;E.append(w);b=a[S];w=new e.ModuleDeclaration(b,E,new e.ASTList,new e.ASTList,v);E.minChar=w.minChar=l;E.limChar=w.limChar=m;if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient)){w.modFlags|=e.ModuleFlags.Ambient}w.modFlags|=e.ModuleFlags.Exported}E=new e.ASTList;E.append(w);E.minChar=l;E.limChar=m;g=new e.ModuleDeclaration(u,E,new e.ASTList,new e.ASTList,v)}else{g=new e.ModuleDeclaration(u,p,this.topVarList(),this.topScopeList(),v);this.popDeclLists()}if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient)){g.modFlags|=e.ModuleFlags.Ambient}if(this.parsingDeclareFile||s||e.hasFlag(n,e.Modifiers.Exported)){g.modFlags|=e.ModuleFlags.Exported}if(c){g.modFlags|=e.ModuleFlags.IsDynamic}g.preComments=f;g.postComments=this.parseComments();this.ambientModule=s;this.topLevel=o;g.leftCurlyCount=this.scanner.leftCurlyCount-r;g.rightCurlyCount=this.scanner.rightCurlyCount-i;g.limChar=p.limChar;return g};i.prototype.parseTypeReferenceTail=function(t,n,r){var i=new e.TypeReference(r,0);i.minChar=n;while(this.currentToken.tokenId==e.TokenID.OpenBracket){this.currentToken=this.scanner.scan();i.arrayCount++;this.checkCurrentToken(e.TokenID.CloseBracket,t|e.ErrorRecoverySet.LBrack)}i.limChar=this.scanner.lastTokenLimChar();return i};i.prototype.parseNamedType=function(t,n,r,i){this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Dot){var s=this.scanner.pos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier||(!this.errorRecovery||!this.scanner.lastTokenHadNewline())&&e.convertTokToID(this.currentToken,this.strictMode)){var o=e.Identifier.fromToken(this.currentToken);o.minChar=this.scanner.startPos;o.limChar=this.scanner.pos;var u=new e.BinaryExpression(e.NodeType.Dot,r,o);u.minChar=r.minChar;u.limChar=o.limChar;return this.parseNamedType(t,n,u,i)}else{this.reportParseError("need identifier after '.'");if(this.errorRecovery){r.flags|=e.ASTFlags.DotLHS;r.limChar=this.scanner.lastTokenLimChar();return r}else{var a=new e.MissingIdentifier;a.minChar=this.scanner.pos;a.limChar=this.scanner.pos;var f=new e.BinaryExpression(e.NodeType.Dot,r,a);f.flags|=e.ASTFlags.Error;f.minChar=r.minChar;f.limChar=a.limChar;return this.parseNamedType(t,n,f,i)}}}else{if(i){return this.parseTypeReferenceTail(t,n,r)}else{return r}}};i.prototype.parseTypeReference=function(t,n){var r=this.scanner.startPos;var i=false;switch(this.currentToken.tokenId){case e.TokenID.Void:{if(!n){this.reportParseError("void not a valid type in this context")}};case e.TokenID.Any:case e.TokenID.Number:case e.TokenID.Bool:case e.TokenID.String:{var s=e.tokenTable[this.currentToken.tokenId].text;var o=new e.Identifier(s);o.minChar=r;o.limChar=this.scanner.pos;this.currentToken=this.scanner.scan();return this.parseTypeReferenceTail(t,r,o)};case e.TokenID.Identifier:{var u=this.createRef(this.currentToken.getText(),this.currentToken.hasEscapeSequence,r);u.limChar=this.scanner.pos;return this.parseNamedType(t,r,u,true)};case e.TokenID.OpenBrace:{return this.parseObjectType(r,t)};case e.TokenID.New:{this.currentToken=this.scanner.scan();if(this.currentToken.tokenId!=e.TokenID.OpenParen){this.reportParseError("Expected '('")}else{i=true}};case e.TokenID.OpenParen:{var a=new e.ASTList;var f=this.parseFormalParameterList(t|e.ErrorRecoverySet.RParen,a,false,true,false,false,false,false,null,true);this.checkCurrentToken(e.TokenID.EqualsGreaterThan,t);var l=this.parseTypeReference(t,true);var c=new e.FuncDecl(null,null,false,a,null,null,null,e.NodeType.FuncDecl);c.returnTypeAnnotation=l;c.variableArgList=f;c.fncFlags|=e.FncFlags.Signature;if(i){c.fncFlags|=e.FncFlags.ConstructMember;c.hint="_construct";c.classDecl=null}c.minChar=r;return this.parseTypeReferenceTail(t,r,c)};default:{this.reportParseError("Expected type name");var h=new e.TypeReference(null,0);h.flags|=e.ASTFlags.Error;h.minChar=this.scanner.pos;h.limChar=this.scanner.pos;return h}}};i.prototype.parseObjectType=function(t,n){this.currentToken=this.scanner.scan();var r=new e.ASTList;r.minChar=t;var i=this.inInterfaceDecl;this.inInterfaceDecl=true;this.parseTypeMemberList(n|e.ErrorRecoverySet.RCurly,r);this.inInterfaceDecl=i;this.checkCurrentToken(e.TokenID.CloseBrace,n);var s=new e.InterfaceDeclaration(this.anonId,r,null,null);s.minChar=t;s.limChar=r.limChar;return this.parseTypeReferenceTail(n,t,s)};i.prototype.parseFunctionStatements=function(r,i,s,o,u,a,f,l,c){this.pushDeclLists();var h=this.statementInfoStack;this.resetStmtStack();var p=null;var d=false;var v=false;if(!l){p=new e.ASTList;var m=this.scanner.startPos;if(this.currentToken.tokenId==e.TokenID.EqualsGreaterThan){if(o){this.reportParseError("'=>' may not be used for class methods")}d=true;this.currentToken=this.scanner.scan()}if(d&&this.currentToken.tokenId!=e.TokenID.OpenBrace){var g=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Assignment,true,t.NoTypes);var y=new e.ReturnStatement;y.returnExpression=g;y.minChar=g.minChar;y.limChar=g.limChar;p.minChar=m;p.append(y)}else{this.state=n.StartStatementList;this.checkCurrentToken(e.TokenID.OpenBrace,r|e.ErrorRecoverySet.StmtStart);var b=this.inFunction;v=d;this.inFunction=true;this.parseStatementList(r|e.ErrorRecoverySet.RCurly|e.ErrorRecoverySet.StmtStart,p,true,false,a,c);p.minChar=m;p.limChar=this.scanner.pos;this.inFunction=b;var w=new e.EndCode;w.minChar=p.limChar;w.limChar=w.minChar;p.append(w)}}var E=new e.FuncDecl(i,p,s,u,this.topVarList(),this.topScopeList(),this.topStaticsList(),e.NodeType.FuncDecl);this.popDeclLists();var S=this.topScopeList();S.append(E);var x=false;var T=this.scanner.pos;if(l){this.checkCurrentToken(e.TokenID.Semicolon,r,this.currentToken.tokenId==e.TokenID.OpenBrace?"Function declarations are not permitted within interfaces, ambient modules or classes":"Expected ';'")}else{if(!d||v){E.endingToken=new e.ASTSpan;E.endingToken.minChar=this.scanner.startPos;E.endingToken.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseBrace,r);if(v){E.fncFlags|=e.FncFlags.IsFatArrowFunction}}else{E.fncFlags|=e.FncFlags.IsFatArrowFunction;E.endingToken=new e.ASTSpan;E.endingToken.minChar=p.members[0].minChar;E.endingToken.limChar=p.members[0].limChar}}E.minChar=f;E.limChar=T;if(!l){E.fncFlags|=e.FncFlags.Definition}this.statementInfoStack=h;return E};i.prototype.transformAnonymousArgsIntoFormals=function(t,n){var r=this;var i=function(n){if(n.nodeType==e.NodeType.Comma){return r.transformAnonymousArgsIntoFormals(t,n)}else{if(n.nodeType==e.NodeType.Name||n.nodeType==e.NodeType.Asg){var i=n.nodeType==e.NodeType.Asg?n.operand1:n;var s=new e.ArgDecl(i);s.preComments=i.preComments;s.postComments=i.postComments;s.minChar=n.minChar;s.limChar=n.limChar;if(e.hasFlag(i.flags,e.ASTFlags.PossibleOptionalParameter)){s.isOptional=true}if(n.nodeType==e.NodeType.Asg){s.init=n.operand2}t.append(s);return s.isOptional||s.init}else{r.reportParseError("Invalid lambda argument")}}return false};if(n){if(n.nodeType==e.NodeType.Comma){var s=n;if(s.operand1.isParenthesized){this.reportParseError("Invalid lambda argument",s.operand1.minChar,s.operand1.limChar)}if(s.operand2.isParenthesized){this.reportParseError("Invalid lambda argument",s.operand2.minChar,s.operand2.limChar)}var o=i(s.operand1);o=i(s.operand2)||o;return o}else{return i(n)}}};i.prototype.parseFormalParameterList=function(n,r,i,s,o,u,a,f,l,c){r.minChar=this.scanner.startPos;if(o){this.currentToken=this.scanner.scan()}else{if(!f){this.checkCurrentToken(e.TokenID.OpenParen,n|e.ErrorRecoverySet.RParen)}}var h=false;var p=true;var d=false;var v=false;if(f&&l&&l.nodeType!=e.NodeType.EmptyExpr){d=this.transformAnonymousArgsIntoFormals(r,l);v=true}while(true){var m=false;var g=e.VarFlags.None;var y=this.scanner.startPos;if(this.inferPropertiesFromThisAssignment&&this.currentToken.tokenId==e.TokenID.This){if(!i){this.reportParseError("Instance property declarations using 'this' may only be used in class constructors")}this.currentToken=this.scanner.scan();g|=e.VarFlags.Public|e.VarFlags.Property;if(this.currentClassDefinition){this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor}}if(this.currentToken.tokenId==e.TokenID.Public){g|=e.VarFlags.Public|e.VarFlags.Property;if(this.currentClassDefinition){this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor}}else{if(this.currentToken.tokenId==e.TokenID.Private){g|=e.VarFlags.Private|e.VarFlags.Property;if(this.currentClassDefinition){this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor}}else{if(this.currentToken.tokenId==e.TokenID.Static&&i){this.reportParseError("Static properties can not be declared as parameter properties");this.currentToken=this.scanner.scan()}}}if(g!=e.VarFlags.None){if(!i){this.reportParseError("only constructor parameters can be properties")}this.currentToken=this.scanner.scan();if(e.isModifier(this.currentToken)){this.reportParseError("Multiple modifiers may not be applied to parameters");this.currentToken=this.scanner.scan()}if(this.inferPropertiesFromThisAssignment&&this.currentToken.tokenId==e.TokenID.This){if(!i){this.reportParseError("Instance property declarations using 'this' may only be used in class constructors")}this.currentToken=this.scanner.scan();this.currentToken=this.scanner.scan()}}else{if(this.currentToken.tokenId==e.TokenID.DotDotDot){h=true;this.currentToken=this.scanner.scan();if(!(this.currentToken.tokenId==e.TokenID.Identifier)||e.convertTokToID(this.currentToken,this.strictMode)){this.reportParseError("'...' parameters require both a parameter name and an array type annotation to be specified");h=false}}}var b=null;if(!v&&this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){b=e.Identifier.fromToken(this.currentToken);b.minChar=this.scanner.startPos;b.limChar=this.scanner.pos}if(v||b){m=true;var w=null;var E=null;if(v&&r.members.length){E=r.members[r.members.length-1];if(E.isOptional){d=true}}else{E=new e.ArgDecl(b);if(u){this.reportParseError("Property getters may not take any arguments")}if(a&&!p){this.reportParseError("Property setters may only take one argument")}E.minChar=y;E.preComments=this.parseComments();this.currentToken=this.scanner.scan()}if(this.currentToken.tokenId==e.TokenID.Question){E.isOptional=true;d=true;this.currentToken=this.scanner.scan()}if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();w=this.parseTypeReference(n,false)}if(this.currentToken.tokenId==e.TokenID.Equals){if(s){this.reportParseError("Arguments in signatures may not have default values")}d=true;this.currentToken=this.scanner.scan();E.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,false,t.NoTypes)}if(d&&!E.isOptionalArg()&&!h){this.reportParseError("Optional parameters may only be followed by other optional parameters")}if(h&&E.isOptionalArg()){this.reportParseError("Varargs may not be optional or have default parameters")}if(h&&!w){this.reportParseError("'...' parameters require both a parameter name and an array type annotation to be specified")}E.postComments=this.parseComments();E.typeExpr=w;E.limChar=this.scanner.lastTokenLimChar();E.varFlags|=g;if(!v){r.append(E)}else{v=false}}p=false;if(this.currentToken.tokenId==e.TokenID.Comma){if(m&&!h){this.currentToken=this.scanner.scan();continue}else{this.reportParseError("Unexpected ',' in argument list");if(this.errorRecovery){this.currentToken=this.scanner.scan();continue}}}else{break}}if(o){this.checkCurrentToken(e.TokenID.CloseBracket,n|e.ErrorRecoverySet.LCurly|e.ErrorRecoverySet.SColon)}else{if(c){this.checkCurrentToken(e.TokenID.CloseParen,n|e.ErrorRecoverySet.LCurly|e.ErrorRecoverySet.SColon)}}r.limChar=this.scanner.lastTokenLimChar();return h};i.prototype.parseFncDecl=function(t,r,i,s,o,u,a,f,l,c,h){var p=this.scanner.leftCurlyCount;var d=this.scanner.rightCurlyCount;var v=this.parsingClassConstructorDefinition;this.parsingClassConstructorDefinition=false;var m=null;var g=this.scanner.startPos;var y=this.scanner.pos;var b=this.nestingLevel;this.nestingLevel=0;if(!this.style_funcInLoop&&this.inLoop()){this.reportParseStyleError("function declaration in loop")}if(!s&&!a&&!u&&!c){this.currentToken=this.scanner.scan();this.state=n.StartFncDecl;if(this.currentToken.tokenId!=e.TokenID.Identifier&&!e.convertTokToID(this.currentToken,this.strictMode)){if(r){this.reportParseError("Function declaration must include identifier");this.nestingLevel=b;return new e.IncompleteAST(g,this.scanner.pos)}}else{m=e.Identifier.fromToken(this.currentToken);m.minChar=this.scanner.startPos;m.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}}else{if(o){m=o}}this.state=n.FncDeclName;var w=new e.ASTList;var E=false;var S=false;var x=e.hasFlag(l,e.Modifiers.Getter);var T=e.hasFlag(l,e.Modifiers.Setter);if(this.currentToken.tokenId==e.TokenID.OpenParen||u&&this.currentToken.tokenId==e.TokenID.OpenBracket||c&&(c.preProcessedLambdaArgs||this.currentToken.tokenId==e.TokenID.DotDotDot)){E=this.parseFormalParameterList(t,w,false,i,u,x,T,!!c,c?c.preProcessedLambdaArgs:null,h)}this.state=n.FncDeclArgs;var N=null;if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();if(e.hasFlag(l,e.Modifiers.Setter)){this.reportParseError("Property setters may not declare a return type")}N=this.parseTypeReference(t,true)}if(u&&w.members.length==0){this.reportParseError("Index signatures require a parameter type to be specified")}this.state=n.FncDeclReturnType;if(r&&!(this.parsingDeclareFile||f)&&(!s||!(this.ambientModule||this.ambientClass||this.inInterfaceDecl))&&this.currentToken.tokenId==e.TokenID.Semicolon){S=true;r=false;i=true}var C=this.inFncDecl;this.inFncDecl=true;var k=this.parseFunctionStatements(t|e.ErrorRecoverySet.RCurly,m,false,s,w,e.AllowedElements.None,y,i,e.Modifiers.None);this.inFncDecl=C;k.variableArgList=E;k.isOverload=S;if(!i){k.fncFlags|=e.FncFlags.Definition}if(a){k.fncFlags|=e.FncFlags.Static}if(i){k.fncFlags|=e.FncFlags.Signature}if(u){k.fncFlags|=e.FncFlags.IndexerMember}k.returnTypeAnnotation=N;if(s){k.fncFlags|=e.FncFlags.Method;k.fncFlags|=e.FncFlags.ClassPropertyMethodExported}k.leftCurlyCount=this.scanner.leftCurlyCount-p;k.rightCurlyCount=this.scanner.rightCurlyCount-d;this.nestingLevel=b;this.parsingClassConstructorDefinition=v;return k};i.prototype.convertToTypeReference=function(t){var n;switch(t.nodeType){case e.NodeType.TypeRef:{return t};case e.NodeType.Name:{n=new e.TypeReference(t,0);n.minChar=t.minChar;n.limChar=t.limChar;return n};case e.NodeType.Index:{var r=t;n=this.convertToTypeReference(r.operand1);if(n){n.arrayCount++;n.minChar=r.minChar;n.limChar=r.limChar;return n}else{var i=new e.AST(e.NodeType.Error);return i}}}return null};i.prototype.parseArgList=function(n){var r=new e.ASTList;r.minChar=this.scanner.startPos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId!==e.TokenID.CloseParen){while(true){if(r.members.length>65535){this.reportParseError("max number of args exceeded");break}var i=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,false,t.NoTypes);r.append(i);if(this.currentToken.tokenId!=e.TokenID.Comma){break}this.currentToken=this.scanner.scan()}}r.limChar=this.scanner.pos;return r};i.prototype.parseBaseList=function(t,n,r,i,s){var o=true;var u=t;for(;;){if(o){if(this.currentToken.tokenId==e.TokenID.Implements){if(i){this.reportParseError("interfaces can not implement other types")}u=n}this.currentToken=this.scanner.scan();o=false}var a=null;if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){var f=this.scanner.startPos;a=e.Identifier.fromToken(this.currentToken);a.minChar=f;a.limChar=this.scanner.pos;a=this.parseNamedType(r|e.ErrorRecoverySet.LCurly,f,a,false)}else{this.reportParseError("Expected base name");if(this.errorRecovery){a=new e.MissingIdentifier;a.minChar=this.scanner.pos;a.limChar=this.scanner.pos;a.flags|=e.ASTFlags.Error}}if(this.currentToken.tokenId==e.TokenID.OpenParen){if(s){this.reportParseError("Base classes may only be initialized via a 'super' call within the constructor body")}else{this.reportParseError("Interfaces may not be extended with a call expression")}}else{u.append(a)}if(!i&&u==t&&t.members.length>1){this.reportParseError("A class may only extend one other class")}if(this.currentToken.tokenId==e.TokenID.Comma){this.currentToken=this.scanner.scan();continue}else{if(this.currentToken.tokenId==e.TokenID.Extends||this.currentToken.tokenId==e.TokenID.Implements){u=t;o=true;continue}}break}};i.prototype.parseClassDecl=function(t,n,r){var i=this.scanner.leftCurlyCount;var s=this.scanner.rightCurlyCount;if((r&e.Modifiers.Readonly)!=e.Modifiers.None){this.reportParseError("const modifier is implicit for class")}if(this.parsingDeclareFile||this.ambientModule){r|=e.Modifiers.Ambient;r|=e.Modifiers.Exported}var o=this.parsingDeclareFile||(r&e.Modifiers.Ambient)!=e.Modifiers.None;var u=this.ambientClass;this.ambientClass=o;this.currentToken=this.scanner.scan();var a=null;if(this.currentToken.tokenId==e.TokenID.Identifier||!e.isPrimitiveTypeToken(this.currentToken)&&e.convertTokToID(this.currentToken,this.strictMode)){a=e.Identifier.fromToken(this.currentToken);a.minChar=this.scanner.startPos;a.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}else{this.reportParseError("class missing name");if(this.errorRecovery){a=new e.MissingIdentifier;a.minChar=this.scanner.pos;a.limChar=this.scanner.pos;a.flags|=e.ASTFlags.Error}}var f=null;var l=null;var c=false;if(this.currentToken.tokenId==e.TokenID.Extends||this.currentToken.tokenId==e.TokenID.Implements){f=new e.ASTList;l=new e.ASTList;this.parseBaseList(f,l,t,false,true)}var h=new e.ClassDeclaration(a,new e.ASTList,f,l);this.currentClassDefinition=h;this.parseClassElements(h,t,r);if(this.ambientModule||this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Exported)){h.varFlags|=e.VarFlags.Exported}if(this.ambientModule||e.hasFlag(r,e.Modifiers.Ambient)){h.varFlags|=e.VarFlags.Ambient}h.varFlags|=e.VarFlags.Class;this.ambientClass=u;h.leftCurlyCount=this.scanner.leftCurlyCount-i;h.rightCurlyCount=this.scanner.rightCurlyCount-s;return h};i.prototype.parseClassElements=function(t,n,r){var i=r;var s=false;var o=this.scanner.startPos;this.checkCurrentToken(e.TokenID.OpenBrace,n);this.nestingLevel++;var u=this.scanner.startPos;var a=false;while(!(this.currentToken.tokenId==e.TokenID.CloseBrace||this.currentToken.tokenId==e.TokenID.EndOfFile)){var f=true;var l=e.Modifiers.Public|e.Modifiers.Private;if(this.currentToken.tokenId==e.TokenID.Get){if(i&e.Modifiers.Getter){this.reportParseError("Duplicate 'get' declaration in class body")}if(i&e.Modifiers.Setter){this.reportParseError("Getter already marked as a setter")}i|=e.Modifiers.Getter}else{if(this.currentToken.tokenId==e.TokenID.Set){if(i&e.Modifiers.Setter){this.reportParseError("Duplicate 'set' declaration in class body")}if(i&e.Modifiers.Getter){this.reportParseError("Setter already marked as a getter")}i|=e.Modifiers.Setter}else{if(this.currentToken.tokenId==e.TokenID.Private){if(i&l){this.reportParseError("Multiple modifiers may not be applied to class members")}i|=e.Modifiers.Private}else{if(this.currentToken.tokenId==e.TokenID.Public){if(i&l){this.reportParseError("Multiple modifiers may not be applied to class members")}i|=e.Modifiers.Public}else{if(this.currentToken.tokenId==e.TokenID.Static){if(i&e.Modifiers.Static){this.reportParseError("Multiple modifiers may not be applied to class members")}i|=e.Modifiers.Static}else{if(this.currentToken.tokenId==e.TokenID.Constructor){if(i!=r){this.reportParseError("Constructors may not have modifiers")}this.parseClassConstructorDeclaration(u,n,i);f=false;s=true}else{if(a||this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToIDName(this.currentToken)){var c=a?i&e.Modifiers.Getter?"get":"set":this.currentToken.getText();var h=a?new e.Identifier(c):e.Identifier.fromToken(this.currentToken);h.minChar=this.scanner.startPos;h.limChar=this.scanner.pos;if(a){i=i^(i&e.Modifiers.Getter?e.Modifiers.Getter:e.Modifiers.Setter);a=false}else{this.currentToken=this.scanner.scan()}if(this.currentToken.tokenId==e.TokenID.OpenParen){this.parseClassMemberFunctionDeclaration(h,u,n,i);f=false}else{if(i&e.Modifiers.Getter||i&e.Modifiers.Setter){this.reportParseError("Property accessors must be functions")}var p=this.parseClassMemberVariableDeclaration(h,u,false,n,i);if(p.init&&p.init.nodeType==e.NodeType.FuncDecl){if(this.currentToken.tokenId==e.TokenID.CloseBrace){f=false}}else{if(p.init&&p.init.nodeType==e.NodeType.ObjectLit&&this.currentToken.tokenId!=e.TokenID.Semicolon){f=false;p.init.flags|=e.ASTFlags.AutomaticSemicolon}else{if(this.currentToken.tokenId!=e.TokenID.Semicolon){this.reportParseError("Expected ';'");f=false}}}}s=true}else{if(this.currentToken.tokenId==e.TokenID.Super){this.reportParseError("Base class initializers must be the first statement in a class definition")}else{if(!a&&(i&e.Modifiers.Getter||i&e.Modifiers.Setter)&&this.currentToken.tokenId==e.TokenID.OpenParen||this.currentToken.tokenId==e.TokenID.Equals){a=true;f=false}else{if(this.currentToken.tokenId!=e.TokenID.Semicolon){this.reportParseError("Unexpected '"+this.currentToken.getText()+"' in class definition");s=true}}}}}}}}}}if(f){this.currentToken=this.scanner.scan()}if(s){i=r;u=this.scanner.startPos;s=false}}var d=this.scanner.pos;if(this.currentToken.tokenId==e.TokenID.CloseBrace){t.endingToken=new e.ASTSpan;t.endingToken.minChar=this.scanner.startPos;t.endingToken.limChar=this.scanner.pos;if(!this.currentClassDefinition.members.members.length){this.currentClassDefinition.preComments=this.parseComments()}this.currentToken=this.scanner.scan()}this.nestingLevel--;this.currentClassDefinition.members.minChar=o;this.currentClassDefinition.members.limChar=d;this.currentClassDefinition.limChar=d;this.currentClassDefinition=null};i.prototype.parseClassConstructorDeclaration=function(t,n,r){this.parsingClassConstructorDefinition=true;var i=this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient);var s=new e.ASTList;var o=false;var u=this.parseComments();this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.OpenParen){o=this.parseFormalParameterList(n,s,true,i,false,false,false,false,null,true);if(s.members.length>0){var a=s.members[s.members.length-1]}}var f=i||this.currentToken.tokenId==e.TokenID.Semicolon;if(f){for(var l=0;l<s.members.length;l++){var c=s.members[l];if(e.hasFlag(c.varFlags,e.VarFlags.Property)){this.reportParseError("Overload or ambient signatures may not specify parameter properties",c.minChar,c.limChar)}}}if(!f){this.currentClassDefinition.constructorNestingLevel=this.nestingLevel+1}var h=this.parseFunctionStatements(n|e.ErrorRecoverySet.RCurly,this.currentClassDefinition.name,true,false,s,e.AllowedElements.Properties,t,f,r);h.preComments=u;if(f&&!i){h.isOverload=true}h.variableArgList=o;this.currentClassDecl=null;h.returnTypeAnnotation=this.convertToTypeReference(this.currentClassDefinition.name);h.classDecl=this.currentClassDefinition;if(i){h.fncFlags|=e.FncFlags.Ambient}if(f){h.fncFlags|=e.FncFlags.Signature}if(this.ambientModule||e.hasFlag(r,e.Modifiers.Exported)){h.fncFlags|=e.FncFlags.Exported}if(this.currentClassDefinition.constructorDecl){if(!i&&!this.currentClassDefinition.constructorDecl.isSignature()&&!h.isSignature()){this.reportParseError("Duplicate constructor definition")}}if(i||!h.isSignature()){this.currentClassDefinition.constructorDecl=h}h.fncFlags|=e.FncFlags.ClassMethod;this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=h;this.parsingClassConstructorDefinition=false;h.postComments=this.parseComments();return h};i.prototype.parseClassMemberVariableDeclaration=function(n,r,i,s,o){var u=new e.VarDecl(n,this.nestingLevel);u.minChar=r;var a=false;u.preComments=this.parseComments();if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();u.typeExpr=this.parseTypeReference(s|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,false)}if(this.currentToken.tokenId==e.TokenID.Equals){if(this.parsingDeclareFile||e.hasFlag(o,e.Modifiers.Ambient)){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery){this.skip(s);u.flags|=e.ASTFlags.Error;u.limChar=this.scanner.lastTokenLimChar();return u}}this.currentToken=this.scanner.scan();u.init=this.parseExpr(e.ErrorRecoverySet.Comma|s,e.OperatorPrecedence.Comma,true,t.NoTypes);u.limChar=u.init.limChar;if(!(o&e.Modifiers.Static)){this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor}}else{u.limChar=this.scanner.pos}if(o&e.Modifiers.Static){u.varFlags|=e.VarFlags.Static;a=true}if((o&e.Modifiers.Private)!=e.Modifiers.None){u.varFlags|=e.VarFlags.Private}else{u.varFlags|=e.VarFlags.Public}u.varFlags|=e.VarFlags.Property;if(i){u.varFlags|=e.VarFlags.ClassConstructorProperty}if(!i&&!a){u.varFlags|=e.VarFlags.ClassBodyProperty}this.currentClassDefinition.knownMemberNames[n.actualText]=true;if(!i){this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=u}u.postComments=this.parseComments();return u};i.prototype.parseClassMemberFunctionDeclaration=function(t,n,r,i){var s=this.prevIDTok!=null;var o=e.hasFlag(i,e.Modifiers.Getter)||e.hasFlag(i,e.Modifiers.Setter);var u=e.hasFlag(i,e.Modifiers.Static);var a=this.ambientModule||e.hasFlag(i,e.Modifiers.Ambient);r|=e.ErrorRecoverySet.RParen;var f=this.parseComments();if(o&&i&e.Modifiers.Ambient){this.reportParseError("Property accessors may not be declared in ambient classes")}var l=this.parseFncDecl(r,true,a,true,t,false,u,a,i,null,true);if(l.nodeType==e.NodeType.Error){return l}var c=l;c.preComments=f;c.minChar=n;if(c.bod!==null){c.limChar=c.bod.limChar}if(i&e.Modifiers.Private){c.fncFlags|=e.FncFlags.Private}else{c.fncFlags|=e.FncFlags.Public}if(u){c.fncFlags|=e.FncFlags.Static}if(o){if(e.hasFlag(i,e.Modifiers.Getter)){c.fncFlags|=e.FncFlags.GetAccessor;c.hint="get"+c.name.actualText}else{c.fncFlags|=e.FncFlags.SetAccessor;c.hint="set"+c.name.actualText}c.fncFlags|=e.FncFlags.IsFunctionExpression;if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater",c.minChar,c.limChar)}}c.fncFlags|=e.FncFlags.ClassMethod;this.currentClassDefinition.knownMemberNames[t.actualText]=true;this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=c;c.postComments=this.parseComments();return c};i.prototype.parseTypeMember=function(t){var n=this.scanner.startPos;var r=this.parsePropertyDeclaration(t,e.Modifiers.Public,true,false);if(r){r.minChar=n;if(r.nodeType==e.NodeType.VarDecl){this.checkCurrentToken(e.TokenID.Semicolon,t)}}return r};i.prototype.parseTypeMemberList=function(t,n){t|=e.ErrorRecoverySet.TypeScriptS;while(true){switch(this.currentToken.tokenId){case e.TokenID.CloseBrace:case e.TokenID.EndOfFile:{n.limChar=this.scanner.pos;return}}var r=this.parseTypeMember(t);if(r){n.append(r)}}};i.prototype.parseInterfaceDecl=function(t,n){var r=this.scanner.leftCurlyCount;var i=this.scanner.rightCurlyCount;this.currentToken=this.scanner.scan();var s=this.scanner.pos;var o=null;if(this.currentToken.tokenId==e.TokenID.Identifier||!e.isPrimitiveTypeToken(this.currentToken)&&e.convertTokToID(this.currentToken,this.strictMode)){o=e.Identifier.fromToken(this.currentToken);o.minChar=this.scanner.startPos;o.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}else{this.reportParseError("interface missing name");if(this.errorRecovery){o=new e.MissingIdentifier;o.minChar=this.scanner.pos;o.limChar=this.scanner.pos;o.flags|=e.ASTFlags.Error}}var u=null;if(this.currentToken.tokenId==e.TokenID.Extends){u=new e.ASTList;u.minChar=this.scanner.startPos;this.parseBaseList(u,null,t,true,false)}var a=this.scanner.startPos;this.checkCurrentToken(e.TokenID.OpenBrace,t|e.ErrorRecoverySet.TypeScriptS);var f=new e.ASTList;f.minChar=a;var l=this.inInterfaceDecl;this.inInterfaceDecl=true;this.parseTypeMemberList(t|e.ErrorRecoverySet.RCurly,f);this.inInterfaceDecl=l;this.checkCurrentToken(e.TokenID.CloseBrace,t);var c=new e.InterfaceDeclaration(o,f,u,null);if(e.hasFlag(n,e.Modifiers.Private)){c.varFlags|=e.VarFlags.Private}if(e.hasFlag(n,e.Modifiers.Public)){c.varFlags|=e.VarFlags.Public}if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(n,e.Modifiers.Exported)){c.varFlags|=e.VarFlags.Exported}c.limChar=f.limChar;c.leftCurlyCount=this.scanner.leftCurlyCount-r;c.rightCurlyCount=this.scanner.rightCurlyCount-i;return c};i.prototype.makeVarDecl=function(t,n){var r=new e.VarDecl(t,n);var i=this.topVarList();if(i){i.append(r)}return r};i.prototype.parsePropertyDeclaration=function(n,r,i,s){var o=null;var u=this.scanner.startPos;var a=u;var f=false;var l=false;var c=this.prevIDTok!=null;var h=e.hasFlag(r,e.Modifiers.Getter)||e.hasFlag(r,e.Modifiers.Setter);if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(r,e.Modifiers.Ambient)){i=true}if(this.currentToken.tokenId==e.TokenID.OpenParen&&!c){if(!i&&!s){this.reportParseError("Expected identifier in property declaration");if(this.errorRecovery){this.skip(n);o=new e.MissingIdentifier}}}else{if(this.currentToken.tokenId==e.TokenID.New){if(i){this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.OpenParen){f=true}}if(!f){if(!i){this.currentToken=this.scanner.scan()}o=new e.Identifier("new");o.minChar=this.scanner.pos-3;o.limChar=this.scanner.pos;a=this.scanner.pos}}else{if(this.currentToken.tokenId==e.TokenID.OpenBracket&&i){l=true;o=new e.Identifier("__item")}else{if(this.currentToken.tokenId!=e.TokenID.Identifier&&!e.convertTokToIDName(this.currentToken)&&!c){this.reportParseError("Expected identifier in property declaration");if(this.errorRecovery){var p=this.scanner.startPos;var d=this.scanner.pos;this.skip(n&~e.ErrorRecoverySet.Comma);if(this.scanner.pos==d){this.currentToken=this.scanner.scan()}var v=new e.VarDecl(new e.MissingIdentifier,this.nestingLevel);v.flags|=e.ASTFlags.Error;v.minChar=p;v.limChar=this.scanner.lastTokenLimChar();return v}}else{if(c){o=e.Identifier.fromToken(this.prevIDTok);o.minChar=this.scanner.lastTokenLimChar()-3;o.limChar=this.scanner.lastTokenLimChar();a=o.limChar;if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.getText()==o.actualText&&this.currentToken!=this.prevIDTok){this.currentToken=this.scanner.scan()}this.prevIDTok=null}else{o=e.Identifier.fromToken(this.currentToken);o.minChar=this.scanner.startPos;o.limChar=this.scanner.pos;a=this.scanner.pos;this.currentToken=this.scanner.scan()}}}}}if(this.currentToken.tokenId==e.TokenID.Question){if(this.inInterfaceDecl&&o){o.flags|=e.ASTFlags.OptionalName}else{this.reportParseError("Optional properties may only be declared on interface or object types")}this.currentToken=this.scanner.scan()}if(this.currentToken.tokenId==e.TokenID.OpenParen||l&&this.currentToken.tokenId==e.TokenID.OpenBracket){var m=n|e.ErrorRecoverySet.RParen;if(l){m=n|e.ErrorRecoverySet.RBrack}var g=this.parseFncDecl(m,true,i,!this.inFncDecl,o,l,s,this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient),r,null,true);var y;if(g.nodeType==e.NodeType.Error){return g}else{y=g}if(y.name){y.name.minChar=u;y.name.limChar=a}if((r&e.Modifiers.Public)!=e.Modifiers.None){y.fncFlags|=e.FncFlags.Public}if((r&e.Modifiers.Private)!=e.Modifiers.None){y.fncFlags|=e.FncFlags.Private}if(s){y.fncFlags|=e.FncFlags.Static}if(this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient)){y.fncFlags|=e.FncFlags.Ambient}if(h){if(e.hasFlag(r,e.Modifiers.Getter)){y.fncFlags|=e.FncFlags.GetAccessor;y.hint="get"+y.name.actualText}else{y.fncFlags|=e.FncFlags.SetAccessor;y.hint="set"+y.name.actualText}y.fncFlags|=e.FncFlags.IsFunctionExpression;if(r&e.Modifiers.Ambient){this.reportParseError("Property accessors may not be declared in ambient types")}}if(o==null){if(f){y.fncFlags|=e.FncFlags.ConstructMember;y.hint="_construct";y.classDecl=this.currentClassDecl}else{y.hint="_call";y.fncFlags|=e.FncFlags.CallMember}}return y}else{var b=new e.VarDecl(o,this.nestingLevel);b.minChar=u;if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();b.typeExpr=this.parseTypeReference(n|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,false)}if(this.currentToken.tokenId==e.TokenID.Equals){if(i){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery){this.skip(n);b.flags|=e.ASTFlags.Error;b.limChar=this.scanner.lastTokenLimChar();return b}}this.currentToken=this.scanner.scan();b.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,true,t.NoTypes);b.limChar=b.init.limChar;if(b.init.nodeType==e.NodeType.FuncDecl){var y=b.init;y.hint=b.id.text;y.boundToProperty=b}else{if(h){this.reportParseError("Accessors may only be functions")}}}else{b.limChar=this.scanner.pos}if((r&e.Modifiers.Readonly)!=e.Modifiers.None){b.varFlags|=e.VarFlags.Readonly}if(s){b.varFlags|=e.VarFlags.Static}if((r&e.Modifiers.Public)!=e.Modifiers.None){b.varFlags|=e.VarFlags.Public}if((r&e.Modifiers.Private)!=e.Modifiers.None){b.varFlags|=e.VarFlags.Private}b.varFlags|=e.VarFlags.Property;return b}};i.prototype.parseVariableDeclaration=function(n,r,i,s){var o=e.hasFlag(r,e.Modifiers.Readonly);var u=this.scanner.startPos;var a=null;var f=null;var l=false;this.currentToken=this.scanner.scan();var c=this.parseComments();while(true){if(this.currentToken.tokenId!=e.TokenID.Identifier&&!e.convertTokToID(this.currentToken,this.strictMode)){this.reportParseError("Expected identifier in variable declaration");if(this.errorRecovery){a=new e.VarDecl(new e.MissingIdentifier,this.nestingLevel);a.minChar=u;this.skip(n);a.flags|=e.ASTFlags.Error;a.limChar=this.scanner.lastTokenLimChar();return a}}var h=e.Identifier.fromToken(this.currentToken);if(this.strictMode&&h.text=="eval"){this.reportParseError("'eval' may not name a variable in strict mode")}a=this.makeVarDecl(h,this.nestingLevel);a.id.minChar=this.scanner.startPos;a.id.limChar=this.scanner.pos;a.preComments=c;if(s){a.varFlags|=e.VarFlags.Static}if(e.hasFlag(r,e.Modifiers.Readonly)){a.varFlags|=e.VarFlags.Readonly}if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(r,e.Modifiers.Ambient)){a.varFlags|=e.VarFlags.Ambient}if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(r,e.Modifiers.Exported)){a.varFlags|=e.VarFlags.Exported}a.minChar=u;if(f){f.append(a)}this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();var p=this.inFncDecl;this.inFncDecl=false;a.typeExpr=this.parseTypeReference(n|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,false);this.inFncDecl=p}if(this.currentToken.tokenId==e.TokenID.Equals){if(e.hasFlag(a.varFlags,e.VarFlags.Ambient)){this.reportParseError("Ambient variable can not have an initializer")}this.currentToken=this.scanner.scan();a.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,i,t.NoTypes);a.limChar=a.init.limChar;if(a.init.nodeType==e.NodeType.FuncDecl){var d=a.init;d.hint=a.id.actualText}}else{if(o){this.reportParseError("const declaration requires initializer")}a.limChar=this.scanner.pos}a.postComments=this.parseCommentsForLine(this.scanner.line);if(this.currentToken.tokenId!=e.TokenID.Comma){if(f){f.limChar=a.limChar;return f}else{return a}}if(!l){f=new e.ASTList;f.minChar=a.minChar;f.append(a);l=true}this.currentToken=this.scanner.scan();u=this.scanner.startPos}};i.prototype.parseMemberList=function(n){var r=new e.ASTList;if(this.currentToken.tokenId==e.TokenID.CloseBrace){return r}var i=null;var s=null;var o=null;var u=null;var a=this.scanner.startPos;var f=false;var l=false;var c=null;var h=0;var p=0;for(;;){var d=false;if(this.currentToken.tokenId==e.TokenID.Get||this.currentToken.tokenId==e.TokenID.Set){f=this.currentToken.tokenId==e.TokenID.Set;c=this.currentToken;h=this.scanner.startPos;p=this.scanner.pos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToIDName(this.currentToken)){i=f?"set":"get";i=i+this.currentToken.getText();s=e.Identifier.fromToken(this.currentToken);s.minChar=this.scanner.startPos;d=true;if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}}else{if(this.currentToken.tokenId!=e.TokenID.Colon){this.reportParseError("Expected identifier, string or number as accessor name")}else{l=true;s=e.Identifier.fromToken(c);s.minChar=h;s.limChar=p}}}else{if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToIDName(this.currentToken)){i=this.currentToken.getText();s=e.Identifier.fromToken(this.currentToken);s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos}else{if(this.currentToken.tokenId==e.TokenID.StringLiteral){i=this.currentToken.getText();s=new e.StringLiteral(i);s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos}else{if(this.currentToken.tokenId==e.TokenID.NumberLiteral){var v=this.currentToken;i=v.value.toString();s=new e.StringLiteral(i);s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos}else{this.reportParseError("Expected identifier, string or number as member name");if(this.errorRecovery){s=new e.MissingIdentifier;s.minChar=this.scanner.startPos;s.flags|=e.ASTFlags.Error;this.skip(n|e.ErrorRecoverySet.Comma);s.limChar=this.scanner.lastTokenLimChar()}}}}}if(!l){this.currentToken=this.scanner.scan()}else{l=false}if(this.currentToken.tokenId==e.TokenID.Question){s.flags|=e.ASTFlags.OptionalName;this.currentToken=this.scanner.scan()}if(d){var m=new e.ASTList;this.parseFormalParameterList(n|e.ErrorRecoverySet.RParen,m,false,true,false,!f,f,false,null,true);var g=this.parseFunctionStatements(n|e.ErrorRecoverySet.RCurly,s,false,true,m,e.AllowedElements.None,this.scanner.startPos,false,e.Modifiers.None);if(f&&g.returnTypeAnnotation){this.reportParseError("Property setters may not declare a return type")}g.fncFlags|=f?e.FncFlags.SetAccessor:e.FncFlags.GetAccessor;g.fncFlags|=e.FncFlags.IsFunctionExpression;g.hint=i;o=g;u=new e.BinaryExpression(e.NodeType.Member,s,o);u.minChar=s.minChar;if(o.nodeType==e.NodeType.FuncDecl){var g=o;g.hint=i}}else{if(this.currentToken.tokenId==e.TokenID.Colon){this.currentToken=this.scanner.scan();o=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,true,t.NoTypes);if(o.nodeType==e.NodeType.TypeRef){this.reportParseError("Expected 'new' on array declaration in member definition")}u=new e.BinaryExpression(e.NodeType.Member,s,o);u.minChar=s.minChar;if(o.nodeType==e.NodeType.FuncDecl){var g=o;g.hint=i}}else{this.reportParseError("Expected ':' in member definition");if(this.errorRecovery){this.skip(n);r.flags|=e.ASTFlags.Error;r.minChar=a;r.limChar=this.scanner.lastTokenLimChar();return r}}}i=null;r.append(u);u.limChar=this.scanner.lastTokenLimChar();if(this.currentToken.tokenId!=e.TokenID.Comma){break}else{this.currentToken=this.scanner.scan()}if(this.currentToken.tokenId==e.TokenID.CloseBrace){break}}if(u){r.limChar=u.limChar}r.minChar=a;return r};i.prototype.parseArrayList=function(n){var r=null;if(this.currentToken.tokenId==e.TokenID.CloseBracket){return r}else{r=new e.ASTList;r.minChar=this.scanner.startPos}var i;for(;;){if(this.currentToken.tokenId==e.TokenID.Comma||this.currentToken.tokenId==e.TokenID.CloseBracket){i=new e.AST(e.NodeType.EmptyExpr)}else{i=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Comma,true,t.NoTypes)}r.append(i);if(this.currentToken.tokenId!=e.TokenID.Comma){break}this.currentToken=this.scanner.scan()}r.limChar=this.scanner.lastTokenLimChar();return r};i.prototype.parseArrayLiteral=function(t){var n=null;n=new e.UnaryExpression(e.NodeType.ArrayLit,this.parseArrayList(t));return n};i.prototype.parseTerm=function(n,r,i,s){var o=null;var u=false;var a=false;var f=this.scanner.startPos;var l=this.scanner.pos;var c=false;var h=false;switch(this.currentToken.tokenId){case e.TokenID.Number:case e.TokenID.Bool:case e.TokenID.Any:case e.TokenID.String:{var p=new e.Identifier(e.tokenTable[this.currentToken.tokenId].text);if(e.hasFlag(i,t.Primitive)){o=new e.TypeReference(p,0);u=true}else{o=p;u=true}o.minChar=f;this.currentToken=this.scanner.scan();l=this.scanner.lastTokenLimChar();break};case e.TokenID.This:{o=new e.AST(e.NodeType.This);o.minChar=f;this.currentToken=this.scanner.scan();l=this.scanner.lastTokenLimChar();break};case e.TokenID.Super:{o=new e.AST(e.NodeType.Super);o.minChar=f;this.currentToken=this.scanner.scan();l=this.scanner.lastTokenLimChar();break};case e.TokenID.True:{o=new e.AST(e.NodeType.True);this.currentToken=this.scanner.scan();o.minChar=f;break};case e.TokenID.False:{o=new e.AST(e.NodeType.False);this.currentToken=this.scanner.scan();o.minChar=f;break};case e.TokenID.Null:{o=new e.AST(e.NodeType.Null);this.currentToken=this.scanner.scan();o.minChar=f;break};case e.TokenID.New:{f=this.scanner.pos;this.currentToken=this.scanner.scan();o=new e.CallExpression(e.NodeType.New,this.parseTerm(n,false,t.AllSimpleTypes,s),null);o.minChar=f;l=this.scanner.lastTokenLimChar();a=true;break};case e.TokenID.Function:{f=this.scanner.pos;o=this.parseFncDecl(n,false,false,false,null,false,false,false,e.Modifiers.None,null,true);o.fncFlags|=e.FncFlags.IsFunctionExpression;o.minChar=f;l=this.scanner.lastTokenLimChar();o.limChar=l;break}}if(o==null){if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){var d=this.currentToken.getText();o=this.createRef(d,this.currentToken.hasEscapeSequence,f);u=true;o.minChar=f;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Question){o.flags|=e.ASTFlags.PossibleOptionalParameter}l=this.scanner.lastTokenLimChar()}}if(s){this.checkCurrentToken(e.TokenID.GreaterThan,n)}if(o==null){switch(this.currentToken.tokenId){case e.TokenID.OpenParen:{f=this.scanner.pos;var v=this.scanner.previousToken().tokenId;this.currentToken=this.scanner.scan();var m=v==e.TokenID.OpenParen||v==e.TokenID.Comma||v==e.TokenID.EqualsEquals||v==e.TokenID.Colon;if(m&&this.currentToken.tokenId==e.TokenID.CloseParen){c=true;h=false;this.currentToken=this.scanner.scan()}else{if(m&&this.currentToken.tokenId==e.TokenID.DotDotDot){c=true;h=true}else{o=this.parseExpr(n|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes,m);l=this.scanner.lastTokenLimChar();c=m&&(o.nodeType==e.NodeType.Name||o.nodeType==e.NodeType.Comma)&&(this.currentToken.tokenId==e.TokenID.Colon||this.currentToken.tokenId==e.TokenID.Question);h=true}}if(o&&!c){if(e.hasFlag(o.flags,e.ASTFlags.SkipNextRParen)){o.flags=o.flags&~e.ASTFlags.SkipNextRParen;break}this.checkCurrentToken(e.TokenID.CloseParen,n);o.isParenthesized=true}break};case e.TokenID.NumberLiteral:{var g=this.currentToken;this.currentToken=this.scanner.scan();o=new e.NumberLiteral(g.value,g.hasEmptyFraction);o.minChar=f;l=this.scanner.lastTokenLimChar();break};case e.TokenID.StringLiteral:{o=new e.StringLiteral(this.currentToken.getText());this.currentToken=this.scanner.scan();o.minChar=f;l=this.scanner.lastTokenLimChar();break};case e.TokenID.RegularExpressionLiteral:{var y=this.currentToken;o=new e.RegexLiteral(y.regex);this.currentToken=this.scanner.scan();o.minChar=f;l=this.scanner.lastTokenLimChar();break};case e.TokenID.OpenBracket:{f=this.scanner.startPos;this.currentToken=this.scanner.scan();o=this.parseArrayLiteral(e.ErrorRecoverySet.RBrack|n);o.minChar=f;l=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseBracket,n);break};case e.TokenID.OpenBrace:{f=this.scanner.startPos;this.currentToken=this.scanner.scan();var b=this.parseMemberList(e.ErrorRecoverySet.RCurly|n);this.checkCurrentToken(e.TokenID.CloseBrace,n);o=new e.UnaryExpression(e.NodeType.ObjectLit,b);o.minChar=f;l=this.scanner.lastTokenLimChar();b.minChar=f;b.limChar=l;break};case e.TokenID.LessThan:{f=this.scanner.startPos;this.currentToken=this.scanner.scan();var w=this.parseTypeReference(e.ErrorRecoverySet.BinOp,false);this.checkCurrentToken(e.TokenID.GreaterThan,n);o=new e.UnaryExpression(e.NodeType.TypeAssertion,this.parseExpr(n,e.OperatorPrecedence.Unary,false,t.NoTypes));o.castTerm=w;break};default:{if(this.prevExpr&&e.hasFlag(this.prevExpr.flags,e.ASTFlags.PossibleOptionalParameter)){c=true;o=this.prevExpr}else{this.reportParseError("Check format of expression term");if(this.errorRecovery){var E=new e.MissingIdentifier;E.minChar=f;E.flags|=e.ASTFlags.Error;this.skip(n|e.ErrorRecoverySet.Postfix);if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){E.setText(this.currentToken.getText(),this.currentToken.hasEscapeSequence);this.currentToken=this.scanner.scan();l=this.scanner.lastTokenLimChar()}else{l=this.scanner.lastTokenLimChar()}o=E}}}}}if(c){if(this.currentToken.tokenId==e.TokenID.Colon||this.currentToken.tokenId==e.TokenID.Comma||this.currentToken.tokenId==e.TokenID.CloseParen||this.currentToken.tokenId==e.TokenID.DotDotDot){o=this.parseLambdaExpr(n,o,true,h);o.minChar=f;l=this.scanner.lastTokenLimChar();o.limChar=l}else{if(o){o.isParenthesized=true}}}if(u&&i!=t.NoTypes){i|=t.ArraySuffix}var S=this.parsePostfixOperators(n,o,r,a,i,f,l);if(S){if(u&&S.nodeType==e.NodeType.Index){var x=S;if(x.operand2==null){S=this.convertToTypeReference(S)}}S.minChar=f;S.limChar=e.max(S.limChar,this.scanner.lastTokenLimChar());return S}else{return new e.AST(e.NodeType.Error)}};i.prototype.parseLambdaExpr=function(t,n,r,i){var s=this.parseFncDecl(t,false,false,false,null,false,false,false,e.Modifiers.None,{preProcessedLambdaArgs:n},i);s.fncFlags|=e.FncFlags.IsFunctionExpression;s.fncFlags|=e.FncFlags.IsFatArrowFunction;if(!r){s.flags|=e.ASTFlags.SkipNextRParen}s.limChar=this.scanner.lastTokenLimChar();return s};i.prototype.parseExpr=function(n,r,i,s,o){if(typeof o==="undefined"){o=false}var u=null;var a=e.lookupToken(this.currentToken.tokenId);var f=true;var l=null;var c=this.scanner.startPos;var h=this.parseComments();var p=false;if(a!=undefined&&a.unopNodeType!=e.NodeType.None){f=false;this.currentToken=this.scanner.scan();var d=this.parseExpr(e.ErrorRecoverySet.BinOp|n,a.unopPrecedence,i,t.NoTypes);if(a.unopNodeType==e.NodeType.Pos&&d.nodeType==e.NodeType.NumberLit){u=d}else{if(a.unopNodeType==e.NodeType.Neg&&d.nodeType==e.NodeType.NumberLit){var v=d;v.value=-v.value;if(v.value==0){v.isNegativeZero=true}u=d}else{u=new e.UnaryExpression(a.unopNodeType,d);u.limChar=d.limChar}}u.minChar=c}else{u=this.parseTerm(e.ErrorRecoverySet.BinOp|e.ErrorRecoverySet.AddOp|n,true,s,false);var m;var g;if(u.nodeType==e.NodeType.Name){m=u;l=m.actualText}else{if(u.nodeType==e.NodeType.Dot){var y=false;if(this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId==e.TokenID.Colon||this.currentToken.tokenId==e.TokenID.Equals)&&this.parsingClassConstructorDefinition&&this.nestingLevel==this.currentClassDefinition.constructorNestingLevel&&u.operand1.nodeType==e.NodeType.This){if(u.operand2.nodeType==e.NodeType.Name){var b=u.operand2;if(!this.currentClassDefinition.knownMemberNames[b.actualText]){u=this.parseClassMemberVariableDeclaration(b,u.minChar,true,n,e.Modifiers.Public);y=true}}}if(!y){g=u;while(g.nodeType==e.NodeType.Dot){var w=g;g=w.operand2}if(g.nodeType==e.NodeType.Name){m=g;l=m.actualText}}}}if(!this.scanner.lastTokenHadNewline()&&(this.currentToken.tokenId==e.TokenID.PlusPlus||this.currentToken.tokenId==e.TokenID.MinusMinus)){f=false;var E=u;u=new e.UnaryExpression(this.currentToken.tokenId==e.TokenID.PlusPlus?e.NodeType.IncPost:e.NodeType.DecPost,E);u.limChar=this.scanner.pos;u.minChar=E.minChar;this.currentToken=this.scanner.scan()}}for(;;){a=e.lookupToken(this.currentToken.tokenId);if(a==undefined||a.binopNodeType==e.NodeType.None){break}if(!i&&a.binopNodeType==e.NodeType.In){break}if(a.binopPrecedence==e.OperatorPrecedence.Assignment){if(a.binopPrecedence<r){break}if(!f){this.reportParseError("illegal assignment")}}else{if(a.binopPrecedence<=r){break}}if(o&&this.currentToken.tokenId==e.TokenID.Comma&&this.scanner.getLookAheadToken().tokenId==e.TokenID.DotDotDot){p=true;f=false;u=this.parseLambdaExpr(n,u,false,true);break}this.currentToken=this.scanner.scan();f=false;if(a.binopNodeType==e.NodeType.ConditionalExpression){if(o&&(this.currentToken.tokenId==e.TokenID.Equals||this.currentToken.tokenId==e.TokenID.Colon||this.currentToken.tokenId==e.TokenID.CloseParen||this.currentToken.tokenId==e.TokenID.Comma)){p=true;f=true}else{this.prevExpr=u;var S=this.parseExpr(n|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.Assignment,i,t.NoTypes);this.prevExpr=null;this.checkCurrentToken(e.TokenID.Colon,n|e.ErrorRecoverySet.ExprStart);var x=this.parseExpr(n|e.ErrorRecoverySet.BinOp,e.OperatorPrecedence.Assignment,i,t.NoTypes);u=new e.ConditionalExpression(u,S,x)}}else{var T=t.NoTypes;var N;N=new e.BinaryExpression(a.binopNodeType,u,this.parseExpr(n|e.ErrorRecoverySet.BinOp,a.binopPrecedence,i,t.NoTypes,o));if(N.operand2.nodeType==e.NodeType.FuncDecl){var C=N.operand2;C.hint=l}N.minChar=u.minChar;N.limChar=this.scanner.lastTokenLimChar();l=null;u=N}}if(f){u.flags|=e.ASTFlags.Writeable}if(!p){u.minChar=c;u.limChar=e.max(u.limChar,this.scanner.lastTokenLimChar());u.preComments=h;u.postComments=this.parseCommentsForLine(this.scanner.line)}return u};i.prototype.parsePostfixOperators=function(n,r,i,s,o,u,a){var f=0;if(!r){r=new e.AST(e.NodeType.EmptyExpr);r.isParenthesized=true}r.minChar=u;r.limChar=a;for(;;){switch(this.currentToken.tokenId){case e.TokenID.OpenParen:{if(s){var l=r;l.arguments=this.parseArgList(n);s=false}else{if(!i){return r}r=new e.CallExpression(e.NodeType.Call,r,this.parseArgList(n));r.minChar=u}r.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,n);break};case e.TokenID.OpenBracket:{this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.CloseBracket){if(e.hasFlag(o,t.ArraySuffix)){this.currentToken=this.scanner.scan();if(r.nodeType==e.NodeType.TypeRef){var c=r;c.arrayCount++}else{r=new e.BinaryExpression(e.NodeType.Index,r,null)}r.limChar=this.scanner.pos;break}}r=new e.BinaryExpression(e.NodeType.Index,r,this.parseExpr(n|e.ErrorRecoverySet.RBrack,e.OperatorPrecedence.None,true,t.NoTypes));r.minChar=u;r.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseBracket,n);break};case e.TokenID.Dot:{var h=null;var p=this.scanner.pos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier||(!this.errorRecovery||!this.scanner.lastTokenHadNewline())&&e.convertTokToIDName(this.currentToken)){r.flags|=e.ASTFlags.DotLHS;h=this.createRef(this.currentToken.getText(),this.currentToken.hasEscapeSequence,this.scanner.startPos);h.limChar=this.scanner.pos;this.currentToken=this.scanner.scan()}else{this.reportParseError("Expected identifier following dot");if(this.errorRecovery){this.skip(n);r.flags|=e.ASTFlags.Error|e.ASTFlags.DotLHS;return r}else{h=new e.MissingIdentifier}}r=new e.BinaryExpression(e.NodeType.Dot,r,h);r.minChar=u;r.limChar=this.scanner.lastTokenLimChar();break};case e.TokenID.EqualsGreaterThan:{r=this.parseFncDecl(n,false,false,false,null,false,false,false,e.Modifiers.None,{preProcessedLambdaArgs:r},false);r.fncFlags|=e.FncFlags.IsFunctionExpression;r.minChar=u;r.limChar=this.scanner.lastTokenLimChar();break};default:{return r}}}};i.prototype.parseTry=function(t,n,r){var i=this.scanner.startPos;var s=this.parseComments();this.currentToken=this.scanner.scan();if(this.currentToken.tokenId!=e.TokenID.OpenBrace){this.reportParseError("Expected '{'");if(this.errorRecovery){var o=t;o.minChar=i;o.limChar=this.scanner.lastTokenLimChar();o.flags|=e.ASTFlags.Error;return o}}t.body=this.parseStatement(n,e.AllowedElements.None,r);t.minChar=i;t.limChar=t.body.limChar;t.preComments=s;t.postComments=this.parseComments();return t};i.prototype.parseCatch=function(t,n){var r=this.scanner.startPos;var i=this.parseComments();this.currentToken=this.scanner.scan();this.checkCurrentToken(e.TokenID.OpenParen,t|e.ErrorRecoverySet.ExprStart);if(this.currentToken.tokenId!=e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){this.reportParseError("Expected identifier in catch header");if(this.errorRecovery){this.skip(t);var s=new e.Catch(new e.VarDecl(new e.MissingIdentifier,this.nestingLevel),new e.Statement(e.NodeType.Empty));s.statement.minChar=r;s.statement.limChar=this.scanner.pos;s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos;s.flags|=e.ASTFlags.Error;return s}}var o=new e.VarDecl(e.Identifier.fromToken(this.currentToken),this.nestingLevel);o.id.minChar=this.scanner.startPos;o.id.limChar=this.scanner.pos;o.minChar=o.id.minChar;o.limChar=o.id.limChar;this.currentToken=this.scanner.scan();var u=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,t|e.ErrorRecoverySet.StmtStart);if(this.currentToken.tokenId!=e.TokenID.OpenBrace){this.reportParseError("Expected '{' to start catch body");if(this.errorRecovery){this.skip(t);var s=new e.Catch(new e.VarDecl(new e.MissingIdentifier,this.nestingLevel),new e.Statement(e.NodeType.Empty));s.statement.minChar=r;s.statement.limChar=u;s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos;s.flags|=e.ASTFlags.Error;return s}}var a=this.parseStatement(t,e.AllowedElements.None,n);var f=new e.Catch(o,a);f.statement.minChar=r;f.statement.limChar=u;f.minChar=r;f.limChar=a.limChar;f.preComments=i;f.postComments=this.parseComments();return f};i.prototype.parseFinally=function(t,n){var r=this.scanner.startPos;var i=this.parseComments();this.currentToken=this.scanner.scan();if(this.currentToken.tokenId!=e.TokenID.OpenBrace){this.reportParseError("Expected '{' to start body of finally statement");if(this.errorRecovery){this.skip(t);var s=new e.Finally(new e.Statement(e.NodeType.Empty));s.flags|=e.ASTFlags.Error;s.minChar=this.scanner.startPos;s.limChar=this.scanner.pos;return s}}var o=this.parseStatement(t,e.AllowedElements.None,n);var u=new e.Finally(o);u.minChar=r;u.limChar=u.body.limChar;u.preComments=i;u.postComments=this.parseComments();return u};i.prototype.parseTryCatchFinally=function(t,n,r){var i=new e.Try(null);var s=this.scanner.startPos;this.pushStmt(i,r);this.parseTry(i,t|e.ErrorRecoverySet.Catch,n);this.popStmt();var o=null;var u=null;if(this.currentToken.tokenId==e.TokenID.Catch){var a=this.parseCatch(t|e.ErrorRecoverySet.Catch,n);o=new e.TryCatch(i,a);o.minChar=i.minChar;o.limChar=a.limChar}if(this.currentToken.tokenId!=e.TokenID.Finally){if(o==null){this.reportParseError("try with neither catch nor finally");if(this.errorRecovery){var f=new e.TryFinally(i,new e.Finally(new e.AST(e.NodeType.Empty)));f.flags|=e.ASTFlags.Error;f.minChar=this.scanner.startPos;f.limChar=this.scanner.pos;return f}return new e.TryFinally(i,new e.Finally(new e.AST(e.NodeType.Empty)))}else{return o}}else{if(o){i=o}var l=this.parseFinally(t,n);u=new e.TryFinally(i,l);u.minChar=s;u.limChar=l.limChar;return u}};i.prototype.parseStatement=function(r,i,s){function m(){return e.hasFlag(l,e.Modifiers.Ambient)||e.hasFlag(s,e.Modifiers.Ambient)}function g(){if(e.hasFlag(l,e.Modifiers.Exported)){this.reportError("Statement may not be exported")}}var o=null;var u=null;var a=null;var f;var l=e.Modifiers.None;var c=this.scanner.startPos;var h=false;var p=false;var d=null;var v=this.parseComments();this.state=n.StartStatement;for(;;){switch(this.currentToken.tokenId){case e.TokenID.EndOfFile:{o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.pos;break};case e.TokenID.Function:{if(this.parsingDeclareFile||m()||this.ambientModule){this.currentToken=this.scanner.scan();d=this.parsePropertyDeclaration(r|e.ErrorRecoverySet.SColon,l,true,false);if(d.nodeType==e.NodeType.VarDecl){this.reportParseError("function keyword can only introduce function declaration")}else{if(d.nodeType==e.NodeType.FuncDecl&&(d.fncFlags,e.FncFlags.IsFatArrowFunction)){p=true}}o=d;if(this.parsingDeclareFile||this.ambientModule&&o.nodeType==e.NodeType.FuncDecl){o.fncFlags|=e.FncFlags.Exported}}else{o=this.parseFncDecl(r,true,false,false,null,false,false,m(),l,null,true);if(e.hasFlag(o.fncFlags,e.FncFlags.IsFatArrowFunction)){p=true}if(this.ambientModule){this.reportParseError("function declaration not permitted within ambient module")}if(e.hasFlag(l,e.Modifiers.Exported)){o.fncFlags|=e.FncFlags.Exported}}break};case e.TokenID.Module:{if((i&e.AllowedElements.ModuleDeclarations)==e.AllowedElements.None){this.reportParseError("module not allowed in this context");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{o=this.parseModuleDecl(r,l)}break};case e.TokenID.Import:{if((i&e.AllowedElements.ModuleDeclarations)==e.AllowedElements.None){this.reportParseError("module not allowed in this context");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{o=this.parseImportDeclaration(r,l);p=true}break};case e.TokenID.Export:{if((i&e.AllowedElements.ModuleDeclarations)==e.AllowedElements.None){this.reportParseError("'export' statements are only allowed at the global and module levels");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}if(this.topLevel){this.hasTopLevelImportOrExport=true}l|=e.Modifiers.Exported;this.currentToken=this.scanner.scan();break};case e.TokenID.Private:{l|=e.Modifiers.Private;this.currentToken=this.scanner.scan();if(this.parsingClassConstructorDefinition){if(!this.inferPropertiesFromThisAssignment){this.reportParseError("Property declarations are not permitted within constructor bodies")}c=this.scanner.pos;if(this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId!=e.TokenID.This||(this.currentToken=this.scanner.scan()).tokenId!=e.TokenID.Dot)){this.reportParseError("Expected 'this.' for property declaration");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{this.currentToken=this.scanner.scan();var y=e.Identifier.fromToken(this.currentToken);y.minChar=this.scanner.startPos;y.limChar=this.scanner.pos;this.currentToken=this.scanner.scan();o=this.parseClassMemberVariableDeclaration(y,c,this.parsingClassConstructorDefinition,r,l)}}else{if(this.currentToken.tokenId!=e.TokenID.Interface){if(this.currentToken.tokenId==e.TokenID.Get){this.prevIDTok=this.currentToken;this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Getter;this.prevIDTok=null}}else{if(this.currentToken.tokenId==e.TokenID.Set){this.prevIDTok=this.currentToken;this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Setter;this.prevIDTok=null}}}d=this.parsePropertyDeclaration(r|e.ErrorRecoverySet.SColon,l,m(),false);if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction)){p=true}o=d}}break};case e.TokenID.Public:{if(this.parsingClassConstructorDefinition){if(!this.inferPropertiesFromThisAssignment){this.reportParseError("Property declarations are not permitted within constructor bodies")}this.currentToken=this.scanner.scan();c=this.scanner.pos;l|=e.Modifiers.Public;if(this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId!=e.TokenID.This||(this.currentToken=this.scanner.scan()).tokenId!=e.TokenID.Dot)){this.reportParseError("Expected 'this.' for property declaration");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{this.currentToken=this.scanner.scan();var y=e.Identifier.fromToken(this.currentToken);y.minChar=this.scanner.startPos;y.limChar=this.scanner.pos;this.currentToken=this.scanner.scan();o=this.parseClassMemberVariableDeclaration(y,c,this.parsingClassConstructorDefinition,r,l)}}else{if((i&e.AllowedElements.Properties)==e.AllowedElements.None){this.reportParseError("'property' statements are only allowed within classes");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{l|=e.Modifiers.Public;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Get){this.prevIDTok=this.currentToken;this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Getter;this.prevIDTok=null}}else{if(this.currentToken.tokenId==e.TokenID.Set){this.prevIDTok=this.currentToken;this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Setter;this.prevIDTok=null}}}d=this.parsePropertyDeclaration(r|e.ErrorRecoverySet.SColon,l,m(),false);if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction)){p=true}o=d}}break};case e.TokenID.Declare:{if(!(i&e.AllowedElements.AmbientDeclarations)){this.reportParseError("Ambient declarations are only allowed at the top-level or module scopes")}if(!this.parsingDeclareFile&&e.hasFlag(s,e.Modifiers.Ambient)){this.reportParseError("Duplicate ambient declaration in this context. (Is the enclosing module or class already ambient?)")}l|=e.Modifiers.Ambient;this.currentToken=this.scanner.scan();break};case e.TokenID.Class:{if((i&e.AllowedElements.ClassDeclarations)==e.AllowedElements.None){this.reportParseError("class not allowed in this context");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{o=this.parseClassDecl(r,c,l)}break};case e.TokenID.Interface:{if((i&e.AllowedElements.InterfaceDeclarations)==e.AllowedElements.None){this.reportParseError("interface not allowed in this context");this.currentToken=this.scanner.scan();o=new e.AST(e.NodeType.Error);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar()}else{o=this.parseInterfaceDecl(r,l)}break};case e.TokenID.Var:{var b=this.parseVariableDeclaration(r|e.ErrorRecoverySet.StmtStart,l,true,false);if(b.nodeType==e.NodeType.VarDecl){o=b}else{o=new e.Block(b,false)}p=true;break};case e.TokenID.Static:{if(this.currentClassDecl==null){this.reportParseError("Statics may only be class members")}g();l|=e.Modifiers.Public;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Get){this.prevIDTok=this.currentToken;this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Getter;this.prevIDTok=null}}else{if(this.currentToken.tokenId==e.TokenID.Set){this.currentToken=this.scanner.scan();if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("Property accessors are only available when targeting ES5 or greater")}if(this.currentToken.tokenId==e.TokenID.Identifier||e.convertTokToID(this.currentToken,this.strictMode)){l|=e.Modifiers.Setter}}}if(m()){l|=e.Modifiers.Ambient}d=this.parsePropertyDeclaration(r|e.ErrorRecoverySet.SColon,l,this.parsingDeclareFile||(l&e.Modifiers.Ambient)!=e.Modifiers.None,true);var w=this.topStaticsList();if(w&&d.nodeType==e.NodeType.VarDecl){w.append(d)}if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction)){p=true}o=d;break};case e.TokenID.For:{g();if(l!=e.Modifiers.None){this.reportParseError("syntax error: for statement does not take modifiers")}c=this.scanner.startPos;this.checkNextToken(e.TokenID.OpenParen,r|e.ErrorRecoverySet.ExprStart|e.ErrorRecoverySet.Var);this.state=n.ForInit;h=true;switch(this.currentToken.tokenId){case e.TokenID.Var:{f=this.parseVariableDeclaration(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.In,e.Modifiers.None,false,false);break};case e.TokenID.Semicolon:{f=null;this.state=n.ForCondStart;break};default:{f=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.In,e.OperatorPrecedence.None,false,t.NoTypes);break}}this.state=n.ForInitAfterVar;if(this.currentToken.tokenId==e.TokenID.In){if(f==null||!h){this.reportParseError("malformed for statement");if(this.errorRecovery){this.skip(r|e.ErrorRecoverySet.StmtStart);o=new e.AST(e.NodeType.Empty);o.flags|=e.ASTFlags.Error}}else{this.currentToken=this.scanner.scan();var E=new e.ForInStatement(f,this.parseExpr(e.ErrorRecoverySet.RParen|r,e.OperatorPrecedence.Comma,false,t.NoTypes));E.limChar=this.scanner.pos;E.statement.minChar=c;E.statement.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,e.ErrorRecoverySet.StmtStart|r);this.pushStmt(E,u);E.body=this.parseStatement(r,i,s);this.popStmt();E.minChar=c;o=E}}else{var S=new e.ForStatement(f);S.minChar=c;this.checkCurrentToken(e.TokenID.Semicolon,r);if(this.currentToken.tokenId==e.TokenID.Semicolon){S.cond=null}else{S.cond=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes);if(this.currentToken.tokenId!=e.TokenID.Semicolon){this.skip(r|e.ErrorRecoverySet.StmtStart);o=S;o.flags|=e.ASTFlags.Error}}this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.CloseParen){S.incr=null}else{S.incr=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes)}this.checkCurrentToken(e.TokenID.CloseParen,r|e.ErrorRecoverySet.LCurly);this.pushStmt(S,u);S.body=this.parseStatement(r,i,s);this.popStmt();S.limChar=S.body.limChar;o=S}break};case e.TokenID.With:{{if(e.codeGenTarget<e.CodeGenTarget.ES5){this.reportParseError("'with' statements are only available in ES5 codegen mode or better")}if(this.strictMode){this.reportParseError("'with' statements are not available in strict mode")}g();if(l!=e.Modifiers.None){this.reportParseError("'with' statement does not take modifiers")}c=this.scanner.startPos;this.checkNextToken(e.TokenID.OpenParen,r|e.ErrorRecoverySet.ExprStart|e.ErrorRecoverySet.Var);var x=this.parseExpr(r|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.None,true,t.NoTypes);this.checkCurrentToken(e.TokenID.CloseParen,r|e.ErrorRecoverySet.LCurly);var T=new e.WithStatement(x);T.body=this.parseStatement(r,i,s);T.minChar=c;T.limChar=T.body.limChar;o=T}break};case e.TokenID.Switch:{g();if(l!=e.Modifiers.None){this.reportParseError("'switch' statement does not take modifiers")}this.checkNextToken(e.TokenID.OpenParen,r|e.ErrorRecoverySet.ExprStart);var N=new e.SwitchStatement(this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes));N.statement.minChar=c;N.statement.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,r|e.ErrorRecoverySet.LCurly);var C=this.scanner.startPos;this.checkCurrentToken(e.TokenID.OpenBrace,r|e.ErrorRecoverySet.SCase);N.defaultCase=null;N.caseList=new e.ASTList;var k=null;this.pushStmt(N,u);for(;;){if(this.currentToken.tokenId==e.TokenID.Case||this.currentToken.tokenId==e.TokenID.Default){var L=this.currentToken.tokenId==e.TokenID.Default;k=new e.CaseStatement;k.minChar=this.scanner.startPos;this.currentToken=this.scanner.scan();if(L){N.defaultCase=k}else{k.expr=this.parseExpr(r|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.None,true,t.NoTypes)}this.checkCurrentToken(e.TokenID.Colon,r|e.ErrorRecoverySet.StmtStart);k.body=new e.ASTList;this.parseStatementList(r|e.ErrorRecoverySet.RCurly,k.body,false,true,i,l);k.limChar=k.body.limChar;N.caseList.append(k)}else{break}}N.caseList.minChar=C;N.caseList.limChar=this.scanner.pos;N.limChar=N.caseList.limChar;this.checkCurrentToken(e.TokenID.CloseBrace,r);this.popStmt();o=N;break};case e.TokenID.While:{g();if(l!=e.Modifiers.None){this.reportParseError("'while' statement does not take modifiers")}c=this.scanner.startPos;this.checkNextToken(e.TokenID.OpenParen,e.ErrorRecoverySet.ExprStart|r);var A=new e.WhileStatement(this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes));A.minChar=c;this.checkCurrentToken(e.TokenID.CloseParen,r|e.ErrorRecoverySet.StmtStart);this.pushStmt(A,u);A.body=this.parseStatement(r,i,s);A.limChar=A.body.limChar;this.popStmt();o=A;break};case e.TokenID.Do:{g();if(l!=e.Modifiers.None){this.reportParseError("'do' statement does not take modifiers")}c=this.scanner.startPos;this.currentToken=this.scanner.scan();var O=new e.DoWhileStatement;O.minChar=c;this.pushStmt(O,u);O.body=this.parseStatement(r|e.ErrorRecoverySet.While,i,s);this.popStmt();O.whileAST=new e.Identifier("while");O.whileAST.minChar=this.scanner.startPos;this.checkCurrentToken(e.TokenID.While,r|e.ErrorRecoverySet.LParen);O.whileAST.limChar=O.whileAST.minChar+5;this.checkCurrentToken(e.TokenID.OpenParen,r|e.ErrorRecoverySet.ExprStart);O.cond=this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.None,true,t.NoTypes);O.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,r);o=O;if(this.currentToken.tokenId==e.TokenID.Semicolon){this.currentToken=this.scanner.scan()}break};case e.TokenID.If:{g();if(l!=e.Modifiers.None){this.reportParseError("if statement does not take modifiers")}c=this.scanner.startPos;this.checkNextToken(e.TokenID.OpenParen,r|e.ErrorRecoverySet.ExprStart);var M=new e.IfStatement(this.parseExpr(r|e.ErrorRecoverySet.LParen,e.OperatorPrecedence.None,true,t.NoTypes));M.minChar=c;M.statement.minChar=c;M.statement.limChar=this.scanner.pos;this.checkCurrentToken(e.TokenID.CloseParen,r|e.ErrorRecoverySet.StmtStart);this.pushStmt(M,u);M.thenBod=this.parseStatement(e.ErrorRecoverySet.Else|r,i,s);M.limChar=M.thenBod.limChar;if(this.currentToken.tokenId==e.TokenID.Else){this.currentToken=this.scanner.scan();M.elseBod=this.parseStatement(r,i,s);M.limChar=M.elseBod.limChar}this.popStmt();o=M;break};case e.TokenID.Try:{g();if(l!=e.Modifiers.None){this.reportParseError("try statement does not take modifiers")}c=this.scanner.startPos;o=this.parseTryCatchFinally(r,s,u);break};case e.TokenID.OpenBrace:{g();if(l!=e.Modifiers.None){this.reportParseError("block does not take modifiers")}c=this.scanner.startPos;this.currentToken=this.scanner.scan();var _=new e.Block(new e.ASTList,true);this.pushStmt(_,u);this.parseStatementList(r|e.ErrorRecoverySet.RCurly,_.statements,false,false,e.AllowedElements.None,l);this.popStmt();_.statements.minChar=c;_.statements.limChar=this.scanner.pos;_.minChar=_.statements.minChar;_.limChar=_.statements.limChar;this.checkCurrentToken(e.TokenID.CloseBrace,r);o=_;break};case e.TokenID.Semicolon:{g();if(l!=e.Modifiers.None){this.reportParseError("modifier can not appear here")}o=new e.AST(e.NodeType.Empty);this.currentToken=this.scanner.scan();break};case e.TokenID.Break:case e.TokenID.Continue:{g();if(l!=e.Modifiers.None){this.reportParseError("modifiers can not appear before jump statement")}var D=new e.Jump(this.currentToken.tokenId==e.TokenID.Break?e.NodeType.Break:e.NodeType.Continue);this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==e.TokenID.Identifier&&!this.scanner.lastTokenHadNewline()){D.target=this.currentToken.getText();this.currentToken=this.scanner.scan()}this.resolveJumpTarget(D);o=D;p=true;break};case e.TokenID.Return:{g();if(l!=e.Modifiers.None){this.reportParseError("modifiers can not appear before return statement")}if(!this.inFunction){this.reportParseError("return statement outside of function body")}c=this.scanner.startPos;this.currentToken=this.scanner.scan();var P=new e.ReturnStatement;P.minChar=c;if(this.currentToken.tokenId!=e.TokenID.Semicolon&&this.currentToken.tokenId!=e.TokenID.CloseBrace&&!this.scanner.lastTokenHadNewline()){P.returnExpression=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.None,true,t.NoTypes)}p=true;P.limChar=this.scanner.lastTokenLimChar();o=P;break};case e.TokenID.Throw:{g();if(l!=e.Modifiers.None){this.reportParseError("modifiers can not appear before a throw statement")}c=this.scanner.startPos;this.currentToken=this.scanner.scan();if(this.currentToken.tokenId!=e.TokenID.Semicolon&&this.currentToken.tokenId!=e.TokenID.CloseBrace&&!this.scanner.lastTokenHadNewline()){f=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.None,true,t.NoTypes)}else{this.reportParseError("throw with no target");f=null}o=new e.UnaryExpression(e.NodeType.Throw,f);o.limChar=this.scanner.lastTokenLimChar();p=true;break};case e.TokenID.Enum:{this.currentToken=this.scanner.scan();o=this.parseEnumDecl(r,l);o.minChar=c;o.limChar=this.scanner.lastTokenLimChar();if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(l,e.Modifiers.Ambient)){o.modFlags|=e.ModuleFlags.Ambient}if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(l,e.Modifiers.Exported)){o.modFlags|=e.ModuleFlags.Exported}break};case e.TokenID.Debugger:{g();if(l!=e.Modifiers.None){this.reportParseError("modifiers can not appear before debugger statement")}c=this.scanner.startPos;this.currentToken=this.scanner.scan();var H=new e.DebuggerStatement;H.minChar=c;p=true;H.limChar=this.scanner.lastTokenLimChar();o=H;break};default:{if(l!=e.Modifiers.None){this.reportParseError("modifiers can not appear before an expression statement or label")}c=this.scanner.startPos;var B=this.scanner.pos;f=this.parseExpr(e.ErrorRecoverySet.Colon|e.ErrorRecoverySet.StmtStart|r,e.OperatorPrecedence.None,true,t.NoTypes);if(this.scanner.pos==B){this.currentToken=this.scanner.scan();o=f}else{if(this.currentToken.tokenId==e.TokenID.Colon&&!this.scanner.lastTokenHadNewline()&&f&&f.nodeType==e.NodeType.Name){if(u==null){u=new e.ASTList}u.append(new e.Label(f));this.currentToken=this.scanner.scan()}else{o=f;p=true}}}}if(o){break}}if(p){switch(this.currentToken.tokenId){case e.TokenID.Semicolon:{this.currentToken=this.scanner.scan();o.flags|=e.ASTFlags.ExplicitSemicolon;break};case e.TokenID.EndOfFile:{o.limChar=this.scanner.pos};case e.TokenID.CloseBrace:{o.flags|=e.ASTFlags.AutomaticSemicolon;if(this.style_requireSemi){this.reportParseStyleError("no automatic semicolon")}break};default:{if(!this.scanner.lastTokenHadNewline()){this.reportParseError("Expected ';'")}else{o.flags|=e.ASTFlags.AutomaticSemicolon;if(this.style_requireSemi){this.reportParseStyleError("no automatic semicolon")}}break}}}if(u){o=new e.LabeledStatement(u,o)}o.minChar=c;o.limChar=e.max(o.limChar,this.scanner.lastTokenLimChar());o.preComments=v;if(this.ambientModule&&!this.okAmbientModuleMember(o)){this.reportParseError("statement not permitted within ambient module")}o.flags|=e.ASTFlags.IsStatement;return o};i.prototype.okAmbientModuleMember=function(t){var n=t.nodeType;return n==e.NodeType.ClassDeclaration||n==e.NodeType.ImportDeclaration||n==e.NodeType.InterfaceDeclaration||n==e.NodeType.ModuleDeclaration||n==e.NodeType.Empty||n==e.NodeType.VarDecl||n==e.NodeType.Block&&!t.isStatementBlock||n==e.NodeType.FuncDecl&&t.isMethod()};i.prototype.parseStatementList=function(t,r,i,s,o,u){var a=i;r.minChar=this.scanner.startPos;var f=this.scanner.pos;var l=(o&e.AllowedElements.ModuleDeclarations)==e.AllowedElements.None;var c=(o&e.AllowedElements.ClassDeclarations)==e.AllowedElements.None;t|=e.ErrorRecoverySet.TypeScriptS|e.ErrorRecoverySet.RCurly;this.state=n.StartStatementList;var h=this.strictMode;this.nestingLevel++;for(;;){if(this.currentToken.tokenId==e.TokenID.CloseBrace||s&&(this.currentToken.tokenId==e.TokenID.Case||this.currentToken.tokenId==e.TokenID.Default)||l&&this.currentToken.tokenId==e.TokenID.Export||c&&this.currentToken.tokenId==e.TokenID.Class||this.currentToken.tokenId==e.TokenID.EndOfFile){this.state=n.EndStmtList;r.limChar=f;if(r.members.length==0){r.preComments=this.parseComments()}else{r.postComments=this.parseComments()}this.strictMode=h;this.nestingLevel--;return}var p=this.parseStatement(t&~(e.ErrorRecoverySet.Else|e.ErrorRecoverySet.RParen|e.ErrorRecoverySet.Catch|e.ErrorRecoverySet.Colon),o,u);if(p){p.postComments=this.combineComments(p.postComments,this.parseCommentsForLine(this.scanner.prevLine));r.append(p);f=p.limChar;if(a){if(p.nodeType==e.NodeType.QString){var d=p;if(d.text=='"use strict"'){r.flags|=e.ASTFlags.StrictMode;this.strictMode=true}else{a=false}}else{a=false}}}}};i.prototype.quickParse=function(t,n,i){var s=e.moduleGenTarget;try{e.moduleGenTarget=e.ModuleGenTarget.Local;var o=this.parse(t,n,i,e.AllowedElements.QuickParse);return new r(o,this.scanner.lexState)}finally{e.moduleGenTarget=s}};i.prototype.parse=function(t,r,i,s){if(typeof s==="undefined"){s=e.AllowedElements.Global}var o=this;this.ambientModule=false;this.topLevel=true;this.hasTopLevelImportOrExport=false;this.fname=r;this.currentUnitIndex=i;this.amdDependencies=[];this.scanner.resetComments();this.scanner.setErrorHandler(function(e){return o.reportParseError(e)});this.scanner.setSourceText(t,e.LexMode.File);var u=this.scanner.leftCurlyCount;var a=this.scanner.rightCurlyCount;var f=this.scanner.pos;this.currentToken=this.scanner.scan();this.pushDeclLists();var l=new e.ASTList;l.minChar=f;this.state=n.StartScript;this.parsingDeclareFile=e.isDSTRFile(r)||e.isDTSFile(r);this.parseStatementList(e.ErrorRecoverySet.EOF|e.ErrorRecoverySet.Func,l,true,false,s,e.Modifiers.None);if(this.currentToken.tokenId!=e.TokenID.EndOfFile){var c=e.tokenTable[this.currentToken.tokenId];this.reportParseError("Unexpected statement block terminator '"+c.text+"'")}this.state=n.EndScript;l.limChar=this.scanner.pos;var h=null;if(e.moduleGenTarget!=e.ModuleGenTarget.Local&&this.hasTopLevelImportOrExport){var p=e.switchToForwardSlashes(r);var d=new e.Identifier(p);h=new e.ModuleDeclaration(d,l,this.topVarList(),this.topScopeList(),null);h.modFlags|=e.ModuleFlags.IsDynamic;h.modFlags|=e.ModuleFlags.IsWholeFile;h.modFlags|=e.ModuleFlags.Exported;if(this.parsingDeclareFile){h.modFlags|=e.ModuleFlags.Ambient}h.minChar=f;h.limChar=this.scanner.pos;h.prettyName=e.getPrettyName(p);h.containsUnicodeChar=this.scanner.seenUnicodeChar;h.containsUnicodeCharInComment=this.scanner.seenUnicodeCharInComment;h.amdDependencies=this.amdDependencies;l=new e.ASTList;l.minChar=h.minChar;l.limChar=h.limChar;l.append(h)}var v=new e.Script(this.topVarList(),this.topScopeList());v.bod=l;this.popDeclLists();v.minChar=f;v.limChar=this.scanner.pos;v.locationInfo=new e.LocationInfo(r,this.scanner.lineMap,i);v.leftCurlyCount=this.scanner.leftCurlyCount-u;v.rightCurlyCount=this.scanner.rightCurlyCount-a;v.isDeclareFile=this.parsingDeclareFile;v.topLevelMod=h;v.containsUnicodeChar=this.scanner.seenUnicodeChar;v.containsUnicodeCharInComment=this.scanner.seenUnicodeCharInComment;return v};return i}();e.Parser=i;e.quickParse=s})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(e,t,n){var r=n.state;e.print(r);r.increaseIndent();return e}function r(e,t,n){var r=n.state;r.decreaseIndent();return e}var t=function(){function t(e,t){this.outfile=e;this.parser=t;this.builder="";this.indent1="  ";this.indentStrings=[];this.indentAmt=0}t.prototype.increaseIndent=function(){this.indentAmt++};t.prototype.decreaseIndent=function(){this.indentAmt--};t.prototype.startLine=function(){if(this.builder.length>0){e.CompilerDiagnostics.Alert(this.builder)}var t=this.indentStrings[this.indentAmt];if(t===undefined){t="";for(var n=0;n<this.indentAmt;n++){t+=this.indent1}this.indentStrings[this.indentAmt]=t}this.builder+=t};t.prototype.write=function(e){this.builder+=e};t.prototype.writeLine=function(e){this.builder+=e;this.outfile.WriteLine(this.builder);this.builder=""};return t}();e.PrintContext=t;e.prePrintAST=n;e.postPrintAST=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function u(e,t){var n=0;var r=t.length;var i;while(n+1<r){i=n+(r-n)/2;i-=i%2;if(t[i]<=e&&e<=t[i+1]){return true}if(e<t[i]){r=i}else{n=i+2}}return false}function a(t){if(e.codeGenTarget==e.CodeGenTarget.ES3){return u(t,i)}else{return u(t,o)}}function f(t){if(e.codeGenTarget==e.CodeGenTarget.ES3){return u(t,r)}else{return u(t,s)}}function l(){e.initializeStaticTokens();t[e.LexCodeLPR]=e.staticTokens[e.TokenID.OpenParen];t[e.LexCodeRPR]=e.staticTokens[e.TokenID.CloseParen];t[e.LexCodeCMA]=e.staticTokens[e.TokenID.Comma];t[e.LexCodeSMC]=e.staticTokens[e.TokenID.Semicolon];t[e.LexCodeLBR]=e.staticTokens[e.TokenID.OpenBracket];t[e.LexCodeRBR]=e.staticTokens[e.TokenID.CloseBracket];t[e.LexCodeTIL]=e.staticTokens[e.TokenID.Tilde];t[e.LexCodeQUE]=e.staticTokens[e.TokenID.Question];t[e.LexCodeLC]=e.staticTokens[e.TokenID.OpenBrace];t[e.LexCodeRC]=e.staticTokens[e.TokenID.CloseBrace];t[e.LexCodeCOL]=e.staticTokens[e.TokenID.Colon];e.LexKeywordTable=new e.StringHashTable;for(var r in e.TokenID._map){if(r<=e.TokenID.LimKeyword){e.LexKeywordTable.add(e.TokenID._map[r].toLowerCase(),r)}}for(var i=0;i<e.LexCodeASCIIChars;i++){if(h(i)){n[i]=true}else{n[i]=false}}}function c(t,n){if(t==e.LexCodeLBR||t==e.LexCodeLC||t==e.LexCodeLPR){return n+1}else{if(t==e.LexCodeRBR||t==e.LexCodeRC||t==e.LexCodeRPR){return n-1}else{return n}}}function h(t){return t>=97&&t<=122||t>=65&&t<=90||t==e.LexCodeDollar||t==e.LexCodeUnderscore}function p(e){return e>=48&&e<=57}function d(e){return n[e]||p(e)}function v(t){if(t==e.LexCodeRBR){return e.LexCodeLBR}else{if(t==e.LexCodeRC){return e.LexCodeLC}else{if(t==e.LexCodeRPR){return e.LexCodeLPR}else{return 0}}}}function C(e){return L(e,true,false)}function k(e,t){return L(e,false,t)}function L(t,n,r){if(t.tokenId<=e.TokenID.LimKeyword){var i=e.lookupToken(t.tokenId);if(i!=undefined){var s=e.Reservation.Javascript|e.Reservation.JavascriptFuture;if(r){s|=e.Reservation.JavascriptFutureStrict}if(n||!e.hasFlag(i.reservation,s)){return true}}else{return false}}else{return false}}function A(e,t){if(t===-1){return 0}var n=0;var r=e.length-1;while(n<r){var i=n+r>>1;if(t<e[i]){r=i-1}else{if(t<e[i+1]){n=r=i}else{n=i+1}}}return n}function O(e,t,n){var r=A(n,t);if(r>0){e.line=r;e.col=t-n[r]}}function M(e,t){var n={line:-1,col:-1};O(n,t,e.locationInfo.lineMap);if(n.col>=0){n.col++}return n}function _(e,t,n){return e.locationInfo.lineMap[t]+(n-1)}function D(t){switch(t.tokenId){case e.TokenID.Any:case e.TokenID.Bool:case e.TokenID.Number:case e.TokenID.String:{return true}}return false}function P(t){switch(t.tokenId){case e.TokenID.Public:case e.TokenID.Private:case e.TokenID.Static:{return true}}return false}e.LexEOF=-1;e.LexCodeNWL=10;e.LexCodeRET=13;e.LexCodeTAB=9;e.LexCodeVTAB=11;e.LexCode_e="e".charCodeAt(0);e.LexCode_E="E".charCodeAt(0);e.LexCode_x="x".charCodeAt(0);e.LexCode_X="X".charCodeAt(0);e.LexCode_a="a".charCodeAt(0);e.LexCode_A="A".charCodeAt(0);e.LexCode_f="f".charCodeAt(0);e.LexCode_F="F".charCodeAt(0);e.LexCode_g="g".charCodeAt(0);e.LexCode_m="m".charCodeAt(0);e.LexCode_i="i".charCodeAt(0);e.LexCode_u="u".charCodeAt(0);e.LexCode_0="0".charCodeAt(0);e.LexCode_9="9".charCodeAt(0);e.LexCode_8="8".charCodeAt(0);e.LexCode_7="7".charCodeAt(0);e.LexCodeBSL="\\".charCodeAt(0);e.LexCodeSHP="#".charCodeAt(0);e.LexCodeBNG="!".charCodeAt(0);e.LexCodeQUO='"'.charCodeAt(0);e.LexCodeAPO="'".charCodeAt(0);e.LexCodePCT="%".charCodeAt(0);e.LexCodeAMP="&".charCodeAt(0);e.LexCodeLPR="(".charCodeAt(0);e.LexCodeRPR=")".charCodeAt(0);e.LexCodePLS="+".charCodeAt(0);e.LexCodeMIN="-".charCodeAt(0);e.LexCodeMUL="*".charCodeAt(0);e.LexCodeSLH="/".charCodeAt(0);e.LexCodeXOR="^".charCodeAt(0);e.LexCodeCMA=",".charCodeAt(0);e.LexCodeDOT=".".charCodeAt(0);e.LexCodeLT="<".charCodeAt(0);e.LexCodeEQ="=".charCodeAt(0);e.LexCodeGT=">".charCodeAt(0);e.LexCodeQUE="?".charCodeAt(0);e.LexCodeLBR="[".charCodeAt(0);e.LexCodeRBR="]".charCodeAt(0);e.LexCodeUSC="_".charCodeAt(0);e.LexCodeLC="{".charCodeAt(0);e.LexCodeRC="}".charCodeAt(0);e.LexCodeBAR="|".charCodeAt(0);e.LexCodeTIL="~".charCodeAt(0);e.LexCodeCOL=":".charCodeAt(0);e.LexCodeSMC=";".charCodeAt(0);e.LexCodeUnderscore="_".charCodeAt(0);e.LexCodeDollar="$".charCodeAt(0);e.LexCodeSpace=32;e.LexCodeASCIIChars=128;e.LexKeywordTable=undefined;var t=new Array(e.LexCodeASCIIChars);var n=new Array(e.LexCodeASCIIChars);var r=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,13312,19893,19893,19968,19968,40869,40869,40960,42124,44032,44032,55203,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500];var i=[768,846,864,866,1155,1158,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1611,1621,1632,1641,1648,1648,1750,1756,1759,1764,1767,1768,1770,1773,1776,1785,1809,1809,1840,1866,1958,1968,2305,2307,2364,2364,2366,2381,2385,2388,2402,2403,2406,2415,2433,2435,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2530,2531,2534,2543,2562,2562,2620,2620,2622,2626,2631,2632,2635,2637,2662,2673,2689,2691,2748,2748,2750,2757,2759,2761,2763,2765,2790,2799,2817,2819,2876,2876,2878,2883,2887,2888,2891,2893,2902,2903,2918,2927,2946,2947,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3134,3140,3142,3144,3146,3149,3157,3158,3174,3183,3202,3203,3262,3268,3270,3272,3274,3277,3285,3286,3302,3311,3330,3331,3390,3395,3398,3400,3402,3405,3415,3415,3430,3439,3458,3459,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3633,3633,3636,3642,3655,3662,3664,3673,3761,3761,3764,3769,3771,3772,3784,3789,3792,3801,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3903,3953,3972,3974,3975,3984,3991,3993,4028,4038,4038,4140,4146,4150,4153,4160,4169,4182,4185,4969,4977,6068,6099,6112,6121,6160,6169,6313,6313,8255,8256,8400,8412,8417,8417,12330,12335,12441,12442,12539,12539,64286,64286,65056,65059,65075,65076,65101,65103,65296,65305,65343,65343,65381,65381];var s=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,13312,19893,19893,19968,19968,40908,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,44032,55203,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500];var o=[768,879,1155,1159,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1552,1562,1611,1641,1648,1648,1750,1756,1759,1764,1767,1768,1770,1773,1776,1785,1809,1809,1840,1866,1958,1968,1984,1993,2027,2035,2070,2073,2075,2083,2085,2087,2089,2093,2137,2139,2276,2302,2304,2307,2362,2364,2366,2383,2385,2391,2402,2403,2406,2415,2433,2435,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2530,2531,2534,2543,2561,2563,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2662,2673,2677,2677,2689,2691,2748,2748,2750,2757,2759,2761,2763,2765,2786,2787,2790,2799,2817,2819,2876,2876,2878,2884,2887,2888,2891,2893,2902,2903,2914,2915,2918,2927,2946,2946,3006,3010,3014,3016,3018,3021,3031,3031,3046,3055,3073,3075,3134,3140,3142,3144,3146,3149,3157,3158,3170,3171,3174,3183,3202,3203,3260,3260,3262,3268,3270,3272,3274,3277,3285,3286,3298,3299,3302,3311,3330,3331,3390,3396,3398,3400,3402,3405,3415,3415,3426,3427,3430,3439,3458,3459,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3633,3633,3636,3642,3655,3662,3664,3673,3761,3761,3764,3769,3771,3772,3784,3789,3792,3801,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3903,3953,3972,3974,3975,3981,3991,3993,4028,4038,4038,4139,4158,4160,4169,4182,4185,4190,4192,4194,4196,4199,4205,4209,4212,4226,4237,4239,4253,4957,4959,5906,5908,5938,5940,5970,5971,6002,6003,6068,6099,6109,6109,6112,6121,6155,6157,6160,6169,6313,6313,6432,6443,6448,6459,6470,6479,6576,6592,6600,6601,6608,6617,6679,6683,6741,6750,6752,6780,6783,6793,6800,6809,6912,6916,6964,6980,6992,7001,7019,7027,7040,7042,7073,7085,7088,7097,7142,7155,7204,7223,7232,7241,7248,7257,7376,7378,7380,7400,7405,7405,7410,7412,7616,7654,7676,7679,8204,8205,8255,8256,8276,8276,8400,8412,8417,8417,8421,8432,11503,11505,11647,11647,11744,11775,12330,12335,12441,12442,42528,42537,42607,42607,42612,42621,42655,42655,42736,42737,43010,43010,43014,43014,43019,43019,43043,43047,43136,43137,43188,43204,43216,43225,43232,43249,43264,43273,43302,43309,43335,43347,43392,43395,43443,43456,43472,43481,43561,43574,43587,43587,43596,43597,43600,43609,43643,43643,43696,43696,43698,43700,43703,43704,43710,43711,43713,43713,43755,43759,43765,43766,44003,44010,44012,44013,44016,44025,64286,64286,65024,65039,65056,65062,65075,65076,65101,65103,65296,65305,65343,65343];e.LexLookUpUnicodeMap=u;e.LexIsUnicodeDigit=a;e.LexIsUnicodeIdStart=f;e.LexInitialize=l;e.LexAdjustIndent=c;e.LexIsIdentifierStartChar=h;e.LexIsDigit=p;e.LexIsIdentifierChar=d;e.LexMatchingOpen=v;(function(e){e._map=[];e._map[0]="Start";e.Start=0;e._map[1]="InFraction";e.InFraction=1;e._map[2]="InEmptyFraction";e.InEmptyFraction=2;e._map[3]="InExponent";e.InExponent=3})(e.NumberScanState||(e.NumberScanState={}));var m=e.NumberScanState;(function(e){e._map=[];e._map[0]="Start";e.Start=0;e._map[1]="InMultilineComment";e.InMultilineComment=1})(e.LexState||(e.LexState={}));var g=e.LexState;(function(e){e._map=[];e._map[0]="Line";e.Line=0;e._map[1]="File";e.File=1})(e.LexMode||(e.LexMode={}));var y=e.LexMode;(function(e){e._map=[];e._map[0]="Line";e.Line=0;e._map[1]="Block";e.Block=1})(e.CommentStyle||(e.CommentStyle={}));var b=e.CommentStyle;var w=function(){function e(e){this.text=e}e.prototype.getText=function(e,t){return this.text.substring(e,t)};e.prototype.getLength=function(){return this.text.length};return e}();e.StringSourceText=w;var E=function(){function e(e,t,n){this.segmentStart=e;this.segmentEnd=t;this.segment=n}e.prototype.charCodeAt=function(e){return this.segment.charCodeAt(e-this.segmentStart)};e.prototype.substring=function(e,t){return this.segment.substring(e-this.segmentStart,t-this.segmentStart)};return e}();e.SourceTextSegment=E;var S=function(){function e(e,t){this.seg1=e;this.seg2=t}e.prototype.charCodeAt=function(e){if(this.seg1.segmentStart<=e&&e<this.seg1.segmentEnd){return this.seg1.segment.charCodeAt(e-this.seg1.segmentStart)}return this.seg2.segment.charCodeAt(e-this.seg2.segmentStart)};e.prototype.substring=function(e,t){if(this.seg1.segmentStart<=e&&t<=this.seg1.segmentEnd){return this.seg1.segment.substring(e-this.seg1.segmentStart,t-this.seg1.segmentStart)}return this.seg2.segment.substring(e-this.seg2.segmentStart)+this.seg1.segment.substring(0,t-this.seg1.segmentStart)};return e}();e.AggerateSourceTextSegment=S;var x=function(){function t(e){this.sourceText=e;this.agg=new S(t.emptySegment,t.emptySegment);this.len=this.sourceText.getLength()}t.emptySegment=new E(0,0,"");t.prototype.max=function(e,t){return e>=t?e:t};t.prototype.min=function(e,t){return e<=t?e:t};t.prototype.fetchSegment=function(t,n){if(this.agg.seg1.segmentStart<=t&&n<=this.agg.seg1.segmentEnd){return this.agg.seg1}if(this.agg.seg2.segmentStart<=t&&n<=this.agg.seg1.segmentEnd){return this.agg}var r=this.agg.seg1;var i=r.segmentEnd;var s=e.max(i+512,n);s=e.min(s,this.len);var o=this.sourceText.getText(i,s);var u=new E(i,s,o);this.agg.seg2=r;this.agg.seg1=u;return this.agg};t.prototype.charCodeAt=function(e){return this.fetchSegment(e,e+1).charCodeAt(e)};t.prototype.substring=function(e,t){return this.fetchSegment(e,t).substring(e,t)};return t}();e.ScannerTextStream=x;var T=function(){function t(){this.prevToken=null;this.curSavedToken=null;this.prevSavedToken=null;this.prevToken=null;this.currentToken=0;this.tokens=new Array;this.seenUnicodeChar=false;this.seenUnicodeCharInComment=false;this.prevLine=1;this.line=1;this.col=0;this.lexState=g.Start;this.commentStack=new Array;this.lineMap=[]}t.prototype.previousToken=function(){return this.prevToken};t.prototype.close=function(){this.currentToken=0};t.prototype.addToken=function(t,n){this.tokens[this.currentToken++]=new e.SavedToken(t,n.startPos,n.pos)};t.prototype.scan=function(){this.startLine=this.line;this.startPos=this.col;if(this.currentTokenIndex==this.currentTokens.length){if(this.line<this.lineMap.length){this.line++;this.col=0;this.currentTokenIndex=0;this.currentTokens=this.tokensByLine[this.line]}else{return e.staticTokens[e.TokenID.EndOfFile]}}if(this.currentTokenIndex<this.currentTokens.length){this.prevToken=this.curSavedToken.tok;this.prevSavedToken=this.curSavedToken;this.curSavedToken=this.currentTokens[this.currentTokenIndex++];var t=this.curSavedToken.tok;this.pos=this.curSavedToken.limChar;this.col+=this.curSavedToken.limChar-this.curSavedToken.minChar;this.startPos=this.curSavedToken.minChar;this.prevLine=this.line;return t}else{return e.staticTokens[e.TokenID.EndOfFile]}};t.prototype.syncToTok=function(e){this.line=A(this.lineMap,e);this.currentTokenIndex=0;var t=e-this.lineMap[this.line];while(this.lexStateByLine[this.line]==g.InMultilineComment&&this.line>0){this.line--;t=0}var n=this.lineMap.length-1;this.currentTokens=this.tokensByLine[this.line];while(this.currentTokens.length==0&&this.line<n){this.line++;this.currentTokens=this.tokensByLine[this.line];t=0}if(this.line<=n){while(this.currentTokenIndex<this.currentTokens.length&&t>this.currentTokens[this.currentTokenIndex].limChar){this.currentTokenIndex++}if(this.currentTokenIndex<this.currentTokens.length){this.col=this.currentTokens[this.currentTokenIndex].minChar;return this.col+this.lineMap[this.line]}}return-1};t.prototype.lastTokenLimChar=function(){if(this.prevSavedToken!==null){return this.prevSavedToken.limChar}else{return 0}};t.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine};t.prototype.pushComment=function(e){this.commentStack.push(e)};t.prototype.getComments=function(){var e=this.commentStack;this.commentStack=[];return e};t.prototype.getCommentsForLine=function(e){var t=null;while(this.commentStack.length>0&&this.commentStack[0].line==e){if(t==null){t=[this.commentStack.shift()]}else{t=t.concat([this.commentStack.shift()])}}return t};t.prototype.resetComments=function(){this.commentStack=[]};t.prototype.setSourceText=function(e,t){};t.prototype.setErrorHandler=function(e){};t.prototype.getLookAheadToken=function(){throw new Error("Invalid operation.")};return t}();e.SavedTokens=T;var N=function(){function r(){this.prevLine=1;this.line=1;this.col=0;this.pos=0;this.startPos=0;this.len=0;this.lineMap=[];this.ch=e.LexEOF;this.lexState=g.Start;this.mode=y.File;this.scanComments=true;this.interveningWhitespace=false;this.interveningWhitespacePos=0;this.leftCurlyCount=0;this.rightCurlyCount=0;this.commentStack=new Array;this.saveScan=null;this.seenUnicodeChar=false;this.seenUnicodeCharInComment=false;this.prevTok=e.staticTokens[e.TokenID.EndOfFile];this.startCol=this.col;this.startLine=this.line;this.lineMap[1]=0;if(!e.LexKeywordTable){l()}}r.prototype.previousToken=function(){return this.prevTok};r.prototype.setSourceText=function(e,t){this.mode=t;this.scanComments=this.mode===y.Line;this.pos=0;this.interveningWhitespacePos=0;this.startPos=0;this.line=1;this.col=0;this.startCol=this.col;this.startLine=this.line;this.len=0;this.src=e.getText(0,e.getLength());this.len=this.src.length;this.lineMap=[];this.lineMap[1]=0;this.commentStack=[];this.leftCurlyCount=0;this.rightCurlyCount=0;this.seenUnicodeChar=false;this.seenUnicodeCharInComment=false};r.prototype.setErrorHandler=function(e){this.reportError=e};r.prototype.setSaveScan=function(e){this.saveScan=e};r.prototype.setText=function(e,t){this.setSourceText(new w(e),t)};r.prototype.setScanComments=function(e){this.scanComments=e};r.prototype.getLexState=function(){return this.lexState};r.prototype.scanLine=function(t,n){this.lexState=n;var r=new Array;this.setText(t,y.Line);var i=this.scan();while(i.tokenId!=e.TokenID.EndOfFile){r[r.length]=i;i=this.scan()}return r};r.prototype.tokenStart=function(){this.startPos=this.pos;this.startLine=this.line;this.startCol=this.col;this.interveningWhitespace=false};r.prototype.peekChar=function(){if(this.pos<this.len){return this.src.charCodeAt(this.pos)}else{return e.LexEOF}};r.prototype.peekCharAt=function(t){if(t<this.len){return this.src.charCodeAt(t)}else{return e.LexEOF}};r.prototype.IsHexDigit=function(t){return t>=e.LexCode_0&&t<=e.LexCode_9||t>=e.LexCode_A&&t<=e.LexCode_F||t>=e.LexCode_a&&t<=e.LexCode_f};r.prototype.IsOctalDigit=function(t){return t>=e.LexCode_0&&t<=e.LexCode_7||t>=e.LexCode_a&&t<=e.LexCode_f};r.prototype.scanHexDigits=function(){var t=false;for(;;){if(this.IsHexDigit(this.ch)){this.nextChar();t=true}else{if(t){return new e.NumberLiteralToken(parseInt(this.src.substring(this.startPos,this.pos)))}else{return null}}}};r.prototype.scanOctalDigits=function(){var t=false;for(;;){if(this.IsOctalDigit(this.ch)){this.nextChar();t=true}else{if(t){return new e.NumberLiteralToken(parseInt(this.src.substring(this.startPos,this.pos)))}else{return null}}}};r.prototype.scanDecimalNumber=function(t){var n=false;var r=this.pos;var i=this.col;for(;;){if(p(this.ch)){n=true;if(this.ch!=e.LexCode_0&&t==m.InEmptyFraction){t=m.InFraction}this.nextChar()}else{if(this.ch==e.LexCodeDOT){if(t==m.Start){this.nextChar();t=m.InEmptyFraction}else{if(n){return new e.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),t==m.InEmptyFraction)}else{this.pos=r;this.col=i;return null}}}else{if(this.ch==e.LexCode_e||this.ch==e.LexCode_E){if(t==m.Start){if(n){n=false;this.nextChar();t=m.InExponent}else{this.pos=r;this.col=i;return null}}else{if(t==m.InFraction||t==m.InEmptyFraction){this.nextChar();t=m.InExponent;n=false}else{if(n){return new e.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)))}else{this.pos=r;this.col=i;return null}}}}else{if(this.ch==e.LexCodePLS||this.ch==e.LexCodeMIN){if(t==m.InExponent){if(!n){this.nextChar()}else{this.pos=r;this.col=i;return null}}else{if(t==m.InEmptyFraction||t==m.InFraction){return new e.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),t==m.InEmptyFraction)}else{if(!n){this.pos=r;this.col=i;return null}else{return new e.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)))}}}}else{if(!n){this.pos=r;this.col=i;return null}else{return new e.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),t==m.InEmptyFraction)}}}}}}};r.prototype.scanNumber=function(){if(this.peekChar()==e.LexCode_0){switch(this.peekCharAt(this.pos+1)){case e.LexCode_x:case e.LexCode_X:{this.advanceChar(2);return this.scanHexDigits()};case e.LexCode_8:case e.LexCode_9:case e.LexCodeDOT:{return this.scanDecimalNumber(m.Start)};default:{return this.scanOctalDigits()}}}else{return this.scanDecimalNumber(m.Start)}};r.prototype.scanFraction=function(){return this.scanDecimalNumber(m.InFraction)};r.prototype.newLine=function(){this.col=0;if(this.mode==y.File){this.line++;this.lineMap[this.line]=this.pos+1}};r.prototype.finishMultilineComment=function(){var t;this.lexState=g.InMultilineComment;while(this.pos<this.len){if(this.ch==e.LexCodeMUL){t=this.peekCharAt(this.pos+1);if(t==e.LexCodeSLH){this.advanceChar(2);if(this.mode==y.File){this.tokenStart()}this.lexState=g.Start;return true}}else{if(this.ch==e.LexCodeNWL){this.newLine();if(this.mode==y.Line){this.nextChar();return false}}else{if(this.ch>=e.LexCodeASCIIChars){this.seenUnicodeCharInComment=true}}}this.nextChar()}return false};r.prototype.pushComment=function(e){this.commentStack.push(e)};r.prototype.getComments=function(){var e=this.commentStack;this.commentStack=[];return e};r.prototype.getCommentsForLine=function(e){var t=null;while(this.commentStack.length>0&&this.commentStack[0].line==e){if(t==null){t=[this.commentStack.shift()]}else{t=t.concat([this.commentStack.shift()])}}return t};r.prototype.resetComments=function(){this.commentStack=[]};r.prototype.endsLine=function(t){return t==e.LexCodeNWL||t==e.LexCodeRET||t==8232||t==8233};r.prototype.finishSinglelineComment=function(){while(this.pos<this.len){if(this.endsLine(this.ch)){break}if(this.ch>=e.LexCodeASCIIChars){this.seenUnicodeCharInComment=true}this.nextChar()}if(this.mode==y.File){this.tokenStart()}};r.prototype.tokenText=function(){return this.src.substring(this.startPos,this.pos)};r.prototype.findClosingSLH=function(){var t=this.pos;var n=this.src.charCodeAt(t);var r=0;var i=false;while(!this.endsLine(n)&&t<this.len){if(n==e.LexCodeSLH&&!i){return t}r=n;t++;if(i){i=false}else{i=r==e.LexCodeBSL}n=this.src.charCodeAt(t)}return-1};r.prototype.speculateRegex=function(){if(e.noRegexTable[this.prevTok.tokenId]!=undefined){return null}var t=this.pos;var n=this.col;var r=this.findClosingSLH();if(r>0){var i=this.src.substring(t,r);var s="";this.pos=r+1;this.ch=this.peekChar();var o=this.pos;while(this.ch==e.LexCode_i||this.ch==e.LexCode_g||this.ch==e.LexCode_m){this.nextChar()}if(this.pos-o>3){return null}else{s=this.src.substring(o,this.pos)}var u=undefined;try{u=new RegExp(i,s)}catch(a){}if(u){this.col=n+(this.pos-this.startPos);return new e.RegularExpressionLiteralToken(u)}}this.pos=t;this.col=n;return null};r.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine};r.prototype.lastTokenLimChar=function(){return this.interveningWhitespace?this.interveningWhitespacePos:this.startPos};r.prototype.advanceChar=function(e){this.pos+=e;this.col+=e;this.ch=this.peekChar()};r.prototype.nextChar=function(){this.pos++;this.col++;this.ch=this.peekChar()};r.prototype.getLookAheadToken=function(){var e=this.prevLine;var t=this.line;var n=this.col;var r=this.pos;var i=this.startPos;var s=this.startCol;var o=this.startLine;var u=this.ch;var a=this.prevTok;var f=this.lexState;var l=this.interveningWhitespace;var c=this.interveningWhitespacePos;var h=this.leftCurlyCount;var p=this.rightCurlyCount;var d=this.seenUnicodeChar;var v=this.seenUnicodeCharInComment;var m=this.commentStack.length;var g=this.scan();this.prevLine=e;this.line=t;this.col=n;this.pos=r;this.startPos=i;this.startCol=s;this.startLine=o;this.ch=u;this.prevTok=a;this.lexState=f;this.interveningWhitespace=l;this.interveningWhitespacePos=c;this.leftCurlyCount=h;this.rightCurlyCount=p;this.seenUnicodeChar=d;this.seenUnicodeCharInComment=v;this.commentStack.length=m;return g};r.prototype.scan=function(){if(this.lexState==g.InMultilineComment&&this.scanComments){this.ch=this.peekChar();var t=this.line;this.finishMultilineComment();if(this.startPos<this.pos){var n=this.src.substring(this.startPos,this.pos);this.tokenStart();return new e.CommentToken(e.TokenID.Comment,n,true,this.startPos,t,true)}else{return e.staticTokens[e.TokenID.EndOfFile]}}this.prevLine=this.line;this.prevTok=this.innerScan();if(this.saveScan){this.saveScan.addToken(this.prevTok,this)}return this.prevTok};r.prototype.isValidUnicodeIdentifierChar=function(){var e=f(this.ch)||a(this.ch);this.seenUnicodeChar=this.seenUnicodeChar||e;return e};r.prototype.scanIdentifier=function(){var t=false;var r=this.ch==e.LexCodeBSL;var i=false;for(;;){while(n[this.ch]||p(this.ch)||this.ch>=e.LexCodeASCIIChars&&this.isValidUnicodeIdentifierChar()){this.nextChar()}if(this.ch==e.LexCodeBSL){this.nextChar();if(this.ch==e.LexCode_u){this.nextChar();for(var s=0;s<4;s++){if(this.IsHexDigit(this.ch)){this.nextChar()}else{this.reportScannerError("Invalid unicode escape sequence");return e.staticTokens[e.TokenID.Error]}}var o=parseInt(this.src.substring(this.pos-4,this.pos),16);if(n[o]||!r&&p(o)||o>=e.LexCodeASCIIChars&&(f(o)||!r&&a(o))){}else{this.reportScannerError("Invalid identifier character");return e.staticTokens[e.TokenID.Error]}t=true;r=false;continue}this.reportScannerError("Invalid unicode escape sequence");return e.staticTokens[e.TokenID.Error]}break}var u;var l=this.src.substring(this.startPos,this.pos);if(!t&&(u=e.LexKeywordTable.lookup(l))!=null){return e.staticTokens[u]}else{return new e.IdentifierToken(l,t)}};r.prototype.innerScan=function(){var r;this.tokenStart();this.ch=this.peekChar();e:while(this.pos<this.len){if(n[this.ch]||this.ch==e.LexCodeBSL||this.ch>=e.LexCodeASCIIChars&&f(this.ch)){return this.scanIdentifier()}else{if(this.ch==e.LexCodeSpace){if(!this.interveningWhitespace){this.interveningWhitespacePos=this.pos}do{this.nextChar()}while(this.ch==e.LexCodeSpace);if(this.mode==y.Line){var i=this.src.substring(this.startPos,this.pos);return new e.WhitespaceToken(e.TokenID.Whitespace,i)}else{this.tokenStart();this.interveningWhitespace=true}}else{if(this.ch==e.LexCodeSLH){this.nextChar();var s;if(this.ch==e.LexCodeSLH){if(!this.interveningWhitespace){this.interveningWhitespacePos=this.pos-1}var o=this.pos-1;var u=this.line;this.finishSinglelineComment();var s=this.src.substring(o,this.pos);var a=new e.CommentToken(e.TokenID.Comment,s,false,o,u,false);if(this.scanComments){this.startPos=o;return a}else{this.pushComment(a)}this.interveningWhitespace=true}else{if(this.ch==e.LexCodeMUL){if(!this.interveningWhitespace){this.interveningWhitespacePos=this.pos-1}var o=this.pos-1;var u=this.line;this.nextChar();this.finishMultilineComment();var s=this.src.substring(o,this.pos);var l=this.peekChar()==e.LexCodeNWL||this.peekChar()==e.LexCodeRET;var a=new e.CommentToken(e.TokenID.Comment,s,true,o,u,l);if(this.scanComments){this.startPos=o;return a}else{this.pushComment(a)}this.interveningWhitespace=true}else{var c=this.speculateRegex();if(c){return c}else{if(this.peekCharAt(this.pos)==e.LexCodeEQ){this.nextChar();return e.staticTokens[e.TokenID.SlashEquals]}else{return e.staticTokens[e.TokenID.Slash]}}}}}else{if(this.ch==e.LexCodeSMC){this.nextChar();return e.staticTokens[e.TokenID.Semicolon]}else{if(this.ch==e.LexCodeAPO||this.ch==e.LexCodeQUO){var h=this.ch;var p=0;var d=false;do{p=this.ch;if(d){d=false}else{d=p==e.LexCodeBSL}if(p>=e.LexCodeASCIIChars){this.seenUnicodeChar=true}this.nextChar()}while(this.ch!=e.LexEOF&&(d||this.ch!=h));if(this.ch!=e.LexEOF){this.nextChar()}return new e.StringLiteralToken(this.src.substring(this.startPos,this.pos))}else{if(t[this.ch]){var v=t[this.ch];if(v.tokenId==e.TokenID.OpenBrace){this.leftCurlyCount++}else{if(v.tokenId==e.TokenID.CloseBrace){this.rightCurlyCount++}}this.nextChar();return v}else{if(this.ch>=e.LexCode_0&&this.ch<=e.LexCode_9){r=this.scanNumber();if(r){return r}else{this.nextChar();return e.staticTokens[e.TokenID.Error]}}else{switch(this.ch){case e.LexCodeTAB:case e.LexCodeVTAB:{if(!this.interveningWhitespace){this.interveningWhitespacePos=this.pos}if(this.mode==y.Line){do{this.nextChar()}while(this.ch==e.LexCodeSpace||this.ch==9);var m=this.src.substring(this.startPos,this.pos);return new e.WhitespaceToken(e.TokenID.Whitespace,m)}else{this.interveningWhitespace=true}};case 255:case 254:case 239:case 187:case 191:case 8232:case 8233:case e.LexCodeNWL:case e.LexCodeRET:{if(this.ch==e.LexCodeNWL){this.newLine();if(this.mode==y.Line){return e.staticTokens[e.TokenID.EndOfFile]}}if(!this.interveningWhitespace){this.interveningWhitespacePos=this.pos}this.nextChar();this.tokenStart();this.interveningWhitespace=true;break};case e.LexCodeDOT:{if(this.peekCharAt(this.pos+1)==e.LexCodeDOT){if(this.peekCharAt(this.pos+2)==e.LexCodeDOT){this.advanceChar(3);return e.staticTokens[e.TokenID.DotDotDot]}else{this.nextChar();return e.staticTokens[e.TokenID.Dot]}}else{this.nextChar();r=this.scanFraction();if(r){return r}else{return e.staticTokens[e.TokenID.Dot]}}};case e.LexCodeEQ:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){if(this.peekCharAt(this.pos+2)==e.LexCodeEQ){this.advanceChar(3);return e.staticTokens[e.TokenID.EqualsEqualsEquals]}else{this.advanceChar(2);return e.staticTokens[e.TokenID.EqualsEquals]}}else{if(this.peekCharAt(this.pos+1)==e.LexCodeGT){this.advanceChar(2);return e.staticTokens[e.TokenID.EqualsGreaterThan]}else{this.nextChar();return e.staticTokens[e.TokenID.Equals]}}};case e.LexCodeBNG:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){if(this.peekCharAt(this.pos+2)==e.LexCodeEQ){this.advanceChar(3);return e.staticTokens[e.TokenID.ExclamationEqualsEquals]}else{this.advanceChar(2);return e.staticTokens[e.TokenID.ExclamationEquals]}}else{this.nextChar();return e.staticTokens[e.TokenID.Exclamation]}};case e.LexCodePLS:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.PlusEquals]}else{if(this.peekCharAt(this.pos+1)==e.LexCodePLS){this.advanceChar(2);return e.staticTokens[e.TokenID.PlusPlus]}else{this.nextChar();return e.staticTokens[e.TokenID.Plus]}}};case e.LexCodeMIN:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.MinusEquals]}else{if(this.peekCharAt(this.pos+1)==e.LexCodeMIN){this.advanceChar(2);return e.staticTokens[e.TokenID.MinusMinus]}else{this.nextChar();return e.staticTokens[e.TokenID.Minus]}}};case e.LexCodeMUL:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.AsteriskEquals]}else{this.nextChar();return e.staticTokens[e.TokenID.Asterisk]}};case e.LexCodePCT:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.PercentEquals]}else{this.nextChar();return e.staticTokens[e.TokenID.Percent]}};case e.LexCodeLT:{if(this.peekCharAt(this.pos+1)==e.LexCodeLT){if(this.peekCharAt(this.pos+2)==e.LexCodeEQ){this.advanceChar(3);return e.staticTokens[e.TokenID.LessThanLessThanEquals]}else{this.advanceChar(2);return e.staticTokens[e.TokenID.LessThanLessThan]}}else{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.LessThanEquals]}else{this.nextChar();return e.staticTokens[e.TokenID.LessThan]}}};case e.LexCodeGT:{if(this.peekCharAt(this.pos+1)==e.LexCodeGT){if(this.peekCharAt(this.pos+2)==e.LexCodeEQ){this.advanceChar(3);return e.staticTokens[e.TokenID.GreaterThanGreaterThanEquals]}else{if(this.peekCharAt(this.pos+2)==e.LexCodeGT){if(this.peekCharAt(this.pos+3)==e.LexCodeEQ){this.advanceChar(4);return e.staticTokens[e.TokenID.GreaterThanGreaterThanGreaterThanEquals]}else{this.advanceChar(3);return e.staticTokens[e.TokenID.GreaterThanGreaterThanGreaterThan]}}else{this.advanceChar(2);return e.staticTokens[e.TokenID.GreaterThanGreaterThan]}}}else{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.GreaterThanEquals]}else{this.nextChar();return e.staticTokens[e.TokenID.GreaterThan]}}};case e.LexCodeXOR:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.CaretEquals]}else{this.nextChar();return e.staticTokens[e.TokenID.Caret]}};case e.LexCodeBAR:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.BarEquals]}else{if(this.peekCharAt(this.pos+1)==e.LexCodeBAR){this.advanceChar(2);return e.staticTokens[e.TokenID.BarBar]}else{this.nextChar();return e.staticTokens[e.TokenID.Bar]}}};case e.LexCodeAMP:{if(this.peekCharAt(this.pos+1)==e.LexCodeEQ){this.advanceChar(2);return e.staticTokens[e.TokenID.AmpersandEquals]}else{if(this.peekCharAt(this.pos+1)==e.LexCodeAMP){this.advanceChar(2);return e.staticTokens[e.TokenID.AmpersandAmpersand]}else{this.nextChar();return e.staticTokens[e.TokenID.And]}}};default:{this.reportScannerError("Invalid character");this.nextChar();continue e}}}}}}}}}}return e.staticTokens[e.TokenID.EndOfFile]};r.prototype.reportScannerError=function(e){if(this.reportError){this.reportError(e)}};return r}();e.Scanner=N;e.convertTokToIDName=C;e.convertTokToID=k;e.getLineNumberFromPosition=A;e.getSourceLineColFromMap=O;e.getLineColumnFromPosition=M;e.getPositionFromLineColumn=_;e.isPrimitiveTypeToken=D;e.isModifier=P})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n,r,i,s){var o=new e.ScopeChain(null,n.scopeChain,t);o.thisType=r;o.classType=i;o.fnc=s;n.scopeChain=o}function r(e){e.scopeChain=e.scopeChain.previous}function i(e,t){if(e==null||!e.isInstanceProperty()){return t}else{return e}}function s(e){return e.isInstanceProperty()}function u(t,r){var i=t;var s=null;var o=null;if(i.name&&i.mod){i.name.sym=i.mod.symbol}var u=i.mod;if(!u){return}s=new e.SymbolTableScope(u.members,u.ambientMembers,u.enclosedTypes,u.ambientEnclosedTypes,u.symbol);u.memberScope=s;r.modDeclChain.push(i);r.typeFlow.checker.currentModDecl=i;o=new e.SymbolAggregateScope(u.symbol);o.addParentScope(s);o.addParentScope(r.scopeChain.scope);n(o,r,null,null,null);u.containedScope=o;if(u.symbol){r.typeFlow.addLocalsFromScope(u.containedScope,u.symbol,i.vars,u.members.privateMembers,true)}}function a(t,r){var i=t;var s=null;var o=null;if(i.name&&i.type){i.name.sym=i.type.symbol}var u=t.type;if(u){var a=u.symbol;s=r.typeFlow.checker.scopeOf(u);o=new e.SymbolAggregateScope(u.symbol);o.addParentScope(s);o.addParentScope(r.scopeChain.scope);u.containedScope=o;u.memberScope=s;var f=u.instanceType;s=r.typeFlow.checker.scopeOf(f);f.memberScope=s;o=new e.SymbolAggregateScope(f.symbol);o.addParentScope(r.scopeChain.scope);n(o,r,f,u,null);f.containedScope=o}else{t.type=r.typeFlow.anyType}}function f(t,r){var i=t;var s=null;var o=null;if(i.name&&i.type){i.name.sym=i.type.symbol}var u=t.type;s=r.typeFlow.checker.scopeOf(u);u.memberScope=s;o=new e.SymbolAggregateScope(u.symbol);o.addParentScope(s);o.addParentScope(r.scopeChain.scope);n(o,r,null,null,null);u.containedScope=o}function l(t,r){var i=t;var s=i.type;var o=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));var u=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));var s=new e.Type;var a=new e.WithSymbol(i.minChar,r.typeFlow.checker.locationInfo.unitIndex,s);s.members=o;s.ambientMembers=u;s.symbol=a;s.setHasImplementation();i.type=s;var f=new e.SymbolScopeBuilder(s.members,s.ambientMembers,null,null,r.scopeChain.scope,s.symbol);n(f,r,null,null,null);s.containedScope=f}function c(t,r){var i=t;var s=null;var o=null;if(i.type){o=t.type.symbol}var u=e.hasFlag(i.fncFlags,e.FncFlags.Static);var a=u&&r.scopeChain.fnc!=null;var f=a?r.scopeChain.fnc.type.memberScope:r.scopeChain.scope;if(r.scopeChain.thisType&&(!i.isConstructor||e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod))){var l=r.scopeChain.thisType;if(!(l.typeFlags&e.TypeFlags.IsClass)&&!e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)){if(!i.isMethod()||u){f=l.constructorScope}else{f=l.containedScope}}else{if(r.scopeChain.previous.scope.container&&r.scopeChain.previous.scope.container.declAST&&r.scopeChain.previous.scope.container.declAST.nodeType==e.NodeType.FuncDecl&&r.scopeChain.previous.scope.container.declAST.isConstructor){f=l.constructorScope}else{if(u&&r.scopeChain.classType){f=r.scopeChain.classType.containedScope}else{f=l.containedScope}}}s=l.symbol}else{if(i.isConstructor&&r.scopeChain.thisType){s=r.scopeChain.thisType.symbol}}if(i.type==null||e.hasFlag(i.type.symbol.flags,e.SymbolFlags.TypeSetDuringScopeAssignment)){if(r.scopeChain.fnc&&r.scopeChain.fnc.type){s=r.scopeChain.fnc.type.symbol}var c=null;var h=r.scopeChain.fnc;var p=i.name?i.name.actualText:null;var d=null;if(u){if(h.type.members==null&&s.getType().memberScope){h.type.members=s.type.memberScope.valueMembers}c=r.scopeChain.fnc.type.memberScope;h.innerStaticFuncs[h.innerStaticFuncs.length]=i}else{if(!i.isConstructor&&s&&s.declAST&&s.declAST.nodeType==e.NodeType.FuncDecl&&s.declAST.isConstructor&&!i.isMethod()){c=r.scopeChain.thisType.constructorScope}else{c=r.scopeChain.scope}}if(p&&p!="__missing"&&!i.isAccessor()){if(u){d=c.findLocal(p,false,false)}else{d=c.findLocal(p,false,false)}}r.typeFlow.checker.createFunctionSignature(i,s,c,d,d==null);if(!i.accessorSymbol&&i.fncFlags&e.FncFlags.ClassMethod&&s&&(!d||d.declAST.nodeType!=e.NodeType.FuncDecl)&&i.isAccessor()||d&&d.isAccessor()){i.accessorSymbol=r.typeFlow.checker.createAccessorSymbol(i,d,s.getType(),i.isMethod()&&u,true,c,s)}i.type.symbol.flags|=e.SymbolFlags.TypeSetDuringScopeAssignment}if(i.name&&i.type){i.name.sym=i.type.symbol}i.scopeType=i.type;if(i.isOverload){return}var v=new e.StringHashTable;var m=new e.ScopedMembers(new e.DualStringHashTable(v,new e.StringHashTable));var g=new e.StringHashTable;var y=new e.ScopedMembers(new e.DualStringHashTable(g,new e.StringHashTable));var b=new e.StringHashTable;var w=new e.ScopedMembers(new e.DualStringHashTable(b,new e.StringHashTable));var E=new e.StringHashTable;var S=new e.ScopedMembers(new e.DualStringHashTable(E,new e.StringHashTable));i.unitIndex=r.typeFlow.checker.locationInfo.unitIndex;var x=new e.SymbolScopeBuilder(m,y,null,null,f,o);var T=new e.SymbolScopeBuilder(w,S,null,null,f,null);if(i.isConstructor&&r.scopeChain.thisType){r.scopeChain.thisType.constructorScope=x}i.symbols=v;if(!i.isSpecialFn()){var N=i.type;var C=i.signature;if(!i.isConstructor){N.containedScope=x;x.container=N.symbol;N.memberScope=T;T.container=N.symbol}i.enclosingFnc=r.scopeChain.fnc;N.enclosingType=u?r.scopeChain.classType:r.scopeChain.thisType;var d=t.type.symbol;if((i.fncFlags&e.FncFlags.Signature)==e.FncFlags.None&&i.vars){r.typeFlow.addLocalsFromScope(x,d,i.vars,v,false);r.typeFlow.addLocalsFromScope(T,d,i.statics,b,false)}if(C.parameters){var k=C.parameters.length;for(var L=0;L<k;L++){var A=C.parameters[L];r.typeFlow.checker.resolveTypeLink(x,A.parameter.typeLink,true)}}r.typeFlow.checker.resolveTypeLink(x,C.returnType,i.isSignature())}if(!i.isConstructor||e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)){var O=i.isConstructor&&e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)?r.scopeChain.thisType:null;n(x,r,O,null,i)}}function h(t,r){var i=t;if(i.param){var s=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));var o=new e.SymbolScopeBuilder(s,null,null,null,r.scopeChain.scope,r.scopeChain.scope.container);i.containedScope=o;n(o,r,r.scopeChain.thisType,r.scopeChain.classType,r.scopeChain.fnc)}}function p(t,n,r){var i=r.state;var s=true;if(t){if(t.nodeType==e.NodeType.List){var o=t;o.enclosingScope=i.scopeChain.scope}else{if(t.nodeType==e.NodeType.ModuleDeclaration){u(t,i)}else{if(t.nodeType==e.NodeType.ClassDeclaration){a(t,i)}else{if(t.nodeType==e.NodeType.InterfaceDeclaration){f(t,i)}else{if(t.nodeType==e.NodeType.With){l(t,i)}else{if(t.nodeType==e.NodeType.FuncDecl){c(t,i)}else{if(t.nodeType==e.NodeType.Catch){h(t,i)}else{if(t.nodeType==e.NodeType.TypeRef){s=false}}}}}}}}}r.options.goChildren=s;return t}function d(t,n,i){var s=i.state;var o=true;if(t){if(t.nodeType==e.NodeType.ModuleDeclaration){var u=t;r(s);s.modDeclChain.pop();if(s.modDeclChain.length>=1){s.typeFlow.checker.currentModDecl=s.modDeclChain[s.modDeclChain.length-1]}}else{if(t.nodeType==e.NodeType.ClassDeclaration){r(s)}else{if(t.nodeType==e.NodeType.InterfaceDeclaration){r(s)}else{if(t.nodeType==e.NodeType.With){r(s)}else{if(t.nodeType==e.NodeType.FuncDecl){var a=t;if((!a.isConstructor||e.hasFlag(a.fncFlags,e.FncFlags.ClassMethod))&&!a.isOverload){r(s)}}else{if(t.nodeType==e.NodeType.Catch){var f=t;if(f.param){r(s)}}else{o=false}}}}}}}i.options.goChildren=o;return t}var t=function(){function e(e,t,n){this.scopeChain=e;this.typeFlow=t;this.modDeclChain=n}return e}();e.AssignScopeContext=t;e.pushAssignScope=n;e.popAssignScope=r;e.instanceCompare=i;e.instanceFilterStop=s;var o=function(){function e(e,t){this.select=e;this.stop=t;this.result=null}e.prototype.reset=function(){this.result=null};e.prototype.update=function(e){this.result=this.select(this.result,e);if(this.result){return this.stop(this.result)}else{return false}};return e}();e.ScopeSearchFilter=o;e.instanceFilter=new o(i,s);e.preAssignModuleScopes=u;e.preAssignClassScopes=a;e.preAssignInterfaceScopes=f;e.preAssignWithScopes=l;e.preAssignFuncDeclScopes=c;e.preAssignCatchScopes=h;e.preAssignScopes=p;e.postAssignScopes=d})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(t,n,r){var i=r.state;if(e.hasFlag(t.flags,i.matchFlag)&&(i.pos<0||i.pos==t.limChar)){i.ast=t;if(t.type==null&&i.pos>=0){i.flow.inScopeTypeCheck(t,i.scope)}i.type=t.type;i.options.stopWalk()}return t}function s(t,n,r,i,s,o,u,a,f){var l=new e.SymbolScopeBuilder(n,r,i,s,null,t);var c=new e.ScopeChain(t,o.scopeChain,l);c.thisType=u;c.classType=a;c.moduleDecl=f;o.scopeChain=c}function o(e){e.scopeChain=e.scopeChain.previous}function u(t,n,r){var i=r.state;var s=t.minChar;var o=t.limChar;if(t.nodeType==e.NodeType.Script&&i.pos>o){o=i.pos}if(s<=i.pos&&o>=i.pos){switch(t.nodeType){case e.NodeType.Script:{var u=t;i.scopeGetter=function(){return u.bod===null?null:u.bod.enclosingScope};i.scopeStartAST=u;break};case e.NodeType.ClassDeclaration:{i.scopeGetter=function(){return t.type===null||t.type.instanceType.containedScope===null?null:t.type.instanceType.containedScope};i.scopeStartAST=t;i.enclosingClassDecl=t;break};case e.NodeType.ObjectLit:{var a=t;if(a.targetType){i.scopeGetter=function(){return a.targetType.containedScope};i.objectLiteralScopeGetter=function(){return a.targetType.memberScope};i.enclosingObjectLit=a}break};case e.NodeType.ModuleDeclaration:{i.deepestModuleDecl=t;i.scopeGetter=function(){return t.type===null?null:t.type.containedScope};i.scopeStartAST=t;break};case e.NodeType.InterfaceDeclaration:{i.scopeGetter=function(){return t.type===null?null:t.type.containedScope};i.scopeStartAST=t;break};case e.NodeType.FuncDecl:{{var f=t;if(i.skipNextFuncDeclForClass){i.skipNextFuncDeclForClass=false}else{i.scopeGetter=function(){if(f.isConstructor&&e.hasFlag(f.fncFlags,e.FncFlags.ClassMethod)){if(t.type&&t.type.enclosingType){return t.type.enclosingType.constructorScope}}if(f.scopeType){return f.scopeType.containedScope}if(f.type){return f.type.containedScope}return null};i.scopeStartAST=t}}break}}r.options.goChildren=true}else{r.options.goChildren=false}return t}function a(t,n,i,s,o){var a=new r(t,n,i,s,o);e.getAstWalkerFactory().walk(n,u,null,null,a);if(a.scopeStartAST===null){return null}return a}var t=function(){function e(e,t){this.scopeChain=e;this.checker=t;this.script=null}return e}();e.TypeCollectionContext=t;var n=function(){function t(t,n,r){this.flow=t;this.pos=n;this.matchFlag=r;this.type=null;this.ast=null;this.options=new e.AstWalkOptions}return t}();e.MemberScopeContext=n;var r=function(){function t(e,t,n,r,i){this.logger=e;this.script=t;this.text=n;this.pos=r;this.isMemberCompletion=i;this.scopeGetter=null;this.objectLiteralScopeGetter=null;this.scopeStartAST=null;this.skipNextFuncDeclForClass=false;this.deepestModuleDecl=null;this.enclosingClassDecl=null;this.enclosingObjectLit=null;this.publicsOnly=true;this.useFullAst=false}t.prototype.getScope=function(){return this.scopeGetter()};t.prototype.getObjectLiteralScope=function(){return this.objectLiteralScopeGetter()};t.prototype.getScopeAST=function(){return this.scopeStartAST};t.prototype.getScopePosition=function(){return this.scopeStartAST.minChar};t.prototype.getScriptFragmentStartAST=function(){return this.scopeStartAST};t.prototype.getScriptFragmentPosition=function(){return this.getScriptFragmentStartAST().minChar};t.prototype.getScriptFragment=function(){if(this.scriptFragment==null){var t=this.getScriptFragmentStartAST();var n=t.minChar;var r=this.isMemberCompletion?this.pos:this.pos+1;this.scriptFragment=e.quickParse(this.logger,t,this.text,n,r,null).Script}return this.scriptFragment};return t}();e.EnclosingScopeContext=r;e.preFindMemberScope=i;e.pushTypeCollectionScope=s;e.popTypeCollectionScope=o;e.preFindEnclosingScope=u;e.findEnclosingScopeAt=a})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(){this.hasVariableArgList=false;this.parameters=null;this.declAST=null;this.typeCheckStatus=e.TypeCheckStatus.NotStarted;this.nonOptionalParameterCount=0}t.prototype.specializeType=function(n,r,i){var s=new t;if(this.hasVariableArgList){s.hasVariableArgList=true}s.returnType=new e.TypeLink;if(this.returnType.type){s.returnType.type=this.returnType.type.specializeType(n,r,i,false)}else{s.returnType.type=i.anyType}if(this.parameters){s.parameters=[];for(var o=0,u=this.parameters.length;o<u;o++){var a=this.parameters[o];var f=new e.ValueLocation;var l=new e.ParameterSymbol(a.name,a.location,i.locationInfo.unitIndex,f);l.declAST=this.declAST;f.symbol=l;f.typeLink=new e.TypeLink;s.parameters[o]=l;var c=a.getType();if(c){f.typeLink.type=c.specializeType(n,r,i,false);l.declAST.type=f.typeLink.type}else{f.typeLink.type=i.anyType}}}s.nonOptionalParameterCount=this.nonOptionalParameterCount;s.declAST=this.declAST;return s};t.prototype.toString=function(){return this.toStringHelper(false,false,null)};t.prototype.toStringHelper=function(e,t,n){return this.toStringHelperEx(e,t,n).toString()};t.prototype.toStringHelperEx=function(t,n,r,i){if(typeof i==="undefined"){i=""}var s=new e.MemberNameArray;if(n){s.prefix=i+"["}else{s.prefix=i+"("}var o=this.parameters.length;var u=this.hasVariableArgList?o-1:o;for(var a=0;a<u;a++){s.add(e.MemberName.create(this.parameters[a].name+(this.parameters[a].isOptional()?"?":"")+": "));s.add(this.parameters[a].getType().getScopedTypeNameEx(r));if(a<o-1){s.add(e.MemberName.create(", "))}}if(this.hasVariableArgList){s.add(e.MemberName.create("..."+this.parameters[a].name+": "));s.add(this.parameters[a].getType().getScopedTypeNameEx(r))}if(t){if(n){s.add(e.MemberName.create("] => "))}else{s.add(e.MemberName.create(") => "))}}else{if(n){s.add(e.MemberName.create("]: "))}else{s.add(e.MemberName.create("): "))}}if(this.returnType.type){s.add(this.returnType.type.getScopedTypeNameEx(r))}else{s.add(e.MemberName.create("any"))}return s};return t}();e.Signature=t;var n=function(){function t(){this.signatures=[];this.hasImplementation=true;this.definitionSignature=null;this.hasBeenTypechecked=false;this.flags=e.SignatureFlags.None}t.prototype.addSignature=function(t){if(this.signatures==null){this.signatures=new Array}this.signatures[this.signatures.length]=t;if(t.declAST&&!t.declAST.isOverload&&!t.declAST.isSignature()&&!e.hasFlag(t.declAST.fncFlags,e.FncFlags.Ambient)&&e.hasFlag(t.declAST.fncFlags,e.FncFlags.Definition)){this.definitionSignature=t}};t.prototype.toString=function(){return this.signatures.toString()};t.prototype.toStrings=function(t,n,r){var i=[];var s=this.signatures.length;if(s>1){n=false}for(var o=0;o<s;o++){if(s>1&&this.signatures[o]==this.definitionSignature){continue}if(this.flags&e.SignatureFlags.IsIndexer){i.push(this.signatures[o].toStringHelperEx(n,true,r))}else{i.push(this.signatures[o].toStringHelperEx(n,false,r,t))}}return i};t.prototype.specializeType=function(e,n,r){var i=new t;if(this.signatures){for(var s=0,o=this.signatures.length;s<o;s++){i.addSignature(this.signatures[s].specializeType(e,n,r))}}return i};t.prototype.verifySignatures=function(t){var n=0;if(this.signatures&&(n=this.signatures.length)>0){for(var r=0;r<n;r++){for(var i=r+1;i<n;i++){if(this.signatures[r].declAST&&this.signatures[i].declAST&&!e.hasFlag(this.signatures[r].declAST.fncFlags,e.FncFlags.Definition)&&!e.hasFlag(this.signatures[i].declAST.fncFlags,e.FncFlags.Definition)&&t.signaturesAreIdentical(this.signatures[r],this.signatures[i])){t.errorReporter.simpleError(this.signatures[r].declAST,this.signatures[r].declAST&&this.signatures[r].declAST.name?"Signature for '"+this.signatures[r].declAST.name.actualText+"' is duplicated":"Signature is duplicated")}}if(this.definitionSignature){if(!t.signatureIsAssignableToTarget(this.definitionSignature,this.signatures[r])){t.errorReporter.simpleError(this.signatures[r].declAST,"Overload signature is not compatible with function definition")}}}}};t.prototype.typeCheck=function(t,n,r){if(this.hasBeenTypechecked){return}this.hasBeenTypechecked=true;var i=0;if(this.signatures&&(i=this.signatures.length)>0){for(var s=0;s<i;s++){if(!r&&!this.definitionSignature&&this.signatures[s].declAST&&this.signatures[s].declAST.isOverload&&!e.hasFlag(this.signatures[s].declAST.fncFlags,e.FncFlags.Ambient)){t.errorReporter.simpleError(this.signatures[s].declAST,"Overload declaration lacks definition")}if(this.signatures[s].declAST&&this.signatures[s].declAST.isConstructor&&this.signatures[s].declAST.classDecl&&this.signatures[s].declAST.classDecl.type.symbol.typeCheckStatus==e.TypeCheckStatus.NotStarted){t.typeFlow.typeCheck(this.signatures[s].declAST.classDecl)}t.typeFlow.typeCheck(this.signatures[s].declAST)}this.verifySignatures(t)}};return t}();e.SignatureGroup=n})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n){if(t.declAST&&n&&n.declAST&&t.declAST.nodeType==e.NodeType.FuncDecl){return t.declAST.minChar<=n.declAST.minChar&&t.declAST.limChar>=n.declAST.limChar}else{return false}}function r(e,t){while(e.container){if(e==t||n(e.container,t)){return true}e=e.container}return false}(function(e){e._map=[];e._map[0]="NotStarted";e.NotStarted=0;e._map[1]="Started";e.Started=1;e._map[2]="Finished";e.Finished=2})(e.TypeCheckStatus||(e.TypeCheckStatus={}));var t=e.TypeCheckStatus;e.aLexicallyEnclosesB=n;e.aEnclosesB=r;var i=function(){function t(t,n,r){this.name=t;this.location=n;this.unitIndex=r;this.bound=false;this.flags=e.SymbolFlags.None;this.isObjectLitField=false;this.declAST=null;this.declModule=null;this.passSymbolCreated=e.CompilerDiagnostics.analysisPass}t.prototype.instanceScope=function(){return null};t.prototype.isVariable=function(){return false};t.prototype.isMember=function(){return false};t.prototype.isInferenceSymbol=function(){return false};t.prototype.isWith=function(){return false};t.prototype.writeable=function(){return false};t.prototype.isType=function(){return false};t.prototype.getType=function(){return null};t.prototype.isAccessor=function(){return false};t.prototype.isInstanceProperty=function(){return e.hasFlag(this.flags,e.SymbolFlags.Property)&&!e.hasFlag(this.flags,e.SymbolFlags.ModuleMember)};t.prototype.getTypeName=function(e){return this.getTypeNameEx(e).toString()};t.prototype.getTypeNameEx=function(t){return e.MemberName.create(this.toString())};t.prototype.getOptionalNameString=function(){return e.hasFlag(this.flags,e.SymbolFlags.Optional)?"?":""};t.prototype.pathToRoot=function(){var t=new Array;var n=this;while(n&&n.name!=e.globalId){t[t.length]=n;n=n.container}return t};t.prototype.findCommonAncestorPath=function(e){if(this.container==null){return new Array}var t=this.container.pathToRoot();var n;if(e){n=e.pathToRoot()}else{n=new Array}var r=-1;for(var i=0,s=t.length;i<s;i++){var o=t[i];for(var u=0,a=n.length;u<a;u++){var f=n[u];if(o==f){r=i;break}}if(r>=0){break}}if(r>=0){return t.slice(0,r)}else{return t}};t.prototype.getPrettyName=function(e,t){return this.name};t.prototype.scopeRelativeName=function(e){if(e==null){return this.name}var t=this.findCommonAncestorPath(e.container);var n="";for(var r=0,i=t.length;r<i;r++){n=t[r].name+"."+n}n+=this.name;return n};t.prototype.fullName=function(){var t=this.name;var n=this.container;while(n&&n.name!=e.globalId){t=n.name+"."+t;n=n.container}return t};t.prototype.isExternallyVisible=function(t){if(this==t.gloMod){return true}if(e.hasFlag(this.flags,e.SymbolFlags.Private)){return false}if(!e.hasFlag(this.flags,e.SymbolFlags.Exported)){return this.container==t.gloMod}return this.container.isExternallyVisible(t)};t.prototype.visible=function(t,n){if(n==null||this.container==n.gloMod){return true}if(e.hasFlag(this.flags,e.SymbolFlags.ModuleMember)){if(e.hasFlag(this.flags,e.SymbolFlags.Exported)){if(!e.hasFlag(this.flags,e.SymbolFlags.Private)){return true}else{return r(this,t.container)}}else{return n&&n.currentModDecl==this.declModule||n.currentModDecl&&n.currentModDecl.mod&&n.currentModDecl.mod.symbol&&this.declModule&&this.declModule.mod&&this.declModule.mod.symbol&&r(n.currentModDecl.mod.symbol,this.declModule.mod.symbol)}}else{var i=this.declAST&&this.declAST.nodeType==e.NodeType.FuncDecl;var s=i&&this.declAST.isMethod();var o=i&&e.hasFlag(this.declAST.fncFlags,e.FncFlags.Static);var u=s&&e.hasFlag(this.declAST.fncFlags,e.FncFlags.Private);var a=this.isType()&&this.aliasLink;if(this.isMember()||s||o||a){if(e.hasFlag(this.flags,e.SymbolFlags.Private)||u){if(t.container==null&&this.container!=t.container){return false}else{return this.container==null?true:r(t.container,this.container)}}else{return true}}else{if(this.container){return r(this,t.container)}else{return true}}}};t.prototype.addRef=function(e){if(!this.refs){this.refs=[]}this.refs[this.refs.length]=e};t.prototype.toString=function(){if(this.name){return this.name}else{return"_anonymous"}};t.prototype.print=function(e){e.Write(this.toString())};t.prototype.specializeType=function(e,t,n){throw new Error("please implement in derived class")};t.prototype.setType=function(e){throw new Error("please implement in derived class")};t.prototype.kind=function(){throw new Error("please implement in derived class")};t.prototype.getInterfaceDeclFromSymbol=function(t){if(this.declAST!=null){if(this.declAST.nodeType==e.NodeType.InterfaceDeclaration){return this.declAST}else{if(this.container!=null&&this.container!=t.gloMod&&this.container.declAST.nodeType==e.NodeType.InterfaceDeclaration){return this.container.declAST}}}return null};t.prototype.getVarDeclFromSymbol=function(){if(this.declAST!=null&&this.declAST.nodeType==e.NodeType.VarDecl){return this.declAST}return null};t.prototype.getImportDeclFromSymbol=function(){if(this.declAST!=null&&this.declAST.nodeType==e.NodeType.ImportDeclaration){return this.declAST}return null};return t}();e.Symbol=i;var s=function(){function e(){}return e}();e.ValueLocation=s;var o=function(n){function r(e,r,i){n.call(this,e,r,i);this.typeCheckStatus=t.NotStarted}__extends(r,n);r.prototype.isInferenceSymbol=function(){return true};r.prototype.transferVarFlags=function(t){if(e.hasFlag(t,e.VarFlags.Ambient)){this.flags|=e.SymbolFlags.Ambient}if(e.hasFlag(t,e.VarFlags.Constant)){this.flags|=e.SymbolFlags.Constant}if(e.hasFlag(t,e.VarFlags.Static)){this.flags|=e.SymbolFlags.Static}if(e.hasFlag(t,e.VarFlags.Property)){this.flags|=e.SymbolFlags.Property}if(e.hasFlag(t,e.VarFlags.Private)){this.flags|=e.SymbolFlags.Private}if(e.hasFlag(t,e.VarFlags.Public)){this.flags|=e.SymbolFlags.Public}if(e.hasFlag(t,e.VarFlags.Readonly)){this.flags|=e.SymbolFlags.Readonly}if(e.hasFlag(t,e.VarFlags.Exported)){this.flags|=e.SymbolFlags.Exported}};return r}(i);e.InferenceSymbol=o;var u=function(t){function n(n,r,i,s){t.call(this,n,r,i);this.type=s;this.expansions=[];this.isMethod=false;this.aliasLink=null;this.onlyReferencedAsTypeRef=e.optimizeModuleCodeGen;this.prettyName=this.name}__extends(n,t);n.prototype.addLocation=function(e){if(this.additionalLocations==null){this.additionalLocations=[]}this.additionalLocations[this.additionalLocations.length]=e};n.prototype.kind=function(){return e.SymbolKind.Type};n.prototype.isType=function(){return true};n.prototype.getType=function(){return this.type};n.prototype.getTypeNameEx=function(e){return this.type.getMemberTypeNameEx(this.name?this.name+this.getOptionalNameString():"",false,false,e)};n.prototype.instanceScope=function(){if(!(this.type.typeFlags&e.TypeFlags.IsClass)&&this.type.isClass()){return this.type.instanceType.constructorScope}else{return this.type.containedScope}};n.prototype.toString=function(){var e=this.type.getTypeName();if(this.name){e=this.name+":"+e}return e};n.prototype.isClass=function(){return this.instanceType!=null};n.prototype.isFunction=function(){return this.declAST!=null&&this.declAST.nodeType==e.NodeType.FuncDecl};n.prototype.specializeType=function(e,t,r){if(this.type==e){return t.symbol}else{var i=this.type.specializeType(e,t,r,false);if(i!=this.type){var s=new n(this.name,0,-1,i);return s}else{return this}}};n.prototype.getPrettyName=function(t,n){if(e.isQuoted(this.prettyName)&&this.type.isModuleType()){var r=n?t.pathToRoot():[t];var i=[];for(var s=0;s<r.length;s++){var o=r[s].getType();if(o.isModuleType()){i.push(r[s]);var u=o;var a=u.findDynamicModuleName(this.type,"",false,i);if(a!=null){return a}}}}return this.prettyName};n.prototype.scopeRelativeName=function(e){if(e==null){return this.prettyName+this.getOptionalNameString()}var t=this.findCommonAncestorPath(e.container);var n="";for(var r=0,i=t.length;r<i;r++){var s=t[r].getPrettyName(r==i-1?e.container:t[r+1],r==i-1);n=s+"."+n}n+=this.getPrettyName(i==0?e.container:t[0],i==0)+this.getOptionalNameString();return n};return n}(o);e.TypeSymbol=u;var a=function(e){function t(t,n,r){e.call(this,"with",t,n,r)}__extends(t,e);t.prototype.isWith=function(){return true};return t}(u);e.WithSymbol=a;var f=function(n){function r(e,t,r,i,s){n.call(this,e,t,r);this.canWrite=i;this.field=s;this.getter=null;this.setter=null;this.hasBeenEmitted=false;this.name=e;this.location=t}__extends(r,n);r.prototype.kind=function(){return e.SymbolKind.Field};r.prototype.writeable=function(){return this.isAccessor()?this.setter!=null:this.canWrite};r.prototype.getType=function(){return this.field.typeLink.type};r.prototype.getTypeNameEx=function(t){return e.MemberName.create(this.field.typeLink.type.getScopedTypeNameEx(t),this.name+this.getOptionalNameString()+": ","")};r.prototype.isMember=function(){return true};r.prototype.setType=function(e){this.field.typeLink.type=e};r.prototype.isAccessor=function(){return this.getter!=null||this.setter!=null};r.prototype.isVariable=function(){return true};r.prototype.toString=function(){return this.getTypeNameEx(null).toString()};r.prototype.specializeType=function(n,i,o){var u=this.field.typeLink.type.specializeType(n,i,o,false);if(u!=this.field.typeLink.type){var a=new s;var f=new r(this.name,0,o.locationInfo.unitIndex,this.canWrite,a);f.flags=this.flags;a.symbol=f;a.typeLink=new e.TypeLink;f.setType(u);f.typeCheckStatus=t.Finished;return f}else{return this}};return r}(o);e.FieldSymbol=f;var l=function(t){function n(e,n,r,i){t.call(this,e,n,r);this.parameter=i;this.argsOffset=-1;this.name=e;this.location=n}__extends(n,t);n.prototype.kind=function(){return e.SymbolKind.Parameter};n.prototype.writeable=function(){return true};n.prototype.getType=function(){return this.parameter.typeLink.type};n.prototype.setType=function(e){this.parameter.typeLink.type=e};n.prototype.isVariable=function(){return true};n.prototype.isOptional=function(){if(this.parameter&&this.parameter.symbol&&this.parameter.symbol.declAST){return this.parameter.symbol.declAST.isOptional}else{return false}};n.prototype.getTypeNameEx=function(t){return e.MemberName.create(this.getType().getScopedTypeNameEx(t),this.name+(this.isOptional()?"?":"")+": ","")};n.prototype.toString=function(){return this.getTypeNameEx(null).toString()};n.prototype.specializeType=function(e,t,r){var i=this.parameter.typeLink.type.specializeType(e,t,r,false);if(this.parameter.typeLink.type!=i){var o=new s;var u=new n(this.name,0,r.locationInfo.unitIndex,o);o.symbol=u;u.setType(i);return u}else{return this}};return n}(o);e.ParameterSymbol=l;var c=function(t){function n(e,n,r,i){t.call(this,e,n,r);this.variable=i}__extends(n,t);n.prototype.kind=function(){return e.SymbolKind.Variable};n.prototype.writeable=function(){return true};n.prototype.getType=function(){return this.variable.typeLink.type};n.prototype.getTypeNameEx=function(t){return e.MemberName.create(this.getType().getScopedTypeNameEx(t),this.name+": ","")};n.prototype.setType=function(e){this.variable.typeLink.type=e};n.prototype.isVariable=function(){return true};return n}(o);e.VariableSymbol=c})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(t,n){return n?!(e.hasFlag(t.flags,e.SymbolFlags.Private)||t.declAST&&t.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(t.declAST.fncFlags,e.FncFlags.Private)):true}var t=function(){function e(e){this.dualMembers=e;this.allMembers=this.dualMembers;this.publicMembers=this.dualMembers.primaryTable;this.privateMembers=this.dualMembers.secondaryTable}e.prototype.addPublicMember=function(e,t){return this.dualMembers.primaryTable.add(e,t)};e.prototype.addPrivateMember=function(e,t){return this.dualMembers.secondaryTable.add(e,t)};return e}();e.ScopedMembers=t;(function(e){e._map=[];e._map[0]="None";e.None=0;e._map[1]="Type";e.Type=1;e._map[2]="Field";e.Field=2;e._map[3]="Parameter";e.Parameter=3;e._map[4]="Variable";e.Variable=4})(e.SymbolKind||(e.SymbolKind={}));var n=e.SymbolKind;var r=function(){function e(e){this.container=e}e.prototype.printLabel=function(){return"base"};e.prototype.getAllSymbolNames=function(e){return["please","implement","in","derived","classes"]};e.prototype.getAllTypeSymbolNames=function(e){return["please","implement","in","derived","classes"]};e.prototype.getAllValueSymbolNames=function(e){return["please","implement","in","derived","classes"]};e.prototype.search=function(e,t,n,r){return null};e.prototype.findLocal=function(e,t,n){return null};e.prototype.find=function(e,t,n){return null};e.prototype.findImplementation=function(e,t,n){return null};e.prototype.findAmbient=function(e,t,n){return null};e.prototype.print=function(e){if(this.container){e.WriteLine(this.printLabel()+" scope with container: "+this.container.name+"...")}else{e.WriteLine(this.printLabel()+" scope...")}};e.prototype.enter=function(e,t,n,r,i,s,o){throw new Error("please implement in derived class")};e.prototype.getTable=function(){throw new Error("please implement in derived class")};return e}();e.SymbolScope=r;var s=function(t){function n(e){t.call(this,e);this.valueCache=null;this.valueImplCache=null;this.valueAmbientCache=null;this.typeCache=null;this.typeImplCache=null;this.typeAmbientCache=null;this.parents=null;this.container=e}__extends(n,t);n.prototype.printLabel=function(){return"agg"};n.prototype.search=function(e,t,n,r){if(this.parents){for(var i=0;i<this.parents.length;i++){var s=this.parents[i].search(e,t,n,r);if(s){if(e.update(s)){return s}}}}return e.result};n.prototype.getAllSymbolNames=function(e){var t=[];if(this.parents){for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllSymbolNames(e);if(r){t=t.concat(r)}}}return t};n.prototype.getAllTypeSymbolNames=function(e){var t=[];if(this.parents){for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllTypeSymbolNames(e);if(r){t=t.concat(r)}}}return t};n.prototype.getAllValueSymbolNames=function(e){var t=[];if(this.parents){for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllValueSymbolNames(e);if(r){t=t.concat(r)}}}return t};n.prototype.print=function(e){t.prototype.print.call(this,e);if(this.parents){for(var n=0;n<this.parents.length;n++){this.parents[n].print(e)}}};n.prototype.findImplementation=function(t,n,r){var i=null;var s=0;var o=this.valueImplCache;if(r){o=this.typeImplCache}if(o&&(i=o.lookup(t))!=null&&(n?!(e.hasFlag(i.flags,e.SymbolFlags.Private)||i.declAST&&i.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(i.declAST.fncFlags,e.FncFlags.Private)):true)){return i}if(this.parents){for(s=0;s<this.parents.length;s++){i=this.parents[s].findImplementation(t,n,r);if(i){break}}}if(o){if(r){this.typeImplCache=new e.StringHashTable;o=this.typeImplCache}else{this.valueImplCache=new e.StringHashTable;o=this.valueImplCache}}o.add(t,i);return i};n.prototype.find=function(t,n,r){var i=null;var s=0;var o=this.valueCache;if(r){o=this.typeCache}if(o&&(i=o.lookup(t))!=null&&(n?!(e.hasFlag(i.flags,e.SymbolFlags.Private)||i.declAST&&i.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(i.declAST.fncFlags,e.FncFlags.Private)):true)){return i}if(this.parents){for(s=0;s<this.parents.length;s++){i=this.parents[s].find(t,n,r);if(i){break}}}if(o==null){if(r){this.typeCache=new e.StringHashTable;o=this.typeCache}else{this.valueCache=new e.StringHashTable;o=this.valueCache}}o.add(t,i);return i};n.prototype.findAmbient=function(t,n,r){var i=null;var s=0;var o=this.valueAmbientCache;if(r){o=this.typeAmbientCache}if(o&&(i=o.lookup(t))!=null){return i}if(this.parents){for(s=0;s<this.parents.length;s++){i=this.parents[s].findAmbient(t,n,r);if(i){break}}}if(o==null){if(r){this.typeAmbientCache=new e.StringHashTable;o=this.typeAmbientCache}else{this.valueAmbientCache=new e.StringHashTable;o=this.valueAmbientCache}}o.add(t,i);return i};n.prototype.addParentScope=function(e){if(this.parents==null){this.parents=new Array}this.parents[this.parents.length]=e};return n}(r);e.SymbolAggregateScope=s;var o=function(e){function t(t,n,r,i,s){e.call(this,s);this.valueMembers=t;this.ambientValueMembers=n;this.enclosedTypes=r;this.ambientEnclosedTypes=i;this.container=s}__extends(t,e);t.prototype.printLabel=function(){return"table"};t.prototype.getAllSymbolNames=function(e){var t=this.getAllTypeSymbolNames(e);return t.concat(this.getAllValueSymbolNames(e))};t.prototype.getAllTypeSymbolNames=function(e){var t=[];if(this.ambientEnclosedTypes){t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())}if(this.enclosedTypes){t=t.concat(this.enclosedTypes.allMembers.getAllKeys())}return t};t.prototype.getAllValueSymbolNames=function(e){var t=[];if(this.ambientValueMembers){t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())}if(this.valueMembers){t=t.concat(this.valueMembers.allMembers.getAllKeys())}return t};t.prototype.search=function(e,t,n,r){var i=this.find(t,n,r);e.update(i);return e.result};t.prototype.find=function(e,t,n){var r=null;var i=null;if(n){r=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers;i=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}else{r=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers;i=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers}if(i){var s=i.lookup(e);if(s){return s}}if(r){var s=r.lookup(e);if(s){return s}}return null};t.prototype.findAmbient=function(e,t,n){var r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;if(n){r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}if(r){var i=r.lookup(e);if(i){return i}}return null};t.prototype.print=function(t){e.prototype.print.call(this,t);if(this.ambientValueMembers){this.ambientValueMembers.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null)}if(this.valueMembers){this.valueMembers.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null)}if(this.ambientEnclosedTypes){this.ambientEnclosedTypes.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null)}if(this.enclosedTypes){this.enclosedTypes.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null)}};t.prototype.findImplementation=function(e,t,r){var i=this.find(e,t,r);if(i){if(i.kind()==n.Type){var s=i;if(!s.type.hasImplementation()){i=null}}else{if(i.container){if(i.container.kind()==n.Type){var o=i.container;if(!o.type.hasImplementation()){i=null}}}}}return i};t.prototype.getTable=function(){return this.valueMembers.publicMembers};return t}(r);e.SymbolTableScope=o;var u=function(t){function n(e,n,r,i,s,o){t.call(this,o);this.valueMembers=e;this.ambientValueMembers=n;this.enclosedTypes=r;this.ambientEnclosedTypes=i;this.parent=s;this.container=o}__extends(n,t);n.prototype.printLabel=function(){return"builder"};n.prototype.getAllSymbolNames=function(e){var t=this.getAllTypeSymbolNames(e);return t.concat(this.getAllValueSymbolNames(e))};n.prototype.getAllTypeSymbolNames=function(e){var t=[];if(this.ambientEnclosedTypes){t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())}if(this.enclosedTypes){t=t.concat(this.enclosedTypes.allMembers.getAllKeys())}if(!e&&this.parent){var n=this.parent.getAllTypeSymbolNames(e);if(n){t=t.concat(n)}}return t};n.prototype.getAllValueSymbolNames=function(e){var t=[];if(this.ambientValueMembers){t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())}if(this.valueMembers){t=t.concat(this.valueMembers.allMembers.getAllKeys())}if(!e&&this.parent){var n=this.parent.getAllValueSymbolNames(e);if(n){t=t.concat(n)}}return t};n.prototype.search=function(e,t,n,r){var i=null;var s=this.valueMembers==null?null:n?this.valueMembers.publicMembers:this.valueMembers.allMembers;var o=this.ambientValueMembers==null?null:n?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;if(r){s=this.enclosedTypes==null?null:n?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers;o=this.ambientEnclosedTypes==null?null:n?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}if(o){if((i=o.lookup(t))!=null){if(e.update(i)){return i}}}if(s){if((i=s.lookup(t))!=null){if(e.update(i)){return i}}}if(this.parent){i=this.parent.search(e,t,n,r);if(i){if(e.update(i)){return i}}}return e.result};n.prototype.print=function(e){t.prototype.print.call(this,e);if(this.ambientValueMembers){this.ambientValueMembers.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null)}if(this.valueMembers){this.valueMembers.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null)}if(this.ambientEnclosedTypes){this.ambientEnclosedTypes.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null)}if(this.enclosedTypes){this.enclosedTypes.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null)}if(this.parent){this.parent.print(e)}};n.prototype.find=function(e,t,n){var r=null;var i=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers;var s=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;if(n){i=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers;s=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}if(s&&(r=s.lookup(e))!=null){return r}if(i&&(r=i.lookup(e))!=null){return r}if(this.parent){return this.parent.find(e,t,n)}return null};n.prototype.findAmbient=function(e,t,n){var r=null;var i=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;if(n){i=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}if(i&&(r=i.lookup(e))!=null){return r}if(this.parent){return this.parent.findAmbient(e,t,n)}return null};n.prototype.findLocal=function(e,t,n){var r=null;var i=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers;var s=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;if(n){i=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers;s=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers}if(i){if((r=i.lookup(e))!=null){if(r){return r}}}if(s){if((r=s.lookup(e))!=null){if(r){return r}}}return null};n.prototype.enter=function(t,n,r,i,s,o,u){var a=null;if(u){if(o){a=this.ambientEnclosedTypes==null?null:s?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.privateMembers}else{a=this.ambientValueMembers==null?null:s?this.ambientValueMembers.publicMembers:this.ambientValueMembers.privateMembers}}else{if(o){a=this.enclosedTypes==null?null:s?this.enclosedTypes.publicMembers:this.enclosedTypes.privateMembers}else{a=this.valueMembers==null?null:s?this.valueMembers.publicMembers:this.valueMembers.privateMembers}}if(a){if(!a.add(r.name,r)){i.duplicateIdentifier(n,r.name)}}else{e.CompilerDiagnostics.Alert("YYYYY")}r.container=t};n.prototype.getTable=function(){return this.valueMembers.allMembers};return n}(r);e.SymbolScopeBuilder=u;var a=function(e){function t(t,n,r){e.call(this,n);this.scope=t;this.filter=r}__extends(t,e);t.prototype.print=function(e){this.scope.print(e)};t.prototype.find=function(e,t,n){this.filter.reset();return this.scope.search(this.filter,e,t,n)};t.prototype.findLocal=function(e,t,n){return this.scope.findLocal(e,t,n)};return t}(r);e.FilteredSymbolScope=a;var f=function(e){function t(t,n,r,i){e.call(this,t,null,null,null,n,r);this.filter=i}__extends(t,e);t.prototype.findLocal=function(t,n,r){var i=e.prototype.findLocal.call(this,t,n,r);if(i){if(!this.filter(i)){return null}}return i};t.prototype.search=function(e,t,n,r){throw new Error("please implement")};t.prototype.find=function(t,n,r){var i=e.prototype.findLocal.call(this,t,n,r);if(i){if(!this.filter(i)){return null}}return e.prototype.find.call(this,t,n,r)};return t}(u);e.FilteredSymbolScopeBuilder=f})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(t,n,r,s,o,u,a,f){if(t!==undefined){e.tokenTable[t]=new i(t,n,r,s,o,u,a,f);if(s!=e.NodeType.None){e.nodeTypeTable[s]=a;e.nodeTypeToTokTable[s]=t}if(u!=e.NodeType.None){e.nodeTypeTable[u]=a}}}function o(t){return e.tokenTable[t]}function m(){for(var n=0;n<=t.LimFixed;n++){e.staticTokens[n]=new f(n)}}(function(e){e._map=[];e._map[0]="Any";e.Any=0;e._map[1]="Bool";e.Bool=1;e._map[2]="Break";e.Break=2;e._map[3]="Case";e.Case=3;e._map[4]="Catch";e.Catch=4;e._map[5]="Class";e.Class=5;e._map[6]="Const";e.Const=6;e._map[7]="Continue";e.Continue=7;e._map[8]="Debugger";e.Debugger=8;e._map[9]="Default";e.Default=9;e._map[10]="Delete";e.Delete=10;e._map[11]="Do";e.Do=11;e._map[12]="Else";e.Else=12;e._map[13]="Enum";e.Enum=13;e._map[14]="Export";e.Export=14;e._map[15]="Extends";e.Extends=15;e._map[16]="Declare";e.Declare=16;e._map[17]="False";e.False=17;e._map[18]="Finally";e.Finally=18;e._map[19]="For";e.For=19;e._map[20]="Function";e.Function=20;e._map[21]="Constructor";e.Constructor=21;e._map[22]="Get";e.Get=22;e._map[23]="If";e.If=23;e._map[24]="Implements";e.Implements=24;e._map[25]="Import";e.Import=25;e._map[26]="In";e.In=26;e._map[27]="InstanceOf";e.InstanceOf=27;e._map[28]="Interface";e.Interface=28;e._map[29]="Let";e.Let=29;e._map[30]="Module";e.Module=30;e._map[31]="New";e.New=31;e._map[32]="Number";e.Number=32;e._map[33]="Null";e.Null=33;e._map[34]="Package";e.Package=34;e._map[35]="Private";e.Private=35;e._map[36]="Protected";e.Protected=36;e._map[37]="Public";e.Public=37;e._map[38]="Return";e.Return=38;e._map[39]="Set";e.Set=39;e._map[40]="Static";e.Static=40;e._map[41]="String";e.String=41;e._map[42]="Super";e.Super=42;e._map[43]="Switch";e.Switch=43;e._map[44]="This";e.This=44;e._map[45]="Throw";e.Throw=45;e._map[46]="True";e.True=46;e._map[47]="Try";e.Try=47;e._map[48]="TypeOf";e.TypeOf=48;e._map[49]="Var";e.Var=49;e._map[50]="Void";e.Void=50;e._map[51]="With";e.With=51;e._map[52]="While";e.While=52;e._map[53]="Yield";e.Yield=53;e._map[54]="Semicolon";e.Semicolon=54;e._map[55]="OpenParen";e.OpenParen=55;e._map[56]="CloseParen";e.CloseParen=56;e._map[57]="OpenBracket";e.OpenBracket=57;e._map[58]="CloseBracket";e.CloseBracket=58;e._map[59]="OpenBrace";e.OpenBrace=59;e._map[60]="CloseBrace";e.CloseBrace=60;e._map[61]="Comma";e.Comma=61;e._map[62]="Equals";e.Equals=62;e._map[63]="PlusEquals";e.PlusEquals=63;e._map[64]="MinusEquals";e.MinusEquals=64;e._map[65]="AsteriskEquals";e.AsteriskEquals=65;e._map[66]="SlashEquals";e.SlashEquals=66;e._map[67]="PercentEquals";e.PercentEquals=67;e._map[68]="AmpersandEquals";e.AmpersandEquals=68;e._map[69]="CaretEquals";e.CaretEquals=69;e._map[70]="BarEquals";e.BarEquals=70;e._map[71]="LessThanLessThanEquals";e.LessThanLessThanEquals=71;e._map[72]="GreaterThanGreaterThanEquals";e.GreaterThanGreaterThanEquals=72;e._map[73]="GreaterThanGreaterThanGreaterThanEquals";e.GreaterThanGreaterThanGreaterThanEquals=73;e._map[74]="Question";e.Question=74;e._map[75]="Colon";e.Colon=75;e._map[76]="BarBar";e.BarBar=76;e._map[77]="AmpersandAmpersand";e.AmpersandAmpersand=77;e._map[78]="Bar";e.Bar=78;e._map[79]="Caret";e.Caret=79;e._map[80]="And";e.And=80;e._map[81]="EqualsEquals";e.EqualsEquals=81;e._map[82]="ExclamationEquals";e.ExclamationEquals=82;e._map[83]="EqualsEqualsEquals";e.EqualsEqualsEquals=83;e._map[84]="ExclamationEqualsEquals";e.ExclamationEqualsEquals=84;e._map[85]="LessThan";e.LessThan=85;e._map[86]="LessThanEquals";e.LessThanEquals=86;e._map[87]="GreaterThan";e.GreaterThan=87;e._map[88]="GreaterThanEquals";e.GreaterThanEquals=88;e._map[89]="LessThanLessThan";e.LessThanLessThan=89;e._map[90]="GreaterThanGreaterThan";e.GreaterThanGreaterThan=90;e._map[91]="GreaterThanGreaterThanGreaterThan";e.GreaterThanGreaterThanGreaterThan=91;e._map[92]="Plus";e.Plus=92;e._map[93]="Minus";e.Minus=93;e._map[94]="Asterisk";e.Asterisk=94;e._map[95]="Slash";e.Slash=95;e._map[96]="Percent";e.Percent=96;e._map[97]="Tilde";e.Tilde=97;e._map[98]="Exclamation";e.Exclamation=98;e._map[99]="PlusPlus";e.PlusPlus=99;e._map[100]="MinusMinus";e.MinusMinus=100;e._map[101]="Dot";e.Dot=101;e._map[102]="DotDotDot";e.DotDotDot=102;e._map[103]="Error";e.Error=103;e._map[104]="EndOfFile";e.EndOfFile=104;e._map[105]="EqualsGreaterThan";e.EqualsGreaterThan=105;e._map[106]="Identifier";e.Identifier=106;e._map[107]="StringLiteral";e.StringLiteral=107;e._map[108]="RegularExpressionLiteral";e.RegularExpressionLiteral=108;e._map[109]="NumberLiteral";e.NumberLiteral=109;e._map[110]="Whitespace";e.Whitespace=110;e._map[111]="Comment";e.Comment=111;e._map[112]="Lim";e.Lim=112;e.LimFixed=e.EqualsGreaterThan;e.LimKeyword=e.Yield})(e.TokenID||(e.TokenID={}));var t=e.TokenID;e.tokenTable=new Array;e.nodeTypeTable=new Array;e.nodeTypeToTokTable=new Array;e.noRegexTable=new Array;e.noRegexTable[t.Identifier]=true;e.noRegexTable[t.StringLiteral]=true;e.noRegexTable[t.NumberLiteral]=true;e.noRegexTable[t.RegularExpressionLiteral]=true;e.noRegexTable[t.This]=true;e.noRegexTable[t.PlusPlus]=true;e.noRegexTable[t.MinusMinus]=true;e.noRegexTable[t.CloseParen]=true;e.noRegexTable[t.CloseBracket]=true;e.noRegexTable[t.CloseBrace]=true;e.noRegexTable[t.True]=true;e.noRegexTable[t.False]=true;(function(e){e._map=[];e._map[0]="None";e.None=0;e._map[1]="Comma";e.Comma=1;e._map[2]="Assignment";e.Assignment=2;e._map[3]="Conditional";e.Conditional=3;e._map[4]="LogicalOr";e.LogicalOr=4;e._map[5]="LogicalAnd";e.LogicalAnd=5;e._map[6]="BitwiseOr";e.BitwiseOr=6;e._map[7]="BitwiseExclusiveOr";e.BitwiseExclusiveOr=7;e._map[8]="BitwiseAnd";e.BitwiseAnd=8;e._map[9]="Equality";e.Equality=9;e._map[10]="Relational";e.Relational=10;e._map[11]="Shift";e.Shift=11;e._map[12]="Additive";e.Additive=12;e._map[13]="Multiplicative";e.Multiplicative=13;e._map[14]="Unary";e.Unary=14;e._map[15]="Lim";e.Lim=15})(e.OperatorPrecedence||(e.OperatorPrecedence={}));var n=e.OperatorPrecedence;(function(e){e._map=[];e.None=0;e.Javascript=1;e.JavascriptFuture=2;e.TypeScript=4;e.JavascriptFutureStrict=8;e.TypeScriptAndJS=e.Javascript|e.TypeScript;e.TypeScriptAndJSFuture=e.JavascriptFuture|e.TypeScript;e.TypeScriptAndJSFutureStrict=e.JavascriptFutureStrict|e.TypeScript})(e.Reservation||(e.Reservation={}));var r=e.Reservation;var i=function(){function e(e,t,n,r,i,s,o,u){this.tokenId=e;this.reservation=t;this.binopPrecedence=n;this.binopNodeType=r;this.unopPrecedence=i;this.unopNodeType=s;this.text=o;this.ers=u}return e}();e.TokenInfo=i;s(t.Any,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"any",e.ErrorRecoverySet.PrimType);s(t.Bool,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"bool",e.ErrorRecoverySet.PrimType);s(t.Break,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"break",e.ErrorRecoverySet.Stmt);s(t.Case,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"case",e.ErrorRecoverySet.SCase);s(t.Catch,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"catch",e.ErrorRecoverySet.Catch);s(t.Class,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"class",e.ErrorRecoverySet.TypeScriptS);s(t.Const,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"const",e.ErrorRecoverySet.Var);s(t.Continue,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"continue",e.ErrorRecoverySet.Stmt);s(t.Debugger,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.Debugger,"debugger",e.ErrorRecoverySet.Stmt);s(t.Default,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"default",e.ErrorRecoverySet.SCase);s(t.Delete,r.TypeScriptAndJS,n.None,e.NodeType.None,n.Unary,e.NodeType.Delete,"delete",e.ErrorRecoverySet.Prefix);s(t.Do,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"do",e.ErrorRecoverySet.Stmt);s(t.Else,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"else",e.ErrorRecoverySet.Else);s(t.Enum,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"enum",e.ErrorRecoverySet.TypeScriptS);s(t.Export,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"export",e.ErrorRecoverySet.TypeScriptS);s(t.Extends,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"extends",e.ErrorRecoverySet.None);s(t.Declare,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"declare",e.ErrorRecoverySet.Stmt);s(t.False,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"false",e.ErrorRecoverySet.RLit);s(t.Finally,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"finally",e.ErrorRecoverySet.Catch);s(t.For,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"for",e.ErrorRecoverySet.Stmt);s(t.Function,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"function",e.ErrorRecoverySet.Func);s(t.Constructor,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"constructor",e.ErrorRecoverySet.Func);s(t.Get,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"get",e.ErrorRecoverySet.Func);s(t.Set,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"set",e.ErrorRecoverySet.Func);s(t.If,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"if",e.ErrorRecoverySet.Stmt);s(t.Implements,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"implements",e.ErrorRecoverySet.None);s(t.Import,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"import",e.ErrorRecoverySet.TypeScriptS);s(t.In,r.TypeScriptAndJS,n.Relational,e.NodeType.In,n.None,e.NodeType.None,"in",e.ErrorRecoverySet.None);s(t.InstanceOf,r.TypeScriptAndJS,n.Relational,e.NodeType.InstOf,n.None,e.NodeType.None,"instanceof",e.ErrorRecoverySet.BinOp);s(t.Interface,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"interface",e.ErrorRecoverySet.TypeScriptS);s(t.Let,r.JavascriptFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"let",e.ErrorRecoverySet.None);s(t.Module,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"module",e.ErrorRecoverySet.TypeScriptS);s(t.New,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"new",e.ErrorRecoverySet.PreOp);s(t.Number,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"number",e.ErrorRecoverySet.PrimType);s(t.Null,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"null",e.ErrorRecoverySet.RLit);s(t.Package,r.JavascriptFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"package",e.ErrorRecoverySet.None);s(t.Private,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"private",e.ErrorRecoverySet.TypeScriptS);s(t.Protected,r.JavascriptFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"protected",e.ErrorRecoverySet.None);s(t.Public,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"public",e.ErrorRecoverySet.TypeScriptS);s(t.Return,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"return",e.ErrorRecoverySet.Stmt);s(t.Static,r.TypeScriptAndJSFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"static",e.ErrorRecoverySet.None);s(t.String,r.TypeScript,n.None,e.NodeType.None,n.None,e.NodeType.None,"string",e.ErrorRecoverySet.PrimType);s(t.Super,r.TypeScriptAndJSFuture,n.None,e.NodeType.None,n.None,e.NodeType.None,"super",e.ErrorRecoverySet.RLit);s(t.Switch,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"switch",e.ErrorRecoverySet.Stmt);s(t.This,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"this",e.ErrorRecoverySet.RLit);s(t.Throw,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"throw",e.ErrorRecoverySet.Stmt);s(t.True,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"true",e.ErrorRecoverySet.RLit);s(t.Try,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"try",e.ErrorRecoverySet.Stmt);s(t.TypeOf,r.TypeScriptAndJS,n.None,e.NodeType.None,n.Unary,e.NodeType.Typeof,"typeof",e.ErrorRecoverySet.Prefix);s(t.Var,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"var",e.ErrorRecoverySet.Var);s(t.Void,r.TypeScriptAndJS,n.None,e.NodeType.None,n.Unary,e.NodeType.Void,"void",e.ErrorRecoverySet.Prefix);s(t.With,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.With,"with",e.ErrorRecoverySet.Stmt);s(t.While,r.TypeScriptAndJS,n.None,e.NodeType.None,n.None,e.NodeType.None,"while",e.ErrorRecoverySet.While);s(t.Yield,r.JavascriptFutureStrict,n.None,e.NodeType.None,n.None,e.NodeType.None,"yield",e.ErrorRecoverySet.None);s(t.Identifier,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"identifier",e.ErrorRecoverySet.ID);s(t.NumberLiteral,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"numberLiteral",e.ErrorRecoverySet.Literal);s(t.RegularExpressionLiteral,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"regex",e.ErrorRecoverySet.RegExp);s(t.StringLiteral,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"qstring",e.ErrorRecoverySet.Literal);s(t.Semicolon,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,";",e.ErrorRecoverySet.SColon);s(t.CloseParen,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,")",e.ErrorRecoverySet.RParen);s(t.CloseBracket,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"]",e.ErrorRecoverySet.RBrack);s(t.OpenBrace,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"{",e.ErrorRecoverySet.LCurly);s(t.CloseBrace,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"}",e.ErrorRecoverySet.RCurly);s(t.DotDotDot,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"...",e.ErrorRecoverySet.None);s(t.Comma,r.None,n.Comma,e.NodeType.Comma,n.None,e.NodeType.None,",",e.ErrorRecoverySet.Comma);s(t.Equals,r.None,n.Assignment,e.NodeType.Asg,n.None,e.NodeType.None,"=",e.ErrorRecoverySet.Asg);s(t.PlusEquals,r.None,n.Assignment,e.NodeType.AsgAdd,n.None,e.NodeType.None,"+=",e.ErrorRecoverySet.BinOp);s(t.MinusEquals,r.None,n.Assignment,e.NodeType.AsgSub,n.None,e.NodeType.None,"-=",e.ErrorRecoverySet.BinOp);s(t.AsteriskEquals,r.None,n.Assignment,e.NodeType.AsgMul,n.None,e.NodeType.None,"*=",e.ErrorRecoverySet.BinOp);s(t.SlashEquals,r.None,n.Assignment,e.NodeType.AsgDiv,n.None,e.NodeType.None,"/=",e.ErrorRecoverySet.BinOp);s(t.PercentEquals,r.None,n.Assignment,e.NodeType.AsgMod,n.None,e.NodeType.None,"%=",e.ErrorRecoverySet.BinOp);s(t.AmpersandEquals,r.None,n.Assignment,e.NodeType.AsgAnd,n.None,e.NodeType.None,"&=",e.ErrorRecoverySet.BinOp);s(t.CaretEquals,r.None,n.Assignment,e.NodeType.AsgXor,n.None,e.NodeType.None,"^=",e.ErrorRecoverySet.BinOp);s(t.BarEquals,r.None,n.Assignment,e.NodeType.AsgOr,n.None,e.NodeType.None,"|=",e.ErrorRecoverySet.BinOp);s(t.LessThanLessThanEquals,r.None,n.Assignment,e.NodeType.AsgLsh,n.None,e.NodeType.None,"<<=",e.ErrorRecoverySet.BinOp);s(t.GreaterThanGreaterThanEquals,r.None,n.Assignment,e.NodeType.AsgRsh,n.None,e.NodeType.None,">>=",e.ErrorRecoverySet.BinOp);s(t.GreaterThanGreaterThanGreaterThanEquals,r.None,n.Assignment,e.NodeType.AsgRs2,n.None,e.NodeType.None,">>>=",e.ErrorRecoverySet.BinOp);s(t.Question,r.None,n.Conditional,e.NodeType.ConditionalExpression,n.None,e.NodeType.None,"?",e.ErrorRecoverySet.BinOp);s(t.Colon,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,":",e.ErrorRecoverySet.Colon);s(t.BarBar,r.None,n.LogicalOr,e.NodeType.LogOr,n.None,e.NodeType.None,"||",e.ErrorRecoverySet.BinOp);s(t.AmpersandAmpersand,r.None,n.LogicalAnd,e.NodeType.LogAnd,n.None,e.NodeType.None,"&&",e.ErrorRecoverySet.BinOp);s(t.Bar,r.None,n.BitwiseOr,e.NodeType.Or,n.None,e.NodeType.None,"|",e.ErrorRecoverySet.BinOp);s(t.Caret,r.None,n.BitwiseExclusiveOr,e.NodeType.Xor,n.None,e.NodeType.None,"^",e.ErrorRecoverySet.BinOp);s(t.And,r.None,n.BitwiseAnd,e.NodeType.And,n.None,e.NodeType.None,"&",e.ErrorRecoverySet.BinOp);s(t.EqualsEquals,r.None,n.Equality,e.NodeType.Eq,n.None,e.NodeType.None,"==",e.ErrorRecoverySet.BinOp);s(t.ExclamationEquals,r.None,n.Equality,e.NodeType.Ne,n.None,e.NodeType.None,"!=",e.ErrorRecoverySet.BinOp);s(t.EqualsEqualsEquals,r.None,n.Equality,e.NodeType.Eqv,n.None,e.NodeType.None,"===",e.ErrorRecoverySet.BinOp);s(t.ExclamationEqualsEquals,r.None,n.Equality,e.NodeType.NEqv,n.None,e.NodeType.None,"!==",e.ErrorRecoverySet.BinOp);s(t.LessThan,r.None,n.Relational,e.NodeType.Lt,n.None,e.NodeType.None,"<",e.ErrorRecoverySet.BinOp);s(t.LessThanEquals,r.None,n.Relational,e.NodeType.Le,n.None,e.NodeType.None,"<=",e.ErrorRecoverySet.BinOp);s(t.GreaterThan,r.None,n.Relational,e.NodeType.Gt,n.None,e.NodeType.None,">",e.ErrorRecoverySet.BinOp);s(t.GreaterThanEquals,r.None,n.Relational,e.NodeType.Ge,n.None,e.NodeType.None,">=",e.ErrorRecoverySet.BinOp);s(t.LessThanLessThan,r.None,n.Shift,e.NodeType.Lsh,n.None,e.NodeType.None,"<<",e.ErrorRecoverySet.BinOp);s(t.GreaterThanGreaterThan,r.None,n.Shift,e.NodeType.Rsh,n.None,e.NodeType.None,">>",e.ErrorRecoverySet.BinOp);s(t.GreaterThanGreaterThanGreaterThan,r.None,n.Shift,e.NodeType.Rs2,n.None,e.NodeType.None,">>>",e.ErrorRecoverySet.BinOp);s(t.Plus,r.None,n.Additive,e.NodeType.Add,n.Unary,e.NodeType.Pos,"+",e.ErrorRecoverySet.AddOp);s(t.Minus,r.None,n.Additive,e.NodeType.Sub,n.Unary,e.NodeType.Neg,"-",e.ErrorRecoverySet.AddOp);s(t.Asterisk,r.None,n.Multiplicative,e.NodeType.Mul,n.None,e.NodeType.None,"*",e.ErrorRecoverySet.BinOp);s(t.Slash,r.None,n.Multiplicative,e.NodeType.Div,n.None,e.NodeType.None,"/",e.ErrorRecoverySet.BinOp);s(t.Percent,r.None,n.Multiplicative,e.NodeType.Mod,n.None,e.NodeType.None,"%",e.ErrorRecoverySet.BinOp);s(t.Tilde,r.None,n.None,e.NodeType.None,n.Unary,e.NodeType.Not,"~",e.ErrorRecoverySet.PreOp);s(t.Exclamation,r.None,n.None,e.NodeType.None,n.Unary,e.NodeType.LogNot,"!",e.ErrorRecoverySet.PreOp);s(t.PlusPlus,r.None,n.None,e.NodeType.None,n.Unary,e.NodeType.IncPre,"++",e.ErrorRecoverySet.PreOp);s(t.MinusMinus,r.None,n.None,e.NodeType.None,n.Unary,e.NodeType.DecPre,"--",e.ErrorRecoverySet.PreOp);s(t.OpenParen,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"(",e.ErrorRecoverySet.LParen);s(t.OpenBracket,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"[",e.ErrorRecoverySet.LBrack);s(t.Dot,r.None,n.Unary,e.NodeType.None,n.None,e.NodeType.None,".",e.ErrorRecoverySet.Dot);s(t.EndOfFile,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"<EOF>",e.ErrorRecoverySet.EOF);s(t.EqualsGreaterThan,r.None,n.None,e.NodeType.None,n.None,e.NodeType.None,"=>",e.ErrorRecoverySet.None);e.lookupToken=o;(function(e){e._map=[];e._map[0]="Punctuation";e.Punctuation=0;e._map[1]="Keyword";e.Keyword=1;e._map[2]="Operator";e.Operator=2;e._map[3]="Comment";e.Comment=3;e._map[4]="Whitespace";e.Whitespace=4;e._map[5]="Identifier";e.Identifier=5;e._map[6]="Literal";e.Literal=6})(e.TokenClass||(e.TokenClass={}));var u=e.TokenClass;var a=function(){function e(e,t,n){this.tok=e;this.minChar=t;this.limChar=n}return e}();e.SavedToken=a;var f=function(){function n(e){this.tokenId=e}n.prototype.toString=function(){return"token: "+this.tokenId+" "+this.getText()+" ("+t._map[this.tokenId]+")"};n.prototype.print=function(e,t){t.WriteLine(this.toString()+",on line"+e)};n.prototype.getText=function(){return e.tokenTable[this.tokenId].text};n.prototype.classification=function(){if(this.tokenId<=t.LimKeyword){return u.Keyword}else{var n=o(this.tokenId);if(n!=undefined){if(n.unopNodeType!=e.NodeType.None||n.binopNodeType!=e.NodeType.None){return u.Operator}}}return u.Punctuation};return n}();e.Token=f;var l=function(e){function n(n,r){e.call(this,t.NumberLiteral);this.value=n;this.hasEmptyFraction=r}__extends(n,e);n.prototype.getText=function(){return this.hasEmptyFraction?this.value.toString()+".0":this.value.toString()};n.prototype.classification=function(){return u.Literal};return n}(f);e.NumberLiteralToken=l;var c=function(e){function n(n){e.call(this,t.StringLiteral);this.value=n}__extends(n,e);n.prototype.getText=function(){return this.value};n.prototype.classification=function(){return u.Literal};return n}(f);e.StringLiteralToken=c;var h=function(e){function n(n,r){e.call(this,t.Identifier);this.value=n;this.hasEscapeSequence=r}__extends(n,e);n.prototype.getText=function(){return this.value};n.prototype.classification=function(){return u.Identifier};return n}(f);e.IdentifierToken=h;var p=function(e){function t(t,n){e.call(this,t);this.value=n}__extends(t,e);t.prototype.getText=function(){return this.value};t.prototype.classification=function(){return u.Whitespace};return t}(f);e.WhitespaceToken=p;var d=function(e){function t(t,n,r,i,s,o){e.call(this,t);this.value=n;this.isBlock=r;this.startPos=i;this.line=s;this.endsLine=o}__extends(t,e);t.prototype.getText=function(){return this.value};t.prototype.classification=function(){return u.Comment};return t}(f);e.CommentToken=d;var v=function(e){function n(n){e.call(this,t.RegularExpressionLiteral);this.regex=n}__extends(n,e);n.prototype.getText=function(){return this.regex.toString()};n.prototype.classification=function(){return u.Literal};return n}(f);e.RegularExpressionLiteralToken=v;e.staticTokens=new Array;e.initializeStaticTokens=m})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(){this.arrayBase=null}e.prototype.specialize=function(e,t){if(this.arrayBase==null){this.arrayBase=e.specializeType(t.wildElm.type,this.arrayType.elementType,t,true)}return this.arrayBase};return e}();e.ArrayCache=t;var n=function(){function t(){this.onlyCaptureFirstError=false;this.flags=e.TypeRelationshipFlags.SuccessfulComparison;this.message=""}t.prototype.addMessageToFront=function(e){if(!this.onlyCaptureFirstError){this.message=this.message?e+":\n	"+this.message:e}else{this.setMessage(e)}};t.prototype.setMessage=function(e){this.message=e};return t}();e.TypeComparisonInfo=n;(function(e){e._map=[];e._map[0]="Resident";e.Resident=0;e._map[1]="Transient";e.Transient=1})(e.TypeCheckCollectionMode||(e.TypeCheckCollectionMode={}));var r=e.TypeCheckCollectionMode;var i=function(){function t(t){this.errorReporter=t;this.importedGlobalsTable=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));this.importedGlobalsTypeTable=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));this.globals=null;this.globalTypes=null;this.ambientGlobals=null;this.ambientGlobalTypes=null;this.residentGlobalValues=new e.StringHashTable;this.residentGlobalTypes=new e.StringHashTable;this.residentGlobalAmbientValues=new e.StringHashTable;this.residentGlobalAmbientTypes=new e.StringHashTable;this.residentTypeCheck=true;this.mod=null;this.gloMod=null;this.wildElm=null;this.importedGlobals=new e.SymbolScopeBuilder(null,this.importedGlobalsTable,null,this.importedGlobalsTypeTable,null,null);this.dualGlobalValues=new e.DualStringHashTable(this.residentGlobalValues,new e.StringHashTable);this.dualGlobalTypes=new e.DualStringHashTable(this.residentGlobalTypes,new e.StringHashTable);this.dualAmbientGlobalValues=new e.DualStringHashTable(this.residentGlobalAmbientValues,new e.StringHashTable);this.dualAmbientGlobalTypes=new e.DualStringHashTable(this.residentGlobalAmbientTypes,new e.StringHashTable);var n=new e.ScopedMembers(new e.DualStringHashTable(this.dualGlobalValues,new e.StringHashTable));var i=new e.ScopedMembers(new e.DualStringHashTable(this.dualAmbientGlobalValues,new e.StringHashTable));var s=new e.ScopedMembers(new e.DualStringHashTable(this.dualGlobalTypes,new e.StringHashTable));var o=new e.ScopedMembers(new e.DualStringHashTable(this.dualAmbientGlobalTypes,new e.StringHashTable));this.globalScope=new e.SymbolScopeBuilder(n,i,s,o,this.importedGlobals,null);this.voidType=this.enterPrimitive(e.Primitive.Void,"void");this.booleanType=this.enterPrimitive(e.Primitive.Boolean,"bool");this.doubleType=this.enterPrimitive(e.Primitive.Double,"number");this.importedGlobals.ambientEnclosedTypes.addPublicMember("number",this.doubleType.symbol);this.stringType=this.enterPrimitive(e.Primitive.String,"string");this.anyType=this.enterPrimitive(e.Primitive.Any,"any");this.nullType=this.enterPrimitive(e.Primitive.Null,"null");this.undefinedType=this.enterPrimitive(e.Primitive.Undefined,"undefined");this.setCollectionMode(r.Resident);this.wildElm=new e.TypeSymbol("_element",0,-1,new e.Type);this.importedGlobalsTypeTable.addPublicMember(this.wildElm.name,this.wildElm);this.mod=new e.ModuleType(s,o);this.mod.members=n;this.mod.ambientMembers=i;this.mod.containedScope=this.globalScope;this.gloMod=new e.TypeSymbol(e.globalId,0,-1,this.mod);this.mod.members.addPublicMember(this.gloMod.name,this.gloMod);this.defineGlobalValue("undefined",this.undefinedType)}t.prototype.enterPrimitive=function(t,n){var r=new e.Type;r.primitiveTypeClass=t;var i=new e.TypeSymbol(n,0,-1,r);i.typeCheckStatus=e.TypeCheckStatus.Finished;r.symbol=i;this.importedGlobals.enter(null,null,i,this.errorReporter,true,true,true);return r};t.prototype.setCollectionMode=function(e){this.residentTypeCheck=this.dualGlobalValues.insertPrimary=this.dualGlobalTypes.insertPrimary=this.dualAmbientGlobalValues.insertPrimary=this.dualAmbientGlobalTypes.insertPrimary=e==r.Resident};t.prototype.refreshPersistentState=function(){this.globals=new e.StringHashTable;this.globalTypes=new e.StringHashTable;this.ambientGlobals=new e.StringHashTable;this.ambientGlobalTypes=new e.StringHashTable;this.globalTypes.add(this.voidType.symbol.name,this.voidType.symbol);this.globalTypes.add(this.booleanType.symbol.name,this.booleanType.symbol);this.globalTypes.add(this.doubleType.symbol.name,this.doubleType.symbol);this.globalTypes.add("number",this.doubleType.symbol);this.globalTypes.add(this.stringType.symbol.name,this.stringType.symbol);this.globalTypes.add(this.anyType.symbol.name,this.anyType.symbol);this.globalTypes.add(this.nullType.symbol.name,this.nullType.symbol);this.globalTypes.add(this.undefinedType.symbol.name,this.undefinedType.symbol);this.dualGlobalValues.secondaryTable=this.globals;this.dualGlobalTypes.secondaryTable=this.globalTypes;this.dualAmbientGlobalValues.secondaryTable=this.ambientGlobals;this.dualAmbientGlobalTypes.secondaryTable=this.ambientGlobalTypes};t.prototype.defineGlobalValue=function(t,n){var r=new e.ValueLocation;r.typeLink=new e.TypeLink;var i=new e.VariableSymbol(t,0,-1,r);i.setType(n);i.typeCheckStatus=e.TypeCheckStatus.Finished;i.container=this.gloMod;this.importedGlobalsTable.addPublicMember(t,i)};return t}();e.PersistentGlobalTypeState=i;var s=function(){function e(e,t,n){this.contextualType=e;this.provisional=t;this.contextID=n;this.targetSig=null;this.targetThis=null;this.targetAccessorType=null}return e}();e.ContextualTypeContext=s;var o=function(){function t(e){this.checker=e;this.contextStack=[];this.hadProvisionalErrors=false}t.contextID=e.TypeCheckStatus.Finished+1;t.prototype.pushContextualType=function(e,n){this.contextStack.push(new s(e,n,t.contextID++));this.checker.errorReporter.pushToErrorSink=n};t.prototype.popContextualType=function(){var e=this.contextStack.pop();this.checker.errorReporter.pushToErrorSink=this.isProvisional();this.hadProvisionalErrors=this.hadProvisionalErrors||e.provisional&&this.checker.errorReporter.getCapturedErrors().length;this.checker.errorReporter.freeCapturedErrors();return e};t.prototype.getContextualType=function(){return!this.contextStack.length?null:this.contextStack[this.contextStack.length-1]};t.prototype.getContextID=function(){return!this.contextStack.length?e.TypeCheckStatus.Finished:this.contextStack[this.contextStack.length-1].contextID};t.prototype.isProvisional=function(){return!this.contextStack.length?false:this.contextStack[this.contextStack.length-1].provisional};return t}();e.ContextualTypingContextStack=o;var u=function(){function n(e){this.persistentState=e;this.errorReporter=null;this.checkControlFlow=false;this.printControlFlowGraph=false;this.checkControlFlowUseDef=false;this.styleSettings=null;this.units=null;this.anon="_anonymous";this.locationInfo=null;this.typeFlow=null;this.currentCompareA=null;this.currentCompareB=null;this.currentModDecl=null;this.inBind=false;this.inWith=false;this.errorsOnWith=true;this.currentContextualTypeContext=null;this.resolvingBases=false;this.canCallDefinitionSignature=false;this.assignableCache={};this.subtypeCache={};this.identicalCache={};this.provisionalStartedTypecheckObjects=[];this.mustCaptureGlobalThis=false;this.voidType=this.persistentState.voidType;this.booleanType=this.persistentState.booleanType;this.numberType=this.persistentState.doubleType;this.stringType=this.persistentState.stringType;this.anyType=this.persistentState.anyType;this.nullType=this.persistentState.nullType;this.undefinedType=this.persistentState.undefinedType;this.globals=this.persistentState.dualGlobalValues;this.globalTypes=this.persistentState.dualGlobalTypes;this.ambientGlobals=this.persistentState.dualAmbientGlobalValues;this.ambientGlobalTypes=this.persistentState.dualAmbientGlobalTypes;this.gloModType=this.persistentState.mod;this.gloMod=this.persistentState.gloMod;this.wildElm=this.persistentState.wildElm;this.globalScope=this.persistentState.globalScope;this.typingContextStack=new o(this)}n.prototype.setStyleOptions=function(e){this.styleSettings=e};n.prototype.setContextualType=function(e,t){this.typingContextStack.pushContextualType(e,t);this.currentContextualTypeContext=this.typingContextStack.getContextualType()};n.prototype.unsetContextualType=function(){var e=this.typingContextStack.popContextualType();this.currentContextualTypeContext=this.typingContextStack.getContextualType();return e};n.prototype.hadProvisionalErrors=function(){return this.typingContextStack.hadProvisionalErrors};n.prototype.resetProvisionalErrors=function(){if(!this.typingContextStack.getContextualType()){this.typingContextStack.hadProvisionalErrors=false}};n.prototype.typeCheckWithContextualType=function(e,t,n,r){if(n){this.setContextualType(e,this.typingContextStack.isProvisional()||t)}this.typeFlow.typeCheck(r);if(n){this.unsetContextualType()}};n.prototype.resetTargetType=function(){this.currentContextualTypeContext=this.typingContextStack.getContextualType()};n.prototype.killCurrentContextualType=function(){this.currentContextualTypeContext=null;this.errorReporter.pushToErrorSink=false};n.prototype.hasTargetType=function(){return this.currentContextualTypeContext&&this.currentContextualTypeContext.contextualType};n.prototype.getTargetTypeContext=function(){return this.currentContextualTypeContext};n.prototype.inProvisionalTypecheckMode=function(){return this.typingContextStack.isProvisional()};n.prototype.getTypeCheckFinishedStatus=function(){if(this.inProvisionalTypecheckMode()){return this.typingContextStack.getContextID()}return e.TypeCheckStatus.Finished};n.prototype.typeStatusIsFinished=function(t){return t==e.TypeCheckStatus.Finished||this.inProvisionalTypecheckMode()&&t==this.typingContextStack.getContextID()};n.prototype.addStartedPTO=function(e){if(this.inProvisionalTypecheckMode()){this.provisionalStartedTypecheckObjects[this.provisionalStartedTypecheckObjects.length]=e}};n.prototype.cleanStartedPTO=function(){for(var t=0;t<this.provisionalStartedTypecheckObjects.length;t++){if(this.provisionalStartedTypecheckObjects[t].typeCheckStatus==this.typingContextStack.getContextID()){this.provisionalStartedTypecheckObjects[t].typeCheckStatus=e.TypeCheckStatus.NotStarted}}this.provisionalStartedTypecheckObjects=[]};n.prototype.collectTypes=function(t){if(t.nodeType==e.NodeType.Script){var n=t;this.locationInfo=n.locationInfo}var r=new e.ScopeChain(this.gloMod,null,this.globalScope);var i=new e.TypeCollectionContext(r,this);e.getAstWalkerFactory().walk(t,e.preCollectTypes,e.postCollectTypes,null,i)};n.prototype.makeArrayType=function(n){if(n.arrayCache==null){n.arrayCache=new t;n.arrayCache.arrayType=new e.Type;n.arrayCache.arrayType.elementType=n;n.arrayCache.arrayType.symbol=n.symbol}return n.arrayCache.arrayType};n.prototype.getParameterList=function(t,n){var r=null;var i=null;var s=t.members.length;var o=0;var u=[];if(s>0){r=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));i=new e.SymbolScopeBuilder(r,null,null,null,null,n);for(var a=0;a<s;a++){var f=t.members[a];var l=new e.ValueLocation;var c=new e.ParameterSymbol(f.id.text,f.minChar,this.locationInfo.unitIndex,l);c.declAST=f;f.id.sym=c;f.sym=c;l.symbol=c;l.typeLink=e.getTypeLink(f.typeExpr,this,false);i.enter(null,f,c,this.errorReporter,true,false,false);u[u.length]=c;if(!f.isOptionalArg()){o++}}}return{parameters:u,nonOptionalParameterCount:o}};n.prototype.createFunctionSignature=function(t,n,r,i,s){var o=e.hasFlag(t.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)||n==this.gloMod;var u=e.hasFlag(t.fncFlags,e.FncFlags.Static);var a=e.hasFlag(t.fncFlags,e.FncFlags.Private);var f=e.hasFlag(t.fncFlags,e.FncFlags.Definition);var l=e.hasFlag(t.fncFlags,e.FncFlags.Ambient);var c=t.isConstructMember()||t.isConstructor;var h=n==this.gloMod;var p=new e.Signature;var d=t.fncFlags&e.FncFlags.IsFunctionExpression;if(t.returnTypeAnnotation||f){p.returnType=e.getTypeLink(t.returnTypeAnnotation,this,false)}else{p.returnType=new e.TypeLink;p.returnType.type=this.anyType}p.hasVariableArgList=t.variableArgList;var v=this.getParameterList(t.arguments,n);p.parameters=v.parameters;p.nonOptionalParameterCount=v.nonOptionalParameterCount;t.signature=p;p.declAST=t;var m=i&&i.getType()&&!i.isAccessor()&&(t.isSignature()||l==e.hasFlag(i.flags,e.SymbolFlags.Ambient));if(m&&a!=e.hasFlag(i.flags,e.SymbolFlags.Private)){this.errorReporter.simpleError(t,"Public/Private visibility of overloads does not agree")}var g=m?i.getType():new e.Type;if(c){if(g.construct==null){g.construct=new e.SignatureGroup}g.construct.addSignature(p);g.construct.hasImplementation=!t.isSignature();if(g.construct.hasImplementation){g.setHasImplementation()}}else{if(t.isIndexerMember()){if(g.index==null){g.index=new e.SignatureGroup;g.index.flags|=e.SignatureFlags.IsIndexer}g.index.addSignature(p);g.index.hasImplementation=!t.isSignature();if(g.index.hasImplementation){g.setHasImplementation()}}else{if(g.call==null){g.call=new e.SignatureGroup}g.call.addSignature(p);g.call.hasImplementation=!t.isSignature();if(g.call.hasImplementation){g.setHasImplementation()}}}var y=g.instanceType;var b=null;var w=false;if(t.name&&!t.name.isMissing()){b=t.name.text}else{if(t.hint){b=t.hint;w=true}}if(g.symbol==null){g.symbol=new e.TypeSymbol(b?b:this.anon,t.minChar,this.locationInfo.unitIndex,g);if(!m){g.symbol.declAST=t}}if(u){g.symbol.flags|=e.SymbolFlags.Static}if(l){g.symbol.flags|=e.SymbolFlags.Ambient}if(a){g.symbol.flags|=e.SymbolFlags.Private}g.symbol.isMethod=t.isMethod();if(g.symbol.isMethod){g.symbol.flags|=e.SymbolFlags.Property}t.type=g;if(!c){if(b&&!d&&!t.isAccessor()&&!w){if(s){if(t.isMethod()&&u){if(!n.type.members.publicMembers.add(b,g.symbol)){this.errorReporter.duplicateIdentifier(t,b)}g.symbol.container=n}else{if(i==null||i.declAST&&!i.declAST.isOverload&&n.isType()){r.enter(n,t,g.symbol,this.errorReporter,!a&&(o||u||h),false,l)}}}else{if(!t.isSpecialFn()){g.symbol.container=n}}}else{if(!t.isSpecialFn()){g.symbol.container=n}}}if(m){var E=i?i.getType():null;var S=g;if(S!=E){if(S.construct==null){if(E&&E.construct){S.construct=E.construct}else{S.construct=new e.SignatureGroup}}else{if(E){if(E.construct){S.construct.signatures.concat(E.construct.signatures)}}}if(E){if(S.call==null){S.call=E.call}else{if(E.call){S.call.signatures.concat(E.call.signatures)}}if(!u){if(S.instanceType==null){S.instanceType=E.instanceType}var y=S.instanceType;if(y){if(y.call==null){y.call=E.call}else{if(E.call){y.call.signatures.concat(E.call.signatures)}}}}if(S.index==null){S.index=E.index}else{if(E.index){S.index.signatures.concat(E.index.signatures)}}}}}return p};n.prototype.createAccessorSymbol=function(t,n,r,i,s,o,u){var a=null;var f=t.signature;var l=t.name.text;var c=e.hasFlag(t.fncFlags,e.FncFlags.Static);var h=e.hasFlag(t.fncFlags,e.FncFlags.Private);if(n==null){var p=new e.ValueLocation;a=new e.FieldSymbol(l,t.minChar,this.locationInfo.unitIndex,false,p);p.symbol=a;a.declAST=t;if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)){if(a.getter){this.errorReporter.simpleError(t,"Redeclaration of property getter")}a.getter=f.declAST.type.symbol}else{if(a.setter){this.errorReporter.simpleError(t,"Redeclaration of property setter")}a.setter=f.declAST.type.symbol}p.typeLink=e.getTypeLink(null,this,false);if(i){if(r){if(!r.members.publicMembers.add(l,a)){this.errorReporter.duplicateIdentifier(t,a.name)}a.container=r.symbol}else{this.errorReporter.simpleError(t,"Accessor property may not be added in this context")}}else{o.enter(u,t,a,this.errorReporter,!h||c,false,false)}if(s){a.flags|=e.SymbolFlags.Property}if(c){a.flags|=e.SymbolFlags.Static}if(h){a.flags|=e.SymbolFlags.Private}else{a.flags|=e.SymbolFlags.Public}}else{a=n;if(h!=e.hasFlag(a.flags,e.SymbolFlags.Private)){this.errorReporter.simpleError(t,"Getter and setter accessors do not agree in visibility")}if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)){if(a.getter){this.errorReporter.simpleError(t,"Redeclaration of property getter")}a.getter=t.type.symbol}else{if(a.setter){this.errorReporter.simpleError(t,"Redeclaration of property setter")}a.setter=t.type.symbol}}return a};n.prototype.addBases=function(t,n,r){t.addParentScope(new e.SymbolTableScope(n.members,n.ambientMembers,n.getAllEnclosedTypes(),n.getAllAmbientEnclosedTypes(),n.symbol));var i=0;var s;if(n.extendsList){for(var o=n.extendsList.length;i<o;i++){s=n.extendsList[i];if(r.baseId==s.typeID){this.errorReporter.reportErrorFromSym(s.symbol,"Type '"+r.base+"' is recursively referenced as a base class of itself");s.symbol.flags|=e.SymbolFlags.RecursivelyReferenced;break}this.addBases(t,s,r)}}};n.prototype.scopeOf=function(t){var n=new e.SymbolAggregateScope(t.symbol);var r={base:t.symbol&&t.symbol.name?t.symbol.name:"{}",baseId:t.typeID};this.addBases(n,t,r);return n};n.prototype.lookupMemberType=function(e,t){var n=null;if(e.containedScope){n=e.containedScope.find(t,false,true)}else{if(e.members){n=e.members.allMembers.lookup(t);if(n==null&&e.ambientMembers){n=e.ambientMembers.allMembers.lookup(t)}}}if(n==null){var r=e.getAllEnclosedTypes();var i=e.getAllAmbientEnclosedTypes();if(r){n=r.allMembers.lookup(t);if(n==null&&i){n=i.allMembers.lookup(t)}}}if(n&&n.isType()){return n.getType()}else{return null}};n.prototype.findSymbolForDynamicModule=function(t,n,r){var i=t;var s=r(t);if(s==null){if(!s){t=e.swapQuotes(i);s=r(t)}if(!s){t=e.stripQuotes(i)+".ts";s=r(t)}if(!s){t=e.stripQuotes(i)+".str";s=r(t)}if(!s){t=e.stripQuotes(i)+".d.ts";s=r(t)}if(!s){t=e.stripQuotes(i)+".d.str";s=r(t)}if(!s&&!e.isRelative(i)){t=i;var o=e.stripQuotes(t);var u=e.getRootFilePath(e.switchToForwardSlashes(n));while(s==null&&u!=""){t=e.normalizePath(u+o+".ts");s=r(t);if(s==null){t=e.changePathToSTR(t);s=r(t)}if(s==null){t=e.changePathToDTS(t);s=r(t)}if(s==null){t=e.changePathToDSTR(t);s=r(t)}if(s==null){if(u==="/"){u=""}else{u=e.normalizePath(u+"..");u=u&&u!="/"?u+"/":u}}}}}return s};n.prototype.resolveTypeMember=function(t,n){var r=n.operand1;var i=n.operand2;var s=this.anyType;var o=this.anyType;if(r&&i&&i.nodeType==e.NodeType.Name){if(r.nodeType==e.NodeType.Dot){o=this.resolveTypeMember(t,r)}else{if(r.nodeType==e.NodeType.Name){var u=r;var a=t.find(u.text,false,true);if(a==null){this.errorReporter.unresolvedSymbol(u,u.actualText)}else{if(a.isType()){var f=a;if(f.aliasLink&&!f.type&&f.aliasLink.alias.nodeType==e.NodeType.Name){var l=f.aliasLink.alias.text;var c=this.findSymbolForDynamicModule(l,this.locationInfo.filename,function(e){return t.find(e,false,true)});if(c){f.type=c.getType()}}if(e.optimizeModuleCodeGen&&a){var h=a.getType();if(h&&f.aliasLink&&f.onlyReferencedAsTypeRef){var p=h.symbol.declAST;if(p&&e.hasFlag(p.modFlags,e.ModuleFlags.IsDynamic)){f.onlyReferencedAsTypeRef=!this.resolvingBases}}}if(!a.visible(t,this)){this.errorReporter.simpleError(r,"The symbol '"+u.actualText+"' is not visible at this point")}o=a.getType();u.sym=a}else{this.errorReporter.simpleError(r,"Expected type")}}}}if(!o){o=this.anyType}if(o!=this.anyType){var d=i;s=this.lookupMemberType(o,d.text);if(s==null){s=this.anyType;this.errorReporter.simpleError(n,"Expected type")}else{if(!s.symbol.visible(t,this)){this.errorReporter.simpleError(r,"The symbol '"+i.actualText+"' is not visible at this point")}}d.sym=s.symbol}}if(s.isClass()){s=s.instanceType}return s};n.prototype.resolveFuncDecl=function(e,t,n){var r=this.createFunctionSignature(e,t.container,t,n,false).declAST.type.symbol;var i;if(e.isConstructMember()){i=r.type.construct.signatures}else{if(e.isIndexerMember()){i=r.type.getInstanceType().index.signatures}else{i=r.type.call.signatures}}var s=i[i.length-1];var o=s.parameters.length;for(var u=0;u<o;u++){var a=s.parameters[u];this.resolveTypeLink(t,a.parameter.typeLink,true)}if(o&&e.variableArgList){if(!s.parameters[o-1].parameter.typeLink.type.elementType){this.errorReporter.simpleErrorFromSym(s.parameters[o-1].parameter.symbol,"... parameter must have array type");s.parameters[o-1].parameter.typeLink.type=this.makeArrayType(s.parameters[o-1].parameter.typeLink.type)}}this.resolveTypeLink(t,s.returnType,e.isSignature());return r};n.prototype.resolveVarDecl=function(t,n){var r=new e.ValueLocation;var i=new e.FieldSymbol(t.id.text,t.minChar,this.locationInfo.unitIndex,(t.varFlags&e.VarFlags.Readonly)==e.VarFlags.None,r);i.transferVarFlags(t.varFlags);r.symbol=i;i.declAST=t;r.typeLink=e.getTypeLink(t.typeExpr,this,t.init==null);this.resolveTypeLink(n,r.typeLink,true);t.sym=i;t.type=r.typeLink.type;return i};n.prototype.resolveTypeLink=function(t,n,r){var i=0;if(n.type==null){var s=n.ast;if(s){while(n.type==null){switch(s.nodeType){case e.NodeType.Name:{var o=s;var u=t.find(o.text,false,true);if(u==null){n.type=this.anyType;this.errorReporter.unresolvedSymbol(o,o.actualText)}else{if(u.isType()){if(!u.visible(t,this)){this.errorReporter.simpleError(s,"The symbol '"+o.actualText+"' is not visible at this point")}o.sym=u;n.type=u.getType();if(n.type){if(n.type.isClass()){n.type=n.type.instanceType}}else{n.type=this.anyType}}else{n.type=this.anyType;this.errorReporter.simpleError(s,"Expected type")}}break};case e.NodeType.Dot:{n.type=this.resolveTypeMember(t,s);break};case e.NodeType.TypeRef:{var a=s;i=a.arrayCount;s=a.term;if(s==null){n.type=this.anyType}break};case e.NodeType.InterfaceDeclaration:{var f=s;var l=new e.Type;var c=new e.TypeSymbol(f.name.text,s.minChar,this.locationInfo.unitIndex,l);l.symbol=c;l.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));l.containedScope=new e.SymbolTableScope(l.members,null,null,null,c);l.containedScope.container=c;l.memberScope=l.containedScope;var h=f.members;var p=h.members;var d=p.length;for(var v=0;v<d;v++){var m=p[v];var g=null;var y=true;var b=null;if(m.nodeType==e.NodeType.FuncDecl){var w=m;b=w.name;g=l.members.allMembers.lookup(w.getNameText());y=g==null;if(w.isSpecialFn()){y=false;g=this.resolveFuncDecl(w,t,c)}else{g=this.resolveFuncDecl(w,t,g)}w.type=g.type}else{b=m.id;g=this.resolveVarDecl(m,t)}if(y){if(b&&e.hasFlag(b.flags,e.ASTFlags.OptionalName)){g.flags|=e.SymbolFlags.Optional}if(!l.members.allMembers.add(g.name,g)){this.errorReporter.duplicateIdentifier(s,g.name)}}}s.type=l;n.type=l;break};case e.NodeType.FuncDecl:{var E=this.resolveFuncDecl(s,t,null);n.type=E.type;break};default:{n.type=this.anyType;this.errorReporter.simpleError(s,"Expected type");break}}}}for(var S=i;S>0;S--){n.type=this.makeArrayType(n.type)}if(r&&n.type==null){n.type=this.anyType}if(n.ast){n.ast.type=n.type}}};n.prototype.findMostApplicableSignature=function(e,t){if(e.length==1){return{sig:e[0].signature,ambiguous:false}}var n=e[0];var r=null;var i=null;var s=null;var o=null;var u=false;for(var a=1;a<e.length;a++){r=e[a];var f=0;for(f=0;t&&f<t.members.length;f++){i=t.members[f].type;s=f<n.signature.parameters.length?n.signature.parameters[f].getType():n.signature.parameters[n.signature.parameters.length-1].getType().elementType;o=f<r.signature.parameters.length?r.signature.parameters[f].getType():r.signature.parameters[r.signature.parameters.length-1].getType().elementType;if(this.typesAreIdentical(s,o)){continue}else{if(this.typesAreIdentical(i,s)){break}else{if(this.typesAreIdentical(i,o)){n=r;break}else{if(this.sourceIsSubtypeOfTarget(s,o)){break}else{if(this.sourceIsSubtypeOfTarget(o,s)){n=r;break}else{if(r.hadProvisionalErrors){break}else{if(n.hadProvisionalErrors){n=r;break}}}}}}}}if(!t||f==t.members.length){var l={getLength:function(){return 2},setTypeAtIndex:function(e,t){},getTypeAtIndex:function(e){return e?r.signature.returnType.type:n.signature.returnType.type}};var c=this.findBestCommonType(n.signature.returnType.type,null,l,false);u=!c}else{u=false}}return{sig:n.signature,ambiguous:u}};n.prototype.getApplicableSignatures=function(t,n,r){var i=[];var s=null;var o=false;var u=null;var a=false;for(var f=0;f<t.length;f++){o=false;for(var l=0;l<n.members.length;l++){if(l>=t[f].parameters.length){continue}s=t[f].parameters[l].getType();if(t[f].declAST.variableArgList&&l>=t[f].nonOptionalParameterCount-1&&s.isArray()){s=s.elementType}if(s==this.anyType){continue}else{if(n.members[l].nodeType==e.NodeType.FuncDecl){if(this.typeFlow.functionInterfaceType&&s==this.typeFlow.functionInterfaceType){continue}if(!this.canContextuallyTypeFunction(s,n.members[l],true)){if(this.canContextuallyTypeFunction(s,n.members[l],false)){this.typeFlow.typeCheck(n.members[l]);if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r)){break}}else{break}}else{this.typeCheckWithContextualType(s,true,true,n.members[l]);this.cleanStartedPTO();a=this.hadProvisionalErrors();if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r)){if(r){r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'")}o=true}this.resetProvisionalErrors();if(o){break}}}else{if(n.members[l].nodeType==e.NodeType.ObjectLit){if(this.typeFlow.objectInterfaceType&&s==this.typeFlow.objectInterfaceType){continue}this.typeCheckWithContextualType(s,true,true,n.members[l]);this.cleanStartedPTO();a=this.hadProvisionalErrors();if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r)){if(r){r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'")}o=true}this.resetProvisionalErrors();if(o){break}}else{if(n.members[l].nodeType==e.NodeType.ArrayLit){if(this.typeFlow.arrayInterfaceType&&s==this.typeFlow.arrayInterfaceType){continue}this.typeCheckWithContextualType(s,true,true,n.members[l]);this.cleanStartedPTO();a=this.hadProvisionalErrors();if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r)){if(r){r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'")}break}this.resetProvisionalErrors();if(o){break}}}}}}if(l==n.members.length){i[i.length]={signature:t[f],hadProvisionalErrors:a}}a=false}return i};n.prototype.canContextuallyTypeFunction=function(e,t,n){if(t.isParenthesized||t.isMethod()||n&&t.returnTypeAnnotation||t.isInlineCallLiteral){return false}n=n||this.typeFlow.functionInterfaceType==e;if(!n){return true}if(!t.signature){this.createFunctionSignature(t,this.typeFlow.scope.container,this.typeFlow.scope,null,null);this.typeFlow.typeCheck(t)}var r=t.signature;var i=r.parameters.length;for(var s=0;s<i;s++){var o=r.parameters[s];var u=o;var a=u.declAST;if(n&&a.typeExpr){return false}}if(e.construct&&e.call){return false}var f=e.construct?e.construct:e.call;if(!f||f.signatures.length>1){return false}return true};n.prototype.canContextuallyTypeObjectLiteral=function(t,n){if(t==this.typeFlow.objectInterfaceType){return true}var r=n.operand;if(!(r&&t.memberScope)){return false}var i=null;var s=null;var o="";var u={};for(var a=0;a<r.members.length;a++){i=r.members[a].operand1;if(i.nodeType==e.NodeType.Name){o=i.text}else{if(i.nodeType==e.NodeType.QString){var f=i.text;o=f.substring(1,f.length-1)}else{return false}}s=t.memberScope.find(o,true,false);if(!s){return false}u[o]=true}var l=t.memberScope.getAllValueSymbolNames(true);for(var a=0;a<l.length;a++){var c=l[a];var h=t.memberScope.find(c,true,false);if(!u[l[a]]&&!e.hasFlag(h.flags,e.SymbolFlags.Optional)){return false}}return true};n.prototype.widenType=function(e){if(e==this.undefinedType||e==this.nullType){return this.anyType}return e};n.prototype.isNullOrUndefinedType=function(e){return e==this.undefinedType||e==this.nullType};n.prototype.findBestCommonType=function(e,t,n,r,i){var s=0;var o=n.getLength();var u=0;var a=e;if(t){a=a?a.mergeOrdered(t,this,r):t}var f=a;while(u<o){for(s=0;s<o;s++){if(s==u){continue}if(f&&(a=f.mergeOrdered(n.getTypeAtIndex(s),this,r,i))){f=a}if(a==this.anyType||a==null){break}else{if(t){n.setTypeAtIndex(s,t)}}}if(f&&a){break}u++;if(u<o){f=n.getTypeAtIndex(u)}}return r?a:a==this.voidType?null:a};n.prototype.typesAreIdentical=function(t,n){if(t==n){return true}if(!t||!n){return false}if(t.isClass()||t.isClassInstance()){return false}var r=n.typeID<<16|t.typeID;if(this.identicalCache[r]){return true}if(t.typeFlags&e.TypeFlags.IsEnum||n.typeFlags&e.TypeFlags.IsEnum){return false}if(t.isArray()||n.isArray()){if(!(t.isArray()&&n.isArray())){return false}this.identicalCache[r]=false;var i=this.typesAreIdentical(t.elementType,n.elementType);if(i){this.subtypeCache[r]=true}else{this.subtypeCache[r]=undefined}return i}if(t.primitiveTypeClass!=n.primitiveTypeClass){return false}this.identicalCache[r]=false;if(t.memberScope&&n.memberScope){var s=t.memberScope.getAllValueSymbolNames(true).sort();var o=n.memberScope.getAllValueSymbolNames(true).sort();if(s.length!=o.length){this.identicalCache[r]=undefined;return false}var u=null;var a=null;var f=null;var l=null;for(var c=0;c<s.length;c++){if(s[c]!=o[c]){this.identicalCache[r]=undefined;return false}u=t.memberScope.find(s[c],false,false);a=n.memberScope.find(o[c],false,false);if((u.flags&e.SymbolFlags.Optional)!=(a.flags&e.SymbolFlags.Optional)){this.identicalCache[r]=undefined;return false}f=u.getType();l=a.getType();if(f&&l&&this.identicalCache[l.typeID<<16|f.typeID]!=undefined){continue}if(!this.typesAreIdentical(f,l)){this.identicalCache[r]=undefined;return false}}}else{if(t.memberScope||n.memberScope){this.identicalCache[r]=undefined;return false}}if(!this.signatureGroupsAreIdentical(t.call,n.call)){this.identicalCache[r]=undefined;return false}if(!this.signatureGroupsAreIdentical(t.construct,n.construct)){this.identicalCache[r]=undefined;return false}if(!this.signatureGroupsAreIdentical(t.index,n.index)){this.identicalCache[r]=undefined;return false}this.identicalCache[r]=true;return true};n.prototype.signatureGroupsAreIdentical=function(e,t){if(e==t){return true}if(!e||!t){return false}if(e.signatures.length!=t.signatures.length){return false}var n=null;var r=null;var i=false;for(var s=0;s<e.signatures.length;s++){n=e.signatures[s];for(var o=0;o<t.signatures.length;o++){r=t.signatures[o];if(this.signaturesAreIdentical(n,r)){i=true;break}}if(i){i=false;continue}return false}return true};n.prototype.signaturesAreIdentical=function(e,t){if(e.hasVariableArgList!=t.hasVariableArgList){return false}if(e.nonOptionalParameterCount!=t.nonOptionalParameterCount){return false}if(e.parameters.length!=t.parameters.length){return false}if(!this.typesAreIdentical(e.returnType.type,t.returnType.type)){return false}for(var n=0;n<e.parameters.length;n++){if(!this.typesAreIdentical(e.parameters[n].parameter.typeLink.type,t.parameters[n].parameter.typeLink.type)){return false}}return true};n.prototype.sourceIsSubtypeOfTarget=function(e,t,n){return this.sourceIsRelatableToTarget(e,t,false,this.subtypeCache,n)};n.prototype.signatureGroupIsSubtypeOfTarget=function(e,t,n){return this.signatureGroupIsRelatableToTarget(e,t,false,this.subtypeCache,n)};n.prototype.signatureIsSubtypeOfTarget=function(e,t,n){return this.signatureIsRelatableToTarget(e,t,false,this.subtypeCache,n)};n.prototype.sourceIsAssignableToTarget=function(e,t,n){return this.sourceIsRelatableToTarget(e,t,true,this.assignableCache,n)};n.prototype.signatureGroupIsAssignableToTarget=function(e,t,n){return this.signatureGroupIsRelatableToTarget(e,t,true,this.assignableCache,n)};n.prototype.signatureIsAssignableToTarget=function(e,t,n){return this.signatureIsRelatableToTarget(e,t,true,this.assignableCache,n)};n.prototype.sourceIsRelatableToTarget=function(t,n,r,i,s){if(t==n){return true}if(!(t&&n)){return true}var o=t.typeID<<16|n.typeID;if(i[o]!=undefined){return true}if(r){if(t==this.anyType||n==this.anyType){return true}}else{if(n==this.anyType){return true}}if(t==this.undefinedType){return true}if(t==this.nullType&&n!=this.undefinedType&&n!=this.voidType){return true}if(n==this.numberType&&t.typeFlags&e.TypeFlags.IsEnum){return true}if(t==this.numberType&&n.typeFlags&e.TypeFlags.IsEnum){return true}if(t.typeFlags&e.TypeFlags.IsEnum||n.typeFlags&e.TypeFlags.IsEnum){return false}if(t.isArray()||n.isArray()){if(!(t.isArray()&&n.isArray())){return false}i[o]=false;var u=this.sourceIsRelatableToTarget(t.elementType,n.elementType,r,i,s);if(u){i[o]=true}else{i[o]=undefined}return u}if(t.primitiveTypeClass!=n.primitiveTypeClass){if(n.primitiveTypeClass==e.Primitive.None){if(t==this.numberType&&this.typeFlow.numberInterfaceType){t=this.typeFlow.numberInterfaceType}else{if(t==this.stringType&&this.typeFlow.stringInterfaceType){t=this.typeFlow.stringInterfaceType}else{if(t==this.booleanType&&this.typeFlow.booleanInterfaceType){t=this.typeFlow.booleanInterfaceType}else{return false}}}}else{return false}}i[o]=false;if(t.hasBase(n)){i[o]=true;return true}if(this.typeFlow.objectInterfaceType&&n==this.typeFlow.objectInterfaceType){return true}if(this.typeFlow.functionInterfaceType&&(t.call||t.construct)&&n==this.typeFlow.functionInterfaceType){return true}if(n.isClass()||n.isClassInstance()){i[o]=undefined;return false}if(n.memberScope&&t.memberScope){var a=n.memberScope.getAllValueSymbolNames(true);var f=null;var l=null;var c=null;var h=null;var p=null;for(var d=0;d<a.length;d++){f=n.memberScope.find(a[d],false,false);l=t.memberScope.find(a[d],false,false);if(f.name=="arguments"&&this.typeFlow.iargumentsInterfaceType&&this.typeFlow.iargumentsInterfaceType.symbol.flags&e.SymbolFlags.CompilerGenerated&&f.kind()==e.SymbolKind.Variable&&f.variable.typeLink.type==this.typeFlow.iargumentsInterfaceType){continue}if(f.isInferenceSymbol()){p=f;if(p.typeCheckStatus==e.TypeCheckStatus.NotStarted){this.typeFlow.typeCheck(f.declAST)}}c=f.getType();if(!l){if(this.typeFlow.objectInterfaceType){l=this.typeFlow.objectInterfaceType.memberScope.find(a[d],false,false)}if(!l){if(this.typeFlow.functionInterfaceType&&(c.call||c.construct)){l=this.typeFlow.functionInterfaceType.memberScope.find(a[d],false,false)}if(!l){if(!(f.flags&e.SymbolFlags.Optional)){i[o]=undefined;if(s){s.flags|=e.TypeRelationshipFlags.RequiredPropertyIsMissing;s.addMessageToFront("Type '"+t.getTypeName()+"' is missing property '"+a[d]+"' from type '"+n.getTypeName()+"'")}return false}else{continue}}}}if(l.isInferenceSymbol()){p=l;if(p.typeCheckStatus==e.TypeCheckStatus.NotStarted){this.typeFlow.typeCheck(l.declAST)}}h=l.getType();if(c&&h&&i[h.typeID<<16|c.typeID]!=undefined){continue}if(!this.sourceIsRelatableToTarget(h,c,r,i,s)){i[o]=undefined;if(s){s.flags|=e.TypeRelationshipFlags.IncompatiblePropertyTypes;s.addMessageToFront("Types of property '"+f.name+"' of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible")}return false}}}if(t.call||n.call){if(!this.signatureGroupIsRelatableToTarget(t.call,n.call,r,i,s)){if(s){if(t.call&&n.call){s.addMessageToFront("Call signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible")}else{var v=n.call?n.getTypeName():t.getTypeName();var m=!n.call?n.getTypeName():t.getTypeName();s.setMessage("Type '"+v+"' requires a call signature, but Type '"+m+"' lacks one")}s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures}i[o]=undefined;return false}}if(t.construct||n.construct){if(!this.signatureGroupIsRelatableToTarget(t.construct,n.construct,r,i,s)){if(s){if(t.construct&&n.construct){s.addMessageToFront("Construct signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible")}else{var v=n.construct?n.getTypeName():t.getTypeName();var m=!n.construct?n.getTypeName():t.getTypeName();s.setMessage("Type '"+v+"' requires a construct signature, but Type '"+m+"' lacks one")}s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures}i[o]=undefined;return false}}if(n.index){var g=!n.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:n.index;var y=!t.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:t.index;if(!this.signatureGroupIsRelatableToTarget(y,g,r,i,s)){if(s){s.addMessageToFront("Index signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible");s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures}i[o]=undefined;return false}}i[o]=true;return true};n.prototype.signatureGroupIsRelatableToTarget=function(e,t,n,r,i){if(e==t){return true}if(!(e&&t)){return false}var s=null;var o=null;var u=false;for(var a=0;a<t.signatures.length;a++){s=t.signatures[a];for(var f=0;f<e.signatures.length;f++){o=e.signatures[f];if(this.signatureIsRelatableToTarget(o,s,n,r,i)){u=true;break}}if(u){u=false;continue}return false}return true};n.prototype.signatureIsRelatableToTarget=function(t,n,r,i,s){if(!t.parameters||!n.parameters){return false}var o=n.hasVariableArgList?n.nonOptionalParameterCount-1:n.nonOptionalParameterCount;var u=t.hasVariableArgList?t.nonOptionalParameterCount-1:t.nonOptionalParameterCount;if(u>o&&!n.hasVariableArgList){if(s){s.flags|=e.TypeRelationshipFlags.SourceSignatureHasTooManyParameters;s.addMessageToFront("Call signature expects "+o+" or fewer parameters")}return false}var a=t.returnType.type;var f=n.returnType.type;if(f!=this.voidType){if(!this.sourceIsRelatableToTarget(a,f,r,i,s)){if(s){s.flags|=e.TypeRelationshipFlags.IncompatibleReturnTypes}return false}}var l=u<o&&t.hasVariableArgList?o:u;var c=null;var h=null;var p="";var d="";for(var v=0,m=0;v<l;v++,m++){if(!t.hasVariableArgList||v<u){c=t.parameters[v].parameter.typeLink.type;p=t.parameters[v].parameter.symbol.name}else{if(v==u){c=t.parameters[v].parameter.typeLink.type;if(c.elementType){c=c.elementType}p=t.parameters[v].parameter.symbol.name}}if(m<n.parameters.length&&m<o){h=n.parameters[m].parameter.typeLink.type;d=n.parameters[m].parameter.symbol.name}else{if(n.hasVariableArgList&&m==o){h=n.parameters[m].parameter.typeLink.type;if(h.elementType){h=h.elementType}d=n.parameters[m].parameter.symbol.name}}if(!(this.sourceIsRelatableToTarget(c,h,r,i,s)||this.sourceIsRelatableToTarget(h,c,r,i,s))){if(s){s.flags|=e.TypeRelationshipFlags.IncompatibleParameterTypes}return false}}return true};return n}();e.TypeChecker=u})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n){if(t){var r=t.members.length;if(n==null){n=new Array}for(var i=0;i<r;i++){var s=t.members[i];var o=s;var u=new e.TypeLink;u.ast=o;n[n.length]=u}}return n}function r(e,t){e.extendsTypeLinks=n(t.extendsList,e.extendsTypeLinks);e.implementsTypeLinks=n(t.implementsList,e.implementsTypeLinks)}function i(t,n,r){var i=new e.ValueLocation;i.typeLink=new e.TypeLink;i.typeLink.ast=n;i.typeLink.type=t.instanceType;var s=new e.FieldSymbol("prototype",n.minChar,r.checker.locationInfo.unitIndex,true,i);s.flags|=e.SymbolFlags.Property|e.SymbolFlags.BuiltIn;i.symbol=s;s.declAST=n;t.members.addPublicMember("prototype",s)}function s(t){var n=new e.Signature;n.returnType=new e.TypeLink;n.returnType.type=t.instanceType;n.parameters=[];t.construct=new e.SignatureGroup;t.construct.addSignature(n)}function o(t,n){t.construct=new e.SignatureGroup;var r=null;if(!n.construct){s(n)}for(var i=0;i<n.construct.signatures.length;i++){r=new e.Signature;r.parameters=n.construct.signatures[i].parameters;r.nonOptionalParameterCount=n.construct.signatures[i].nonOptionalParameterCount;r.typeCheckStatus=n.construct.signatures[i].typeCheckStatus;r.declAST=n.construct.signatures[i].declAST;r.returnType=new e.TypeLink;r.returnType.type=t.instanceType;t.construct.addSignature(r)}}function u(e,t){var n=t.scope.find(e,false,true);if(n==null&&t.previous){n=u(e,t.previous)}return n}function a(t,n){var r=null;switch(t.nodeType){case e.NodeType.Name:{var i=t.text;var s=e.isQuoted(i);var o=function(e){if(n.members){return n.members.lookup(i)}else{return u(i,n.topLevelScope)}};if(s){r=n.tcContext.checker.findSymbolForDynamicModule(i,n.tcContext.script.locationInfo.filename,o)}else{r=o(i)}break};case e.NodeType.Dot:{var f=t;var l=a(f.operand1,n);if(l&&l.getType()){r=a(f.operand2,n)}break};default:{break}}if(r){var c=r.getType();if(c){var h=c.members;if(h){n.members=h.publicMembers}}}return r}function f(t,n,r){var i=r.scopeChain;var s=null;var o=null;var u=t;var f=e.hasFlag(u.varFlags,e.VarFlags.Exported);var l=a(u.alias,{topLevelScope:i,members:null,tcContext:r});var c=r.scopeChain.container==r.checker.gloMod;if(l){var h=l.getType();if(h){o=h}}s=new e.TypeSymbol(u.id.text,u.minChar,r.checker.locationInfo.unitIndex,o);s.aliasLink=u;if(r.scopeChain.moduleDecl){s.declModule=r.scopeChain.moduleDecl}s.declAST=u;u.id.sym=s;i.scope.enter(i.container,t,s,r.checker.errorReporter,f||c,true,false);i.scope.enter(i.container,t,s,r.checker.errorReporter,f||c,false,false);return true}function l(t,n,r){var i=r.scopeChain;var s=t;var o=e.hasFlag(s.modFlags,e.ModuleFlags.Ambient);var u=e.hasFlag(s.modFlags,e.ModuleFlags.IsEnum);var a=r.scopeChain.container==r.checker.gloMod;var f=e.hasFlag(s.modFlags,e.ModuleFlags.Exported);var l=s.name.text;var c=e.isQuoted(l);var h=i.scope.findLocal(l,false,false);var p=null;var d=null;if(h==null||h.kind()!=e.SymbolKind.Type){if(d==null){var v=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));var m=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));d=new e.ModuleType(v,m);if(u){d.typeFlags|=e.TypeFlags.IsEnum}d.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));d.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));d.setHasImplementation()}p=new e.TypeSymbol(l,s.minChar,r.checker.locationInfo.unitIndex,d);if(r.scopeChain.moduleDecl){p.declModule=r.scopeChain.moduleDecl}p.declAST=s;p.prettyName=s.prettyName;i.scope.enter(i.container,t,p,r.checker.errorReporter,f||a,true,o);i.scope.enter(i.container,t,p,r.checker.errorReporter,f||a,false,o);d.symbol=p}else{if(h&&h.declAST&&h.declAST.nodeType!=e.NodeType.ModuleDeclaration){r.checker.errorReporter.simpleError(s,"Conflicting symbol name for module '"+l+"'")}p=h;var g=p.type.getAllEnclosedTypes().publicMembers;var y=g==null?new e.StringHashTable:g;var v=new e.ScopedMembers(new e.DualStringHashTable(y,new e.StringHashTable));var b=p.type.getAllAmbientEnclosedTypes().publicMembers;var w=b==null?new e.StringHashTable:b;var m=new e.ScopedMembers(new e.DualStringHashTable(w,new e.StringHashTable));var E=p.type.members.publicMembers;var S=E==null?new e.StringHashTable:E;var x=new e.ScopedMembers(new e.DualStringHashTable(S,new e.StringHashTable));var T=p.type.ambientMembers.publicMembers;var N=T==null?new e.StringHashTable:T;var C=new e.ScopedMembers(new e.DualStringHashTable(N,new e.StringHashTable));d=new e.ModuleType(v,m);if(u){d.typeFlags|=e.TypeFlags.IsEnum}d.members=x;d.ambientMembers=C;d.setHasImplementation();d.symbol=p;p.addLocation(s.minChar);p.expansions.push(d)}if(r.scopeChain.moduleDecl){r.scopeChain.moduleDecl.recordNonInterface()}if(f){p.flags|=e.SymbolFlags.Exported}if(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod){p.flags|=e.SymbolFlags.ModuleMember}s.mod=d;e.pushTypeCollectionScope(p,d.members,d.ambientMembers,d.enclosedTypes,d.ambientEnclosedTypes,r,null,null,s);return true}function c(t,n,o){var u=o.scopeChain;var a=t;var f;var l;var c=null;var h=a.name.text;var p=false;var d=e.hasFlag(a.varFlags,e.VarFlags.Ambient);var v=e.hasFlag(a.varFlags,e.VarFlags.Exported);var m=o.scopeChain.container==o.checker.gloMod;var g=u.container;var y=false;c=u.scope.findLocal(h,false,true);if(!c){var b=u.scope.findLocal(h,false,false);if(b&&b.isType()&&b.declAST&&b.declAST.nodeType==e.NodeType.FuncDecl&&b.declAST.isSignature()){c=b;y=true;if(v){c.flags|=e.SymbolFlags.Exported}if(d){c.flags|=e.SymbolFlags.Ambient}o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,true,d)}}if(c&&!y&&c.declAST!=a){c=null}if(c==null){var w=u.scope.findLocal(h,false,false);f=new e.Type;f.setHasImplementation();l=new e.Type;l.setHasImplementation();f.instanceType=l;f.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));f.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));i(f,a,o);l.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));l.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));c=new e.TypeSymbol(h,a.minChar,o.checker.locationInfo.unitIndex,f);c.declAST=a;c.instanceType=l;f.symbol=c;l.symbol=c;if(o.scopeChain.moduleDecl){o.scopeChain.moduleDecl.recordNonInterface();c.declModule=o.scopeChain.moduleDecl;c.flags|=e.SymbolFlags.ModuleMember}if(v){c.flags|=e.SymbolFlags.Exported}if(d){c.flags|=e.SymbolFlags.Ambient}t.type=f;o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,true,d);if(w==null){o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,false,d)}}else{f=c.type;if(f.instanceType==null){f.instanceType=new e.Type;f.instanceType.setHasImplementation();f.instanceType.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));f.instanceType.symbol=f.symbol;f.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));f.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable))}l=f.instanceType;t.type=f}if(!a.constructorDecl){if(c&&c.declAST&&c.declAST.type&&c.declAST.type.call&&!c.declAST.isOverload){o.checker.errorReporter.duplicateIdentifier(c.declAST,c.name)}s(a.type)}f.typeFlags|=e.TypeFlags.IsClass;l.typeFlags|=e.TypeFlags.IsClass;r(l,a);e.pushTypeCollectionScope(c,l.members,l.ambientMembers,null,null,o,l,f,null);return true}function h(t,n,i){var s=i.scopeChain;var o=t;var u=null;var a=null;var f=e.hasFlag(o.varFlags,e.VarFlags.Exported);var l=i.scopeChain.container==i.checker.gloMod;var c=true;c=false;var h=o.name.text;u=s.scope.findLocal(h,false,true);if(u==null){a=new e.Type;u=new e.TypeSymbol(h,t.minChar,i.checker.locationInfo.unitIndex,a);a.symbol=u;a.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));a.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));u.declAST=o;u.declModule=i.scopeChain.moduleDecl}else{c=true;a=u.type}if(!a){a=i.checker.anyType}t.type=a;r(a,o);if(f){u.flags|=e.SymbolFlags.Exported}if(i.scopeChain.moduleDecl){u.flags|=e.SymbolFlags.ModuleMember}if(!c){i.scopeChain.scope.enter(i.scopeChain.container,t,u,i.checker.errorReporter,l||f,true,false)}e.pushTypeCollectionScope(u,a.members,a.ambientMembers,null,null,i,a,null,null);return true}function p(t,n,r){var i=r.scopeChain;var s=t;if(e.hasFlag(s.varFlags,e.VarFlags.Public|e.VarFlags.Private)){var o=new e.ValueLocation;var u=e.hasFlag(s.varFlags,e.VarFlags.Private);var a=new e.FieldSymbol(s.id.text,s.minChar,r.checker.locationInfo.unitIndex,!e.hasFlag(s.varFlags,e.VarFlags.Readonly),o);a.transferVarFlags(s.varFlags);o.symbol=a;a.declAST=t;s.parameterPropertySym=a;r.scopeChain.scope.enter(r.scopeChain.container,t,a,r.checker.errorReporter,!u,false,false);o.typeLink=e.getTypeLink(s.typeExpr,r.checker,s.init==null);s.sym=a}return false}function d(t,n,r){var i=r.scopeChain;var s=t;var o=e.hasFlag(s.varFlags,e.VarFlags.Ambient);var u=e.hasFlag(s.varFlags,e.VarFlags.Exported);var a=r.scopeChain.container==r.checker.gloMod;var f=e.hasFlag(s.varFlags,e.VarFlags.Property);var l=e.hasFlag(s.varFlags,e.VarFlags.Static);var c=e.hasFlag(s.varFlags,e.VarFlags.Private);var h=e.hasFlag(s.id.flags,e.ASTFlags.OptionalName);if(r.scopeChain.moduleDecl){r.scopeChain.moduleDecl.recordNonInterface()}if(f||u||r.scopeChain.container==r.checker.gloMod||r.scopeChain.moduleDecl){if(o){var p=i.scope.findLocal(s.id.text,false,false);if(p){s.sym=p;return false}}if(s.id==null){r.checker.errorReporter.simpleError(s,"Expected variable identifier at this location");return false}var d=new e.ValueLocation;var v=new e.FieldSymbol(s.id.text,s.minChar,r.checker.locationInfo.unitIndex,(s.varFlags&e.VarFlags.Readonly)==e.VarFlags.None,d);v.transferVarFlags(s.varFlags);if(h){v.flags|=e.SymbolFlags.Optional}d.symbol=v;v.declAST=t;if(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod){v.flags|=e.SymbolFlags.ModuleMember;v.declModule=r.scopeChain.moduleDecl}if(e.hasFlag(s.varFlags,e.VarFlags.Property)&&l&&r.scopeChain.classType){if(!r.scopeChain.classType.members.publicMembers.add(s.id.text,v)){r.checker.errorReporter.duplicateIdentifier(t,v.name)}v.container=r.scopeChain.classType.symbol}else{r.scopeChain.scope.enter(r.scopeChain.container,t,v,r.checker.errorReporter,!c&&(f||u||a||l),false,o)}if(e.hasFlag(s.varFlags,e.VarFlags.Exported)){v.flags|=e.SymbolFlags.Exported}d.typeLink=e.getTypeLink(s.typeExpr,r.checker,s.init==null);s.sym=v}return false}function v(t,n,r){var i=r.scopeChain;if(r.scopeChain.moduleDecl){r.scopeChain.moduleDecl.recordNonInterface()}var s=t;var o=null;var u=s.getNameText();var a=e.hasFlag(s.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported);var f=e.hasFlag(s.fncFlags,e.FncFlags.Static);var l=e.hasFlag(s.fncFlags,e.FncFlags.Private);var c=s.isConstructMember()||s.isConstructor;var h=(s.isMethod()&&f||s.isAccessor())&&r.scopeChain.classType?r.scopeChain.classType.symbol:r.scopeChain.container;var p=r.scopeChain.scope;var d=h==r.checker.gloMod;var v=s.name&&e.hasFlag(s.name.flags,e.ASTFlags.OptionalName);var m=false;var g=false;if(c&&e.hasFlag(s.fncFlags,e.FncFlags.ClassMethod)){h=h.container;p=i.previous.scope}s.unitIndex=r.checker.locationInfo.unitIndex;if(!s.isConstructor&&h&&h.declAST&&h.declAST.nodeType==e.NodeType.FuncDecl&&h.declAST.isConstructor&&!s.isMethod()){return m}if(e.hasFlag(s.fncFlags,e.FncFlags.Signature)){var y=r.scopeChain.thisType;if(u&&u!="__missing"){if(f){o=h.type.members.allMembers.lookup(u)}else{o=p.findLocal(u,false,false);if(o==null){o=p.findLocal(u,false,true)}}if(o){g=true;if(!s.isSignature()&&e.hasFlag(s.fncFlags,e.FncFlags.Ambient)!=e.hasFlag(o.flags,e.SymbolFlags.Ambient)){o=null}}}if(o==null){if(!s.isSpecialFn()){o=r.checker.createFunctionSignature(s,h,p,null,!g).declAST.type.symbol}else{o=r.checker.createFunctionSignature(s,h,p,h,false).declAST.type.symbol}if(o.declAST==null||!s.isSpecialFn()){o.declAST=t}}else{if(o.kind()==e.SymbolKind.Type){o=r.checker.createFunctionSignature(s,h,p,o,false).declAST.type.symbol}else{r.checker.errorReporter.simpleError(s,"Function or method '"+s.name.actualText+"' already declared as a property")}}if(s.isSpecialFn()&&!f){s.type=y?y:o.type}else{s.type=o.type}}else{if(u){if(f){o=h.type.members.allMembers.lookup(u)}else{if(s.isConstructor&&r.scopeChain.previous){o=r.scopeChain.previous.scope.findLocal(u,false,false)}if(o==null){o=p.findLocal(u,false,false)}}if(o){g=true;if(!c&&o.declAST.nodeType==e.NodeType.FuncDecl&&!o.declAST.isAccessor()&&!o.declAST.isSignature()){o=null;g=false}}}if(o&&!o.isAccessor()&&o.type&&o.type.construct&&o.type.construct.signatures!=[]&&(o.type.construct.signatures[0].declAST==null||!e.hasFlag(o.type.construct.signatures[0].declAST.fncFlags,e.FncFlags.Ambient))&&!s.isConstructor){r.checker.errorReporter.simpleError(s,"Functions may not have class overloads")}if(o&&!(o.kind()==e.SymbolKind.Type)&&s.isMethod()&&!s.isAccessor()&&!s.isConstructor){r.checker.errorReporter.simpleError(s,"Function or method '"+s.name.actualText+"' already declared as a property");o.type=r.checker.anyType}var b=r.checker.createFunctionSignature(s,h,p,o,!g);if((!o||o.declAST.nodeType!=e.NodeType.FuncDecl)&&s.isAccessor()||o&&o.isAccessor()){s.accessorSymbol=r.checker.createAccessorSymbol(s,o,h.type,s.isMethod()&&f,true,p,h)}s.type.symbol.declAST=t;if(s.isConstructor){m=true}}if(a){if(s.type.call){s.type.symbol.flags|=e.SymbolFlags.Exported}if(o&&!o.isAccessor()&&o.kind()==e.SymbolKind.Type&&o.type.call){o.flags|=e.SymbolFlags.Exported}}if(r.scopeChain.moduleDecl&&!s.isSpecialFn()){s.type.symbol.flags|=e.SymbolFlags.ModuleMember;s.type.symbol.declModule=r.scopeChain.moduleDecl}if(o&&v){o.flags|=e.SymbolFlags.Optional}return m}function m(t,n,r){var i=r.state;var s=false;var o=i.scopeChain;if(t.nodeType==e.NodeType.Script){var u=t;i.script=u;s=true}else{if(t.nodeType==e.NodeType.List){s=true}else{if(t.nodeType==e.NodeType.ImportDeclaration){s=f(t,n,i)}else{if(t.nodeType==e.NodeType.With){s=false}else{if(t.nodeType==e.NodeType.ModuleDeclaration){s=l(t,n,i)}else{if(t.nodeType==e.NodeType.ClassDeclaration){s=c(t,n,i)}else{if(t.nodeType==e.NodeType.Block){s=true}else{if(t.nodeType==e.NodeType.InterfaceDeclaration){s=h(t,n,i)}else{if(t.nodeType==e.NodeType.ArgDecl){s=p(t,n,i)}else{if(t.nodeType==e.NodeType.VarDecl){s=d(t,n,i)}else{if(t.nodeType==e.NodeType.FuncDecl){s=v(t,n,i)}else{if(t.isStatementOrExpression()&&i.scopeChain.moduleDecl){i.scopeChain.moduleDecl.recordNonInterface()}}}}}}}}}}}}r.options.goChildren=s;return t}function g(t,n,r){var i=r.state;if(t.nodeType==e.NodeType.ModuleDeclaration){e.popTypeCollectionScope(i)}else{if(t.nodeType==e.NodeType.ClassDeclaration){e.popTypeCollectionScope(i)}else{if(t.nodeType==e.NodeType.InterfaceDeclaration){e.popTypeCollectionScope(i)}}}return t}var t=function(){function e(e){this.normalBlock=e;this.exceptionBlock=-1}return e}();e.Continuation=t;e.createNewConstructGroupForType=s;e.cloneParentConstructGroupForChildType=o;e.globalId="__GLO";e.preCollectImportTypes=f;e.preCollectModuleTypes=l;e.preCollectClassTypes=c;e.preCollectInterfaceTypes=h;e.preCollectArgDeclTypes=p;e.preCollectVarDeclTypes=d;e.preCollectFuncDeclTypes=v;e.preCollectTypes=m;e.postCollectTypes=g})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(e,t,n){this.container=e;this.previous=t;this.scope=n}return e}();e.ScopeChain=t;var n=function(){function t(e){this.bb=e;this.defsBySymbol=new Array;this.useIndexBySymbol=new Array}t.prototype.updateTop=function(){var e=new i(this.top.bitCount);for(var t=0,n=this.bb.successors.length;t<n;t++){var r=this.bb.successors[t];if(r.useDef){e.union(r.useDef.top)}}e.difference(this.kill);e.union(this.gen);var s=e.notEq(this.top);this.top=e;return s};t.prototype.initialize=function(t){function s(t,n,s){var o=s.state;if(t==null){t=null}if(t.nodeType==e.NodeType.VarDecl){var u=t;if(u.init||e.hasFlag(u.varFlags,e.VarFlags.AutoInit)){r(u.sym,o)}}else{if(t.nodeType==e.NodeType.Name){if(n){if(n.nodeType==e.NodeType.Asg){var a=n;if(a.operand1==t){return t}}else{if(n.nodeType==e.NodeType.VarDecl){var f=n;if(f.id==t){return t}}}}var l=t;i(l.sym,o,t)}else{if(t.nodeType>=e.NodeType.Asg&&t.nodeType<=e.NodeType.LastAsg){var a=t;if(a.operand1&&a.operand1.nodeType==e.NodeType.Name){var l=a.operand1;r(l.sym,o)}}else{if(t.nodeType==e.NodeType.FuncDecl){s.options.goChildren=false}}}}return t}var n=this;var r=function(e,t){if(t.isLocalSym(e)){var r=t.getSymbolIndex(e);n.useIndexBySymbol[r]=new Array;n.defsBySymbol[r]=true}};var i=function(e,t,r){if(t.isLocalSym(e)){var i=t.getSymbolIndex(e);if(n.useIndexBySymbol[i]==undefined){n.useIndexBySymbol[i]=new Array}var s=n.useIndexBySymbol[i];var o=t.getUseIndex(r);t.addUse(i,o);s.push(o)}};var o=new e.AstWalkOptions;o.reverseSiblings=true;e.getAstWalkerFactory().walk(this.bb.content,s,null,o,t)};t.prototype.initializeGen=function(e){var t=this.useIndexBySymbol.length;var n=e.uses.length;this.gen=new i(n);for(var r=0;r<t;r++){var s=this.useIndexBySymbol[r];if(s!=undefined&&s.length>0){for(var o=0,u=s.length;o<u;o++){this.gen.set(s[o],true)}}}this.top=this.gen};t.prototype.initializeKill=function(e){this.kill=new i(this.gen.bitCount);for(var t=0,n=this.defsBySymbol.length;t<n;t++){if(this.defsBySymbol[t]){var r=e.useIndexBySymbol[t];if(r){for(var s=0,o=r.length;s<o;s++){this.kill.set(r[s],true)}}}}};return t}();e.BBUseDefInfo=n;var r=function(){function t(){this.useIndexBySymbol=new Array;this.uses=new Array;this.symbols=new Array;this.symbolMap=new e.StringHashTable;this.symbolCount=0}t.prototype.getSymbolIndex=function(e){var t=e.name;var n=this.symbolMap.lookup(t);if(n==null){n=this.symbolCount++;this.symbols[n]=e;this.symbolMap.add(t,n)}return n};t.prototype.addUse=function(e,t){var n=this.useIndexBySymbol[e];if(n==undefined){n=new Array;this.useIndexBySymbol[e]=n}n[n.length]=t};t.prototype.getUseIndex=function(e){this.uses[this.uses.length]=e;return this.uses.length-1};t.prototype.isLocalSym=function(t){return t&&t.container==this.func&&t.kind()==e.SymbolKind.Variable};t.prototype.killSymbol=function(e,t){var n=this.symbolMap.lookup(e.name);var r=this.useIndexBySymbol[n];for(var i=0,s=r.length;i<s;i++){t.set(r[i],true)}};return t}();e.UseDefContext=r;var i=function(){function e(t){this.bitCount=t;this.firstBits=0;this.restOfBits=null;if(this.bitCount>e.packBits){this.restOfBits=new Array;var n=Math.floor(this.bitCount/e.packBits);for(var r=0;r<n;r++){this.restOfBits[r]=0}}}e.packBits=30;e.prototype.set=function(t,n){if(t<e.packBits){if(n){this.firstBits|=1<<t}else{this.firstBits&=~(1<<t)}}else{var r=Math.floor(t/e.packBits)-1;var i=t%e.packBits;if(n){this.restOfBits[r]|=1<<i}else{this.restOfBits[r]&=~(1<<i)}}};e.prototype.map=function(t){var n;for(n=0;n<e.packBits;n++){if(n==this.bitCount){return}if((1<<n&this.firstBits)!=0){t(n)}}if(this.restOfBits){var r;var i=e.packBits;for(n=0,r=this.restOfBits.length;n<r;n++){var s=this.restOfBits[n];for(var o=0;o<e.packBits;o++){if((1<<o&s)!=0){t(i)}i++;if(i==this.bitCount){return}}}}};e.prototype.union=function(e){this.firstBits|=e.firstBits;if(this.restOfBits){for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t];var i=e.restOfBits[t];this.restOfBits[t]=r|i}}};e.prototype.intersection=function(e){this.firstBits&=e.firstBits;if(this.restOfBits){for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t];var i=e.restOfBits[t];this.restOfBits[t]=r&i}}};e.prototype.notEq=function(e){if(this.firstBits!=e.firstBits){return true}if(this.restOfBits){for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t];var i=e.restOfBits[t];if(r!=i){return true}}}return false};e.prototype.difference=function(e){var t=this.firstBits;this.firstBits&=~e.firstBits;if(this.restOfBits){for(var n=0,r=this.restOfBits.length;n<r;n++){var i=this.restOfBits[n];var s=e.restOfBits[n];this.restOfBits[n]&=~s}}};return e}();e.BitVector=i;var s=function(){function t(){this.predecessors=new Array;this.index=-1;this.markValue=0;this.successors=new Array;this.useDef=null;this.content=new e.ASTList}t.prototype.marked=function(e){return this.markValue>e};t.prototype.mark=function(){this.markValue++};t.prototype.addSuccessor=function(e){this.successors[this.successors.length]=e;e.predecessors[e.predecessors.length]=this};return t}();e.BasicBlock=s;var o=function(){function t(e,t){this.current=e;this.exit=t;this.entry=null;this.unreachable=null;this.noContinuation=false;this.statementStack=new Array;this.currentSwitch=new Array;this.markBase=0;this.linearBBs=new Array;this.entry=this.current}t.prototype.walk=function(e,t){return this.walker.walk(e,t)};t.prototype.pushSwitch=function(e){this.currentSwitch.push(e)};t.prototype.popSwitch=function(){return this.currentSwitch.pop()};t.prototype.reportUnreachable=function(t){if(this.unreachable&&this.unreachable.length>0){var n=this.unreachable.length;for(var r=0;r<n;r++){var i=this.unreachable[r];if(i.nodeType!=e.NodeType.EndCode){t.simpleError(i,"unreachable code")}}}};t.prototype.printAST=function(t,n){var r=new e.PrintContext(n,null);r.increaseIndent();e.getAstWalkerFactory().walk(t,e.prePrintAST,e.postPrintAST,null,r);r.decreaseIndent()};t.prototype.printBlockContent=function(e,t){var n=e.content;for(var r=0,i=n.members.length;r<i;r++){var s=n.members[r];this.printAST(s,t)}};t.prototype.bfs=function(e,t,n,r){var i=this.markBase++;var s=new Array;s[s.length]=this.entry;while(s.length>0){var o=s.pop();if(!o.marked(i)){o.mark();if(e){e(o)}var u=o.successors.length;if(u>0){if(n){n()}for(var a=u-1;a>=0;a--){var f=o.successors[a];if(!f.marked(this.markBase)){if(t){t(o,f)}s[s.length]=f}}if(r){r()}}}}};t.prototype.useDef=function(e,t){var i=this;var s=new r;s.func=t;var o=function(e){e.useDef=new n(e);e.useDef.initialize(s);i.linearBBs[i.linearBBs.length]=e};this.bfs(o,null,null,null);var u,a;for(u=0,a=this.linearBBs.length;u<a;u++){this.linearBBs[u].useDef.initializeGen(s);this.linearBBs[u].useDef.initializeKill(s)}var f=true;while(f){f=false;for(u=0;u<a;u++){f=this.linearBBs[u].useDef.updateTop()||f}}var l=this.entry.useDef.top;l.map(function(t){var n=s.uses[t];e.simpleError(n,"use of variable '"+n.actualText+"' that is not definitely assigned")})};t.prototype.print=function(e){function i(){e.Write("  Branches to ")}function s(){e.WriteLine("")}function o(t,r){if(r.index<0){r.index=n++}e.Write(r.index+" ")}var t=this;var n=0;var r=function(r){if(r.index<0){r.index=n++}if(r==t.exit){e.WriteLine("Exit block with index "+r.index)}else{e.WriteLine("Basic block with index "+r.index);t.printBlockContent(r,e)}};this.bfs(r,o,i,s);if(this.unreachable!=null){for(var u=0,a=this.unreachable.length;u<a;u++){e.WriteLine("Unreachable basic block ...");this.printAST(this.unreachable[u],e)}}};t.prototype.pushStatement=function(e,t,n){this.statementStack.push({stmt:e,continueBB:t,breakBB:n})};t.prototype.popStatement=function(){return this.statementStack.pop()};t.prototype.returnStmt=function(){this.current.addSuccessor(this.exit);this.setUnreachable()};t.prototype.setUnreachable=function(){this.current=null;this.noContinuation=true};t.prototype.addUnreachable=function(e){if(this.unreachable===null){this.unreachable=new Array}this.unreachable[this.unreachable.length]=e};t.prototype.unconditionalBranch=function(e,t){var n=null;for(var r=0,i=this.statementStack.length;r<i;r++){var s=this.statementStack[r];if(s.stmt==e){if(t){n=s.continueBB}else{n=s.breakBB}break}}if(n){this.current.addSuccessor(n)}this.setUnreachable()};t.prototype.addContent=function(e){if(this.current){this.current.content.append(e)}};return t}();e.ControlFlowContext=o;var u=function(){function e(){this.cacheSize=16;this.rdCache=[];this.nextUp=0;for(var e=0;e<this.cacheSize;e++){this.rdCache[e]={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:e}}}e.prototype.getResolutionData=function(){var e=null;if(this.nextUp<this.cacheSize){e=this.rdCache[this.nextUp]}if(e==null){this.cacheSize++;e={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:this.cacheSize};this.rdCache[this.cacheSize]=e}this.nextUp++;return e};e.prototype.returnResolutionData=function(e){e.actuals.length=0;e.exactCandidates.length=0;e.conversionCandidates.length=0;this.nextUp=e.id};return e}();e.ResolutionDataCache=u;var a=function(){function n(e,t,n,r){this.logger=e;this.initScope=t;this.parser=n;this.checker=r;this.thisFnc=null;this.thisClassNode=null;this.enclosingFncIsMethod=false;this.arrayInterfaceType=null;this.stringInterfaceType=null;this.objectInterfaceType=null;this.functionInterfaceType=null;this.numberInterfaceType=null;this.booleanInterfaceType=null;this.iargumentsInterfaceType=null;this.currentScript=null;this.inImportTypeCheck=false;this.inTypeRefTypeCheck=false;this.inArrayElementTypeCheck=false;this.resolutionDataCache=new u;this.nestingLevel=0;this.inBoundPropTypeCheck=false;this.inSuperCall=false;this.checker.typeFlow=this;this.scope=this.initScope;this.globalScope=this.initScope;this.doubleType=this.checker.numberType;this.booleanType=this.checker.booleanType;this.stringType=this.checker.stringType;this.anyType=this.checker.anyType;this.regexType=this.anyType;this.nullType=this.checker.nullType;this.voidType=this.checker.voidType;this.arrayAnyType=this.checker.makeArrayType(this.anyType)}n.prototype.initLibs=function(){var t=this.globalScope.find("Array",false,true);if(t&&t.kind()==e.SymbolKind.Type){this.arrayInterfaceType=t.type}var n=this.globalScope.find("String",false,true);if(n&&n.kind()==e.SymbolKind.Type){this.stringInterfaceType=n.type}var r=this.globalScope.find("Object",false,true);if(r&&r.kind()==e.SymbolKind.Type){this.objectInterfaceType=r.type}var i=this.globalScope.find("Function",false,true);if(i&&i.kind()==e.SymbolKind.Type){this.functionInterfaceType=i.type}var s=this.globalScope.find("Number",false,true);if(s&&s.kind()==e.SymbolKind.Type){this.numberInterfaceType=s.type}var o=this.globalScope.find("Boolean",false,true);if(o&&o.kind()==e.SymbolKind.Type){this.booleanInterfaceType=o.type}var u=this.globalScope.find("RegExp",false,true);if(u&&u.kind()==e.SymbolKind.Type){this.regexType=u.type}};n.prototype.cast=function(e,t){return this.castWithCoercion(e,t,true,false)};n.prototype.castWithCoercion=function(t,n,r,i){var s=new e.TypeComparisonInfo;if(this.checker.sourceIsAssignableToTarget(t.type,n,s)||i&&this.checker.sourceIsAssignableToTarget(n,t.type,s)){if(r){if(n==null){t.type=this.anyType}else{if(n.isClass()){t.type=n.instanceType}else{t.type=n}}}return t}else{this.checker.errorReporter.incompatibleTypes(t,t.type,n,null,this.scope,s);return t}};n.prototype.inScopeTypeCheck=function(t,n){var r=this.scope;this.scope=n;var i=this.thisFnc;var s=this.thisType;var o=this.thisClassNode;var u=this.checker.currentModDecl;var a=this.enclosingFncIsMethod;var f=this.scope.container;var l=null;while(f){if(f.kind()==e.SymbolKind.Type){var c=f;var h=c.type;if(h.call){if(l==null){this.enclosingFncIsMethod=c.isMethod;l=f.declAST}}if(h.isClass()){this.thisType=h.instanceType;if(c.declAST&&c.declAST.nodeType==e.NodeType.ClassDeclaration){this.thisClassNode=c.declAST}break}if(h.isModuleType()){this.checker.currentModDecl=c.declAST;break}}f=f.container}this.thisFnc=l;var p=this.typeCheck(t);this.thisFnc=i;this.thisType=s;this.thisClassNode=o;this.checker.currentModDecl=u;this.enclosingFncIsMethod=a;this.scope=r;return p};n.prototype.typeCheck=function(e){if(e){return e.typeCheck(this)}else{return null}};n.prototype.inScopeTypeCheckDecl=function(t){if(t.nodeType==e.NodeType.VarDecl||t.nodeType==e.NodeType.ArgDecl){this.inScopeTypeCheckBoundDecl(t)}else{if(t.nodeType==e.NodeType.FuncDecl){var n=t;if(n.isAccessor()){this.typeCheckFunction(n)}}}};n.prototype.inScopeTypeCheckBoundDecl=function(t){var n=t.sym;var r=this.thisFnc;var i=this.thisType;var s=this.enclosingFncIsMethod;var o=this.checker.locationInfo;if(n&&n.container){var u=e.hasFlag(t.varFlags,e.VarFlags.ClassConstructorProperty)?n.container.getType().constructorScope:n.container.instanceScope();if(e.hasFlag(t.varFlags,e.VarFlags.Property)&&n.container.declAST.nodeType==e.NodeType.FuncDecl){this.thisFnc=n.container.declAST}if(u){var a=this.scope;this.scope=u;var f=n.container;if(this.checker.units&&n.unitIndex>=0&&n.unitIndex<this.checker.units.length){this.checker.locationInfo=this.checker.units[n.unitIndex]}else{this.checker.locationInfo=e.unknownLocationInfo}while(f){if(f.kind()==e.SymbolKind.Type){var l=f;var c=l.type;if(c.call){this.enclosingFncIsMethod=l.isMethod}if(c.isClass()){this.thisType=c.instanceType;break}}f=f.container}this.typeCheckBoundDecl(t);this.scope=a}}this.thisFnc=r;this.thisType=i;this.checker.locationInfo=o;this.enclosingFncIsMethod=s};n.prototype.resolveBoundDecl=function(e){if(e.typeExpr){if(e.typeExpr.type==null||e.typeExpr.type&&e.typeExpr.type==this.anyType&&this.scope||e.typeExpr.type.symbol==null||!this.checker.typeStatusIsFinished(e.typeExpr.type.symbol.typeCheckStatus)){this.typeCheck(e.typeExpr)}e.type=e.typeExpr.type;if(e.sym){e.sym.setType(e.type)}}else{if(e.init==null){if(this.checker.styleSettings.implicitAny){this.checker.errorReporter.styleError(e,"type implicitly set to 'any'")}e.type=this.anyType;if(e.sym){if(e.sym.isType()){var t=e.sym;if(t.isMethod){this.checker.errorReporter.simpleError(e,"Cannot bind method group to variable.  (Did you mean to use 'declare function' instead of 'declare var'?)");return}else{this.checker.errorReporter.simpleError(e,"Cannot bind type to variable");return}}e.sym.setType(e.type)}}}};n.prototype.typeCheckBoundDecl=function(t){var n=this;var r=t.sym;if(r==null){if(t.init){t.init=this.typeCheck(t.init);t.type=this.checker.widenType(t.init.type)}else{if(this.checker.styleSettings.implicitAny){this.checker.errorReporter.styleError(t,"type implicitly set to 'any'")}t.type=this.anyType}}else{if(r.typeCheckStatus==e.TypeCheckStatus.Started){if(this.checker.styleSettings.implicitAny){this.checker.errorReporter.styleError(t,"type implicitly set to 'any'")}t.type=this.anyType;r.setType(this.anyType)}else{if(r.typeCheckStatus==e.TypeCheckStatus.NotStarted){r.typeCheckStatus=e.TypeCheckStatus.Started;this.checker.addStartedPTO(r);var i=false;if(t.type==null){if(t.typeExpr){this.resolveBoundDecl(t);i=true;t.type=t.typeExpr.type;r.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}}if(t.init){var s=e.hasFlag(t.varFlags,e.VarFlags.LocalStatic);var o=this.scope;var u=!t.init.isParenthesized;if(s){this.scope=t.sym.container.getType().memberScope}if(t.varFlags&e.VarFlags.Property){this.inBoundPropTypeCheck=true}this.checker.typeCheckWithContextualType(t.type,this.checker.inProvisionalTypecheckMode(),u,t.init);if(this.inBoundPropTypeCheck){this.inBoundPropTypeCheck=false}this.scope=o;if(t.type){var a=false;var f=null;if(t.init.type){f=t.init.type.containedScope;a=true;if(t.init.type==this.voidType){this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.actualText+"'")}}t.init=this.castWithCoercion(t.init,t.type,u&&!this.checker.inProvisionalTypecheckMode(),false);if(a&&t.init.type.containedScope==null){t.init.type.containedScope=f}}else{t.type=this.checker.widenType(t.init.type);if(t.type==this.voidType){this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.actualText+"'");t.type=this.anyType}}r.setType(t.type)}else{if(!i){this.resolveBoundDecl(t)}}r.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else{if(this.checker.typeStatusIsFinished(r.typeCheckStatus)&&r.declAST!=t){if(t.init){t.init=this.typeCheck(t.init);t.type=r.getType();t.init=this.cast(t.init,t.type)}}}}}if(t.id&&t.sym){t.id.sym=t.sym}if(t.sym&&t.sym.container){this.checkTypePrivacy(t.sym.getType(),t.sym,function(e){return n.varPrivacyErrorReporter(t,e)})}return t};n.prototype.varPrivacyErrorReporter=function(t,n){if(e.hasFlag(t.varFlags,e.VarFlags.Public)){if(t.sym.container.declAST.nodeType==e.NodeType.InterfaceDeclaration){this.checker.errorReporter.simpleError(t,"property '"+t.sym.name+"' of exported interface has or is using private type '"+n+"'")}else{this.checker.errorReporter.simpleError(t,"public member '"+t.sym.name+"' of exported class has or is using private type '"+n+"'")}}else{this.checker.errorReporter.simpleError(t,"exported variable '"+t.sym.name+"' has or is using private type '"+n+"'")}};n.prototype.typeCheckSuper=function(e){if(this.thisType&&this.enclosingFncIsMethod&&!this.thisFnc.isStatic()&&this.thisType.baseClass()){e.type=this.thisType.baseClass()}else{e.type=this.anyType;this.checker.errorReporter.invalidSuperReference(e)}return e};n.prototype.typeCheckThis=function(t){var n=false;if(this.thisFnc==null){if(this.thisType){if(this.thisClassNode&&this.thisClassNode.nodeType==e.NodeType.ClassDeclaration){n=true;t.type=this.anyType}else{t.type=this.thisType}}else{if(this.checker.currentModDecl){this.checker.errorReporter.simpleError(t,"'this' may not be referenced within module bodies")}t.type=this.anyType}}else{if(this.thisClassNode&&(this.inBoundPropTypeCheck||this.inSuperCall&&e.hasFlag(this.thisClassNode.varFlags,e.VarFlags.ClassSuperMustBeFirstCallInConstructor))){n=true}if(this.thisFnc.isMethod()||this.thisFnc.isConstructor||this.thisFnc.isTargetTypedAsMethod){if(this.thisType&&!(this.thisFnc.fncFlags&e.FncFlags.Static)){t.type=this.thisType}else{t.type=this.anyType}}else{t.type=this.anyType}}if(!this.enclosingFncIsMethod&&this.thisFnc&&e.hasFlag(this.thisFnc.fncFlags,e.FncFlags.IsFatArrowFunction)){if(this.thisFnc.boundToProperty){var r=this.thisFnc.boundToProperty.sym.container;if(r.declAST.nodeType==e.NodeType.FuncDecl){r.declAST.setHasSelfReference()}}else{var i=this.thisFnc.enclosingFnc;var s=i;var o=false;while(i){if(i.isMethod()||i.isConstructor||i.hasSelfReference()){i.setHasSelfReference();o=true;break}i=i.enclosingFnc}if(!o&&s){s.setHasSelfReference()}else{if(!o){if(this.thisClassNode){this.thisClassNode.varFlags|=e.VarFlags.MustCaptureThis}else{if(this.checker.currentModDecl){this.checker.currentModDecl.modFlags|=e.ModuleFlags.MustCaptureThis}else{this.checker.mustCaptureGlobalThis=true}}}}if(o&&this.thisType){t.type=this.thisType}}}if(n){this.checker.errorReporter.simpleError(t,"Keyword 'this' cannot be referenced in initializers in a class body, or in super constructor calls")}return t};n.prototype.setTypeFromSymbol=function(t,n){if(n.isVariable()){if(n.isInferenceSymbol()){var r=n;if(r.declAST&&!this.checker.typeStatusIsFinished(r.typeCheckStatus)){this.inScopeTypeCheckDecl(r.declAST)}if(!this.checker.styleSettings.innerScopeDeclEscape){if(r.declAST&&r.declAST.nodeType==e.NodeType.VarDecl){if(this.nestingLevel<r.declAST.nestingLevel){this.checker.errorReporter.styleError(t,"Illegal reference to a variable defined in more nested scope")}}}}t.type=n.getType();if(!n.writeable()){t.flags=t.flags&~e.ASTFlags.Writeable}}else{if(n.isType()){t.type=n.getType();t.flags=t.flags&~e.ASTFlags.Writeable}else{t.type=this.anyType;this.checker.errorReporter.symbolDoesNotReferToAValue(t,n.name)}}};n.prototype.typeCheckName=function(t){var n=this;var r=t;if(this.checker.inWith){r.type=this.anyType}else{var i=this.inTypeRefTypeCheck;var s=r.text;var o=s;var u=e.isQuoted(r.text);var a=this.scope.find(s,false,i);if(a==null&&u){a=this.checker.findSymbolForDynamicModule(s,this.currentScript.locationInfo.filename,function(e){return n.scope.find(e,false,i)})}if(!a){if(!r.isMissing()){this.checker.errorReporter.unresolvedSymbol(r,r.text)}r.type=this.anyType}else{if(e.optimizeModuleCodeGen&&a&&a.isType()){var f=a.getType();if(f&&a.aliasLink&&a.onlyReferencedAsTypeRef){var l=f.symbol.declAST;if(l&&e.hasFlag(l.modFlags,e.ModuleFlags.IsDynamic)){a.onlyReferencedAsTypeRef=this.inTypeRefTypeCheck}}}if(a.declAST&&a.declAST.nodeType==e.NodeType.FuncDecl&&!a.declAST.returnTypeAnnotation&&a.declAST.signature.typeCheckStatus==e.TypeCheckStatus.Started){a.declAST.type.symbol.flags|=e.SymbolFlags.RecursivelyReferenced;a.declAST.signature.returnType.type=this.anyType}this.setTypeFromSymbol(t,a);r.sym=a;if(this.thisFnc){if(this.thisFnc.type&&a.container!=this.thisFnc.type.symbol){this.thisFnc.freeVariables[this.thisFnc.freeVariables.length]=a}}}}return t};n.prototype.typeCheckScript=function(e){this.checker.locationInfo=e.locationInfo;this.scope=this.checker.globalScope;if(!e.topLevelMod){this.addLocalsFromScope(this.scope,this.checker.gloMod,e.vars,this.checker.globals,true)}this.currentScript=e;e.bod=this.typeCheck(e.bod);this.currentScript=null;return e};n.prototype.typeCheckBitNot=function(e){var t=e;t.operand=this.typeCheck(t.operand);t.type=this.doubleType;return t};n.prototype.typeCheckUnaryNumberOperator=function(e){var t=e;t.operand=this.typeCheck(t.operand);t.type=this.doubleType;return e};n.prototype.typeCheckLogNot=function(e){var t=e;t.operand=this.typeCheck(t.operand);t.type=this.booleanType;return t};n.prototype.astIsWriteable=function(t){return e.hasFlag(t.flags,e.ASTFlags.Writeable)};n.prototype.typeCheckIncOrDec=function(t){var n=t;var r=n.operand;if(!this.astIsWriteable(n)){this.checker.errorReporter.valueCannotBeModified(n);n.type=this.doubleType}else{n=this.typeCheckUnaryNumberOperator(t);if(n.operand.type!=this.checker.numberType&&n.operand.type!=this.checker.anyType&&!(n.operand.type.typeFlags&e.TypeFlags.IsEnum)){this.checker.errorReporter.simpleError(t,"'++' and '--' may only be applied to operands of type 'number' or 'any'")}}return n};n.prototype.typeCheckBitwiseOperator=function(t,n){var r=t;var i=null;r.operand1=this.typeCheck(r.operand1);r.operand2=this.typeCheck(r.operand2);var s=r.operand1.type;var o=r.operand2.type;if(n&&!this.astIsWriteable(r)){this.checker.errorReporter.valueCannotBeModified(r)}if(this.checker.styleSettings.bitwise){this.checker.errorReporter.styleError(t,"use of "+e.nodeTypeTable[r.nodeType])}if(this.checker.sourceIsSubtypeOfTarget(s,this.doubleType)&&this.checker.sourceIsSubtypeOfTarget(o,this.doubleType)){i=this.doubleType}else{if(s==this.booleanType&&o==this.booleanType){i=this.booleanType}else{if(s==this.anyType){if(o==this.anyType||o==this.doubleType||o==this.booleanType){i=this.anyType}}else{if(o==this.anyType){if(s==this.anyType||s==this.doubleType||s==this.booleanType){i=this.anyType}}}}}if(i==null){i=this.anyType;this.checker.errorReporter.incompatibleTypes(r,s,o,r.printLabel(),this.scope)}r.type=i;return r};n.prototype.typeCheckArithmeticOperator=function(t,n){var r=t;r.operand1=this.typeCheck(r.operand1);r.operand2=this.typeCheck(r.operand2);var i=r.operand1.type;var s=r.operand2.type;if(n&&!this.astIsWriteable(r.operand1)){this.checker.errorReporter.valueCannotBeModified(r)}if(this.checker.styleSettings.bitwise&&(r.nodeType==e.NodeType.And||r.nodeType==e.NodeType.Or||r.nodeType==e.NodeType.AsgAnd||r.nodeType==e.NodeType.AsgOr)){this.checker.errorReporter.styleError(t,"use of "+e.nodeTypeTable[r.nodeType])}if(i==null||s==null){this.checker.errorReporter.simpleError(r,"Could not typecheck arithmetic operation.  Possible recursive typecheck error?");r.type=this.anyType;return r}var o=r.nodeType;if(this.checker.isNullOrUndefinedType(i)){i=s}if(this.checker.isNullOrUndefinedType(s)){s=i}i=this.checker.widenType(i);s=this.checker.widenType(s);if(o==e.NodeType.Add||o==e.NodeType.AsgAdd){if(i==this.checker.stringType||s==this.checker.stringType){r.type=this.checker.stringType}else{if(i==this.checker.numberType&&s==this.checker.numberType){r.type=this.checker.numberType}else{if(this.checker.sourceIsSubtypeOfTarget(i,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(s,this.checker.numberType)){r.type=this.checker.numberType}else{if(i==this.checker.anyType||s==this.checker.anyType){r.type=this.checker.anyType}else{r.type=this.anyType;this.checker.errorReporter.incompatibleTypes(r,i,s,r.printLabel(),this.scope)}}}}}else{if(i==this.checker.numberType&&s==this.checker.numberType){r.type=this.checker.numberType}else{if(this.checker.sourceIsSubtypeOfTarget(i,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(s,this.checker.numberType)){r.type=this.checker.numberType}else{if(i==this.checker.anyType||s==this.checker.anyType){r.type=this.checker.numberType}else{r.type=this.anyType;this.checker.errorReporter.incompatibleTypes(r,i,s,r.printLabel(),this.scope)}}}}return r};n.prototype.typeCheckDotOperator=function(e){var t=e;var n=false;t.operand1=this.typeCheck(t.operand1);var r=t.operand1.type;var i=null;if(r){if(r==this.anyType){t.type=this.anyType;return t}else{if(r==this.stringType){if(this.stringInterfaceType){i=this.stringInterfaceType.memberScope}else{t.type=this.anyType;return t}}else{if(r==this.doubleType){if(this.numberInterfaceType){i=this.numberInterfaceType.memberScope}else{t.type=this.anyType;return t}}else{if(r==this.booleanType){if(this.booleanInterfaceType){i=this.booleanInterfaceType.memberScope}else{t.type=this.anyType;return t}}else{if((r.call||r.construct)&&r.members==null){if(this.functionInterfaceType){i=this.functionInterfaceType.memberScope}else{t.type=this.anyType;return t}}else{if(r.elementType){if(this.arrayInterfaceType){var s=r.elementType.getArrayBase(this.arrayInterfaceType,this.checker);i=s.memberScope}else{t.type=this.anyType;return t}}else{i=r.memberScope}}}}}}}if(i==null){this.checker.errorReporter.expectedClassOrInterface(t);t.type=this.anyType}else{var o=t.operand2;var u=this.thisClassNode&&t.operand1.type==this.thisClassNode.type.instanceType||this.inTypeRefTypeCheck;var a=i.find(o.text,!u,this.inTypeRefTypeCheck);if(!a){if(this.objectInterfaceType&&r){if(r.isReferenceType()){a=this.objectInterfaceType.memberScope.find(o.text,false,this.inTypeRefTypeCheck)}if(!a){if(this.functionInterfaceType&&(r.call||r.construct)){a=this.functionInterfaceType.memberScope.find(o.text,false,this.inTypeRefTypeCheck)}}}}if(!a||!a.visible(i,this.checker)){t.type=this.anyType;if(a==null){this.checker.errorReporter.simpleError(o,"The property '"+o.actualText+"' does not exist on value of type '"+r.getScopedTypeName(this.scope)+"'")}else{if(!this.inTypeRefTypeCheck){this.checker.errorReporter.simpleError(t,"The property '"+o.actualText+" on type '"+r.getScopedTypeName(this.scope)+"' is not visible")}}}else{if(a.isVariable()){if(a.isInferenceSymbol()){var f=a;if(f.declAST&&!this.checker.typeStatusIsFinished(f.typeCheckStatus)){this.inScopeTypeCheckDecl(f.declAST)}}}o.sym=a;t.type=a.getType()}}if(t.type==null){t.type=this.anyType}return t};n.prototype.typeCheckBooleanOperator=function(e){var t=e;t.operand1=this.typeCheck(t.operand1);t.operand2=this.typeCheck(t.operand2);var n=t.operand1.type;var r=t.operand2.type;if(!this.checker.sourceIsAssignableToTarget(n,r)&&!this.checker.sourceIsAssignableToTarget(r,n)){this.checker.errorReporter.incompatibleTypes(t,n,r,t.printLabel(),this.scope)}t.type=this.booleanType;return t};n.prototype.typeCheckAsgOperator=function(t){var n=t;var r=!n.operand2.isParenthesized;n.operand1=this.typeCheck(n.operand1);this.checker.typeCheckWithContextualType(n.operand1.type,this.checker.inProvisionalTypecheckMode(),r,n.operand2);var i=n.operand1.type;var s=n.operand2.type;if(!this.astIsWriteable(n.operand1)){this.checker.errorReporter.valueCannotBeModified(n)}if(n.operand1.nodeType==e.NodeType.Call){var o=n.operand1}var u=false;var a=null;if(n.operand2.type){a=n.operand2.type.containedScope;u=true}n.operand2=this.castWithCoercion(n.operand2,i,r&&!this.checker.inProvisionalTypecheckMode(),false);if(u&&n.operand2.type.containedScope==null){n.operand2.type.containedScope=a}n.type=s;return n};n.prototype.typeCheckIndex=function(t){var n=t;n.operand1=this.typeCheck(n.operand1);n.operand2=this.typeCheck(n.operand2);if(!this.checker.styleSettings.literalSubscript){if(n.operand2.nodeType==e.NodeType.QString){this.checker.errorReporter.styleError(t,"use literal subscript ('.') notation instead)")}}var r=n.operand1.type;var i=n.operand2.type;if(r.elementType){if(i==this.checker.anyType||i==this.checker.numberType||e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum)){n.type=r.elementType}else{if(i==this.checker.stringType){n.type=this.checker.anyType}else{this.checker.errorReporter.simpleError(n,"Illegal property access");n.type=this.checker.anyType}}}else{if(r.index){if(i==this.checker.anyType||!(r.index.flags&e.SignatureFlags.IsStringIndexer||r.index.flags&e.SignatureFlags.IsNumberIndexer)||r.index.flags&e.SignatureFlags.IsStringIndexer&&i==this.checker.stringType||r.index.flags&e.SignatureFlags.IsNumberIndexer&&(i==this.checker.numberType||e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum))){var s=this.resolveOverload(t,r.index);if(s){n.type=s.returnType.type}else{n.type=this.checker.anyType}}else{if(i==this.checker.stringType){n.type=this.checker.anyType}else{this.checker.errorReporter.simpleError(n,"Illegal property access");n.type=this.checker.anyType}}}else{if((r==this.checker.anyType||r==this.checker.stringType||r==this.checker.numberType||r==this.checker.booleanType||r.isReferenceType())&&(i==this.checker.anyType||i==this.checker.stringType||i==this.checker.numberType||e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum))){n.type=this.checker.anyType}else{this.checker.errorReporter.simpleError(n,"Illegal property access");n.type=this.checker.anyType}}}return n};n.prototype.typeCheckInOperator=function(e){e.operand1=this.cast(this.typeCheck(e.operand1),this.stringType);e.operand2=this.typeCheck(e.operand2);if(!((e.operand1.type==this.checker.anyType||e.operand1.type==this.checker.stringType)&&(e.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(e.operand2.type,this.objectInterfaceType)))){this.checker.errorReporter.simpleError(e,"The in operator requires the left operand to be of type Any or the String primitive type, and the right operand to be of type Any or an object type")}e.type=this.booleanType;return e};n.prototype.typeCheckShift=function(e,t){e.operand1=this.cast(this.typeCheck(e.operand1),this.doubleType);e.operand2=this.cast(this.typeCheck(e.operand2),this.doubleType);if(t&&!this.astIsWriteable(e.operand1)){this.checker.errorReporter.valueCannotBeModified(e)}e.type=this.doubleType;return e};n.prototype.typeCheckQMark=function(e){e.operand1=this.typeCheck(e.operand1);e.operand2=this.typeCheck(e.operand2);e.operand3=this.typeCheck(e.operand3);var t=e.operand2.type;var n=e.operand3.type;if(t==n){e.type=t}else{if(this.checker.sourceIsSubtypeOfTarget(t,n)){e.type=n}else{if(this.checker.sourceIsSubtypeOfTarget(n,t)){e.type=t}else{e.type=this.anyType;this.checker.errorReporter.incompatibleTypes(e,t,n,e.printLabel(),this.scope)}}}return e};n.prototype.addFormals=function(e,t,n){var r=t.parameters.length;for(var i=0;i<r;i++){var s=t.parameters[i];s.container=e;n.add(s.name,s)}};n.prototype.addLocalsFromScope=function(t,n,r,i,s){var o=r.members.length;var u=false;for(var a=0;a<o;a++){var f=r.members[a];if(f.sym==null||f.sym.kind()!=e.SymbolKind.Field){var l=null;if((l=i.lookup(f.id.text))==null){var c=new e.ValueLocation;c.typeLink=new e.TypeLink;var h=null;if(e.hasFlag(f.varFlags,e.VarFlags.Static)){f.varFlags|=e.VarFlags.LocalStatic;h=new e.FieldSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,true,c)}else{h=new e.VariableSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,c)}h.transferVarFlags(f.varFlags);c.symbol=h;h.declAST=f;c.typeLink.ast=f.typeExpr;this.checker.resolveTypeLink(t,c.typeLink,false);if(f.type==null&&f.init==null){f.type=this.anyType}c.typeLink.type=f.type;c.symbol.container=n;f.sym=c.symbol;i.add(f.id.text,h);if(f.id.text=="arguments"){u=true}}else{f.type=l.getType();f.sym=l}}}if(!s){if(!u){var p=new e.ValueLocation;p.typeLink=new e.TypeLink;var d=new e.VariableSymbol("arguments",r.minChar,this.checker.locationInfo.unitIndex,p);if(!this.iargumentsInterfaceType){var v=t.find("IArguments",false,true);if(v){v.flags|=e.SymbolFlags.CompilerGenerated;this.iargumentsInterfaceType=v.getType()}else{this.iargumentsInterfaceType=this.anyType}}p.typeLink.type=this.iargumentsInterfaceType;i.add("arguments",d)}}};n.prototype.addConstructorLocalArgs=function(t,n,r,i){if(n){var s=n.members.length;for(var o=0;o<s;o++){var u=n.members[o];if(u.sym==null||i||u.sym.kind()!=e.SymbolKind.Field){var a=null;if((a=r.lookup(u.id.text))==null){this.resolveBoundDecl(u);var f=new e.ValueLocation;f.typeLink=new e.TypeLink;var l=new e.ParameterSymbol(u.id.text,u.minChar,this.checker.locationInfo.unitIndex,f);l.declAST=u;f.symbol=l;f.typeLink.type=u.type;f.symbol.container=t;u.sym=f.symbol;r.add(u.id.text,l)}else{u.type=a.getType();u.sym=a}}}}};n.prototype.checkInitSelf=function(e){if(!e.isMethod()){var t=e.freeVariables;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.isInstanceProperty()){return true}}}var s=e.scopes;var o=s.members.length;for(var u=0;u<o;u++){var a=s.members[u];if(this.checkInitSelf(a)){return true}}return false};n.prototype.checkPromoteFreeVars=function(t,n){var r=t.freeVariables;for(var i=0,s=r.length;i<s;i++){var o=r[i];if(!o.isInstanceProperty()&&o.container==n){e.instanceFilter.reset();if(this.scope.search(e.instanceFilter,o.name,false,false)){this.checker.errorReporter.simpleError(t,"Constructor-local variable shadows class property '"+o.name+"'. To access the class property, use 'self."+o.name+"'")}this.checker.errorReporter.simpleError(t,"Constructor-local variables may not be accessed from instance method bodies. Consider changing local variable '"+o.name+"' to a class property")}}};n.prototype.allReturnsAreVoid=function(t){var n=true;if(t.signature.returnType.type==null){var r=function(t,r,i){var s=true;switch(t.nodeType){case e.NodeType.FuncDecl:{s=false;break};case e.NodeType.Return:{var o=t;if(o.returnExpression){n=false;s=false}};default:{break}}i.options.goChildren=s;i.options.goNextSibling=s;return t};e.getAstWalkerFactory().walk(t.bod,r)}return n};n.prototype.classConstructorHasSuperCall=function(t){var n=false;var r=function(t,r,i){var s=true;switch(t.nodeType){case e.NodeType.FuncDecl:{s=false;break};case e.NodeType.Call:{var o=t;if(o.target.nodeType==e.NodeType.Super){s=false;n=true;break}break};default:{break}}i.options.goChildren=s;return t};e.getAstWalkerFactory().walk(t.bod,r);return n};n.prototype.baseListPrivacyErrorReporter=function(t,n,r,i,s,o){var u=t.members[n].type.symbol;var a=r.declAST.nodeType==e.NodeType.InterfaceDeclaration?"interface":"class";var f=i?"extends":"implements";var l=u.declAST.nodeType==e.NodeType.InterfaceDeclaration?"interface":"class";if(o){l=" "+l+" from private module"}else{l=" private "+l}this.checker.errorReporter.simpleError(t.members[n],"exported "+a+" '"+r.name+"' "+f+l+" '"+s+"'")};n.prototype.typeCheckBaseListPrivacy=function(e,t,n){var r=this;if(e){var i=e.members.length;for(var s=0;s<i;s++){if(e.members[s].type==this.checker.anyType){continue}this.checkSymbolPrivacy(e.members[s].type.symbol,t,function(i,o){return r.baseListPrivacyErrorReporter(e,s,t,n,i,o)})}}};n.prototype.checkSymbolPrivacy=function(t,n,r){var i=false;var s=null;var o=0;var u=null;if(t.isExternallyVisible(this.checker)){var a=t.pathToRoot();s=n.pathToRoot();var f=a.length;o=s.length;if(f>0&&o>0){u=a[f-1];var l=s[o-1];if(u!=l&&u.getType().isModuleType()&&e.isQuoted(u.prettyName)){i=true}}if(!i){return}}var c=n.getInterfaceDeclFromSymbol(this.checker);if(c&&!e.hasFlag(c.varFlags,e.VarFlags.Exported)){return}var h=n;var p=n.getVarDeclFromSymbol();if(p){if(e.hasFlag(p.varFlags,e.VarFlags.Private)){return}else{if(e.hasFlag(p.varFlags,e.VarFlags.Public)){h=n.container}}}var d=n.getImportDeclFromSymbol();if(d){if(!e.hasFlag(d.varFlags,e.VarFlags.Exported)){return}h=n.container}if(h.isExternallyVisible(this.checker)){var v=t.name;if(i){var m=[];v=null;for(var g=0;g<o;g++){var y=s[g].getType();if(y.isModuleType()){m.push(s[g]);var b=y;var w=b.findDynamicModuleName(u.type,"",true,m);if(w!=null){return}if(v==null){v=b.findDynamicModuleName(u.type,"",false,m)}}}}r(v,t.name!=v)}};n.prototype.checkTypePrivacy=function(t,n,r){var i=this;if(!(t&&t.primitiveTypeClass==e.Primitive.None)){return}if(t.isArray()){return this.checkTypePrivacy(t.elementType,n,r)}if(t.symbol&&t.symbol.name&&t.symbol.name!="_anonymous"&&(t.call==null&&t.construct==null&&t.index==null||t.members&&!t.isClass())){return this.checkSymbolPrivacy(t.symbol,n,r)}if(t.members){t.members.allMembers.map(function(t,s,o){var u=s;if(!e.hasFlag(u.flags,e.SymbolFlags.BuiltIn)){i.checkTypePrivacy(u.getType(),n,r)}},null)}this.checkSignatureGroupPrivacy(t.call,n,r);this.checkSignatureGroupPrivacy(t.construct,n,r);this.checkSignatureGroupPrivacy(t.index,n,r)};n.prototype.checkSignatureGroupPrivacy=function(e,t,n){if(e){var r=e.signatures.length;for(var i=0;i<e.signatures.length;i++){var s=e.signatures[i];if(r>1&&s==e.definitionSignature){continue}if(s.returnType){this.checkTypePrivacy(s.returnType.type,t,n)}var o=s.parameters.length;for(var u=0;u<o;u++){var a=s.parameters[u];this.checkTypePrivacy(a.getType(),t,n)}}}};n.prototype.functionArgumentPrivacyErrorReporter=function(t,n,r,i){var s=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor);var o=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.SetAccessor);var u=e.hasFlag(t.fncFlags,e.FncFlags.Public);var a=t.type.symbol.getInterfaceDeclFromSymbol(this.checker)!=null;if(!a){if(t.isConstructor){this.checker.errorReporter.simpleError(t.arguments.members[n],"exported class's constructor parameter '"+r.name+"' has or is using private type '"+i+"'")}else{if(o){this.checker.errorReporter.simpleError(t.arguments.members[n],(u?"public":"exported")+" setter parameter '"+r.name+"' has or is using private type '"+i+"'")}else{if(!s){this.checker.errorReporter.simpleError(t.arguments.members[n],(u?"public":"exported")+" function parameter '"+r.name+"' has or is using private type '"+i+"'")}}}}else{if(t.isConstructMember()){this.checker.errorReporter.simpleError(t.arguments.members[n],"exported interface's constructor parameter '"+r.name+"' has or is using private type '"+i+"'")}else{if(t.isCallMember()){this.checker.errorReporter.simpleError(t.arguments.members[n],"exported interface's call parameter '"+r.name+"' has or is using private type '"+i+"'")}else{if(!t.isIndexerMember()){this.checker.errorReporter.simpleError(t.arguments.members[n],"exported interface's function parameter '"+r.name+"' has or is using private type '"+i+"'")}}}}};n.prototype.returnTypePrivacyError=function(t,n,r){var i=n.isAccessor()&&e.hasFlag(n.fncFlags,e.FncFlags.GetAccessor);var s=n.isAccessor()&&e.hasFlag(n.fncFlags,e.FncFlags.SetAccessor);var o=e.hasFlag(n.fncFlags,e.FncFlags.Public);var u=n.type.symbol.getInterfaceDeclFromSymbol(this.checker)!=null;if(!u){if(i){this.checker.errorReporter.simpleError(t,(o?"public":"exported")+" getter return type has or is using private type '"+r+"'")}else{if(!s){this.checker.errorReporter.simpleError(t,(o?"public":"exported")+" function return type has or is using private type '"+r+"'")}}}else{if(n.isConstructMember()){this.checker.errorReporter.simpleError(t,"exported interface's constructor return type has or is using private type '"+r+"'")}else{if(n.isCallMember()){this.checker.errorReporter.simpleError(t,"exported interface's call return type has or is using private type '"+r+"'")}else{if(n.isIndexerMember()){this.checker.errorReporter.simpleError(t,"exported interface's indexer return type has or is using private type '"+r+"'")}else{this.checker.errorReporter.simpleError(t,"exported interface's function return type has or is using private type '"+r+"'")}}}}};n.prototype.functionReturnTypePrivacyErrorReporter=function(e,t,n){var r=false;if(e.returnTypeAnnotation!=null&&e.returnTypeAnnotation.type==t.returnType.type){this.returnTypePrivacyError(e.returnTypeAnnotation,e,n)}for(var i=0;i<e.returnStatementsWithExpressions.length;i++){if(e.returnStatementsWithExpressions[i].type==t.returnType.type){this.returnTypePrivacyError(e.returnStatementsWithExpressions[i],e,n)}else{r=true}}if(r){this.returnTypePrivacyError(e,e,n)}};n.prototype.typeCheckFunction=function(t){var n=this;this.nestingLevel=0;var r=t.type;var i=r.symbol;var s=t.signature;if(this.checker.typeStatusIsFinished(s.typeCheckStatus)){return t}else{if(s.typeCheckStatus==e.TypeCheckStatus.Started){if(!t.returnTypeAnnotation&&t.bod&&!t.isSignature()&&!t.isConstructor&&this.allReturnsAreVoid(t)){s.returnType.type=this.voidType;return t}else{if(t.returnTypeAnnotation==null){if(this.checker.styleSettings.implicitAny){this.checker.errorReporter.styleError(t,"type implicitly set to 'any'")}s.returnType.type=this.anyType;i.flags|=e.SymbolFlags.RecursivelyReferenced}return t}}}s.typeCheckStatus=e.TypeCheckStatus.Started;this.checker.addStartedPTO(s);var o=this.scope;var u=this.thisFnc;var a=this.enclosingFncIsMethod;var f=this.thisClassNode;this.enclosingFncIsMethod=t.isMethod()||t.isConstructor;this.thisFnc=t;var l=t.type.symbol;var c=this.thisType;var h=this.checker.locationInfo;var p=null;var d=false;var v=null;var m=null;var g=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor);var y=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.SetAccessor);var b=(g||y)&&t.accessorSymbol?t.accessorSymbol.getType():null;var w=this.checker.currentModDecl;if(t.isConstructor&&!t.isOverload){if(r.instanceType==null){this.checker.errorReporter.simpleError(t,"Malformed function body (is this a class named the same as an existing interface?)");return t}this.scope=r.instanceType.constructorScope;var E=this.scope;p=E.valueMembers.allMembers}else{if(t.isSpecialFn()&&!(t.fncFlags&e.FncFlags.Signature)||t.isOverload){p=t.symbols;if(!e.hasFlag(t.fncFlags,e.FncFlags.Static)&&r.containedScope){this.scope=r.containedScope}}else{if(t.bod){this.scope=r.containedScope}var E=this.scope;if(E&&E.valueMembers){p=E.valueMembers.allMembers}}}if(t.isConstructor&&t.bod&&e.hasFlag(t.fncFlags,e.FncFlags.ClassMethod)){var S=e.hasFlag(t.classDecl.type.instanceType.typeFlags,e.TypeFlags.HasBaseType);var x=!S||e.hasFlag(t.classDecl.type.instanceType.typeFlags,e.TypeFlags.HasBaseTypeOfObject);var T=e.hasFlag(t.classDecl.varFlags,e.VarFlags.ClassSuperMustBeFirstCallInConstructor);if(x&&this.classConstructorHasSuperCall(t)){this.checker.errorReporter.simpleError(t,"Calls to 'super' constructor are not allowed in classes that either inherit directly from 'Object' or have no base class")}else{if(S){if(T){if(!t.bod||!t.bod.members.length||!(t.bod.members[0].nodeType==e.NodeType.Call&&t.bod.members[0].target.nodeType==e.NodeType.Super||e.hasFlag(t.bod.flags,e.ASTFlags.StrictMode)&&t.bod.members.length>1&&t.bod.members[1].nodeType==e.NodeType.Call&&t.bod.members[1].target.nodeType==e.NodeType.Super)){this.checker.errorReporter.simpleError(t,"If a derived class contains initialized properties or constructor parameter properties, the first statement in the constructor body must be a call to the super constructor")}}else{if(!this.classConstructorHasSuperCall(t)){this.checker.errorReporter.simpleError(t,"Constructors for derived classes must contain a call to the class's 'super' constructor")}}}}}if(t.isMethod()&&t.type.enclosingType){var N=null;if(t.type.enclosingType.symbol.declAST.nodeType==e.NodeType.FuncDecl){N=t.type.enclosingType.symbol.declAST.classDecl}else{if(t.type.enclosingType.symbol.declAST.nodeType==e.NodeType.ClassDeclaration){N=t.type.enclosingType.symbol.declAST}}if(N){this.thisClassNode=N}}if(r.enclosingType){var C=r.symbol.container;if(C&&C.isType()&&C.getType().isClass()){C=C.container}if(C&&C.declAST&&C.declAST.nodeType==e.NodeType.ModuleDeclaration){this.checker.currentModDecl=C.declAST}}if(t.unitIndex>0){if(this.checker.units&&t.unitIndex<this.checker.units.length){this.checker.locationInfo=this.checker.units[t.unitIndex]}else{this.checker.locationInfo=e.unknownLocationInfo}}if(r.enclosingType){this.thisType=r.enclosingType}else{this.thisType=c}var k=s.parameters.length;if(!t.isConstructor&&t.bod&&!t.isSignature()){var L=this.scope;var E=this.scope;if(!t.isMethod()&&t.returnTypeAnnotation==null){if(o&&t.name&&!t.name.isMissing()){var A=o.findAmbient(t.name.text,false,false);if(A&&A.declAST&&A.declAST.type){this.checker.setContextualType(A.declAST.type,false)}}if(this.checker.hasTargetType()){var O=this.checker.getTargetTypeContext();var M=O.contextualType;if(this.checker.canContextuallyTypeFunction(M,t,true)){var _=M.construct?M.construct:M.call;O.targetSig=_.signatures[0];var D=O.targetSig.parameters;v=D;m=O.targetSig.returnType.type;if(O.targetSig.declAST){if(O.targetSig.declAST.isConstructor){t.isTargetTypedAsMethod=true}else{if(O.targetSig.declAST.isMethod()){t.isTargetTypedAsMethod=true}}}i.type=O.contextualType;d=true}else{if(M&&t.isAccessor()){b=M;O.targetAccessorType=b}else{this.checker.killCurrentContextualType()}}}}var P=E.valueMembers;this.scope=new e.SymbolScopeBuilder(P,null,null,null,o,l);for(var H=0;H<k;H++){var B=s.parameters[H];var j=B.declAST;if(this.checker.hasTargetType()&&v&&(this.checker.getTargetTypeContext().targetSig.hasVariableArgList||H<v.length)){var O=this.checker.getTargetTypeContext();var F=O.targetSig.hasVariableArgList;j.type=F&&H>=v.length-1?v[v.length-1].getType().elementType:v[H].getType();j.sym.setType(j.type);j.sym.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else{this.typeCheck(j)}if(y&&b){j=this.cast(j,b)}B.container=l;this.checkTypePrivacy(B.getType(),l,function(e){return n.functionArgumentPrivacyErrorReporter(t,H,B,e)});P.publicMembers.add(B.name,B)}this.scope=L}else{this.typeCheck(t.arguments);for(var H=0;H<k;H++){s.parameters[H].parameter.typeLink.type=t.arguments.members[H].type;this.checkTypePrivacy(s.parameters[H].getType(),l,function(e){return n.functionArgumentPrivacyErrorReporter(t,H,s.parameters[H],e)});if(t.arguments.members[H].parameterPropertySym){t.arguments.members[H].parameterPropertySym.setType(t.arguments.members[H].type)}}if(t.fncFlags&e.FncFlags.IndexerMember){if(!k||k>1){this.checker.errorReporter.simpleError(t,"Index signatures may take one and only one parameter")}else{if(t.arguments.members[0].type==this.checker.numberType){r.index.flags|=e.SignatureFlags.IsNumberIndexer}else{if(t.arguments.members[0].type==this.checker.stringType){r.index.flags|=e.SignatureFlags.IsStringIndexer}else{this.checker.errorReporter.simpleError(t.arguments.members[0],"Index signatures may only take 'string' or 'number' as their parameter")}}}}}if(t.bod&&!t.isSignature()){if(!t.isConstructor){this.addFormals(l,s,p)}else{this.addConstructorLocalArgs(t.type.symbol,t.arguments,p,e.hasFlag(t.fncFlags,e.FncFlags.ClassMethod));if(this.thisClassNode&&this.thisClassNode.extendsList){var I=this.scope;var q=new e.ScopedMembers(p);this.scope=new e.FilteredSymbolScopeBuilder(q,o,t.type.symbol,function(t){return t.kind()==e.SymbolKind.Parameter});this.typeCheckBaseCalls(this.thisClassNode.extendsList);this.scope=I}}var R=this.checker.currentModDecl;if(t.type&&t.type.symbol&&!t.isMethod()&&t.type.symbol.declModule){this.checker.currentModDecl=t.type.symbol.declModule}if(d){this.checker.setContextualType(null,this.checker.inProvisionalTypecheckMode())}this.typeCheck(t.bod);if(d){this.checker.unsetContextualType()}this.checker.currentModDecl=R;if(this.checker.checkControlFlow){var U=t.buildControlFlow();if(this.checker.printControlFlowGraph){U.print(this.checker.errorReporter.outfile)}U.reportUnreachable(this.checker.errorReporter);if(this.checker.checkControlFlowUseDef){U.useDef(this.checker.errorReporter,t.type.symbol)}}if(t.isConstructor){var z=t.scopes;var W=z.members.length;var X;var V;var $=0;for(;$<W;$++){var J=z.members[$];if(!J.isSignature()){if(e.hasFlag(J.fncFlags,e.FncFlags.Method)&&!e.hasFlag(J.fncFlags,e.FncFlags.Static)){this.checkPromoteFreeVars(J,t.type.symbol)}}}}}this.scope=o;this.thisFnc=u;this.thisClassNode=f;this.enclosingFncIsMethod=a;this.thisType=c;this.checker.locationInfo=h;this.checker.currentModDecl=w;s.typeCheckStatus=this.checker.getTypeCheckFinishedStatus();if(t.returnTypeAnnotation){this.checkForVoidConstructor(t.returnTypeAnnotation.type,t.returnTypeAnnotation);if(s.returnType.type==null){this.checker.resolveTypeLink(this.scope,s.returnType,false)}}else{if(m){s.returnType.type=m}}if(!(i.flags&e.SymbolFlags.RecursivelyReferenced)&&t.returnStatementsWithExpressions.length>0){var K={getLength:function(){return t.returnStatementsWithExpressions.length},setTypeAtIndex:function(e,n){t.returnStatementsWithExpressions[e].type=n},getTypeAtIndex:function(e){return t.returnStatementsWithExpressions[e].type}};var Q=t.returnStatementsWithExpressions[0].type;Q=this.checker.findBestCommonType(Q,null,K,true);if(Q){s.returnType.type=this.checker.widenType(Q)}else{for(var G=0;G<t.returnStatementsWithExpressions.length;G++){this.checker.errorReporter.simpleError(t.returnStatementsWithExpressions[G],"Incompatible return type")}s.returnType.type=this.anyType}}if(s.returnType.type==null){if(e.hasFlag(t.fncFlags,e.FncFlags.HasReturnExpression)){if(this.checker.styleSettings.implicitAny){this.checker.errorReporter.styleError(t,"type implicitly set to 'any'")}s.returnType.type=this.anyType}else{s.returnType.type=this.voidType}}else{if(s.returnType.type==this.nullType||s.returnType.type==this.checker.undefinedType){s.returnType.type=this.anyType}else{if(s.returnType.type!=this.voidType&&s.returnType.type!=this.checker.undefinedType&&s.returnType.type!=this.anyType){if(!t.isSignature()&&!t.isConstructor&&!e.hasFlag(t.fncFlags,e.FncFlags.HasReturnExpression)&&!e.hasFlag(t.fncFlags,e.FncFlags.IsFatArrowFunction)){var Y=t.bod.members.length>0&&t.bod.members[0].nodeType==e.NodeType.Throw;if(!Y){this.checker.errorReporter.simpleError(t,"Function declared a non-void return type, but has no return expression")}}this.checkTypePrivacy(s.returnType.type,l,function(e){return n.functionReturnTypePrivacyErrorReporter(t,s,e)})}}}if(t.accessorSymbol){var b=t.accessorSymbol.getType();if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)&&!e.hasFlag(t.fncFlags,e.FncFlags.HasReturnExpression)){this.checker.errorReporter.simpleError(t,"Getters must return a value")}if(b){if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)&&b!=s.returnType.type||t.arguments.members.length>0&&b!=t.arguments.members[0].type){this.checker.errorReporter.simpleError(t,"Getter and setter types do not agree")}}else{if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)){t.accessorSymbol.setType(s.returnType.type)}else{if(t.arguments.members.length!=1){this.checker.errorReporter.simpleError(t,"Setters may have one and only one argument")}else{t.accessorSymbol.setType(t.arguments.members[0].type)}}}}this.typeCheckOverloadSignatures(r,t);return t};n.prototype.typeCheckBases=function(t){var n=false;var r=t.extendsList;if(r){var i=r.length;if(i>0){t.typeFlags|=e.TypeFlags.HasBaseType}for(var s=0;s<i;s++){var o=r[s];var u=o.symbol&&o.symbol.name=="Object"&&o.symbol.container==this.checker.gloMod;if(u){t.typeFlags|=e.TypeFlags.HasBaseTypeOfObject}if(o.isClassInstance()){if(this.currentScript){this.currentScript.requiresInherits=true}if(!t.isClassInstance()){this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Interface base type must be interface")}else{if(n){this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Class may not follow interface as base type")}}}else{if(o.isModuleType()){this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Types may not be derived from module types")}else{if(o.members){if(!n){n=true}}else{if(!t.isClassInstance()){this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Interface base type must be interface")}else{this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Base type must be interface or class")}break}}}}}};n.prototype.checkMembersImplementInterfaces=function(t){var n=t.getInstanceType();if(n.implementsList){var r=n.implementsList.length;for(var i=0;i<r;i++){var s=n.implementsList[i];var o=new e.TypeComparisonInfo;if(!this.checker.sourceIsSubtypeOfTarget(n,s,o)){var u="Class '"+n.getTypeName()+"' declares interface '"+s.getTypeName()+"' but does not implement it";if(!o.message){this.checker.errorReporter.simpleErrorFromSym(n.symbol,u)}else{this.checker.errorReporter.simpleErrorFromSym(n.symbol,u+": "+o.message)}}}}};n.prototype.typeCheckBaseCalls=function(t){if(t==null){return}var n=t.members.length;for(var r=0;r<n;r++){var i=t.members[r];var s=null;if(i.nodeType==e.NodeType.Call){this.typeCheckNew(i)}}};n.prototype.assertUniqueNamesInBaseTypes=function(t,n,r,i){var s=this;if(n){if(n.members){n.members.publicMembers.map(function(e,o,u){var a=o;var f=t.lookup(a.name);if(f){if(i){s.checker.errorReporter.simpleError(r,"duplicate member name in bases for "+r.name.actualText+": "+n.symbol.name+" and "+f.container.name+" both contain member with name "+a.name)}}else{t.add(a.name,a)}},null)}if(n.extendsList){var o=n.extendsList.length;for(var u=0;u<o;u++){if(!(n.extendsList[u].symbol.flags&e.SymbolFlags.RecursivelyReferenced)){this.assertUniqueNamesInBaseTypes(t,n.extendsList[u],r,i)}}}}};n.prototype.checkBaseTypeMemberInheritance=function(t,n){var r=this;var i=t.getInstanceType();if(i.extendsList==null){return}var s=i.extendsList.length;if(s>0){var o=new e.StringHashTable;if(i.isClassInstance()){for(var u=0;u<s;u++){this.assertUniqueNamesInBaseTypes(o,i.extendsList[u],n,u>0)}}if(i.members){i.members.publicMembers.map(function(t,o,u){var a=o;for(var f=0;f<s;f++){var l=i.extendsList[f];if(l.memberScope==null){r.checker.errorReporter.simpleError(n,"Base type '"+l.symbol.name+"' lacks an implementation.")}else{var c=l.memberScope.find(a.name,false,false);if(c){var h=a.getType();var p=c.getType();if(!r.checker.sourceIsSubtypeOfTarget(h,p)){r.checker.errorReporter.simpleErrorFromSym(a,"Type of overridden member '"+a.name+"' is not subtype of original member defined by type '"+c.container.name+"'")}else{if(a.kind()==e.SymbolKind.Type&&c.kind()==e.SymbolKind.Field){r.checker.errorReporter.simpleErrorFromSym(a,"Cannot override field '"+a.name+"' with method")}}}}}},null)}}};n.prototype.typeCheckClass=function(t){var n=t.type.symbol;if(n.typeCheckStatus==e.TypeCheckStatus.Finished){return t}else{if(n.typeCheckStatus==e.TypeCheckStatus.Started){return t}else{n.typeCheckStatus=e.TypeCheckStatus.Started;this.checker.addStartedPTO(n)}}var r=this.scope;var i=this.inBoundPropTypeCheck;this.inBoundPropTypeCheck=false;var s=this.thisClassNode;this.thisClassNode=t;var o=t.type;this.typeCheckBases(o.instanceType);this.typeCheckBaseListPrivacy(t.extendsList,n,true);this.typeCheckBaseListPrivacy(t.implementsList,n,false);var u=this.thisType;this.thisType=o.instanceType;this.scope=o.instanceType.containedScope;if(t.constructorDecl){this.scope=o.instanceType.constructorScope;var a=this.scope;var f=a.valueMembers.allMembers;this.addConstructorLocalArgs(t.constructorDecl.type.symbol,t.constructorDecl.arguments,f,true)}this.typeCheck(t.members);n.typeCheckStatus=e.TypeCheckStatus.Finished;this.checkBaseTypeMemberInheritance(o,t);this.checkMembersImplementInterfaces(o);this.typeCheckOverloadSignatures(o,t);this.typeCheckOverloadSignatures(o.instanceType,t);if(!t.constructorDecl){if(t.extendsList&&t.extendsList.members.length&&t.extendsList.members[0].type&&t.extendsList.members[0].type.symbol.type.isClass()){e.cloneParentConstructGroupForChildType(t.type,t.extendsList.members[0].type.symbol.type)}}this.inBoundPropTypeCheck=i;this.thisType=u;this.thisClassNode=s;this.scope=r;return t};n.prototype.typeCheckOverloadSignatures=function(e,t){if(e.call){e.call.typeCheck(this.checker,t,e.construct!=null)}if(e.construct){e.construct.typeCheck(this.checker,t,false)}if(e.index){e.index.typeCheck(this.checker,t,false)}};n.prototype.typeCheckInterface=function(e){this.typeCheckBases(e.type);this.typeCheckBaseListPrivacy(e.extendsList,e.type.symbol,true);this.typeCheck(e.members);this.checkBaseTypeMemberInheritance(e.type,e);if(e.extendsList){for(var t=0;t<e.extendsList.members.length;t++){if(e.extendsList.members[t].type.call){if(e.type.call){e.type.call.signatures=e.type.call.signatures.concat(e.extendsList.members[t].type.call.signatures)}else{e.type.call=e.extendsList.members[t].type.call}}if(e.extendsList.members[t].type.construct){if(e.type.construct){e.type.construct.signatures=e.type.construct.signatures.concat(e.extendsList.members[t].type.construct.signatures)}else{e.type.construct=e.extendsList.members[t].type.construct}}if(e.extendsList.members[t].type.index){if(e.type.index){e.type.index.signatures=e.type.index.signatures.concat(e.extendsList.members[t].type.index.signatures)}else{e.type.index=e.extendsList.members[t].type.index}}}}return e};n.prototype.typeCheckImportDecl=function(t){var n=this;var r=t.alias.type;var i=null;var s=this.inImportTypeCheck;this.inImportTypeCheck=true;this.typeCheck(t.alias);r=t.alias.type;if(r==null){this.checker.errorReporter.simpleError(t.alias,"Could not resolve module alias '"+t.id.actualText+"'");r=this.checker.anyType;t.id.sym.type=r}t.id.type=r;i=r.symbol;if(!r.isModuleType()){this.checker.errorReporter.simpleError(t.alias,"A module cannot be aliased to a non-module type")}else{i.type=r;if(this.checker.typeFlow.currentScript&&this.checker.typeFlow.currentScript.topLevelMod&&this.checker.typeFlow.currentScript.topLevelMod.mod){this.checker.typeFlow.currentScript.topLevelMod.mod.importedModules.push(t)}t.id.sym.type=r;if(r.symbol&&r.symbol.declAST){r.symbol.declAST.modFlags&=~e.ModuleFlags.ShouldEmitModuleDecl}this.checkSymbolPrivacy(r.symbol,t.id.sym,function(i){var s="";if(!e.isQuoted(r.symbol.name)){s="'"}n.checker.errorReporter.simpleError(t,"exported module '"+t.id.sym.name+"' imports non exported module "+s+r.symbol.name+s)})}this.inImportTypeCheck=s;return t};n.prototype.typeCheckModule=function(t){if(!t.mod){return t}if(this.currentScript){this.currentScript.requiresGlobal=true}var n=t.mod;var r=null;var i=this.inBoundPropTypeCheck;var s=this.scope;var o=this.thisType;var u=this.checker.currentModDecl;this.checker.currentModDecl=t;this.inBoundPropTypeCheck=false;if(!this.inImportTypeCheck&&u&&e.hasFlag(t.modFlags,e.ModuleFlags.IsDynamic)&&!e.hasFlag(t.modFlags,e.ModuleFlags.Ambient)){this.checker.errorReporter.simpleError(t,"Dynamic modules may not be nested within other modules")}this.thisType=null;this.scope=n.containedScope;this.typeCheck(t.members);r=n.symbol;this.checker.currentModDecl=u;this.thisType=o;this.scope=s;this.inBoundPropTypeCheck=i;t.type=n;if(r){r.typeCheckStatus=e.TypeCheckStatus.Finished}return t};n.prototype.typeCheckFor=function(e){e.init=this.typeCheck(e.init);this.nestingLevel++;e.cond=this.typeCheck(e.cond);this.typeCheckCondExpr(e.cond);e.incr=this.typeCheck(e.incr);this.nestingLevel--;e.body=this.typeCheck(e.body);this.typeCheckCompoundStmtBlock(e.body,"for statement");e.type=this.voidType;return e};n.prototype.typeCheckWith=function(e){if(this.checker.errorsOnWith){this.checker.errorReporter.simpleError(e.expr,"All symbols within a 'with' block will be typed as 'any'")}e.expr=this.typeCheck(e.expr);this.checker.inWith=true;e.body=this.typeCheck(e.body);this.typeCheckCompoundStmtBlock(e.body,"with statement");this.checker.inWith=false;return e};n.prototype.typeCheckForIn=function(t){t.obj=this.typeCheck(t.obj);t.lval=this.cast(this.typeCheck(t.lval),this.checker.stringType);if(t.lval.nodeType==e.NodeType.VarDecl){var n=t.lval;if(n.typeExpr){this.checker.errorReporter.simpleError(n,"Variable declarations for for/in expressions may not contain a type annotation")}if(n.sym){n.sym.setType(this.checker.stringType)}}t.body=this.typeCheck(t.body);this.typeCheckCompoundStmtBlock(t.body,"for in statement");return t};n.prototype.typeCheckWhile=function(e){e.cond=this.typeCheck(e.cond);this.typeCheckCondExpr(e.cond);e.body=this.typeCheck(e.body);this.typeCheckCompoundStmtBlock(e.body,"while statement");e.type=this.voidType;return e};n.prototype.typeCheckDoWhile=function(e){e.cond=this.typeCheck(e.cond);this.typeCheckCondExpr(e.cond);e.body=this.typeCheck(e.body);this.typeCheckCompoundStmtBlock(e.body,"do while statement");e.type=this.voidType;return e};n.prototype.typeCheckCondExpr=function(t){if(this.checker.styleSettings.assignmentInCond){if(t!==null&&t.nodeType>=e.NodeType.Asg&&t.nodeType<=e.NodeType.LastAsg){this.checker.errorReporter.simpleError(t,"top-level assignment statement in conditional expression")}}};n.prototype.typeCheckCompoundStmtBlock=function(t,n){if(this.checker.styleSettings.blockInCompoundStmt&&t){if(t.nodeType!=e.NodeType.Block){this.checker.errorReporter.styleError(t,n+" requires a block")}}};n.prototype.typeCheckIf=function(e){e.cond=this.typeCheck(e.cond);this.typeCheckCondExpr(e.cond);e.thenBod=this.typeCheck(e.thenBod);e.elseBod=this.typeCheck(e.elseBod);this.typeCheckCompoundStmtBlock(e.thenBod,"if statement");this.typeCheckCompoundStmtBlock(e.elseBod,"if statement");e.type=this.voidType;return e};n.prototype.typeFromAccessorFuncDecl=function(t){if(!t.isAccessor()){return null}if(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)){return t.type.call.signatures[0].returnType.type}else{return t.type.call.signatures[0].parameters[0].getType()}};n.prototype.typeCheckObjectLit=function(t){var n=new e.Type;n.symbol=new e.TypeSymbol(this.checker.anon,t.minChar,this.checker.locationInfo.unitIndex,n);n.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));n.memberScope=new e.SymbolTableScope(n.members,null,null,null,null);var r=new e.SymbolAggregateScope(n.symbol);r.addParentScope(n.memberScope);r.addParentScope(this.scope);n.containedScope=r;var i=t.operand;var s=this.thisType;var o=false;var u=null;if(this.checker.hasTargetType()){u=this.checker.getTargetTypeContext().contextualType;if(u&&u.symbol&&!this.checker.typeStatusIsFinished(u.symbol.typeCheckStatus)){if(u.symbol.declAST){this.typeCheck(u.symbol.declAST)}}o=true}if(i){for(var a=0,f=i.members.length;a<f;a++){var l=i.members[a];var c=l.operand1;var h;var p=null;var d=null;if(c.nodeType==e.NodeType.Name){h=c.text}else{if(c.nodeType==e.NodeType.QString){var v=c.text;h=v.substring(1,v.length-1)}else{this.checker.errorReporter.simpleError(t,"malformed object literal");n=this.anyType;break}}if(o&&u.memberScope){p=u.memberScope.find(h,false,false)}if(l.operand2.nodeType==e.NodeType.FuncDecl&&l.operand2.isAccessor()){var m=l.operand2;var g=n.members.publicMembers.lookup(h);g=this.checker.createAccessorSymbol(m,g,n,true,false,n.memberScope,null);m.accessorSymbol=g;d=g;if(c.nodeType==e.NodeType.Name){c.sym=g}}this.checker.typeCheckWithContextualType(o&&p?p.getType():null,false,o,l.operand2);if(o&&p){if(l.operand2.type==this.anyType||this.checker.sourceIsAssignableToTarget(l.operand2.type,p.getType())||l.operand2.nodeType==e.NodeType.FuncDecl&&l.operand2.isAccessor()&&this.typeFromAccessorFuncDecl(l.operand2)==p.getType()){l.operand1.type=p.getType()}}else{l.operand2.type=l.operand2.type==this.checker.undefinedType?this.anyType:l.operand2.type}if(d==null){var y=l.operand2.type;var b=new e.ValueLocation;d=new e.FieldSymbol(h,c.minChar,this.checker.locationInfo.unitIndex,true,b);d.flags|=e.SymbolFlags.Property;b.symbol=d;d.typeCheckStatus=this.checker.getTypeCheckFinishedStatus();b.typeLink=new e.TypeLink;b.typeLink.type=y;n.members.publicMembers.add(h,d)}d.isObjectLitField=true}}this.thisType=s;t.type=n;if(u){t.targetType=u}};n.prototype.typeCheckArrayLit=function(t){var n=t.operand;var r=this.anyType;var i=null;var s=new e.TypeComparisonInfo;s.onlyCaptureFirstError=true;if(this.checker.hasTargetType()){var o=this.checker.getTargetTypeContext().contextualType;if(o.elementType){i=o.elementType}}if(n){var u=this.inArrayElementTypeCheck;this.inArrayElementTypeCheck=true;this.checker.typeCheckWithContextualType(i,this.checker.inProvisionalTypecheckMode(),i!=null,n);this.inArrayElementTypeCheck=u;r=n.members[0].type;var a={getLength:function(){return n.members.length},setTypeAtIndex:function(e,t){n.members[e].type=t},getTypeAtIndex:function(e){return n.members[e].type}};r=this.checker.findBestCommonType(r,i,a,false,s);if(r==this.checker.undefinedType||!u&&r==this.nullType){r=this.anyType}}if(!r){var f="Incompatible types in array literal expression";if(!s.message){this.checker.errorReporter.simpleError(t,f)}else{this.checker.errorReporter.simpleError(t,f+": "+s.message)}r=this.anyType}else{if(i){if(this.checker.sourceIsAssignableToTarget(r,i)){r=i}}}t.type=this.checker.makeArrayType(r)};n.prototype.checkForVoidConstructor=function(e,t){if(e&&e.construct&&e.construct.signatures.length>0){for(var n=0;n<e.construct.signatures.length;n++){if(e.construct.signatures[n].returnType.type==this.checker.voidType){this.checker.errorReporter.simpleError(t,"Constructors may not have a return type of 'void'");break}}}};n.prototype.typeCheckReturn=function(t){if(this.thisFnc){var n=null;if(this.checker.hasTargetType()){var r=this.checker.getTargetTypeContext();var i=r.targetAccessorType;if(i){n=i}else{var s=this.checker.getTargetTypeContext().targetSig;if(s&&s.returnType.type!=this.voidType){n=s.returnType.type}}}if(t.returnExpression){this.thisFnc.fncFlags|=e.FncFlags.HasReturnExpression;if(n==null&&this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type&&this.thisFnc.returnTypeAnnotation.type!=this.voidType){n=this.thisFnc.returnTypeAnnotation.type}this.checker.typeCheckWithContextualType(n,this.checker.inProvisionalTypecheckMode(),n!=null,t.returnExpression);var o=this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type?this.thisFnc.returnTypeAnnotation.type:n;if(o){if(o==this.voidType&&t.returnExpression.type!=this.voidType){this.checker.errorReporter.simpleError(t,"Return with value expression in void function");t.type=t.returnExpression.type}else{t.returnExpression=this.cast(t.returnExpression,o);t.type=o}}else{if(n){if(t.returnExpression.type!=this.voidType){t.returnExpression=this.cast(t.returnExpression,n)}else{t.returnExpression.type=n}}t.type=t.returnExpression.type}this.thisFnc.returnStatementsWithExpressions[this.thisFnc.returnStatementsWithExpressions.length]=t}else{t.type=n==null?this.checker.voidType:n}}return t};n.prototype.typeCheckInstOf=function(e){var t=e;t.operand1=this.typeCheck(t.operand1);t.operand2=this.typeCheck(t.operand2);if(!((t.operand1.type==this.checker.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand1.type,this.objectInterfaceType))&&(t.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand2.type,this.functionInterfaceType)))){this.checker.errorReporter.simpleError(e,"The instanceof operator requires the left operand to be of type Any or an object type, and the right operand to be of type Any or a subtype of the Function interface type")}t.type=this.booleanType;return t};n.prototype.typeCheckCommaOperator=function(e){var t=e;t.operand1=this.typeCheck(t.operand1);t.operand2=this.typeCheck(t.operand2);t.type=t.operand2.type;return t};n.prototype.typeCheckLogOr=function(e){e.operand1=this.typeCheck(e.operand1);e.operand2=this.typeCheck(e.operand2);var t=e.operand1.type;var n=e.operand2.type;if(t==this.checker.anyType||n==this.checker.anyType){e.type=this.checker.anyType}else{if(t==this.checker.booleanType){if(n==this.checker.booleanType){e.type=this.checker.booleanType}else{e.type=this.checker.anyType}}else{if(t==this.checker.numberType){if(n==this.checker.numberType){e.type=this.checker.numberType}else{e.type=this.checker.anyType}}else{if(t==this.checker.stringType){if(n==this.checker.stringType){e.type=this.checker.stringType}else{e.type=this.checker.anyType}}else{if(this.checker.sourceIsSubtypeOfTarget(t,n)){e.type=n}else{if(this.checker.sourceIsSubtypeOfTarget(n,t)){e.type=t}else{e.type=this.checker.anyType}}}}}}return e};n.prototype.typeCheckLogAnd=function(e){e.operand1=this.typeCheck(e.operand1);e.operand2=this.typeCheck(e.operand2);e.type=e.operand2.type;return e};n.prototype.tryAddCandidates=function(e,t,n,r,i){var s=e.nonOptionalParameterCount;var o=e.parameters.length;var u=s;var a=false;if(t.length>=s&&(e.hasVariableArgList||t.length<=o)){u=e.hasVariableArgList?e.parameters.length:t.length;a=true}var f=null;if(a||e.hasVariableArgList){if(e.hasVariableArgList){u-=1;f=e.parameters[u].parameter.typeLink.type;f=f.elementType;a=t.length>=u}var l=t.length;var c=a;var h=a;for(var p=0;p<l;p++){var d;if(p<u){d=e.parameters[p].parameter.typeLink.type}else{d=f}var v=t[p];if(!d||!v||!this.checker.typesAreIdentical(d,v)){c=false}if(!this.checker.sourceIsAssignableToTarget(v,d,i)){h=false}if(!(c||h)){break}}if(c){n[n.length]=e}else{if(h&&n.length==0){r[r.length]=e}}}};n.prototype.resolveOverload=function(t,n){var r=this.resolutionDataCache.getResolutionData();var i=r.actuals;var s=r.exactCandidates;var o=r.conversionCandidates;var u=null;var a=n.signatures.length>1;var f=new e.TypeComparisonInfo;var l=null;var c=null;if(t.nodeType==e.NodeType.Call||t.nodeType==e.NodeType.New){var h=t;l=h.arguments;c=h.target;if(h.arguments){var p=h.arguments.members.length;for(var d=0;d<p;d++){i[d]=h.arguments.members[d].type}}}else{if(t.nodeType==e.NodeType.Index){var v=t;c=v.operand1;l=new e.ASTList;l.members[0]=v.operand2;i[0]=v.operand2.type}}for(var m=0,g=n.signatures.length;m<g;m++){var y=n.signatures[m];if(a&&y==n.definitionSignature&&!this.checker.canCallDefinitionSignature){continue}if(!y.returnType.type&&y.declAST&&y.typeCheckStatus!=e.TypeCheckStatus.Finished){this.typeCheckFunction(y.declAST)}this.tryAddCandidates(y,i,s,o,f)}if(s.length==0){var b=this.checker.getApplicableSignatures(o,l,f);if(b.length>0){var w=this.checker.findMostApplicableSignature(b,l);if(w.ambiguous){this.checker.errorReporter.simpleError(c,"Ambiguous call expression - could not choose overload")}u=w.sig}else{var E="Supplied parameters do not match any signature of call target";if(f.message){this.checker.errorReporter.simpleError(c,E+":\n	"+f.message)}else{this.checker.errorReporter.simpleError(c,E)}}}else{if(s.length>1){var S=[];for(var d=0;d<s.length;d++){S[d]={signature:s[d],hadProvisionalErrors:false}}var w=this.checker.findMostApplicableSignature(S,l);if(w.ambiguous){this.checker.errorReporter.simpleError(c,"Ambiguous call expression - could not choose overload")}u=w.sig}else{u=s[0]}}this.resolutionDataCache.returnResolutionData(r);return u};n.prototype.typeCheckNew=function(e){var t=e;t.target=this.typeCheck(t.target);var n=t.target;if(n.type.construct||n.type.call){this.preTypeCheckCallArgs(t.arguments)}else{t.arguments=this.typeCheck(t.arguments)}if(n.type==this.anyType){t.type=this.anyType;t.arguments=this.typeCheck(t.arguments)}else{if(n.type.construct){var r=this.resolveOverload(t,n.type.construct);if(r==null){t.type=this.anyType}else{if(r.returnType.type==this.voidType){t.type=this.anyType;t.signature=r}else{t.type=r.returnType.type;t.signature=r}}}else{if(n.type.call){var r=this.resolveOverload(t,n.type.call);if(r==null){t.type=this.anyType}else{if(r.returnType.type==this.voidType||r.returnType.type==this.anyType){t.type=this.anyType;t.signature=r}else{this.checker.errorReporter.simpleError(t.target,"new expression only valid on constructors")}}}else{if(n.type.elementType){t.type=n.type}else{this.checker.errorReporter.invalidCall(t,t.nodeType,this.scope);t.type=this.anyType}}}}this.postTypeCheckCallArgs(t);return t};n.prototype.preTypeCheckCallArgs=function(t){if(!t){return}for(var n=0;n<t.members.length;n++){switch(t.members[n].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:{continue};default:{this.typeCheck(t.members[n]);break}}}};n.prototype.postTypeCheckCallArgs=function(t){var n=false;var r=0;if(t.target&&t.target.type&&t.signature&&t.arguments){var i=t.signature;if(i&&t.arguments.members.length>=i.nonOptionalParameterCount){n=true;var s=null;var o=t.arguments.members.length<i.parameters.length?t.arguments.members.length:i.parameters.length;for(r=0;r<o;r++){s=i.parameters[r].getType();if(s&&i.hasVariableArgList&&r>=i.nonOptionalParameterCount-1){s=s.elementType}switch(t.arguments.members[r].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:{this.checker.typeCheckWithContextualType(s,this.checker.inProvisionalTypecheckMode(),!i.parameters[r].declAST.isParenthesized,t.arguments.members[r]);break};default:{continue}}}}}if(!n&&t.arguments){this.checker.killCurrentContextualType();for(r=0;r<t.arguments.members.length;r++){switch(t.arguments.members[r].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:{this.typeCheck(t.arguments.members[r]);break};default:{continue}}}}};n.prototype.typeCheckCall=function(t){var n=t;if(this.checker.styleSettings.newMustBeUsed&&t.nodeType==e.NodeType.New){if(e.hasFlag(t.flags,e.ASTFlags.IsStatement)){this.checker.errorReporter.styleError(t,"use of new expression as a statement")}}else{if(!this.checker.styleSettings.evalOK&&t.nodeType==e.NodeType.Call){if(n.target.nodeType==e.NodeType.Name&&n.target.text=="eval"){this.checker.errorReporter.styleError(n,"eval not permitted")}}}if(n.target.nodeType==e.NodeType.FuncDecl){n.target.isInlineCallLiteral=true}var r=this.inSuperCall;if(n.target.nodeType==e.NodeType.Super){this.inSuperCall=true}n.target=this.typeCheck(n.target);this.preTypeCheckCallArgs(n.arguments);var i=n.target;if(i.type==null||i.type==this.anyType||this.functionInterfaceType&&i.type==this.functionInterfaceType){n.type=this.anyType}else{var s=i.type;if(s.call){var o=this.resolveOverload(n,s.call);if(o==null){n.type=this.anyType}else{n.type=o.returnType.type;n.signature=o}}else{if(n.target.nodeType==e.NodeType.Super&&this.thisFnc&&this.thisFnc.isConstructor&&e.hasFlag(this.thisFnc.fncFlags,e.FncFlags.ClassMethod)){var o=s.symbol.type.construct?this.resolveOverload(n,s.symbol.type.construct):null;if(o==null){n.type=this.anyType}else{n.flags|=e.ASTFlags.ClassBaseConstructorCall;n.type=o.returnType.type;n.signature=o}}else{n.type=this.anyType;this.checker.errorReporter.invalidCall(n,n.nodeType,this.scope)}}}this.postTypeCheckCallArgs(n);this.inSuperCall=r;return n};n.prototype.assignScopes=function(n){var r=n;this.checker.locationInfo=r.locationInfo;var i=new t(this.checker.gloMod,null,this.globalScope);var s=new e.AssignScopeContext(i,this,[this.checker.currentModDecl]);e.getAstWalkerFactory().walk(n,e.preAssignScopes,e.postAssignScopes,null,s)};n.prototype.findMemberScope=function(t,n){var r=t.getScope();var i=t.pos-t.getScriptFragmentPosition();var s=t.getScriptFragment();var o=new e.MemberScopeContext(this,i,n);o.scope=r;if(s.nodeType==e.NodeType.Name){return s.type.getMemberScope(this)}else{e.getAstWalkerFactory().walk(s,e.preFindMemberScope,null,null,o);if(o.ast&&t.enclosingClassDecl&&o.ast.type==t.enclosingClassDecl.type.instanceType){t.publicsOnly=false}if(o.type){return o.type.getMemberScope(this)}else{return null}}};n.prototype.findMemberScopeAt=function(t){return this.findMemberScope(t,e.ASTFlags.DotLHS)};n.prototype.findMemberScopeAtFullAst=function(t){var n=e.ASTFlags.DotLHS;var r=t.pos;var i=null;var s=function(t,s,o){if(e.isValidAstNode(t)){if(e.hasFlag(t.flags,n)&&(r==t.limChar||r-1==t.limChar)){i=t;o.options.stopWalk()}o.options.goChildren=t.minChar<=r&&r<=t.limChar}return t};var o=function(t,s,o){if(e.isValidAstNode(t)){if(e.hasFlag(t.flags,n)&&t.minChar<r&&r<=t.limChar){i=t}o.options.goChildren=t.minChar<=r&&r<=t.limChar}return t};e.getAstWalkerFactory().walk(t.script,s);if(i==null){e.getAstWalkerFactory().walk(t.script,o)}if(i&&t.enclosingClassDecl&&i.type==t.enclosingClassDecl.type.instanceType){t.publicsOnly=false}if(i&&i.type){return i.type.getMemberScope(this)}else{return null}};return n}();e.TypeFlow=a})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function f(e,t,n){var r=new a;r.ast=e;if(e==null&&n){r.type=t.anyType}else{r.type=null}return r}(function(e){e._map=[];e.None=0;e.Void=1;e.Double=2;e.String=4;e.Boolean=8;e.Any=16;e.Null=32;e.Undefined=64})(e.Primitive||(e.Primitive={}));var t=e.Primitive;var n=function(){function e(){this.prefix="";this.suffix=""}e.prototype.isString=function(){return false};e.prototype.isArray=function(){return false};e.prototype.toString=function(){return e.memberNameToString(this)};e.memberNameToString=function(n){var r=n.prefix;if(n.isString()){r+=n.text}else{var i=n;for(var s=0;s<i.entries.length;s++){r+=e.memberNameToString(i.entries[s]);r+=i.delim}}r+=n.suffix;return r};e.create=function(t,n,s){if(typeof t=="string"){return new r(t)}else{var o=new i;if(n){o.prefix=n}if(s){o.suffix=s}o.entries.push(t);return o}};return e}();e.MemberName=n;var r=function(e){function t(t){e.call(this);this.text=t}__extends(t,e);t.prototype.isString=function(){return true};return t}(n);e.MemberNameString=r;var i=function(e){function t(){e.apply(this,arguments);this.delim="";this.entries=[]}__extends(t,e);t.prototype.isArray=function(){return true};t.prototype.add=function(e){this.entries.push(e)};t.prototype.addAll=function(e){for(var t=0;t<e.length;t++){this.entries.push(e[t])}};return t}(n);e.MemberNameArray=i;var s=-1;var o=function(){function r(){this.typeID=s++;this.construct=null;this.call=null;this.index=null;this.passTypeCreated=e.CompilerDiagnostics.analysisPass;this.primitiveTypeClass=t.None;this.typeFlags=e.TypeFlags.None}r.prototype.baseClass=function(){if(this.extendsList&&this.extendsList.length>0){return this.extendsList[0]}else{return null}};r.prototype.getArrayBase=function(e,t){return this.arrayCache.specialize(e,t)};r.prototype.isClass=function(){return this.instanceType!=null};r.prototype.isArray=function(){return this.elementType!=null};r.prototype.isClassInstance=function(){return this.symbol&&!this.elementType&&this.symbol.type.isClass()};r.prototype.getInstanceType=function(){if(this.isClass()){return this.instanceType}else{return this}};r.prototype.hasImplementation=function(){return e.hasFlag(this.typeFlags,e.TypeFlags.HasImplementation)};r.prototype.setHasImplementation=function(){this.typeFlags|=e.TypeFlags.HasImplementation};r.prototype.isDouble=function(){return e.hasFlag(this.primitiveTypeClass,t.Double)};r.prototype.isString=function(){return e.hasFlag(this.primitiveTypeClass,t.String)};r.prototype.isBoolean=function(){return e.hasFlag(this.primitiveTypeClass,t.Boolean)};r.prototype.isNull=function(){return e.hasFlag(this.primitiveTypeClass,t.Null)};r.prototype.getTypeName=function(){return this.getMemberTypeName("",true,false,null)};r.prototype.getScopedTypeName=function(e){return this.getMemberTypeName("",true,false,e)};r.prototype.getScopedTypeNameEx=function(e){return this.getMemberTypeNameEx("",true,false,e)};r.prototype.callCount=function(){var e=0;if(this.call){e+=this.call.signatures.length}if(this.construct){e+=this.construct.signatures.length}if(this.index){e+=this.index.signatures.length}return e};r.prototype.getMemberTypeName=function(e,t,n,r){var i=this.getMemberTypeNameEx(e,t,n,r);return i.toString()};r.prototype.getMemberTypeNameEx=function(t,r,s,o){if(this.elementType){return n.create(this.elementType.getMemberTypeNameEx(t,false,true,o),"","[]")}else{if(this.symbol&&this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||e.hasFlag(this.typeFlags,e.TypeFlags.BuildingName)||this.members&&!this.isClass())){var u=this.symbol.scopeRelativeName(o);return n.create(u=="null"?"any":u)}else{if(this.members||this.call||this.construct){if(e.hasFlag(this.typeFlags,e.TypeFlags.BuildingName)){return n.create("this")}this.typeFlags|=e.TypeFlags.BuildingName;var a="";var f=new i;var l=s||this.index!=null;var c=0;var h="; ";if(this.members){this.members.allMembers.map(function(t,n,r){var i=n;if(!e.hasFlag(i.flags,e.SymbolFlags.BuiltIn)){var s=i.getTypeNameEx(o);if(s.isArray()&&s.delim==h){f.addAll(s.entries)}else{f.add(s)}c++;l=true}},null)}var p=this.callCount();var d;var v=0;var m=!l&&p==1&&r;if(this.call){f.addAll(this.call.toStrings(t,m,o))}if(this.construct){f.addAll(this.construct.toStrings("new",m,o))}if(this.index){f.addAll(this.index.toStrings("",m,o))}if(l||p>1&&r){f.prefix="{ ";f.suffix="}";f.delim=h}else{if(f.entries.length>1){f.delim=h}}this.typeFlags&=~e.TypeFlags.BuildingName;if(p==0&&c==0){return n.create("{}")}else{return f}}else{return n.create("{}")}}}};r.prototype.checkDecl=function(e){if(this.isClassInstance()||this.isClass()){if(this.symbol.declAST){e.typeFlow.inScopeTypeCheckDecl(this.symbol.declAST)}}};r.prototype.getMemberScope=function(e){if(this==e.anyType){return null}else{if(this.isDouble()){if(e.numberInterfaceType){return e.numberInterfaceType.memberScope}else{return null}}else{if(this.isBoolean()){if(e.booleanInterfaceType){return e.booleanInterfaceType.memberScope}else{return null}}else{if(this==e.stringType){if(e.stringInterfaceType){return e.stringInterfaceType.memberScope}else{return null}}else{if(this.elementType){if(e.arrayInterfaceType){var t=this.elementType.getArrayBase(e.arrayInterfaceType,e.checker);return t.memberScope}else{return null}}else{return this.memberScope}}}}}};r.prototype.isReferenceType=function(){return this.members||this.extendsList||this.construct||this.call||this.index||this.elementType};r.prototype.specializeType=function(t,n,i,s){if(t==this){return n}var o=this;if(s){if(this.isReferenceType()){o=new r;if(this.members){o.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));this.members.publicMembers.map(function(e,r,s){var u=r;var a=u.specializeType(t,n,i);o.members.addPublicMember(a.name,a)},null);this.members.privateMembers.map(function(e,r,s){var u=r;var a=u.specializeType(t,n,i);o.members.addPrivateMember(a.name,a)},null)}if(this.ambientMembers){o.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));this.ambientMembers.publicMembers.map(function(e,r,s){var u=r;var a=u.specializeType(t,n,i);o.ambientMembers.addPublicMember(a.name,a)},null);this.ambientMembers.privateMembers.map(function(e,r,s){var u=r;var a=u.specializeType(t,n,i);o.ambientMembers.addPrivateMember(a.name,a)},null)}o.containedScope=i.scopeOf(o);o.memberScope=o.containedScope}}else{if(this.elementType){if(this.elementType==t){o=i.makeArrayType(n)}else{if(this.elementType.elementType==t){o=i.makeArrayType(i.makeArrayType(n))}}}else{if(this.call){o=new r;o.call=this.call.specializeType(t,n,i)}}}return o};r.prototype.hasBase=function(e){if(e==this){return true}else{if(this.extendsList){for(var t=0,n=this.extendsList.length;t<n;t++){if(this.extendsList[t].hasBase(e)){return true}}}}return false};r.prototype.mergeOrdered=function(e,t,n,r){if(this==t.anyType||e==t.anyType){return t.anyType}else{if(this==e){return this}else{if(e==t.nullType&&this!=t.nullType){return this}else{if(this==t.nullType&&e!=t.nullType){return e}else{if(n&&e==t.voidType&&this!=t.voidType){return this}else{if(n&&this==t.voidType&&e!=t.voidType){return e}else{if(e==t.undefinedType&&this!=t.undefinedType){return this}else{if(this==t.undefinedType&&e!=t.undefinedType){return e}else{if(this.elementType&&e.elementType){if(this.elementType==e.elementType){return this}else{var i=this.elementType.mergeOrdered(e.elementType,t,n,r);if(i==null){return t.makeArrayType(t.anyType)}else{return t.makeArrayType(i)}}}else{if(t.sourceIsSubtypeOfTarget(this,e,r)){return e}else{if(t.sourceIsSubtypeOfTarget(e,this,r)){return this}else{return null}}}}}}}}}}}};r.prototype.isModuleType=function(){return false};r.prototype.hasMembers=function(){return this.members!=null};r.prototype.getAllEnclosedTypes=function(){return null};r.prototype.getAllAmbientEnclosedTypes=function(){return null};r.prototype.getPublicEnclosedTypes=function(){return null};r.prototype.getpublicAmbientEnclosedTypes=function(){return null};return r}();e.Type=o;var u=function(t){function n(n,r){t.call(this);this.enclosedTypes=n;this.ambientEnclosedTypes=r;this.importedModules=[];this.prettyNames=new e.SimpleHashTable}__extends(n,t);n.prototype.isModuleType=function(){return true};n.prototype.hasMembers=function(){return this.members!=null||this.enclosedTypes!=null};n.prototype.getAllEnclosedTypes=function(){return this.enclosedTypes};n.prototype.getAllAmbientEnclosedTypes=function(){return this.ambientEnclosedTypes};n.prototype.getPublicEnclosedTypes=function(){return null};n.prototype.getpublicAmbientEnclosedTypes=function(){return null};n.findDynamicModuleNameInHashTable=function(n,r,i){var s=null;r.map(function(t,r,o){if(s==null&&!e.isQuoted(t)){var u=r;var a=u.getType();if(a==n){s=t}else{if(a){var f=i.length-1;for(;f>=0;f--){if(i[f]==r){break}}if(f<0&&a.isModuleType()){i.push(r);var l=t+".";var c=a;s=c.findDynamicModuleName(n,l,true,i);if(s!=null){s=c.findDynamicModuleName(n,l,true,i)}}}}}},null);return s};n.prototype.findDynamicModuleName=function(e,t,r,i){var s=null;var o=this.prettyNames.lookup(e);if(o!=null){s=!o.data.isPrivate||!r?o.data.moduleName:null}else{s=n.findDynamicModuleNameInHashTable(e,this.members.publicMembers,i);if(s!=null){this.prettyNames.add(e,{moduleName:s,isPrivate:false})}else{s=n.findDynamicModuleNameInHashTable(e,this.ambientMembers.publicMembers,i);if(s!=null){this.prettyNames.add(e,{moduleName:s,isPrivate:false})}else{var u=n.findDynamicModuleNameInHashTable(e,this.members.privateMembers,i);if(u!=null){this.prettyNames.add(e,{moduleName:u,isPrivate:true})}else{u=n.findDynamicModuleNameInHashTable(e,this.ambientMembers.privateMembers,i);this.prettyNames.add(e,{moduleName:u,isPrivate:true})}if(!r){s=u}}}}if(s!=null){return t+s}return s};return n}(o);e.ModuleType=u;var a=function(){function e(){this.type=null;this.ast=null}return e}();e.TypeLink=a;e.getTypeLink=f})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function t(e){return e.replace('"',"").replace("'","").replace("'","").replace('"',"")}function n(e){return e.indexOf('"')!=-1||e.indexOf("'")!=-1||e.indexOf("'")!=-1||e.indexOf('"')!=-1}function r(e){return'"'+e+'"'}function i(e){if(e.indexOf('"')!=-1){e=e.replace('"',"'");e=e.replace('"',"'")}else{e=e.replace("'",'"');e=e.replace("'",'"')}return e}function s(e){return e.replace(/\\/g,"/")}function o(e){if(e.length>6&&e.substring(e.length-6,e.length)==".d.str"){return e.substring(0,e.length-6)}if(e.length>4&&e.substring(e.length-4,e.length)==".str"){return e.substring(0,e.length-4)}if(e.length>5&&e.substring(e.length-5,e.length)==".d.ts"){return e.substring(0,e.length-5)}if(e.length>3&&e.substring(e.length-3,e.length)==".ts"){return e.substring(0,e.length-3)}if(e.length>3&&e.substring(e.length-3,e.length)==".js"){return e.substring(0,e.length-3)}return e}function u(e){return a(e)?m(e):f(e)?y(e):y(e)}function a(e){return e.length>4&&e.substring(e.length-4,e.length)==".str"}function f(e){return e.length>3&&e.substring(e.length-3,e.length)==".ts"}function l(e){return e.length>6&&e.substring(e.length-6,e.length)==".d.str"}function c(e){return e.length>5&&e.substring(e.length-5,e.length)==".d.ts"}function h(e,n,i){if(typeof n==="undefined"){n=true}if(typeof i==="undefined"){i=false}var u=i?s(e):o(t(e));var a=u.split("/");return a.length?n?r(a[a.length-1]):a[a.length-1]:e}function p(e,t){t=s(t);var n=t.split("/");var r=e.split("/");var i=0;for(;i<n.length&&i<r.length;i++){if(r[i]!=n[i]){break}}if(i!=0){var o="";var u=n.slice(i,n.length);for(;i<r.length;i++){if(r[i]!=""){o=o+"../"}}return o+u.join("/")}return t}function d(e){var n=o(t(e));var i=E(n);if(i==""){return e}else{var s=n.split(i);var u=s.length>1?1:0;return r(s[u])}}function v(e){return o(t(e))+".str"}function m(e){return o(t(e))+".d.str"}function g(e){return o(t(e))+".ts"}function y(e){return o(t(e))+".d.ts"}function b(e){return e.charAt(0)=="."}function w(e){return e.charAt(0)=="\\"||e.charAt(0)=="/"||e.indexOf(":\\")!=-1||e.indexOf(":/")!=-1}function E(e){if(e==""){return e}else{var t=e.indexOf("/")!=-1;return t?S(e):""}}function S(e){e=s(e);var t=e.split("/");var n=t.slice(0,t.length-1);return n.join("/")+"/"}function x(e){var t=/^(https?:\/\/[\-\w\.]+(:\d+)?\/)(.*)$/i;var n=t.exec(e);if(n){var r=n[1];var i=n[3];return r+T(i)}return T(e)}function T(e){e=s(e);var t=e.charAt(0)==="/";var n=e.split("/");for(var r=0;r<n.length;r++){if(n[r]==="."||n[r]===""){n.splice(r,1);r--}if(r>0&&n[r]===".."&&n[r-1]!==".."){n.splice(r-1,2);r-=2}}return(t?"/":"")+n.join("/")}function N(e){return T(e)}e.stripQuotes=t;e.isQuoted=n;e.quoteStr=r;e.swapQuotes=i;e.switchToForwardSlashes=s;e.trimModName=o;e.getDeclareFilePath=u;e.isSTRFile=a;e.isTSFile=f;e.isDSTRFile=l;e.isDTSFile=c;e.getPrettyName=h;e.getRelativePathToFixedPath=p;e.quoteBaseName=d;e.changePathToSTR=v;e.changePathToDSTR=m;e.changePathToTS=g;e.changePathToDTS=y;e.isRelative=b;e.isRooted=w;e.getRootFilePath=E;e.filePath=S;e.normalizeURL=x;e.pathNormalizeRegExp=/\//g;e.normalizePath=T;e.normalizeImportPath=N})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(e,t){this.path=e;this.content=t;this.referencedFiles=null}e.prototype.getText=function(e,t){return this.content.substring(e,t)};e.prototype.getLength=function(){return this.content.length};return e}();e.SourceUnit=t;var n=function(){function e(e,t){this.compilationSettings=e;this.ioHost=t;this.residentCode=[];this.code=[]}return e}();e.CompilationEnvironment=n;var r=function(){function n(e){this.environment=e;this.visited={}}n.prototype.resolveCode=function(n,r,i,s){var o={content:"",path:n};var u=this.environment.ioHost;var a=e.isRelative(n);var f=a?false:e.isRooted(n);var l=a?u.resolvePath(r+"/"+n):f||!r||i?n:r+"/"+n;if(!e.isSTRFile(l)&&!e.isTSFile(l)){l+=".ts"}l=e.switchToForwardSlashes(e.stripQuotes(l));var c=this.environment.compilationSettings.useCaseSensitiveFileResolution?l:l.toLocaleUpperCase();if(!this.visited[c]){if(a||f||!i){try{e.CompilerDiagnostics.debugPrint("   Reading code from "+l);try{o.content=u.readFile(l)}catch(h){try{if(e.isSTRFile(l)){l=e.changePathToTS(l)}else{if(e.isTSFile(l)){l=e.changePathToSTR(l)}}e.CompilerDiagnostics.debugPrint("   Reading code from "+l);o.content=u.readFile(l)}catch(h){l=e.changePathToDSTR(l);e.CompilerDiagnostics.debugPrint("   Reading code from "+l);try{o.content=u.readFile(l)}catch(h){l=e.changePathToDTS(l);e.CompilerDiagnostics.debugPrint("   Reading code from "+l);o.content=u.readFile(l)}}}e.CompilerDiagnostics.debugPrint("   Found code at "+l);o.path=l;this.visited[c]=true}catch(h){e.CompilerDiagnostics.debugPrint("   Did not find code for "+n)}}else{o=u.findFile(r,l);if(!o){if(e.isSTRFile(l)){l=e.changePathToTS(l)}else{if(e.isTSFile(l)){l=e.changePathToSTR(l)}}o=u.findFile(r,l)}if(!o){l=e.changePathToDTS(l);o=u.findFile(r,l);if(!o){l=e.changePathToDSTR(l);o=u.findFile(r,l)}}if(o){o.path=e.switchToForwardSlashes(e.stripQuotes(o.path));e.CompilerDiagnostics.debugPrint(n+" resolved to: "+o.path);o.content=o.content;this.visited[c]=true}else{e.CompilerDiagnostics.debugPrint("Could not find "+n)}}if(o&&o.content){var p=u.dirName(o.path);var d=new t(o.path,o.content);var v=e.preProcessFile(d,this.environment.compilationSettings);d.referencedFiles=v.referencedFiles;for(var m=0;m<v.referencedFiles.length;m++){var g=v.referencedFiles[m];var l=e.isRooted(g.path)?g.path:p+"/"+g.path;l=u.resolvePath(l);if(n==l){s.postResolutionError(l,"File contains reference to itself",null);continue}this.resolveCode(g.path,p,false,s)}for(var m=0;m<v.importedFiles.length;m++){this.resolveCode(v.importedFiles[m].path,p,true,s)}s.postResolution(d.path,d)}}};return n}();e.CodeResolver=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function r(t){var n=/^(\/\/\/\s*<reference\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm;var r=n.exec(t);if(r){var i=e.normalizePath(r[3]);var s=e.normalizePath(i);var o=r.length>=7&&r[6]=="true";if(o){e.CompilerDiagnostics.debugPrint(i+" is resident")}return{minChar:0,limChar:0,path:e.switchToForwardSlashes(s),isResident:o}}else{return null}}function i(e){var t=/^(\/\/\/\s*<amd-dependency\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm;var n=t.exec(e);if(n){var r=n[3];return r}else{return null}}function s(e){var t=/^(\/\/\/\s*<implicit-import\s*)*\/>/igm;var n=t.exec(e);if(n){return true}return false}function o(e,t){var n=/^(\/\/\/\s*<style\s+)(([a-zA-Z])+=('|").+('|"))\s*\/>/igm;var r=n.exec(e);if(r){var i=/^([a-zA-Z]+=['"]on['|"])/igm;r=i.exec(r[2]);if(r){for(var s=0;s<r.length;s++){var o=r[s].split("=");var u='"on"';switch(o[0]){case"blockInCompoundStmt":{t.blockInCompoundStmt=o[1]==u;break};case"eqeqeq":{t.eqeqeq=o[1]==u;break};case"forin":{t.forin=o[1]==u;break};case"emptyBlocks":{t.emptyBlocks=o[1]==u;break};case"newMustBeUsed":{t.newMustBeUsed=o[1]==u;break};case"requireSemi":{t.requireSemi=o[1]==u;break};case"assignmentInCond":{t.assignmentInCond=o[1]==u;break};case"eqnull":{t.eqnull=o[1]==u;break};case"evalOK":{t.evalOK=o[1]==u;break};case"innerScopeDeclEscape":{t.innerScopeDeclEscape=o[1]==u;break};case"funcInLoop":{t.funcInLoop=o[1]==u;break};case"reDeclareLocal":{t.reDeclareLocal=o[1]==u;break};case"literalSubscript":{t.literalSubscript=o[1]==u;break};case"implicitAny":{t.implicitAny=o[1]==u;break}}}}}}function u(e){var t=a(e,null,false);return t.referencedFiles}function a(t,i,s){if(typeof i==="undefined"){i=new n}if(typeof s==="undefined"){s=true}var u=new e.Scanner;u.resetComments();u.setSourceText(t,e.LexMode.File);var a=u.scan();var f=[];var l=null;var c=[];var h=i;var p=[];var d=[];var v=false;while(a.tokenId!=e.TokenID.EndOfFile){if(s&&a.tokenId==e.TokenID.Import){a=u.scan();if(a.tokenId==e.TokenID.Identifier||e.convertTokToID(a,false)){a=u.scan();if(a.tokenId==e.TokenID.Equals){a=u.scan();if(a.tokenId==e.TokenID.Module){a=u.scan();if(a.tokenId==e.TokenID.OpenParen){a=u.scan();if(a.tokenId==e.TokenID.StringLiteral){var m={minChar:u.startPos,limChar:u.pos,path:e.stripQuotes(e.switchToForwardSlashes(a.getText())),isResident:false};d.push(m)}}}}}}if(a.tokenId==e.TokenID.OpenBrace){c.push(a)}if(a.tokenId==e.TokenID.CloseBrace){c.pop()}a=u.scan()}f=u.getComments();for(var g=0;g<f.length;g++){l=f[g];if(!l.isBlock){var y=r(l.getText());if(y){y.minChar=l.startPos;y.limChar=y.minChar+l.value.length;p.push(y)}if(h){o(l.getText(),h.styleSettings);var b=/^(\/\/\/\s*<reference\s+no-default-lib=)('|")(.+?)\2\s*\/>/igm;var w=b.exec(l.getText());if(w){v=w[3]=="true"}}}}return{settings:h,referencedFiles:p,importedFiles:d,isLibFile:v}}var t=function(){function e(){this.bitwise=false;this.blockInCompoundStmt=false;this.eqeqeq=false;this.forin=false;this.emptyBlocks=true;this.newMustBeUsed=false;this.requireSemi=false;this.assignmentInCond=false;this.eqnull=false;this.evalOK=true;this.innerScopeDeclEscape=true;this.funcInLoop=true;this.reDeclareLocal=true;this.literalSubscript=true;this.implicitAny=false}e.prototype.setOption=function(e,t){var n=this[e];if(n!==undefined){this[e]=t;return true}else{return false}};e.prototype.parseOptions=function(e){var t=e.split(";");for(var n=0,r=t.length;n<r;n++){var i=t[n];var s=true;var o=i.lastIndexOf(":");if(o>=0){var u=i.substring(o+1);i=i.substring(0,o);if(u=="off"){s=false}}if(!this.setOption(i,s)){return false}}return true};return e}();e.StyleSettings=t;var n=function(){function n(){this.styleSettings=new t;this.propagateConstants=false;this.minWhitespace=false;this.parseOnly=false;this.outputMany=true;this.errorRecovery=false;this.emitComments=false;this.watch=false;this.exec=false;this.resolve=true;this.controlFlow=false;this.printControlFlow=false;this.controlFlowUseDef=false;this.errorOnWith=true;this.preprocess=true;this.canCallDefinitionSignature=false;this.inferPropertiesFromThisAssignment=false;this.useDefaultLib=true;this.codeGenTarget=e.CodeGenTarget.ES3;this.moduleGenTarget=e.ModuleGenTarget.Synchronous;this.outputFileName="";this.mapSourceFiles=false;this.generateDeclarationFiles=false;this.useCaseSensitiveFileResolution=false}n.prototype.setStyleOptions=function(e){this.styleSettings.parseOptions(e)};n.prototype.outputOne=function(e){this.outputFileName=e;this.outputMany=false};return n}();e.CompilationSettings=n;e.getAdditionalDependencyPath=i;e.getImplicitImport=s;e.getStyleSettings=o;e.getReferencedFiles=u;e.preProcessFile=a})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(t){this.logger=t;this.astLogger=new e.AstLogger(this.logger)}t.prototype.getEnclosingScopeContextIfSingleScopeEdit=function(t,n,r,i){this.logger.log('checkEditsInsideSingleScope("'+n+'")');if(i===null){throw new Error("editRange should be valid")}if(i.isUnknown()){this.logger.log("  Bailing out because edit range is unknown");return null}var s=e.findEnclosingScopeAt(this.logger,t,r,i.minChar,false);var o=e.findEnclosingScopeAt(this.logger,t,r,i.limChar,false);if(s==null||o==null){this.logger.log("  Bailing out because containing scopes cannot be determined");return null}if(s.scopeStartAST!==o.scopeStartAST){this.logger.log("  Bailing out because edit overlaps 2 disctint scopes");return null}var u=s.scopeStartAST.limChar-s.scopeStartAST.minChar+i.delta;if(u<=0){this.logger.log("  Bailing out because scope has been entirely removed from new source text");return null}return s};t.prototype.attemptIncrementalUpdateUnit=function(t,n,r,i){this.logger.log('attemptIncrementalUpdateUnit("'+n+'")');if(i===null){throw new Error("editRange should be valid")}var s=this.getEnclosingScopeContextIfSingleScopeEdit(t,n,r,i);if(s===null){return null}var o=s.scopeStartAST.limChar-s.scopeStartAST.minChar+i.delta;if(o>=r.getLength()/2){this.logger.log("  Bailing out because range of scope to reparse ("+o+" characters) is greater than half the size of the source text");return null}var u=[];var a=function(t,n,r,i){u.push(new e.ErrorEntry(i,t,t+n,r))};var f=e.quickParse(this.logger,s.scopeStartAST,r,s.scopeStartAST.minChar,s.scopeStartAST.minChar+o,a);if(f.endLexState!=e.LexState.Start){this.logger.log("  Bailing out because scope contains unterminated comment");return null}var l=f.Script;if(l.vars.members.length!==0){this.logger.log("  Bailing out because new source text defines variables");return null}if(l.bod.members.length!==1){this.logger.log("  Bailing out because new source text defines more than one scope (or none)");return null}var c=s.scopeStartAST;var h=l.bod.members[0];if(c.nodeType!=h.nodeType){this.logger.log("  Bailing out because new source text does not define the same scope type as the existing scope");return null}if(!c.leftCurlyCount||!c.rightCurlyCount){this.logger.log("  Bailing out because sopce doesn't have left/right curly count");return null}if(c.leftCurlyCount!==h.leftCurlyCount){this.logger.log("  Bailing out because new source text contains more (or fewer) left curly braces");return null}if(c.rightCurlyCount!==h.rightCurlyCount){this.logger.log("  Bailing out because new source text contains more (or fewer) right curly braces");return null}if(h.minChar!==0){this.logger.log("  Bailing out because new function declaration does not start at position 0");return null}if(h.limChar!==o){this.logger.log("  Bailing out because new function declaration does not end at the new end position");return null}return e.UpdateUnitResult.singleScopeEdits(t,l,c,h,i,u)};t.prototype.mergeTrees=function(t){var n=this;e.timeFunction(this.logger,"mergeTrees()",function(){var r=new e.ScriptEditRange(t.scope1.minChar,t.scope1.limChar,t.editRange.delta);n.applyDeltaPosition(t.script1,r.limChar,r.delta);n.applyDeltaPosition(t.script2,0,r.minChar);n.mergeLocationInfo(t.script1,t.script2,r);n.replaceAST(t.script1,t.scope1,t.scope2)})};t.prototype.replaceAST=function(t,n,r){var i=this;var s=function(t,s,o){if(t===n){r.preComments=t.preComments;r.postComments=t.postComments;i.logger.log("replaced old AST node with new one in script AST");o.options.stopWalk();return r}if(e.isValidAstNode(t)){if(t.limChar<n.minChar||t.minChar>n.limChar){o.options.goChildren=false}}return t};e.getAstWalkerFactory().walk(t,s)};t.prototype.mergeLocationInfo=function(e,t,n){var r=e.locationInfo.lineMap;var i=t.locationInfo.lineMap;if(this.logger.information()){this.logger.log("lineMap1 (before):");this.astLogger.logLinemap(r);this.logger.log("lineMap2 (quick parse):");this.astLogger.logLinemap(i);this.logger.log("EditRange="+n)}var s=2;var o=2;var u=r.length;var a=i.length;while(s<u||o<a){if(s<u){if(r[s]<=n.minChar){s++}else{if(r[s]>=n.limChar){r[s]+=n.delta;s++}else{if(o<a){r.splice(s,0,i[o]+n.minChar);s++;u++;o++}else{r.splice(s,1);u--}}}}else{r.push(i[o]+n.minChar);o++}}if(this.logger.information()){this.logger.log("lineMap1 (after merge):");this.astLogger.logLinemap(r)}};t.prototype.applyDeltaPosition=function(t,n,r){var i=function(e){if(e.minChar!==-1&&e.minChar>=n){e.minChar+=r}if(e.limChar!==-1&&e.limChar>=n){e.limChar+=r}};var s=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){i(e[t])}}};var o=function(e,t,r){if(e.limChar!==-1&&e.limChar<n){r.options.goChildren=false}i(e);s(e.preComments);s(e.postComments);return e};e.getAstWalkerFactory().walk(t,o)};return t}();e.IncrementalParser=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(t,n){this.checker=t;this.emitOptions=n;this.declFile=null;this.indenter=new e.Indenter;this.declarationContainerStack=[];this.isDottedModuleName=[];this.ignoreCallbackAst=null;this.singleDeclFile=null;this.varListCount=0}t.prototype.getAstDeclarationContainer=function(){return this.declarationContainerStack[this.declarationContainerStack.length-1]};t.prototype.emitDottedModuleName=function(){return this.isDottedModuleName.length==0?false:this.isDottedModuleName[this.isDottedModuleName.length-1]};t.prototype.setDeclarationFile=function(e){this.declFile=e};t.prototype.emitDeclarations=function(t){e.AstWalkerWithDetailCallback.walk(t,this)};t.prototype.getIndentString=function(e){if(typeof e==="undefined"){e=false}if(this.emitOptions.minWhitespace){return""}else{return this.indenter.getIndent()}};t.prototype.emitIndent=function(){this.declFile.Write(this.getIndentString())};t.prototype.canEmitSignature=function(t,n,r){if(typeof n==="undefined"){n=true}if(typeof r==="undefined"){r=true}var i;if(r){i=this.getAstDeclarationContainer()}else{i=this.declarationContainerStack[this.declarationContainerStack.length-2]}if(i.nodeType==e.NodeType.ModuleDeclaration&&!e.hasFlag(t,e.DeclFlags.Exported)){return false}if(!n&&i.nodeType==e.NodeType.Script&&e.hasFlag(t,e.DeclFlags.Ambient)){return false}return true};t.prototype.canEmitPrePostAstSignature=function(t,n,r){if(this.ignoreCallbackAst){e.CompilerDiagnostics.assert(this.ignoreCallbackAst!=n,"Ignore Callback AST mismatch");this.ignoreCallbackAst=null;return false}else{if(r&&!this.canEmitSignature(t,true,r)){this.ignoreCallbackAst=n;return false}}return true};t.prototype.emitDeclFlags=function(t,n){this.emitIndent();var r="";if(e.hasFlag(t,e.DeclFlags.GetAccessor)){r="get "}else{if(e.hasFlag(t,e.DeclFlags.SetAccessor)){r="set "}}var i=this.getAstDeclarationContainer();if(i.nodeType==e.NodeType.ModuleDeclaration&&e.hasFlag(i.modFlags,e.ModuleFlags.IsWholeFile)&&e.hasFlag(t,e.DeclFlags.Exported)){this.declFile.Write("export ")}if(e.hasFlag(t,e.DeclFlags.LocalStatic)||e.hasFlag(t,e.DeclFlags.Static)){this.declFile.Write("static "+r)}else{if(e.hasFlag(t,e.DeclFlags.Private)){this.declFile.Write("private "+r)}else{if(e.hasFlag(t,e.DeclFlags.Public)){this.declFile.Write("public "+r)}else{if(r==""){this.declFile.Write(n+" ")}else{this.declFile.Write(r)}}}}};t.prototype.canEmitTypeAnnotationSignature=function(t){if(typeof t==="undefined"){t=e.DeclFlags.None}return!e.hasFlag(t,e.DeclFlags.Private)};t.prototype.pushDeclarationContainer=function(e){this.declarationContainerStack.push(e)};t.prototype.popDeclarationContainer=function(t){e.CompilerDiagnostics.assert(t!=this.getAstDeclarationContainer(),"Declaration container mismatch");this.declarationContainerStack.pop()};t.prototype.emitTypeNamesMember=function(e,t){if(typeof t==="undefined"){t=false}if(e.prefix=="{ "){if(t){this.emitIndent()}this.declFile.WriteLine("{");this.indenter.increaseIndent();t=true}else{if(e.prefix!=""){if(t){this.emitIndent()}this.declFile.Write(e.prefix);t=false}}if(e.isString()){if(t){this.emitIndent()}this.declFile.Write(e.text)}else{var n=e;for(var r=0;r<n.entries.length;r++){this.emitTypeNamesMember(n.entries[r],t);if(n.delim=="; "){this.declFile.WriteLine(";")}}}if(e.suffix=="}"){this.indenter.decreaseIndent();this.emitIndent();this.declFile.Write(e.suffix)}else{this.declFile.Write(e.suffix)}};t.prototype.emitTypeSignature=function(t){var n=null;var r=this.getAstDeclarationContainer();switch(r.nodeType){case e.NodeType.ModuleDeclaration:case e.NodeType.InterfaceDeclaration:case e.NodeType.FuncDecl:{if(r.type){n=r.type.containedScope}break};case e.NodeType.Script:{var i=r;if(i.bod){n=i.bod.enclosingScope}break};case e.NodeType.ClassDeclaration:{if(r.type){n=r.type.instanceType.containedScope}break};default:{e.CompilerDiagnostics.debugPrint("Unknown containing scope")}}var s=t.getScopedTypeNameEx(n);this.emitTypeNamesMember(s)};t.prototype.VarDeclCallback=function(t,n){if(t&&this.canEmitSignature(e.ToDeclFlags(n.varFlags),false)){var r=this.getAstDeclarationContainer().nodeType==e.NodeType.InterfaceDeclaration;if(!r){if(this.varListCount>=0){this.emitDeclFlags(e.ToDeclFlags(n.varFlags),"var");this.varListCount=-this.varListCount}this.declFile.Write(n.id.text)}else{this.emitIndent();this.declFile.Write(n.id.text);if(e.hasFlag(n.id.flags,e.ASTFlags.OptionalName)){this.declFile.Write("?")}}var i=null;if(n.typeExpr&&n.typeExpr.type){i=n.typeExpr.type}else{if(n.sym){i=n.sym.getType();if(i==this.checker.anyType){i=null}}}if(i&&this.canEmitTypeAnnotationSignature(e.ToDeclFlags(n.varFlags))){this.declFile.Write(": ");this.emitTypeSignature(i)}if(this.varListCount>0){this.varListCount--}else{if(this.varListCount<0){this.varListCount++}}if(this.varListCount<0){this.declFile.Write(", ")}else{this.declFile.WriteLine(";")}}return false};t.prototype.BlockCallback=function(e,t){if(!t.isStatementBlock){if(e){this.varListCount=t.statements.members.length}else{this.varListCount=0}return true}return false};t.prototype.emitArgDecl=function(t,n){this.declFile.Write(t.id.text);if(t.isOptionalArg()){this.declFile.Write("?")}if((t.typeExpr||t.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(e.ToDeclFlags(n.fncFlags))){this.declFile.Write(": ");this.emitTypeSignature(t.type)}};t.prototype.FuncDeclCallback=function(t,n){if(!t){return false}if(n.isAccessor()){return this.emitPropertyAccessorSignature(n)}var r=this.getAstDeclarationContainer().nodeType==e.NodeType.InterfaceDeclaration;if(n.bod){if(n.isConstructor){if(n.type.construct&&n.type.construct.signatures.length>1){return false}}else{if(n.type.call&&n.type.call.signatures.length>1){return false}}}else{if(!r&&e.hasFlag(n.fncFlags,e.FncFlags.Private)&&n.type.call&&n.type.call.signatures.length>1){var i=n.type.call.signatures;var s=i[0].declAST;if(s.bod){s=i[1].declAST}if(s!=n){return false}}}if(!this.canEmitSignature(e.ToDeclFlags(n.fncFlags),false)){return false}if(n.isConstructor){this.emitIndent();this.declFile.Write("constructor ")}else{var o=n.getNameText();if(!r){this.emitDeclFlags(e.ToDeclFlags(n.fncFlags),"function");this.declFile.Write(o)}else{this.emitIndent();if(n.isConstructMember()){this.declFile.Write("new")}else{if(!n.isCallMember()&&!n.isIndexerMember()){this.declFile.Write(o);if(e.hasFlag(n.name.flags,e.ASTFlags.OptionalName)){this.declFile.Write("? ")}}}}}if(!n.isIndexerMember()){this.declFile.Write("(")}else{this.declFile.Write("[")}if(n.arguments){var u=n.arguments.members.length;if(n.variableArgList){u--}for(var a=0;a<u;a++){var f=n.arguments.members[a];this.emitArgDecl(f,n);if(a<u-1){this.declFile.Write(", ")}}}if(n.variableArgList){var l=n.arguments.members[n.arguments.members.length-1];if(n.arguments.members.length>1){this.declFile.Write(", ...")}else{this.declFile.Write("...")}this.emitArgDecl(l,n)}if(!n.isIndexerMember()){this.declFile.Write(")")}else{this.declFile.Write("]")}if(!n.isConstructor&&(n.returnTypeAnnotation||n.signature.returnType.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(e.ToDeclFlags(n.fncFlags))){this.declFile.Write(": ");this.emitTypeSignature(n.signature.returnType.type)}if(n.hasStaticDeclarations()){this.declFile.WriteLine(" {")}else{this.declFile.WriteLine(";")}return false};t.prototype.emitBaseList=function(e,t){if(e&&e.members.length>0){this.declFile.Write(" "+t+" ");var n=e.members.length;for(var r=0;r<n;r++){var i=e.members[r];var s=i.type.symbol;var o=i.type;if(r>0){this.declFile.Write(", ")}this.emitTypeSignature(o)}}};t.prototype.emitPropertyAccessorSignature=function(t){var n=t.accessorSymbol;if(n.getter&&n.getter.declAST!=t){return false}this.emitDeclFlags(e.ToDeclFlags(n.flags),"var");this.declFile.Write(t.name.text);var r=n.getType();if(this.canEmitTypeAnnotationSignature(e.ToDeclFlags(n.flags))){this.declFile.Write(" : ");this.emitTypeSignature(r)}this.declFile.WriteLine(";");return false};t.prototype.emitClassMembersFromConstructorDefinition=function(t){if(t.arguments){var n=t.arguments.members.length;if(t.variableArgList){n--}for(var r=0;r<n;r++){var i=t.arguments.members[r];if(e.hasFlag(i.varFlags,e.VarFlags.Property)){this.emitDeclFlags(e.ToDeclFlags(i.varFlags),"var");this.declFile.Write(i.id.text);if(i.typeExpr&&this.canEmitTypeAnnotationSignature(e.ToDeclFlags(i.varFlags))){this.declFile.Write(": ");this.emitTypeSignature(i.type)}this.declFile.WriteLine(";")}}}};t.prototype.ClassDeclarationCallback=function(t,n){if(!this.canEmitPrePostAstSignature(e.ToDeclFlags(n.varFlags),n,t)){return false}if(t){var r=n.name.text;this.emitDeclFlags(e.ToDeclFlags(n.varFlags),"class");this.declFile.Write(r);this.emitBaseList(n.extendsList,"extends");this.emitBaseList(n.implementsList,"implements");this.declFile.WriteLine(" {");this.pushDeclarationContainer(n);this.indenter.increaseIndent();if(n.constructorDecl){this.emitClassMembersFromConstructorDefinition(n.constructorDecl)}}else{this.indenter.decreaseIndent();this.popDeclarationContainer(n);this.emitIndent();this.declFile.WriteLine("}")}return true};t.prototype.InterfaceDeclarationCallback=function(t,n){if(!this.canEmitPrePostAstSignature(e.ToDeclFlags(n.varFlags),n,t)){return false}if(t){var r=n.name.text;this.emitDeclFlags(e.ToDeclFlags(n.varFlags),"interface");this.declFile.Write(r);this.emitBaseList(n.extendsList,"extends");this.declFile.WriteLine(" {");this.indenter.increaseIndent();this.pushDeclarationContainer(n)}else{this.indenter.decreaseIndent();this.popDeclarationContainer(n);this.emitIndent();this.declFile.WriteLine("}")}return true};t.prototype.ImportDeclarationCallback=function(t,n){if(t&&this.canEmitSignature(e.ToDeclFlags(n.varFlags))){this.emitDeclFlags(e.ToDeclFlags(n.varFlags),"import");this.declFile.Write(n.id.text+" = ");if(n.isDynamicImport){this.declFile.WriteLine("module ("+n.getAliasName()+");")}else{this.declFile.WriteLine(n.getAliasName()+";")}}return false};t.prototype.emitEnumSignature=function(t){if(!this.canEmitSignature(e.ToDeclFlags(t.modFlags))){return false}this.emitDeclFlags(e.ToDeclFlags(t.modFlags),"enum");this.declFile.WriteLine(t.name.text+" {");this.indenter.increaseIndent();var n=t.members.members.length;for(var r=1;r<n;r++){var i=t.members.members[r];if(i.nodeType==e.NodeType.VarDecl){this.emitIndent();this.declFile.WriteLine(i.id.text+",")}else{e.CompilerDiagnostics.assert(i.nodeType!=e.NodeType.Asg,"We want to catch this")}}this.indenter.decreaseIndent();this.emitIndent();this.declFile.WriteLine("}");return false};t.prototype.ModuleDeclarationCallback=function(t,n){if(e.hasFlag(n.modFlags,e.ModuleFlags.IsWholeFile)){if(e.hasFlag(n.modFlags,e.ModuleFlags.IsDynamic)){if(t){if(!this.emitOptions.outputMany){this.singleDeclFile=this.declFile;e.CompilerDiagnostics.assert(this.indenter.indentAmt==0,"Indent has to be 0 when outputing new file");var r=e.getDeclareFilePath(e.stripQuotes(n.name.sym.name));this.declFile=this.emitOptions.createFile(r)}this.pushDeclarationContainer(n)}else{if(!this.emitOptions.outputMany){e.CompilerDiagnostics.assert(this.singleDeclFile!=this.declFile,"singleDeclFile cannot be null as we are going to revert back to it");e.CompilerDiagnostics.assert(this.indenter.indentAmt==0,"Indent has to be 0 when outputing new file");this.declFile.Close();this.declFile=this.singleDeclFile}this.popDeclarationContainer(n)}}return true}if(n.isEnum()){if(t){this.emitEnumSignature(n)}return false}if(!this.canEmitPrePostAstSignature(e.ToDeclFlags(n.modFlags),n,t)){return false}if(t){if(this.emitDottedModuleName()){this.declFile.Write(".")}else{this.emitDeclFlags(e.ToDeclFlags(n.modFlags),"module")}this.declFile.Write(n.name.text);var i=n.members.members.length==1&&n.members.members[0].nodeType==e.NodeType.ModuleDeclaration&&!n.members.members[0].isEnum()&&e.hasFlag(n.members.members[0].modFlags,e.ModuleFlags.Exported);this.isDottedModuleName.push(i);this.pushDeclarationContainer(n);if(!i){this.declFile.WriteLine(" {");this.indenter.increaseIndent()}}else{if(!this.emitDottedModuleName()){this.indenter.decreaseIndent();this.emitIndent();this.declFile.WriteLine("}")}this.popDeclarationContainer(n);this.isDottedModuleName.pop()}return true};t.prototype.ScriptCallback=function(t,n){if(t){if(this.emitOptions.outputMany){for(var r=0;r<n.referencedFiles.length;r++){var i=e.getDeclareFilePath(n.referencedFiles[r].path);this.declFile.WriteLine('/// <reference path="'+i+'" />')}}this.pushDeclarationContainer(n)}else{this.popDeclarationContainer(n)}return true};t.prototype.DefaultCallback=function(t,n){return!e.hasFlag(n.flags,e.ASTFlags.IsStatement)};return t}();e.DeclarationEmitter=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[];e._map[0]="Unknown";e.Unknown=0;e._map[1]="NoEdits";e.NoEdits=1;e._map[2]="EditsInsideSingleScope";e.EditsInsideSingleScope=2})(e.UpdateUnitKind||(e.UpdateUnitKind={}));var t=e.UpdateUnitKind;var n=function(){function e(e,t,n){this.minChar=e;this.limChar=t;this.delta=n}e.unknown=function(){return new e(-1,-1,-1)};e.prototype.isUnknown=function(){return this.minChar===-1&&this.limChar===-1&&this.delta===-1};e.prototype.containsPosition=function(e){return this.minChar<=e&&e<this.limChar||this.minChar<=e&&e<this.limChar+this.delta};e.prototype.toString=function(){return"editRange(minChar="+this.minChar+", limChar="+this.limChar+", delta="+this.delta+")"};return e}();e.ScriptEditRange=n;var r=function(){function e(e,t,n,r){this.kind=e;this.unitIndex=t;this.script1=n;this.script2=r;this.scope1=null;this.scope2=null;this.editRange=null;this.parseErrors=[]}e.noEdits=function(r){return new e(t.NoEdits,r,null,null)};e.unknownEdits=function(r,i,s){var o=new e(t.Unknown,r.locationInfo.unitIndex,r,i);o.parseErrors=s;return o};e.singleScopeEdits=function(r,i,s,o,u,a){var f=new e(t.EditsInsideSingleScope,r.locationInfo.unitIndex,r,i);f.scope1=s;f.scope2=o;f.editRange=u;f.parseErrors=a;return f};return e}();e.UpdateUnitResult=r;var i=function(){function e(e,t,n,r){this.unitIndex=e;this.minChar=t;this.limChar=n;this.message=r}return e}();e.ErrorEntry=i;e.defaultSettings=new e.CompilationSettings;var s=function(){function n(t,n,r){if(typeof n==="undefined"){n=new e.NullLogger}if(typeof r==="undefined"){r=e.defaultSettings}this.errorOutput=t;this.logger=n;this.settings=r;this.parser=new e.Parser;this.typeFlow=null;this.scripts=new e.ASTList;this.units=new Array;this.errorReporter=new e.ErrorReporter(this.errorOutput);this.persistentTypeState=new e.PersistentGlobalTypeState(this.errorReporter);this.errorReporter.parser=this.parser;this.initTypeChecker(this.errorOutput);this.parser.style_requireSemi=this.settings.styleSettings.requireSemi;this.parser.style_funcInLoop=this.settings.styleSettings.funcInLoop;this.parser.inferPropertiesFromThisAssignment=this.settings.inferPropertiesFromThisAssignment;this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany};e.codeGenTarget=r.codeGenTarget}n.prototype.timeFunction=function(t,n){return e.timeFunction(this.logger,t,n)};n.prototype.initTypeChecker=function(t){this.persistentTypeState.refreshPersistentState();this.typeChecker=new e.TypeChecker(this.persistentTypeState);this.typeChecker.errorReporter=this.errorReporter;this.typeChecker.checkControlFlow=this.settings.controlFlow;this.typeChecker.checkControlFlowUseDef=this.settings.controlFlowUseDef;this.typeChecker.printControlFlowGraph=this.settings.printControlFlow;this.typeChecker.errorsOnWith=this.settings.errorOnWith;this.typeChecker.styleSettings=this.settings.styleSettings;this.typeChecker.canCallDefinitionSignature=this.settings.canCallDefinitionSignature;this.errorReporter.checker=this.typeChecker;this.setErrorOutput(this.errorOutput)};n.prototype.setErrorOutput=function(e){this.errorOutput=e;this.errorReporter.setErrOut(e);this.parser.outfile=e};n.prototype.emitCommentsToOutput=function(){this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany}};n.prototype.setErrorCallback=function(e){this.parser.errorCallback=e};n.prototype.updateUnit=function(t,n,r){return this.updateSourceUnit(new e.StringSourceText(t),n,r)};n.prototype.updateSourceUnit=function(e,t,n){var r=this;return this.timeFunction("updateSourceUnit("+t+")",function(){var i=r.partialUpdateUnit(e,t,n);return r.applyUpdateResult(i)})};n.prototype.applyUpdateResult=function(n){switch(n.kind){case t.NoEdits:{return false};case t.Unknown:{this.scripts.members[n.unitIndex]=n.script2;this.units[n.unitIndex]=n.script2.locationInfo;for(var r=0,i=n.parseErrors.length;r<i;r++){var s=n.parseErrors[r];if(this.parser.errorCallback){this.parser.errorCallback(s.minChar,s.limChar-s.minChar,s.message,s.unitIndex)}}return true};case t.EditsInsideSingleScope:{(new e.IncrementalParser(this.logger)).mergeTrees(n);return true}}};n.prototype.partialUpdateUnit=function(e,t,n){var s=this;return this.timeFunction("partialUpdateUnit("+t+")",function(){for(var o=0,u=s.units.length;o<u;o++){if(s.units[o].filename==t){if(s.scripts.members[o].isResident){return r.noEdits(o)}if(n){s.parser.setErrorRecovery(null)}var a;var f=[];var l=function(e,t,n,r){f.push(new i(r,e,e+t,n))};var c=s.parser.errorCallback;if(c){s.parser.errorCallback=l}var h=s.scripts.members[o];var p=s.parser.parse(e,t,o);if(c){s.parser.errorCallback=c}a=r.unknownEdits(h,p,f);return a}}throw new Error('Unknown file "'+t+'"')})};n.prototype.addUnit=function(t,n,r,i){if(typeof r==="undefined"){r=false}if(typeof i==="undefined"){i=[]}return this.addSourceUnit(new e.StringSourceText(t),n,r,i)};n.prototype.addSourceUnit=function(t,n,r,i){if(typeof i==="undefined"){i=[]}var s=this;return this.timeFunction("addSourceUnit("+n+", "+r+")",function(){var o=s.parser.parse(t,n,s.units.length,e.AllowedElements.Global);o.referencedFiles=i;o.isResident=r;s.persistentTypeState.setCollectionMode(r?e.TypeCheckCollectionMode.Resident:e.TypeCheckCollectionMode.Transient);var u=s.units.length;s.units[u]=o.locationInfo;s.typeChecker.collectTypes(o);s.scripts.append(o);return o})};n.prototype.parseUnit=function(t,n){return this.parseSourceUnit(new e.StringSourceText(t),n)};n.prototype.parseSourceUnit=function(e,t){this.parser.setErrorRecovery(this.errorOutput);var n=this.parser.parse(e,t,0);var r=this.units.length;this.units[r]=n.locationInfo;this.typeChecker.collectTypes(n);this.scripts.append(n)};n.prototype.typeCheck=function(){var t=this;return this.timeFunction("typeCheck()",function(){var n=new e.Binder(t.typeChecker);t.typeChecker.units=t.units;n.bind(t.typeChecker.globalScope,t.typeChecker.globals);n.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobals);n.bind(t.typeChecker.globalScope,t.typeChecker.globalTypes);n.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobalTypes);t.typeFlow=new e.TypeFlow(t.logger,t.typeChecker.globalScope,t.parser,t.typeChecker);var r=0;var i=null;var s=t.scripts.members.length;t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Resident);for(r=0;r<s;r++){i=t.scripts.members[r];if(!i.isResident||i.hasBeenTypeChecked){continue}t.typeFlow.assignScopes(i);t.typeFlow.initLibs()}for(r=0;r<s;r++){i=t.scripts.members[r];if(!i.isResident||i.hasBeenTypeChecked){continue}t.typeFlow.typeCheck(i);i.hasBeenTypeChecked=true}t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Transient);s=t.scripts.members.length;for(r=0;r<s;r++){i=t.scripts.members[r];if(i.isResident){continue}t.typeFlow.assignScopes(i);t.typeFlow.initLibs()}for(r=0;r<s;r++){i=t.scripts.members[r];if(i.isResident){continue}t.typeFlow.typeCheck(i)}return null})};n.prototype.cleanASTTypesForReTypeCheck=function(t){function n(t,n){t.type=null;if(t.nodeType==e.NodeType.VarDecl){var r=t;r.sym=null}else{if(t.nodeType==e.NodeType.ArgDecl){var i=t;i.sym=null}else{if(t.nodeType==e.NodeType.Name){var s=t;s.sym=null}else{if(t.nodeType==e.NodeType.FuncDecl){var o=t;o.signature=null;o.freeVariables=new Array;o.symbols=null;o.accessorSymbol=null;o.scopeType=null}else{if(t.nodeType==e.NodeType.ModuleDeclaration){var u=t;u.mod=null}else{if(t.nodeType==e.NodeType.With){t.withSym=null}else{if(t.nodeType==e.NodeType.Catch){t.containedScope=null}}}}}}}return t}e.getAstWalkerFactory().walk(t,n)};n.prototype.cleanTypesForReTypeCheck=function(){var e=this;return this.timeFunction("cleanTypesForReTypeCheck()",function(){for(var t=0,n=e.scripts.members.length;t<n;t++){var r=e.scripts.members[t];if(r.isResident){continue}e.cleanASTTypesForReTypeCheck(r);e.typeChecker.collectTypes(r)}return null})};n.prototype.attemptIncrementalTypeCheck=function(e){return this.timeFunction("attemptIncrementalTypeCheck()",function(){return false})};n.prototype.reTypeCheck=function(){var t=this;return this.timeFunction("reTypeCheck()",function(){e.CompilerDiagnostics.analysisPass++;t.initTypeChecker(t.errorOutput);t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Transient);t.cleanTypesForReTypeCheck();return t.typeCheck()})};n.prototype.emitDeclarationFile=function(t){if(!this.settings.generateDeclarationFiles){return}if(this.errorReporter.hasErrors){return}var n=new e.DeclarationEmitter(this.typeChecker,this.emitSettings);var r=null;for(var i=0,s=this.scripts.members.length;i<s;i++){var o=this.scripts.members[i];if(o.isDeclareFile||o.isResident||o.bod==null){continue}if(this.emitSettings.outputMany){var u=this.units[i].filename;var a=e.getDeclareFilePath(u);r=t(a,this.outputScriptToUTF8(o));n.setDeclarationFile(r)}else{if(r==null){var f=e.getDeclareFilePath(this.settings.outputFileName);r=t(f,this.outputScriptsToUTF8(this.scripts.members));n.setDeclarationFile(r)}}n.emitDeclarations(o);if(this.emitSettings.outputMany){r.Close()}}if(!this.emitSettings.outputMany&&r){r.Close()}};n.prototype.emit=function(t){var n=null;this.emitSettings.createFile=t;var r=null;for(var i=0,s=this.scripts.members.length;i<s;i++){var o=this.scripts.members[i];if(!o.emitRequired()){continue}if(this.emitSettings.outputMany){var u=this.units[i].filename;var a=u.split(".");a.pop();var f=a.join(".");var l=f+".js";this.emitSettings.path=l;var c=this.outputScriptToUTF8(o);r=t(l,c);n=new e.Emitter(this.typeChecker,r,this.emitSettings);if(this.settings.mapSourceFiles){n.setSourceMappings(new e.SourceMapper(u,l,r,t(l+e.SourceMapper.MapFileExtension)))}}else{if(n==null){var c=this.outputScriptsToUTF8(this.scripts.members);r=t(this.settings.outputFileName,c);n=new e.Emitter(this.typeChecker,r,this.emitSettings);if(this.settings.mapSourceFiles){n.setSourceMappings(new e.SourceMapper(o.locationInfo.filename,this.settings.outputFileName,r,t(this.settings.outputFileName+e.SourceMapper.MapFileExtension)))}}else{if(this.settings.mapSourceFiles){n.setSourceMappings(new e.SourceMapper(o.locationInfo.filename,this.settings.outputFileName,r,n.sourceMapper.sourceMapOut))}}}this.typeChecker.locationInfo=o.locationInfo;n.emitJavascript(o,e.TokenID.Comma,false);if(this.emitSettings.outputMany){if(this.settings.mapSourceFiles){n.emitSourceMappings()}r.Close()}}if(!this.emitSettings.outputMany){if(this.settings.mapSourceFiles){n.emitSourceMappings()}r.Close()}};n.prototype.emitToOutfile=function(t){var n=null;if(this.settings.mapSourceFiles){throw Error("Cannot generate source map")}if(this.settings.generateDeclarationFiles){throw Error("Cannot generate declaration files")}for(var r=0,i=this.scripts.members.length;r<i;r++){if(n==null){n=new e.Emitter(this.typeChecker,t,this.emitSettings)}var s=this.scripts.members[r];this.typeChecker.locationInfo=s.locationInfo;n.emitJavascript(s,e.TokenID.Comma,false)}};n.prototype.emitAST=function(t,n){var r=null;var i=null;for(var s=0,o=this.scripts.members.length;s<o;s++){var u=this.scripts.members[s];if(t){var a=this.units[s].filename;var f=a.split(".");f.pop();var l=f.join(".");var c=l+".txt";this.emitSettings.path=c;r=n(c,this.outputScriptToUTF8(u));i=new e.PrintContext(r,this.parser)}else{if(i==null){r=n(this.settings.outputFileName,this.outputScriptsToUTF8(this.scripts.members));i=new e.PrintContext(r,this.parser)}}e.getAstWalkerFactory().walk(u,e.prePrintAST,e.postPrintAST,null,i);if(t){r.Close()}}if(!t){r.Close()}};n.prototype.outputScriptToUTF8=function(e){return e.containsUnicodeChar||this.emitSettings.emitComments&&e.containsUnicodeCharInComment};n.prototype.outputScriptsToUTF8=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(this.outputScriptToUTF8(r)){return true}}return false};return n}();e.TypeScriptCompiler=s;var o=function(){function e(e,t,n){this.name=e;this.type=t;this.sym=n}return e}();e.ScopeEntry=o;var u=function(){function t(e){this.compiler=e}t.prototype.getScope=function(e){if(e.enclosingObjectLit&&e.isMemberCompletion){return e.getObjectLiteralScope()}else{if(e.isMemberCompletion){if(e.useFullAst){return this.compiler.typeFlow.findMemberScopeAtFullAst(e)}else{return this.compiler.typeFlow.findMemberScopeAt(e)}}else{return e.getScope()}}};t.prototype.getScopeEntries=function(t){var n=this.getScope(t);if(n==null){return[]}var r=new e.StringHashTable;var i=n.getAllSymbolNames(t.isMemberCompletion);for(var s=0;s<i.length;s++){var o=i[s];if(o==e.globalId||o=="_Core"||o=="_element"){continue}r.add(o,"")}var u=this.compiler.typeChecker.currentModDecl;this.compiler.typeChecker.currentModDecl=t.deepestModuleDecl;var a=this.getTypeNamesForNames(t,r.getAllKeys(),n);this.compiler.typeChecker.currentModDecl=u;return a};t.prototype.getTypeNamesForNames=function(t,n,r){var i=[];var s=t.getScope();for(var u=0;u<n.length;u++){var a=n[u];var f=t.publicsOnly&&t.isMemberCompletion;var l=r.find(a,f,false);if(l==null){l=r.find(a,f,true)}var c=l&&l.flags&e.SymbolFlags.Private?l.container==r.container:true;if(l){if(c&&!e.isQuoted(l.name)&&!e.isRelative(l.name)){var h=l.getType().getScopedTypeName(s);i.push(new o(a,h,l))}}else{if(a=="true"||a=="false"){i.push(new o(a,"bool",this.compiler.typeChecker.booleanType.symbol))}}}return i};return t}();e.ScopeTraversal=u})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(e,t,n){var r=+(new Date);var i=n();var s=+(new Date);e.log(t+" completed in "+(s-r)+" msec");return i}function o(e,t){var n="";var r=function(t){var r=e.charCodeAt(t);switch(r){case 9:{n+="\\t";break};case 10:{n+="\\n";break};case 11:{n+="\\v";break};case 12:{n+="\\f";break};case 13:{n+="\\r";break};case 34:{n+='\\"';break};case 39:{n+="\\'";break};case 92:{n+="\\";break};default:{n+=e.charAt(t)}}};var i=e.length>t;if(i){var s=t>>1;for(var o=0;o<s;o++){r(o)}n+="(...)";for(var o=e.length-s;o<e.length;o++){r(o)}}else{t=e.length;for(var o=0;o<t;o++){r(o)}}return n}(function(e){function t(t){if(e.diagnosticWriter){e.diagnosticWriter.Alert(t)}}function n(n){if(e.debug){t(n)}}function r(n,r){if(e.debug){if(!n){t(r)}}}e.debug=false;e.diagnosticWriter=null;e.analysisPass=0;e.Alert=t;e.debugPrint=n;e.assert=r})(e.CompilerDiagnostics||(e.CompilerDiagnostics={}));var t=e.CompilerDiagnostics;var n=function(){function e(){}e.prototype.information=function(){return false};e.prototype.debug=function(){return false};e.prototype.warning=function(){return false};e.prototype.error=function(){return false};e.prototype.fatal=function(){return false};e.prototype.log=function(e){};return e}();e.NullLogger=n;var r=function(){function e(e){this.logger=e;this._information=this.logger.information();this._debug=this.logger.debug();this._warning=this.logger.warning();this._error=this.logger.error();this._fatal=this.logger.fatal()}e.prototype.information=function(){return this._information};e.prototype.debug=function(){return this._debug};e.prototype.warning=function(){return this._warning};e.prototype.error=function(){return this._error};e.prototype.fatal=function(){return this._fatal};e.prototype.log=function(e){this.logger.log(e)};return e}();e.LoggerAdapter=r;var i=function(){function e(){this.logContents=[]}e.prototype.information=function(){return false};e.prototype.debug=function(){return false};e.prototype.warning=function(){return false};e.prototype.error=function(){return false};e.prototype.fatal=function(){return false};e.prototype.log=function(e){this.logContents.push(e)};return e}();e.BufferedLogger=i;e.timeFunction=s;e.stringToLiteral=o})(TypeScript||(TypeScript={}));

// ################################################
// CUSTOM CODE ADDED TO ADD ENTRY POINT INTO TS

//JSON Stringify/Parse
if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a&&typeof a==="object"&&typeof a.toJSON==="function"){a=a.toJSON(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();


function Buffer() {
    this.buffer = "";
}

Buffer.prototype = {
    Write: function(s) {
        this.buffer += s;
    },
    WriteLine: function(s) {
        this.buffer += s + "\n";
    },
    toString: function() {
        return this.buffer;
    },
    log: function(x) {

    },
    Close: function() {
    },
    toJSON: function() {
        return this.buffer;
    }
};

function compilify_ts(fileMapStr) {
    var fileMap = JSON.parse(fileMapStr);
    var convertedFileMap = { };

    function changeExtension(fname, ext) {
        var splitFname = fname.split(".");
        splitFname.pop();
        var baseName = splitFname.join(".");
        var outFname = baseName + "." + ext;
        return outFname;
    }

    function createFile(fileName) {
        var buffer = new Buffer();
        convertedFileMap[fileName] = buffer;
        return buffer;
    }

    var errors = new Buffer();
    var logger = new Buffer();
    var compiler = new TypeScript.TypeScriptCompiler(errors, logger);
    for (var fileName in fileMap) {
        if (fileMap.hasOwnProperty(fileName)) {
            compiler.addUnit(fileMap[fileName], fileName);
        }
    }
    compiler.typeCheck();
    compiler.emit(createFile);

    var convertedMapWithOriginalFileNames = { };
    for (var file in convertedFileMap) {
        convertedMapWithOriginalFileNames[changeExtension(file, "ts")] = convertedFileMap[file];
    }

    return JSON.stringify(convertedMapWithOriginalFileNames);
}